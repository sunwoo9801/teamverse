/*!
*  filename: ej2-richtexteditor.umd.min.js
*  version : 28.2.5
*  Copyright Syncfusion Inc. 2001 - 2024. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-navigations"),require("@syncfusion/ej2-splitbuttons"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-inputs"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-dropdowns"),require("@syncfusion/ej2-filemanager")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-navigations","@syncfusion/ej2-splitbuttons","@syncfusion/ej2-popups","@syncfusion/ej2-inputs","@syncfusion/ej2-buttons","@syncfusion/ej2-dropdowns","@syncfusion/ej2-filemanager"],t):t((e=e||self).ej={},e.ej2Base,e.ej2Navigations,e.ej2Splitbuttons,e.ej2Popups,e.ej2Inputs,e.ej2Buttons,e.ej2Dropdowns,e.ej2Filemanager)}(this,function(m,j,R,A,I,U,P,H,z){"use strict";var _="tableclass",V="load",Q="initial-load",W="content-changed",n="initial-end",K="iframe-click",o="destroy",G="toolbarClick",X="toolbar-refresh",Y="refresh-begin",J="toolbar-updated",$="bind-on-end",Z="html-toolbar-click",ee="markdown-toolbar-click",te="model-changed",ne="tableModulekeyUp",ie="keyUp",h="keyDown",oe="onImport",re="onExport",se="mouseUp",ae="toolbarCreated",le="toolbarRenderComplete",de="enableFullScreen",ce="disableFullScreen",pe="dropDownSelect",he="beforeDropDownItemRender",ue="execCommandCallBack",me="image-toolbar-action",ge="audio-toolbar-action",fe="video-toolbar-action",be="link-toolbar-action",ve="resize",ye="resizeStart",Ce="resizing",Ne="resizeStop",Ee="insertLink",Se="unLink",Te="editLink",Oe="openLink",Le="actionBegin",ke="actionComplete",we="updatedToolbarStatus",xe="updateToolbarItem",De="insertImage",Me="insertAudio",Be="insertVideo",Re="insertCompleted",Ae="insertImgLink",Ie="imgAltText",Ue="delete",Pe="delete",He="delete",je="caption",Fe="imageSize",qe="videoSize",ze="sourceCode",_e="updateSource",Ve="beforeDropDownOpen",Qe="selection-save",We="selection-restore",Ke="count",Ge="mouseDown",Xe="sourceCodeMouseDown",Ye="editAreaClick",Je="scroll",$e="contentscroll",Ze="colorPickerChanged",et="tableColorPickerChanged",tt="focusChange",nt="selectAll",it="selectRange",ot="getSelectedHtml",rt="renderInlineToolbar",st="paste-content",at="rtl-mode",lt="createTable",dt="docClick",ct="table-toolbar-action",pt="checkUndoStack",ht="readOnlyMode",ut="pasteClean",mt="enterHandler",gt="beforeDialogOpen",ft="clearDialogObj",bt="dialogOpen",vt="beforeDialogClose",yt="dialogClose",Ct="beforeQuickToolbarOpen",Nt="quickToolbarOpen",Et="quickToolbarClose",St="imageSelected",Tt="imageUploading",Ot="imageUploadSuccess",Lt="imageUploadFailed",kt="imageRemoving",wt="fileSelected",xt="fileUploading",Dt="fileUploadSuccess",Mt="fileUploadFailed",Bt="fileRemoving",Rt="afterImageDelete",At="afterMediaDelete",It="drop",Ut="renderQuickToolbar",Pt="xhtmlValidation",Ht="beforeImageUpload",jt="beforeFileUpload",Ft="resizeInitialized",qt="renderFileManager",zt="beforeImageDrop",_t="dynamicModule",Vt="beforePasteCleanup",Qt="afterPasteCleanup",Wt="updateTbItemsStatus",Kt="showLinkDialog",Gt="closeLinkDialog",Xt="showImageDialog",Yt="showAudioDialog",Jt="showVideoDialog",$t="closeImageDialog",Zt="closeAudioDialog",en="closeVideoDialog",tn="showTableDialog",nn="closeTableDialog",on="bindCssClass",rn="formatPainterClick",sn="formatPainterDoubleClick",an="emojiPicker",ln="destroyTooltip",dn="hidePopup",cn="cleanupResizeElements",pn="afterKeyDown",hn="updateValueOnIdle",un="documentClickClosedBy",mn="showColorPicker",gn="closeTooltip",fn="autoResize",bn="address:empty, article:empty, aside:empty, blockquote:empty,\n details:empty, dd:empty, div:empty, dl:empty, dt:empty, fieldset:empty, footer:empty,form:empty, h1:empty,\n h2:empty, h3:empty, h4:empty, h5:empty, h6:empty, header:empty, hgroup:empty, li:empty, main:empty, nav:empty,\n noscript:empty, output:empty, p:empty, pre:empty, section:empty, td:empty, th:empty",vn="a:empty, abbr:empty, acronym:empty, b:empty, bdi:empty, bdo:empty, big:empty, button:empty,\ncanvas:empty, cite:empty, code:empty, data:empty, datalist:empty, del:empty, dfn:empty, em:empty, font:empty, i:empty, iframe:empty,\nins:empty, kbd:empty, label:empty, map:empty, mark:empty, meter:empty, noscript:empty, object:empty, output:empty, picture:empty, progress:empty,\nq:empty, ruby:empty, s:empty, samp:empty, script:empty, select:empty, slot:empty, small:empty, span:empty, strong:empty, strike:empty, sub:empty, sup:empty, svg:empty,\ntemplate:empty, textarea:empty, time:empty, u:empty, tt:empty, var:empty, wbr:empty",yn=["px","em","rem","pt","cm","mm","in","pc","vw","vh","vmin","vmax"],Cn={px:{px:1,em:.0625,rem:.0625,pt:.75,cm:.0264583,mm:.0026458,in:.0104167,pc:.0625,vw:.00625,vh:.00625,vmin:.00625,vmax:.00625},em:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},rem:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},pt:{px:1.33333,em:.0833333,rem:.0833333,pt:1,cm:.0352778,mm:.0035278,in:.0138889,pc:.0416667,vw:.00416667,vh:.00416667,vmin:.00416667,vmax:.00416667},cm:{px:37.7953,em:2.3622,rem:2.3622,pt:28.3465,cm:1,mm:.1,in:.393701,pc:.148148,vw:.0377953,vh:.0377953,vmin:.0377953,vmax:.0377953},mm:{px:3.77953,em:.23622,rem:.23622,pt:2.83465,cm:10,mm:1,in:.0393701,pc:.0148148,vw:.00377953,vh:.00377953,vmin:.00377953,vmax:.00377953},in:{px:96,em:6,rem:6,pt:72,cm:2.54,mm:25.4,in:1,pc:.375,vw:.09375,vh:.09375,vmin:.09375,vmax:.09375},pc:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:1,vw:.0625,vh:.0625,vmin:.0625,vmax:.0625},vw:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vh:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmin:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmax:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1}},Nn="onHandleFontsizeChange",En="preventQuickToolbarClose",Sn="e-richtexteditor",Tn="e-rtl",On="e-disabled",Ln="rte-iframe-script-sheet",kn="rte-iframe-style-sheet",wn="e-rte-container",xn="e-rte-toolbar",Dn="e-rte-tb-fixed",Mn="e-rte-tb-float",Bn="e-rte-inline",Rn="e-rte-tb-expand",An="e-rte-full-screen",In="e-rte-quick-toolbar",Un="e-rte-text-quicktoolbar",Pn="e-rte-pop",Hn="e-tb-static",jn="e-rte-quick-popup",Fn="e-quick-dropdown",qn="e-rte-image-popup",zn="e-rte-text-popup",_n="e-rte-inline-popup",Vn="e-rte-inline-dropdown",Qn="e-rte-dropdown-popup",Wn="e-rte-dropdown-icons",Kn="e-rte-dropdown-items",Gn="e-rte-dropdown-btn",Xn="e-rte-content",Yn="e-toolbar-item",Jn="e-toolbar-wrapper",$n="e-show",Zn="e-hide",ei="e-visible",ti="e-focused",ni="e-remove-white-space",ii="e-imgright",oi="e-imgleft",ri="e-imgcenter",si="e-imgbreak",ai="e-audio-break",li="e-clickelem",di="e-video-clickelem",ci="e-audio-wrap",pi="e-video-wrap",hi="e-video-break",ui="e-img-caption",mi="e-rte-img-caption",gi="e-caption-inline",fi="e-imginline",bi="e-audio-inline",vi="e-video-inline",yi="e-rte-character-count",Ci="e-warning",Ni="e-error",Ei="e-icons",Si="e-active",Ti="e-expand-open",Oi="e-rte-elements",Li="e-tbar-btn",ki="e-rte-horizontal-separator",wi="e-tbar-ios-fixed",xi="e-rte-list-primary-content",Di="e-rte-numberformatlist-dropdown",Mi="e-rte-bulletformatlist-dropdown",Bi="e-formats-tbar-btn",Ri="e-font-name-tbar-btn",Ai="e-font-size-tbar-btn",Ii="e-alignment-tbar-btn",Ui="e-rte-fontcolor-element",Pi="e-rte-backgroundcolor-element",Hi="e-rte-color-content",ji="e-rte-fontcolor-dropdown",Fi="e-rte-backgroundcolor-dropdown",qi="e-rte-square-palette",zi="e-rte-fontcolor-colorpicker",_i="e-rte-backgroundcolor-colorpicker",Vi="e-rte-readonly",Qi="e-cell-select",Wi="e-cell-select-end",Ki="e-multi-cells-select",Gi="e-dashed-border",Xi="e-alternate-border",Yi="e-column-resize",Ji="e-row-resize",$i="e-table-box",Zi="e-rte-hidden",eo="e-rte-keepformat",to="e-rte-removeformat",no="e-rte-plainformat",io="e-rte-pasteok",oo="e-rte-pastecancel",ro="e-rte-dialog-minheight",so="e-resize-handle",ao="e-south-east",lo="e-rte-image",co="e-resize",po="e-img-focus",ho="e-audio-focus",uo="e-video-focus",mo="e-rte-drag-image",go="e-rte-upload-popup",fo="e-popup-open",bo="e-img-resize",vo="e-droparea",yo="e-img-inner",Co="e-upload-files",No="e-rte-dialog-upload",Eo="e-rte-resize",So="e-custom-tile",To="e-nocolor-item",Oo="e-rte-table-border",Lo="e-rte-table-resize",ko="e-rte-fixed-tb-expand",wo="e-rte-toolbar-enabled",xo="e-south-west",Do="e-rte-srctextarea",Mo=["Enter","ArrowRight","ArrowLeft"],Bo=((e=m.RenderType||(m.RenderType={}))[e.Toolbar=0]="Toolbar",e[e.Content=1]="Content",e[e.Popup=2]="Popup",e[e.LinkToolbar=3]="LinkToolbar",e[e.TextToolbar=4]="TextToolbar",e[e.ImageToolbar=5]="ImageToolbar",e[e.AudioToolbar=6]="AudioToolbar",e[e.VideoToolbar=7]="VideoToolbar",e[e.InlineToolbar=8]="InlineToolbar",e[e.TableToolbar=9]="TableToolbar",(e=m.ToolbarType||(m.ToolbarType={})).Expand="Expand",e.MultiRow="MultiRow",e.Scrollable="Scrollable",(e=m.DialogType||(m.DialogType={})).InsertLink="InsertLink",e.InsertImage="InsertImage",e.InsertAudio="InsertAudio",e.InsertVideo="InsertVideo",e.InsertTable="InsertTable",(e=m.ImageInputSource||(m.ImageInputSource={})).Uploaded="Uploaded",e.Dropped="Dropped",e.Pasted="Pasted",["alignments","formats","fontname","fontsize","fontcolor","backgroundcolor","align","display","audiolayoutoption","videolayoutoption","videoalign","tablerows","tablecolumns","tablecell","tablecellhorizontalalign","tablecellverticalalign","styles","numberformatlist","bulletformatlist"]),Ro={alignments:{id:"Alignments",icon:"e-alignments",tooltip:"Alignments",command:"Alignments",subCommand:"Alignments"},justifyleft:{id:"JustifyLeft",icon:"e-justify-left",tooltip:"JustifyLeft",command:"Alignments",subCommand:"JustifyLeft"},justifycenter:{id:"JustifyCenter",icon:"e-justify-center",tooltip:"JustifyCenter",command:"Alignments",subCommand:"JustifyCenter"},justifyright:{id:"JustifyRight",icon:"e-justify-right",tooltip:"JustifyRight",command:"Alignments",subCommand:"JustifyRight"},justifyfull:{id:"JustifyFull",icon:"e-justify-full",tooltip:"JustifyFull",command:"Alignments",subCommand:"JustifyFull"},fontname:{id:"FontName",icon:"e-font-name",tooltip:"Font Name",command:"Font",subCommand:"FontName"},fontsize:{id:"FontSize",icon:"e-font-size",tooltip:"Font Size",command:"Font",subCommand:"FontSize"},fontcolor:{id:"FontColor",icon:"e-rte-font-color",tooltip:"Font Color",command:"Font",subCommand:"FontColor",value:"#ff0000ff"},backgroundcolor:{id:"BackgroundColor",icon:"e-background-color",tooltip:"Background Color",command:"Font",subCommand:"BackgroundColor",value:"#ffff00ff"},importword:{id:"ImportWord",icon:"e-rte-import-doc",tooltip:"Import from Word",command:"Import",subCommand:"ImportWord"},exportword:{id:"ExportWord",icon:"e-rte-export-doc",tooltip:"Export to Word",command:"Export",subCommand:"ExportWord"},exportpdf:{id:"ExportPdf",icon:"e-rte-export-pdf",tooltip:"Export to PDF",command:"Export",subCommand:"ExportPdf"},bold:{id:"Bold",icon:"e-bold",tooltip:"Bold",command:"Style",subCommand:"Bold"},italic:{id:"Italic",icon:"e-italic",tooltip:"Italic",command:"Style",subCommand:"Italic"},underline:{id:"Underline",icon:"e-underline",tooltip:"Underline",command:"Style",subCommand:"Underline"},strikethrough:{id:"StrikeThrough",icon:"e-strike-through",tooltip:"StrikeThrough",command:"Style",subCommand:"StrikeThrough"},clearformat:{id:"ClearFormat",icon:"e-clear-format",tooltip:"Clear Format",command:"Clear",subCommand:"ClearFormat"},clearall:{id:"ClearAll",icon:"e-clear-all",tooltip:"Clear All",command:"Clear",subCommand:"ClearAll"},cut:{id:"Cut",icon:"e-cut",tooltip:"Cut",command:"ClipBoard",subCommand:"Cut"},copy:{id:"Copy",icon:"e-copy",tooltip:"Copy",command:"ClipBoard",subCommand:"Copy"},paste:{id:"Paste",icon:"e-paste",tooltip:"Paste",command:"ClipBoard",subCommand:"Paste"},unorderedlist:{id:"UnorderedList",icon:"e-unorder-list",tooltip:"Bulleted List",command:"Lists",subCommand:"UL"},orderedlist:{id:"OrderedList",icon:"e-order-list",tooltip:"Numbered List",command:"Lists",subCommand:"OL"},numberformatlist:{id:"NumberFormatList",icon:"e-order-list",tooltip:"Number Format List",command:"NumberFormatList",subCommand:"NumberFormatList"},bulletformatlist:{id:"BulletFormatList",icon:"e-unorder-list",tooltip:"Bullet Format List",command:"BulletFormatList",subCommand:"BulletFormatList"},indent:{id:"Indent",icon:"e-indent",tooltip:"Increase Indent",command:"Indents",subCommand:"Indent"},outdent:{id:"Outdent",icon:"e-outdent",tooltip:"Decrease Indent",command:"Indents",subCommand:"Outdent"},undo:{id:"Undo",icon:"e-undo",tooltip:"Undo",command:"Actions",subCommand:"Undo"},redo:{id:"Redo",icon:"e-redo",tooltip:"Redo",command:"Actions",subCommand:"Redo"},superscript:{id:"SuperScript",icon:"e-super-script",tooltip:"Superscript",command:"Effects",subCommand:"SuperScript"},subscript:{id:"SubScript",icon:"e-sub-script",tooltip:"Subscript",command:"Effects",subCommand:"SubScript"},createlink:{id:"CreateLink",icon:"e-create-link",tooltip:"Insert Hyperlink",command:"Links",subCommand:"CreateLink"},openlink:{id:"OpenLink",icon:"e-open-link",tooltip:"Open Link",command:"Links",subCommand:"OpenLink"},editlink:{id:"EditLink",icon:"e-edit-link",tooltip:"Edit Link",command:"Links",subCommand:"EditLink"},removelink:{id:"RemoveLink",icon:"e-remove-link",tooltip:"Remove Link",command:"Links",subCommand:"RemoveLink"},image:{id:"Image",icon:"e-image",tooltip:"Insert Image",command:"Images",subCommand:"Image"},audio:{id:"Audio",icon:"e-audio",tooltip:"Insert Audio",command:"Audios",subCommand:"Audio"},video:{id:"Video",icon:"e-video",tooltip:"Insert Video",command:"Videos",subCommand:"Video"},filemanager:{id:"FileManager",icon:"e-rte-file-manager",tooltip:"File Manager",command:"Files",subCommand:"File"},createtable:{id:"CreateTable",icon:"e-create-table",tooltip:"Create Table",command:"Table",subCommand:"CreateTable"},removetable:{id:"removeTable",icon:"e-remove-table",tooltip:"Remove Table",command:"removeTable",subCommand:"removeTable"},replace:{id:"Replace",icon:"e-replace",tooltip:"Replace",command:"Images",subCommand:"Replace"},audioreplace:{id:"AudioReplace",icon:"e-audio-replace",tooltip:"Audio Replace",command:"Audios",subCommand:"AudioReplace"},audioremove:{id:"AudioRemove",icon:"e-audio-remove",tooltip:"Audio Remove",command:"Audios",subCommand:"AudioRemove"},audiolayoutoption:{id:"AudioLayoutOption",icon:"e-audio-display",tooltip:"Audio LayoutOption",command:"Audios",subCommand:"AudioLayoutOption"},videoreplace:{id:"VideoReplace",icon:"e-video-replace",tooltip:"Video Replace",command:"Videos",subCommand:"VideoReplace"},videoalign:{id:"VideoAlign",icon:"e-video-align",tooltip:"Video Align",command:"Videos",subCommand:"VideoAlign"},videoremove:{id:"VideoRemove",icon:"e-video-remove",tooltip:"Video Remove",command:"Videos",subCommand:"VideoRemove"},videolayoutoption:{id:"VideoLayoutOption",icon:"e-video-display",tooltip:"Video LayoutOption",command:"Videos",subCommand:"VideoLayoutOption"},videodimension:{id:"VideoDimension",icon:"e-video-dimension",tooltip:"Video Dimension",command:"Videos",subCommand:"VideoDimension"},align:{id:"Align",icon:"e-align",tooltip:"Align",command:"Images",subCommand:"Align"},caption:{id:"Caption",icon:"e-caption",tooltip:"Image Caption",command:"Images",subCommand:"Caption"},remove:{id:"Remove",icon:"e-remove",tooltip:"Remove",command:"Images",subCommand:"Remove"},openimagelink:{id:"OpenImageLink",icon:"e-open-link",tooltip:"Open Link",command:"Images",subCommand:"OpenImageLink"},editimagelink:{id:"EditImageLink",icon:"e-edit-link",tooltip:"Edit Link",command:"Images",subCommand:"EditImageLink"},removeimagelink:{id:"RemoveImageLink",icon:"e-remove-link",tooltip:"Remove Link",command:"Images",subCommand:"RemoveImageLink"},insertlink:{id:"InsertLink",icon:"e-insert-link",tooltip:"Insert Link",command:"Images",subCommand:"InsertLink"},display:{id:"Display",icon:"e-display",tooltip:"Display",command:"Images",subCommand:"Display"},alttext:{id:"AltText",icon:"e-alt-text",tooltip:"Alternative Text",command:"Images",subCommand:"AltText"},dimension:{id:"Dimension",icon:"e-img-dimension",tooltip:"Change Size",command:"Images",subCommand:"Dimension"},fullscreen:{id:"Maximize",icon:"e-maximize",tooltip:"Maximize",command:"View",subCommand:"Maximize"},maximize:{id:"Maximize",icon:"e-maximize",tooltip:"Maximize",command:"FullScreen",subCommand:"Maximize"},minimize:{id:"Minimize",icon:"e-minimize",tooltip:"Minimize",command:"FullScreen",subCommand:"Minimize"},lowercase:{id:"LowerCase",icon:"e-lower-case",tooltip:"Lower Case",command:"Casing",subCommand:"LowerCase"},uppercase:{id:"UpperCase",icon:"e-upper-case",tooltip:"Upper Case",command:"Casing",subCommand:"UpperCase"},print:{id:"Print",icon:"e-print",tooltip:"Print",command:"Print",subCommand:"Print"},formats:{id:"Formats",icon:"e-formats",tooltip:"Formats",command:"Formats",subCommand:"Formats"},sourcecode:{id:"SourceCode",icon:"e-source-code",tooltip:"Code View (Ctrl+Shift+H)",command:"SourceCode",subCommand:"SourceCode"},preview:{id:"Preview",icon:"e-preview",tooltip:"Preview (Ctrl+Shift+H)",command:"Preview",subCommand:"Preview"},viewside:{id:"ViewSide",icon:"e-view-side",tooltip:"ViewSide",command:"ViewSide",subCommand:"ViewSide"},insertcode:{id:"InsertCode",icon:"e-preformat-code",tooltip:"Insert Code",command:"Formats",subCommand:"Pre"},blockquote:{id:"Blockquote",icon:"e-blockquote",tooltip:"Blockquote",command:"Formats",subCommand:"blockquote"},tableheader:{id:"TableHeader",icon:"e-table-header",tooltip:"Table Header",command:"Table",subCommand:"TableHeader"},tableremove:{id:"TableRemove",icon:"e-table-remove",tooltip:"Table Remove",command:"Table",subCommand:"TableRemove"},tablerows:{id:"TableRows",icon:"e-table-rows",tooltip:"Table Rows",command:"Table",subCommand:"TableRows"},tablecolumns:{id:"TableColumns",icon:"e-table-columns",tooltip:"Table Columns",command:"Table",subCommand:"TableColumns"},tablecell:{id:"TableCell",icon:"e-table-cell",tooltip:"Table Cell",command:"Table",subCommand:"TableCell"},tablecellbackground:{id:"TableCellBackground",icon:"e-table-cell-background",tooltip:"Table Cell Background",command:"Table",subCommand:"TableCellBackground"},tablecellhorizontalalign:{id:"TableCellHorizontalAlign",icon:"e-table-cell-horizontalAlign",tooltip:"Table Cell HorizontalAlign",command:"Table",subCommand:"TableCellHorizontalAlign"},tablecellverticalalign:{id:"TableCellVerticalAlign",icon:"e-table-cell-verticalAlign",tooltip:"Table Cell VerticalAlign",command:"Table",subCommand:"TableCellVerticalAlign"},tableeditproperties:{id:"TableEditProperties",icon:"e-table-edit-properties",tooltip:"Table Edit Properties",command:"Table",subCommand:"TableEditProperties"},styles:{id:"Styles",icon:"e-table-styles",tooltip:"Styles",command:"Table",subCommand:"Styles"},formatpainter:{id:"FormatPainter",icon:"e-rte-format-painter",tooltip:"Format Painter",command:"FormatPainter",subCommand:"FormatPainter"},emojipicker:{id:"EmojiPicker",icon:"e-emoji",tooltip:"Emoji Icon",command:"EmojiPicker",subCommand:"EmojiPicker"},inlinecode:{id:"inlineCode",icon:"e-inline-code",tooltip:"inlineCode",command:"Style",subCommand:"InlineCode"}},Ao=[{locale:"alignmentsDropDownLeft",value:"JustifyLeft"},{locale:"alignmentsDropDownCenter",value:"JustifyCenter"},{locale:"alignmentsDropDownRight",value:"JustifyRight"},{locale:"alignmentsDropDownJustify",value:"JustifyFull"}],Io=[{iconCss:"e-icons e-justify-left",text:"Align Left",command:"Alignments",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",text:"Align Center",command:"Alignments",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",text:"Align Right",command:"Alignments",subCommand:"JustifyRight"},{iconCss:"e-icons e-justify-full",text:"Align Justify",command:"Alignments",subCommand:"JustifyFull"}],Uo=[{iconCss:"e-icons e-justify-left",command:"Images",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",command:"Images",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",command:"Images",subCommand:"JustifyRight"}],Po=[{iconCss:"e-icons e-justify-left",command:"Videos",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",command:"Videos",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",command:"Videos",subCommand:"JustifyRight"}],Ho=[{locale:"imageDisplayDropDownInline",value:"Inline"},{locale:"imageDisplayDropDownBreak",value:"Break"}],jo=[{locale:"audioLayoutOptionDropDownInline",value:"Inline"},{locale:"audioLayoutOptionDropDownBreak",value:"Break"}],Fo=[{locale:"videoLayoutOptionDropDownInline",value:"Inline"},{locale:"videoLayoutOptionDropDownBreak",value:"Break"}],qo=[{text:"Inline",cssClass:"e-inline",command:"Images",subCommand:"Inline"},{text:"Break",cssClass:"e-break",command:"Images",subCommand:"Break"}],zo=[{text:"Inline",cssClass:"e-audio-inline",command:"Audios",subCommand:"Inline"},{text:"Break",cssClass:"e-audio-break",command:"Audios",subCommand:"Break"}],_o=[{text:"Inline",cssClass:"e-video-inline",command:"Videos",subCommand:"Inline"},{text:"Break",cssClass:"e-video-break",command:"Videos",subCommand:"Break"}],Vo=[{iconCss:"e-icons e-cell-merge",text:"Merge cells",command:"Table",subCommand:"Merge"},{iconCss:"e-icons e-cell-horizontal-split",text:"Horizontal split",command:"Table",subCommand:"HorizontalSplit"},{iconCss:"e-icons e-cell-vertical-split",text:"Vertical split",command:"Table",subCommand:"VerticalSplit"}],Qo=[{locale:"tableInsertRowDropDownBefore",value:"InsertRowBefore"},{locale:"tableInsertRowDropDownAfter",value:"InsertRowAfter"},{locale:"tableInsertRowDropDownDelete",value:"DeleteRow"}],Wo=[{iconCss:"e-icons e-insert-row-before",text:"Insert row before",command:"Table",subCommand:"InsertRowBefore"},{iconCss:"e-icons e-insert-row-after",text:"Insert row after",command:"Table",subCommand:"InsertRowAfter"},{iconCss:"e-icons e-delete-row",text:"Delete row",command:"Table",subCommand:"DeleteRow"}],Ko=[{locale:"tableInsertColumnDropDownLeft",value:"InsertColumnLeft"},{locale:"tableInsertColumnDropDownRight",value:"InsertColumnRight"},{locale:"tableInsertColumnDropDownDelete",value:"DeleteColumn"}],Go=[{iconCss:"e-icons e-insert-column-left",text:"Insert column left",command:"Table",subCommand:"InsertColumnLeft"},{iconCss:"e-icons e-insert-column-right",text:"Insert column right",command:"Table",subCommand:"InsertColumnRight"},{iconCss:"e-icons e-delete-column",text:"Delete column",command:"Table",subCommand:"DeleteColumn"}],Xo=[{locale:"tableVerticalAlignDropDownTop",value:"AlignTop"},{locale:"tableVerticalAlignDropDownMiddle",value:"AlignMiddle"},{locale:"tableVerticalAlignDropDownBottom",value:"AlignBottom"}],Yo=[{iconCss:"e-icons e-align-top",text:"Align Top",command:"Table",subCommand:"AlignTop"},{iconCss:"e-icons e-align-middle",text:"Align Middle",command:"Table",subCommand:"AlignMiddle"},{iconCss:"e-icons e-align-bottom",text:"Align Bottom",command:"Table",subCommand:"AlignBottom"}],Jo=[{locale:"tableStylesDropDownDashedBorder",value:"Dashed"},{locale:"tableStylesDropDownAlternateRows",value:"Alternate"}],$o=[{text:"Dashed Borders",cssClass:"e-dashed-borders",command:"Table",subCommand:"Dashed"},{text:"Alternate Rows",cssClass:"e-alternate-rows",command:"Table",subCommand:"Alternate"}],e=["Bold","Italic","Underline","|","Formats","Alignments","Blockquote","OrderedList","UnorderedList","|","CreateLink","Image","|","SourceCode","Undo","Redo"],Zo=[{cssClass:"e-default",text:"Default",command:"Font",subCommand:"FontName",value:""},{cssClass:"e-segoe-ui",text:"Segoe UI",command:"Font",subCommand:"FontName",value:"Segoe UI"},{cssClass:"e-arial",text:"Arial",command:"Font",subCommand:"FontName",value:"Arial,Helvetica,sans-serif"},{cssClass:"e-georgia",text:"Georgia",command:"Font",subCommand:"FontName",value:"Georgia,serif"},{cssClass:"e-impact",text:"Impact",command:"Font",subCommand:"FontName",value:"Impact,Charcoal,sans-serif"},{cssClass:"e-tahoma",text:"Tahoma",command:"Font",subCommand:"FontName",value:"Tahoma,Geneva,sans-serif"},{cssClass:"e-times-new-roman",text:"Times New Roman",command:"Font",subCommand:"FontName",value:"Times New Roman,Times,serif"},{cssClass:"e-verdana",text:"Verdana",command:"Font",subCommand:"FontName",value:"Verdana,Geneva,sans-serif"}],er=[{text:"Default",value:""},{text:"8 pt",value:"8pt"},{text:"10 pt",value:"10pt"},{text:"12 pt",value:"12pt"},{text:"14 pt",value:"14pt"},{text:"18 pt",value:"18pt"},{text:"24 pt",value:"24pt"},{text:"36 pt",value:"36pt"}],tr=[{cssClass:"e-paragraph",text:"Paragraph",command:"Formats",subCommand:"P",value:"P"},{cssClass:"e-h1",text:"Heading 1",command:"Formats",subCommand:"H1",value:"H1"},{cssClass:"e-h2",text:"Heading 2",command:"Formats",subCommand:"H2",value:"H2"},{cssClass:"e-h3",text:"Heading 3",command:"Formats",subCommand:"H3",value:"H3"},{cssClass:"e-h4",text:"Heading 4",command:"Formats",subCommand:"H4",value:"H4"},{cssClass:"e-code",text:"preformatted",command:"Formats",subCommand:"Pre",value:"Pre"}],nr={Custom:["","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},ir={Custom:["","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},or=[{text:"None",command:"Lists",subCommand:"NumberFormatList",value:"none"},{text:"Number",command:"Lists",subCommand:"NumberFormatList",value:"decimal"},{text:"Lower Greek",command:"Lists",subCommand:"NumberFormatList",value:"lowerGreek"},{text:"Lower Roman",command:"Lists",subCommand:"NumberFormatList",value:"lowerRoman"},{text:"Upper Alpha",command:"Lists",subCommand:"NumberFormatList",value:"upperAlpha"},{text:"Lower Alpha",command:"Lists",subCommand:"NumberFormatList",value:"lowerAlpha"},{text:"Upper Roman",command:"Lists",subCommand:"NumberFormatList",value:"upperRoman"}],rr=[{text:"None",command:"Lists",subCommand:"BulletFormatList",value:"none"},{text:"Disc",command:"Lists",subCommand:"BulletFormatList",value:"disc"},{text:"Circle",command:"Lists",subCommand:"BulletFormatList",value:"circle"},{text:"Square",command:"Lists",subCommand:"BulletFormatList",value:"square"}];function sr(e,t,n){for(var i=0;t.length>i;i++)if(t[i].value===n.subCommand)return e.localeObj.getConstant(t[i].locale);return n.text}var ar={"Insert Link":"Ctrl+K","Insert Image":"Ctrl+Shift+I","Create Table":"Ctrl+Shift+E",Undo:"Ctrl+Z",Redo:"Ctrl+Y",Copy:"Ctrl+C",Cut:"Ctrl+X",Paste:"Ctrl+V",Bold:"Ctrl+B",Italic:"Ctrl+I",Underline:"Ctrl+U",Strikethrough:"Ctrl+Shift+S","Upper Case":"Ctrl+Shift+U","Lower Case":"Ctrl+Shift+L",Superscript:"Ctrl+Shift+=",Subscript:"Ctrl+=","Code View":"Ctrl+Shift+H",Maximize:"Ctrl+Shift+F",Minimize:"Esc","Clear Format":"Ctrl+Shift+R","Numbered List":"Ctrl+Shift+O","Bulleted List":"Ctrl+Alt+O","Number Format List":"Ctrl+Shift+O","Bullet Format List":"Ctrl+Alt+O","Insert Audio":"Ctrl+Shift+A","Insert Video":"Ctrl+Alt+V","Increase Indent":"Ctrl+]","Decrease Indent":"Ctrl+[","Decrease Fontsize":"Ctrl+Shift+<","Increase Fontsize":"Ctrl+Shift+>","Justify Center":"Ctrl+E","Justify Full":"Ctrl+J","Justify Left":"Ctrl+L","Justify Right":"Ctrl+R","Format Painter":"Alt+Shift+C, Alt+Shift+V",inlineCode:"ctrl+`"},lr=[{name:"Smilies & People",code:"1F600",iconCss:"e-emoji",icons:[{code:"1F600",desc:"Grinning face"},{code:"1F603",desc:"Grinning face with big eyes"},{code:"1F604",desc:"Grinning face with smiling eyes"},{code:"1F606",desc:"Grinning squinting face"},{code:"1F605",desc:"Grinning face with sweat"},{code:"1F602",desc:"Face with tears of joy"},{code:"1F923",desc:"Rolling on the floor laughing"},{code:"1F60A",desc:"Smiling face with smiling eyes"},{code:"1F607",desc:"Smiling face with halo"},{code:"1F642",desc:"Slightly smiling face"},{code:"1F643",desc:"Upside-down face"},{code:"1F60D",desc:"Smiling face with heart-eyes"},{code:"1F618",desc:"Face blowing a kiss"},{code:"1F61B",desc:"Face with tongue"},{code:"1F61C",desc:"Winking face with tongue"},{code:"1F604",desc:"Grinning face with smiling eyes"},{code:"1F469",desc:"Woman"},{code:"1F468",desc:"Man"},{code:"1F467",desc:"Girl"},{code:"1F466",desc:"Boy"},{code:"1F476",desc:"Baby"},{code:"1F475",desc:"Old woman"},{code:"1F474",desc:"Old man"},{code:"1F46E",desc:"Police officer"},{code:"1F477",desc:"Construction worker"},{code:"1F482",desc:"Guard"},{code:"1F575",desc:"Detective"},{code:"1F9D1",desc:"Cook"}]},{name:"Animals & Nature",code:"1F435",iconCss:"e-animals",icons:[{code:"1F436",desc:"Dog face"},{code:"1F431",desc:"Cat face"},{code:"1F42D",desc:"Mouse face"},{code:"1F439",desc:"Hamster face"},{code:"1F430",desc:"Rabbit face"},{code:"1F98A",desc:"Fox face"},{code:"1F43B",desc:"Bear face"},{code:"1F43C",desc:"Panda face"},{code:"1F428",desc:"Koala"},{code:"1F42F",desc:"Tiger face"},{code:"1F981",desc:"Lion face"},{code:"1F42E",desc:"Cow face"},{code:"1F437",desc:"Pig face"},{code:"1F43D",desc:"Pig nose"},{code:"1F438",desc:"Frog face"},{code:"1F435",desc:"Monkey face"},{code:"1F649",desc:"Hear-no-evil monkey"},{code:"1F64A",desc:"Speak-no-evil monkey"},{code:"1F412",desc:"Monkey"},{code:"1F414",desc:"Chicken"},{code:"1F427",desc:"Penguin"},{code:"1F426",desc:"Bird"},{code:"1F424",desc:"Baby chick"},{code:"1F986",desc:"Duck"},{code:"1F985",desc:"Eagle"}]},{name:"Food & Drink",code:"1F347",iconCss:"e-food-and-drinks",icons:[{code:"1F34E",desc:"Red apple"},{code:"1F34C",desc:"Banana"},{code:"1F347",desc:"Grapes"},{code:"1F353",desc:"Strawberry"},{code:"1F35E",desc:"Bread"},{code:"1F950",desc:"Croissant"},{code:"1F955",desc:"Carrot"},{code:"1F354",desc:"Hamburger"},{code:"1F355",desc:"Pizza"},{code:"1F32D",desc:"Hot dog"},{code:"1F35F",desc:"French fries"},{code:"1F37F",desc:"Popcorn"},{code:"1F366",desc:"Soft ice cream"},{code:"1F367",desc:"Shaved ice"},{code:"1F36A",desc:"Cookie"},{code:"1F382",desc:"Birthday cake"},{code:"1F370",desc:"Shortcake"},{code:"1F36B",desc:"Chocolate bar"},{code:"1F369",desc:"Donut"},{code:"1F36E",desc:"Custard"},{code:"1F36D",desc:"Lollipop"},{code:"1F36C",desc:"Candy"},{code:"1F377",desc:"Wine glass"},{code:"1F37A",desc:"Beer mug"},{code:"1F37E",desc:"Bottle with popping cork"}]},{name:"Activities",code:"1F383",iconCss:"e-activities",icons:[{code:"26BD",desc:"Soccer ball"},{code:"1F3C0",desc:"Basketball"},{code:"1F3C8",desc:"American football"},{code:"26BE",desc:"Baseball"},{code:"1F3BE",desc:"Tennis"},{code:"1F3D0",desc:"Volleyball"},{code:"1F3C9",desc:"Rugby football"},{code:"1F3B1",desc:"Pool 8 ball"},{code:"1F3D3",desc:"Ping pong"},{code:"1F3F8",desc:"Badminton"},{code:"1F94A",desc:"Boxing glove"},{code:"1F3CA",desc:"Swimmer"},{code:"1F3CB",desc:"Weightlifter"},{code:"1F6B4",desc:"Bicyclist"},{code:"1F6F9",desc:"Skateboard"},{code:"1F3AE",desc:"Video game"},{code:"1F579",desc:"Joystick"},{code:"1F3CF",desc:"Cricket"},{code:"1F3C7",desc:"Horse racing"},{code:"1F3AF",desc:"Direct hit"},{code:"1F3D1",desc:"Field hockey"},{code:"1F3B0",desc:"Slot machine"},{code:"1F3B3",desc:"Bowling"},{code:"1F3B2",desc:"Game die"},{code:"265F",desc:"Chess pawn"}]},{name:"Travel & Places",code:"1F30D",iconCss:"e-travel-and-places",icons:[{code:"2708",desc:"Airplane"},{code:"1F697",desc:"Automobile"},{code:"1F695",desc:"Taxi"},{code:"1F6B2",desc:"Bicycle"},{code:"1F68C",desc:"Bus"},{code:"1F682",desc:"Locomotive"},{code:"1F6F3",desc:"Passenger ship"},{code:"1F680",desc:"Rocket"},{code:"1F681",desc:"Helicopter"},{code:"1F6A2",desc:"Ship"},{code:"1F3DF",desc:"Stadium"},{code:"1F54C",desc:"Mosque"},{code:"26EA",desc:"Church"},{code:"1F6D5",desc:"Hindu Temple"},{code:"1F3D4",desc:"Snow-capped mountain"},{code:"1F3EB",desc:"School"},{code:"1F30B",desc:"Volcano"},{code:"1F3D6",desc:"Beach with umbrella"},{code:"1F3DD",desc:"Desert island"},{code:"1F3DE",desc:"National park"},{code:"1F3F0",desc:"Castle"},{code:"1F5FC",desc:"Tokyo tower"},{code:"1F5FD",desc:"Statue of liberty"},{code:"26E9",desc:"Shinto shrine"},{code:"1F3EF",desc:"Japanese castle"},{code:"1F3A2",desc:"Roller coaster"}]},{name:"Objects",code:"1F507",iconCss:"e-objects",icons:[{code:"1F4A1",desc:"Light bulb"},{code:"1F526",desc:"Flashlight"},{code:"1F4BB",desc:"Laptop computer"},{code:"1F5A5",desc:"Desktop computer"},{code:"1F5A8",desc:"Printer"},{code:"1F4F7",desc:"Camera"},{code:"1F4F8",desc:"Camera with flash"},{code:"1F4FD",desc:"Film projector"},{code:"1F3A5",desc:"Movie camera"},{code:"1F4FA",desc:"Television"},{code:"1F4FB",desc:"Radio"},{code:"1F50B",desc:"Battery"},{code:"231A",desc:"Watch"},{code:"1F4F1",desc:"Mobile phone"},{code:"260E",desc:"Telephone"},{code:"1F4BE",desc:"Floppy disk"},{code:"1F4BF",desc:"Optical disk"},{code:"1F4C0",desc:"Digital versatile disc"},{code:"1F4BD",desc:"Computer disk"},{code:"1F3A7",desc:"Headphone"},{code:"1F3A4",desc:"Microphone"},{code:"1F3B6",desc:"Multiple musical notes"},{code:"1F4DA",desc:"Books"}]},{name:"Symbols",code:"1F3E7",iconCss:"e-symbols",icons:[{code:"274C",desc:"Cross mark"},{code:"2714",desc:"Check mark"},{code:"26A0",desc:"Warning sign"},{code:"1F6AB",desc:"Prohibited"},{code:"2139",desc:"Information"},{code:"267B",desc:"Recycling symbol"},{code:"1F6AD",desc:"No smoking"},{code:"1F4F5",desc:"No mobile phones"},{code:"1F6AF",desc:"No littering"},{code:"1F6B3",desc:"No bicycles"},{code:"1F6B7",desc:"No pedestrians"},{code:"2795",desc:"Plus"},{code:"2796",desc:"Minus"},{code:"2797",desc:"Divide"},{code:"2716",desc:"Multiplication"},{code:"1F4B2",desc:"Dollar banknote"},{code:"1F4AC",desc:"Speech balloon"},{code:"2755",desc:"White exclamation mark"},{code:"2754",desc:"White question mark"},{code:"2764",desc:"Heart"}]}],dr={alignments:"Alignments",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",fontName:"Font Name",fontSize:"Font Size",fontColor:"Font Color",backgroundColor:"Background Color",importWord:"Import from Word",exportWord:"Export to Word",exportPdf:"Export to PDF",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",clearFormat:"Clear Format",clearAll:"Clear All",cut:"Cut",copy:"Copy",paste:"Paste",unorderedList:"Bulleted List",orderedList:"Numbered List",indent:"Increase Indent",outdent:"Decrease Indent",undo:"Undo",redo:"Redo",superscript:"Superscript",subscript:"Subscript",createLink:"Insert Link",openLink:"Open Link",editLink:"Edit Link",removeLink:"Remove Link",image:"Insert Image",audio:"Insert Audio",video:"Insert Video",replace:"Replace",numberFormatList:"Number Format List",bulletFormatList:"Bullet Format List",audioReplace:"Replace",videoReplace:"Replace",videoAlign:"Align",videoDimension:"Dimension",audioRemove:"Remove",videoRemove:"Remove",audioLayoutOption:"Layout option",videoLayoutOption:"Layout option",align:"Align",caption:"Caption",remove:"Remove",insertLink:"Insert Link",display:"Display",altText:"Alternative text",dimension:"Change Size",fullscreen:"Maximize",maximize:"Maximize",minimize:"Minimize",lowerCase:"Lower Case",upperCase:"Upper Case",print:"Print",formats:"Formats",sourcecode:"Code View",preview:"Preview",viewside:"ViewSide",insertCode:"Insert Code",blockquote:"Blockquote",linkText:"Display text",linkTooltipLabel:"Title",linkWebUrl:"Web address",linkTitle:"Enter a title",linkurl:"https://example.com",linkOpenInNewWindow:"Open link in new window",linkHeader:"Insert Link",dialogInsert:"Insert",dialogCancel:"Cancel",dialogUpdate:"Update",imageHeader:"Insert Image",audioHeader:"Insert Audio",videoHeader:"Insert Video",imageLinkHeader:"You can also provide a link from the web",audioLinkHeader:"You can also provide a link from the web",videoLinkHeader:"Web URL",embedVideoLinkHeader:"Media Embed URL",mdimageLink:"Please provide a URL for your image",imageUploadMessage:"Drop image here or browse to upload",audioUploadMessage:"Drop an audio file or browse to upload",videoUploadMessage:"Drop a video file or browse to upload",imageDeviceUploadMessage:"Click here to upload",audioDeviceUploadMessage:"Click here to upload",videoDeviceUploadMessage:"Click here to upload",imageAlternateText:"Alternate Text",alternateHeader:"Alternative Text",browse:"Browse",imageUrl:"https://example.com/image.png",audioUrl:"https://example.com/audio.mp3",videoUrl:"https://example.com/video.mp4",webUrl:"Web URL",embedUrl:"Embed Code",imageCaption:"Caption",imageSizeHeader:"Image Size",videoSizeHeader:"Video Size",imageHeight:"Height",imageWidth:"Width",videoHeight:"Height",videoWidth:"Width",textPlaceholder:"Enter text",inserttablebtn:"Insert Table",tabledialogHeader:"Insert Table",tableWidth:"Width",cellpadding:"Cell Padding",cellspacing:"Cell Spacing",columns:"Number of columns",rows:"Number of rows",tableRows:"Row",tableColumns:"Column",tableCellHorizontalAlign:"Table Cell Horizontal Align",tableCellVerticalAlign:"Vertical Align",createTable:"Create Table",removeTable:"Remove Table",tableHeader:"Header Row",tableRemove:"Delete Table",tableCellBackground:"Table Cell Background",tableEditProperties:"Table Edit Properties",styles:"Styles",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteColumn:"Delete Column",insertRowBefore:"Insert Row Before",insertRowAfter:"Insert Row After",deleteRow:"Delete Row",tableEditHeader:"Edit Table",TableHeadingText:"Heading",TableColText:"Col",imageInsertLinkHeader:"Insert Link",editImageHeader:"Edit Image",editAudioHeader:"Edit Audio",editVideoHeader:"Edit Video",alignmentsDropDownLeft:"Align Left",alignmentsDropDownCenter:"Align Center",alignmentsDropDownRight:"Align Right",alignmentsDropDownJustify:"Align Justify",imageDisplayDropDownInline:"Inline",imageDisplayDropDownBreak:"Break",audioLayoutOptionDropDownInline:"Inline",audioLayoutOptionDropDownBreak:"Break",videoLayoutOptionDropDownInline:"Inline",videoLayoutOptionDropDownBreak:"Break",tableInsertRowDropDownBefore:"Insert row before",tableInsertRowDropDownAfter:"Insert row after",tableInsertRowDropDownDelete:"Delete row",tableInsertColumnDropDownLeft:"Insert column left",tableInsertColumnDropDownRight:"Insert column right",tableInsertColumnDropDownDelete:"Delete column",tableVerticalAlignDropDownTop:"Align Top",tableVerticalAlignDropDownMiddle:"Align Middle",tableVerticalAlignDropDownBottom:"Align Bottom",tableStylesDropDownDashedBorder:"Dashed Borders",tableStylesDropDownAlternateRows:"Alternate Rows",pasteFormat:"Paste Format",pasteFormatContent:"Choose the formatting action",plainText:"Plain Text",cleanFormat:"Clean",keepFormat:"Keep",pasteDialogOk:"OK",pasteDialogCancel:"Cancel",fileManager:"File Manager",fileDialogHeader:"File Browser",formatsDropDownParagraph:"Paragraph",formatsDropDownCode:"Preformatted",formatsDropDownQuotation:"Blockquote",formatsDropDownHeading1:"Heading 1",formatsDropDownHeading2:"Heading 2",formatsDropDownHeading3:"Heading 3",formatsDropDownHeading4:"Heading 4",fontNameSegoeUI:"Segoe UI",fontNameArial:"Arial",fontNameGeorgia:"Georgia",fontNameImpact:"Impact",fontNameTahoma:"Tahoma",fontNameTimesNewRoman:"Times New Roman",fontNameVerdana:"Verdana",numberFormatListNumber:"Number",numberFormatListLowerAlpha:"Lower Alpha",numberFormatListUpperAlpha:"Upper Alpha",numberFormatListLowerRoman:"Lower Roman",numberFormatListUpperRoman:"Upper Roman",numberFormatListLowerGreek:"Lower Greek",bulletFormatListDisc:"Disc",bulletFormatListCircle:"Circle",bulletFormatListSquare:"Square",numberFormatListNone:"None",bulletFormatListNone:"None",formatPainter:"Format Painter",emojiPicker:"Emoji Picker",embeddedCode:"Embedded code",pasteEmbeddedCodeHere:"Paste embedded code here",emojiPickerTypeToFind:"Type to find",emojiPickerNoResultFound:"No results found",emojiPickerTrySomethingElse:"Try something else",linkAriaLabel:"Open in new window",unsupportedImage:"Unsupported file format",mergecells:"Merge cells",verticalsplit:"Vertical split",horizontalsplit:"Horizontal split",inlinecode:"Inline Code",slashMenuItemHeadingOneText:"Heading 1",slashMenuItemHeadingOneDescription:"Use this for a top level heading or title.",slashMenuItemHeadingTwoText:"Heading 2",slashMenuItemHeadingTwoDescription:"Use this for key sections.",slashMenuItemHeadingThreeText:"Heading 3",slashMenuItemHeadingThreeDescription:"Use this for sub sections and group headings.",slashMenuItemHeadingFourText:"Heading 4",slashMenuItemHeadingFourDescription:"Use this for the key points of the sub topics.",slashMenuItemParagraphText:"Paragraph",slashMenuItemParagraphDescription:"Writing with paragraphs.",slashMenuItemBlockquoteText:"Blockquote",slashMenuItemBlockquoteDescription:"Create a quote or citation.",slashMenuItemOrderedListText:"Ordered List",slashMenuItemOrderedListDescription:"Create an ordered list.",slashMenuItemUnorderedListText:"Unordered List",slashMenuItemUnorderedListDescription:"Create an unordered list.",slashMenuItemCodeText:"CodeBlock",slashMenuItemCodeDescription:"Create a preformatted code block.",slashMenuItemTableText:"Table",slashMenuItemTableDescription:"Insert a table.",slashMenuItemLinkText:"Link",slashMenuItemLinkDescription:"Insert a link.",slashMenuItemImageText:"Image",slashMenuItemImageDescription:"Insert an image.",slashMenuItemAudioText:"Audio",slashMenuItemAudioDescription:"Insert an audio.",slashMenuItemVideoText:"Video",slashMenuItemVideoDescription:"Insert a video.",slashMenuItemEmojiText:"Emojipicker",slashMenuItemEmojiDescription:"Use emojis to express ideas and emoticons."},cr={alignments:"alignments",justifyleft:"justifyLeft",justifycenter:"justifyCenter",justifyright:"justifyRight",justifyfull:"justifyFull",fontname:"fontName",fontsize:"fontSize",fontcolor:"fontColor",backgroundcolor:"backgroundColor",importword:"importWord",exportword:"exportWord",exportpdf:"exportPdf",bold:"bold",italic:"italic",underline:"underline",strikethrough:"strikethrough",clearformat:"clearFormat",clearall:"clearAll",cut:"cut",copy:"copy",paste:"paste",unorderedlist:"unorderedList",orderedlist:"orderedList",indent:"indent",outdent:"outdent",numberformatlist:"numberFormatList",bulletformatlist:"bulletFormatList",undo:"undo",redo:"redo",filemanager:"fileManager",superscript:"superscript",subscript:"subscript",createlink:"createLink",openlink:"openLink",editlink:"editLink",removelink:"removeLink",openimagelink:"openLink",editimagelink:"editLink",removeimagelink:"removeLink",image:"image",audio:"audio",video:"video",replace:"replace",audioreplace:"audioReplace",videoreplace:"videoReplace",videoalign:"videoAlign",videodimension:"videoDimension",audioremove:"audioRemove",videoremove:"videoRemove",audiolayoutoption:"audioLayoutOption",videolayoutoption:"videoLayoutOption",align:"align",caption:"caption",remove:"remove",insertlink:"insertLink",display:"display",alttext:"imageAlternateText",dimension:"dimension",fullscreen:"fullscreen",maximize:"maximize",minimize:"minimize",lowercase:"lowerCase",uppercase:"upperCase",print:"print",formats:"formats",sourcecode:"sourcecode",preview:"preview",viewside:"viewside",insertcode:"insertCode",blockquote:"blockquote",tablerows:"tableRows",tablecolumns:"tableColumns",tablecellhorizontalalign:"tableCellHorizontalAlign",tablecellverticalalign:"tableCellVerticalAlign",createtable:"createTable",removetable:"removeTable",tableheader:"tableHeader",tableremove:"tableRemove",tablecellbackground:"tableCellBackground",tableeditproperties:"tableEditProperties",styles:"styles",insertcolumnleft:"insertColumnLeft",insertcolumnright:"insertColumnRight",deletecolumn:"deleteColumn",aligntop:"AlignTop",alignmiddle:"AlignMiddle",alignbottom:"AlignBottom",insertrowbefore:"insertRowBefore",insertrowafter:"insertRowAfter",deleterow:"deleteRow",formatpainter:"formatPainter",emojipicker:"emojiPicker",embeddedCode:"Embedded code",pasteEmbeddedCodeHere:"Paste embedded code here",emojiPickerTypeToFind:"Type to find",emojiPickerNoResultFound:"No results found",emojiPickerTrySomethingElse:"Try something else",imageLinkAriaLabel:"Open in new window",inlinecode:"inlinecode"},pr=[{locale:"fontNameSegoeUI",value:"Segoe UI"},{locale:"fontNameArial",value:"Arial,Helvetica,sans-serif"},{locale:"fontNameGeorgia",value:"Georgia,serif"},{locale:"fontNameImpact",value:"Impact,Charcoal,sans-serif"},{locale:"fontNameTahoma",value:"Tahoma,Geneva,sans-serif"},{locale:"fontNameTimesNewRoman",value:"Times New Roman,Times,serif"},{locale:"fontNameVerdana",value:"Verdana,Geneva,sans-serif"}],hr=[{locale:"formatsDropDownParagraph",value:"P"},{locale:"formatsDropDownCode",value:"Pre"},{locale:"formatsDropDownHeading1",value:"H1"},{locale:"formatsDropDownHeading2",value:"H2"},{locale:"formatsDropDownHeading3",value:"H3"},{locale:"formatsDropDownHeading4",value:"H4"}],ur=[{locale:"numberFormatListNone",value:"none"},{locale:"numberFormatListNumber",value:"decimal"},{locale:"numberFormatListLowerAlpha",value:"lowerAlpha"},{locale:"numberFormatListUpperAlpha",value:"upperAlpha"},{locale:"numberFormatListLowerRoman",value:"lowerRoman"},{locale:"numberFormatListUpperRoman",value:"upperRoman"},{locale:"numberFormatListLowerGreek",value:"lowerGreek"}],mr=[{locale:"bulletFormatListNone",value:"none"},{locale:"bulletFormatListDisc",value:"disc"},{locale:"bulletFormatListCircle",value:"circle"},{locale:"bulletFormatListSquare",value:"square"}],gr=new Map([["Heading 1",{text:"slashMenuItemHeadingOneText",description:"slashMenuItemHeadingOneDescription"}],["Heading 2",{text:"slashMenuItemHeadingTwoText",description:"slashMenuItemHeadingTwoDescription"}],["Heading 3",{text:"slashMenuItemHeadingThreeText",description:"slashMenuItemHeadingThreeDescription"}],["Heading 4",{text:"slashMenuItemHeadingFourText",description:"slashMenuItemHeadingFourDescription"}],["Paragraph",{text:"slashMenuItemParagraphText",description:"slashMenuItemParagraphDescription"}],["Blockquote",{text:"slashMenuItemBlockquoteText",description:"slashMenuItemBlockquoteDescription"}],["OrderedList",{text:"slashMenuItemOrderedListText",description:"slashMenuItemOrderedListDescription"}],["UnorderedList",{text:"slashMenuItemUnorderedListText",description:"slashMenuItemUnorderedListDescription"}],["CodeBlock",{text:"slashMenuItemCodeText",description:"slashMenuItemCodeDescription"}],["Table",{text:"slashMenuItemTableText",description:"slashMenuItemTableDescription"}],["Link",{text:"slashMenuItemLinkText",description:"slashMenuItemLinkDescription"}],["Image",{text:"slashMenuItemImageText",description:"slashMenuItemImageDescription"}],["Audio",{text:"slashMenuItemAudioText",description:"slashMenuItemAudioDescription"}],["Video",{text:"slashMenuItemVideoText",description:"slashMenuItemVideoDescription"}],["Emojipicker",{text:"slashMenuItemEmojiText",description:"slashMenuItemEmojiDescription"}]]),fr=["Undo","Redo"],br=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","strike","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"];function vr(n,e){var i=-1;return e.some(function(e,t){return"string"==typeof e&&n===e.toLocaleLowerCase()&&(i=t,!0)}),i}function p(e,t){var n=!1;return n=e.classList.contains(t)?!0:n}function yr(e,t,n,i){var o,r;if(0===e.length&&"FontSize"===t)return"Font Size";for(var s=0;s<e.length;s++){if("value"===n&&e[s].value.toLocaleLowerCase()===t.toLocaleLowerCase()){o=e[s];break}if("text"===n&&e[s].text.toLocaleLowerCase()===t.toLocaleLowerCase()){o=e[s];break}if("subCommand"===n&&e[s].subCommand.toLocaleLowerCase()===t.toLocaleLowerCase()){o=e[s];break}}if(!j.isNullOrUndefined(o))switch(i){case"text":r=o.text;break;case"value":r=o.value;break;case"iconCss":r=o.iconCss}return r}function Cr(){var e=!1;return e=j.Browser.isDevice&&j.Browser.isIos?!0:e}function Nr(e){return j.isNullOrUndefined(e)?"":e}function Er(e,t,n){return n?window.pageYOffset+t.getBoundingClientRect().top+e.clientY:e.pageY}function Sr(e,t){return t.getService("rteLocale").getConstant(cr[""+e])}function Tr(e,t,n){qr(n);for(var i=e.dropDownModule,o=e.args,r=0,s=Object.keys(e.args);r<s.length;r++)for(var a=s[r],l=0;l<e.tbItems.length;l++){var d=e.tbItems[l].subCommand,c=d&&d.toLocaleLowerCase();if(d&&c===a||"UL"===d&&"unorderedlist"===a||"OL"===d&&"orderedlist"===a||"pre"===c&&"insertcode"===a||"NumberFormatList"===d&&"numberFormatList"===a||"BulletFormatList"===d&&"bulletFormatList"===a)if("boolean"==typeof o[""+a])!0===o[""+a]?j.addClass([e.tbElements[l]],[Si]):j.removeClass([e.tbElements[l]],[Si]);else if(("string"==typeof o[""+a]||null===o[""+a])&&-1<=vr(a,e.parent.toolbarSettings.items)){var p,h,u,m,g=o[""+a]||"",f="";switch(a){case"formats":j.isNullOrUndefined(i.formatDropDown)||t||!j.isNullOrUndefined(i.formatDropDown)&&i.formatDropDown.isDestroyed||(p=e.parent.format.types,h=j.isNullOrUndefined(e.parent.format.default)?p[0].text:e.parent.format.default,f="empty"===g?"":yr(p,g,"subCommand","text"),i.formatDropDown.content='<span style="display: inline-flex;width:'+e.parent.format.width+'" ><span class="e-rte-dropdown-btn-text'+(j.isNullOrUndefined(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+(j.isNullOrUndefined(f)?h:f)+"</span></span>",i.formatDropDown.dataBind());break;case"alignments":j.isNullOrUndefined(i.alignDropDown)||!j.isNullOrUndefined(i.alignDropDown)&&i.alignDropDown.isDestroyed||(f=yr(Io,g,"subCommand","iconCss"),i.alignDropDown.iconCss=j.isNullOrUndefined(f)?"e-icons e-justify-left":f,i.alignDropDown.dataBind());break;case"fontname":j.isNullOrUndefined(i.fontNameDropDown)||t||!j.isNullOrUndefined(i.fontNameDropDown)&&i.fontNameDropDown.isDestroyed||(p=e.parent.fontFamily.items,f="empty"===g?"":yr(p,g,"value","text"),h=j.isNullOrUndefined(e.parent.fontFamily.default)?0===p.length?n.serviceLocator.getService("rteLocale").getConstant("fontName"):p[0].text:e.parent.fontFamily.default,u="Default"===(j.isNullOrUndefined(f)?h:f)?n.serviceLocator.getService("rteLocale").getConstant("fontName"):j.isNullOrUndefined(f)?h:f,i.fontNameDropDown.content='<span style="display: inline-flex;width:'+e.parent.fontFamily.width+'" ><span class="e-rte-dropdown-btn-text'+(j.isNullOrUndefined(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+u+"</span></span>",i.fontNameDropDown.dataBind());break;case"fontsize":j.isNullOrUndefined(i.fontSizeDropDown)||!j.isNullOrUndefined(i.fontSizeDropDown)&&i.fontSizeDropDown.isDestroyed||(u=e.parent.fontSize.items,m=j.isNullOrUndefined(e.parent.fontSize.default)?0===u.length?n.serviceLocator.getService("rteLocale").getConstant("fontSize"):u[0].text:e.parent.fontSize.default,m=yr(u,""===g?m.replace(/\s/g,""):g,0<u.length&&u[0]&&m.replace(/\s/g,"")===u[0].text&&""===g?"text":"value","text"),f="empty"===g?"":"Default"===m?n.serviceLocator.getService("rteLocale").getConstant("fontSize"):m,i.fontSizeDropDown.content='<span style="display: inline-flex;width:'+e.parent.fontSize.width+'" ><span class="e-rte-dropdown-btn-text'+(j.isNullOrUndefined(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+Nr(f)+"</span></span>",i.fontSizeDropDown.dataBind());break;case"bulletFormatList":case"numberFormatList":""!==g?j.addClass([e.tbElements[l]],[Si]):j.removeClass([e.tbElements[l]],[Si])}}}}function Or(e){return"object"==typeof e?e:[e]}function Lr(e,t){for(var n=[],i=0;i<e.length;i++)for(var o=0;o<t.length;o++)if("Separator"!==t[o].type){if(("OrderedList"===e[i]||"NumberFormatList"===e[i])&&"OL"===t[o].subCommand){n.push(o);break}if(("UnorderedList"===e[i]||"BulletFormatList"===e[i])&&"UL"===t[o].subCommand){n.push(o);break}if("InsertCode"===e[i]&&"Pre"===t[o].subCommand){n.push(o);break}if("Blockquote"===e[i]&&"blockquote"===t[o].subCommand){n.push(o);break}if("FileManager"===e[i]&&"File"===t[o].subCommand){n.push(o);break}if("object"==typeof e[i]&&"Custom"===e[i].command){n.push(i);break}if(e[i]===t[o].subCommand){n.push(o);break}}return n}function kr(e,t){for(var n=0,i=Lr(Or(fr),e.toolbarObj.items),o=j.selectAll("."+Yn,e.toolbarObj.element),r=0,s=Object.keys(t);r<s.length;r++){var a=s[r],l=o[i[n]];l&&e.toolbarObj.enableItems(l,t[""+a]),n++}}function wr(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}function xr(e){var t=j.createElement("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)}function Dr(e,t){var n=[];for(t=t.firstChild;t;t=t.nextSibling)3===t.nodeType?n.push(t):n=n.concat(Dr(e,t));return n}function Mr(e){for(var t={},n=Object.keys(e),i=0;i<Object.keys(e).length;i++)t[n[i].toLocaleLowerCase()]=e[n[i]];return t}function Br(e,t){var n;return null!==e&&""!==e?(n=t.enableHtmlEncode?Rr(Ur(e),t):Rr(e,t),t.setProperties({value:n},!0)):n="DIV"===t.enterKey?t.enableHtmlEncode?"&lt;div&gt;&lt;br/&gt;&lt;/div&gt;":"<div><br/></div>":"BR"===t.enterKey?t.enableHtmlEncode?"&lt;br/&gt;":"<br/>":t.enableHtmlEncode?"&lt;p&gt;&lt;br/&gt;&lt;/p&gt;":"<p><br/></p>",n}function Rr(e,t){var n=document.createElement("div"),i=document.createElement("div"),o=n.childNodes;if(n.innerHTML=e,n.setAttribute("class","tempDiv"),0<o.length){for(var r=void 0,s=void 0,a=void 0;n.firstChild;){for(var l=n.querySelectorAll(bn),d=0;d<l.length;d++)l[d].innerHTML="<br>";for(var c=n.querySelectorAll("p"),d=0;d<c.length;d++)0===c[d].textContent.trim().length&&1===c[d].childNodes.length&&"#text"===c[d].childNodes[0].nodeName&&j.isNullOrUndefined(c[d].childNodes[0].textContent.match(/\u00a0/g))&&(c[d].innerHTML="<br>");for(var p=n.querySelectorAll(vn),d=0;d<p.length;d++)p[d].innerHTML="&ZeroWidthSpace;";"BR"!==t.enterKey&&("#text"===n.firstChild.nodeName&&(n.firstChild.textContent.indexOf("\n")<0||""!==n.firstChild.textContent.trim())||0<=br.indexOf(n.firstChild.nodeName.toLocaleLowerCase()))?((r?s:(a="DIV"===t.enterKey?j.createElement("div"):j.createElement("p"),i.appendChild(a),a)).appendChild(n.firstChild),s=a,r=!0):"#text"===n.firstChild.nodeName&&("\n"===n.firstChild.textContent||0<=n.firstChild.textContent.indexOf("\n")&&""===n.firstChild.textContent.trim())?j.detach(n.firstChild):(i.appendChild(n.firstChild),r=!1)}for(var h=i.querySelectorAll("img"),d=0;d<h.length;d++)h[d].classList.contains("e-rte-image-unsupported")||(h[d].classList.contains(lo)||h[d].classList.add(lo),h[d].classList.contains(fi))||h[d].classList.contains(si)||h[d].classList.contains("e-imgleft")||h[d].classList.contains("e-imgright")||h[d].classList.contains("e-imgcenter")||h[d].classList.add(fi)}return i.innerHTML}function Ar(e){e="DIV"===e.enterKey?e.enableHtmlEncode?"&lt;div&gt;&lt;br/&gt;&lt;/div&gt;":"<div><br/></div>":"BR"===e.enterKey?e.enableHtmlEncode?"&lt;br/&gt;":"<br/>":e.enableHtmlEncode?"&lt;p&gt;&lt;br/&gt;&lt;/p&gt;":"<p><br/></p>";return e}function Ir(e){return"<p><br></p>"===e||"&lt;p&gt;&lt;br&gt;&lt;/p&gt;"===e||"<div><br></div>"===e||"&lt;div&gt;&lt;br&gt;&lt;/div&gt;"===e||"<br>"===e||"&lt;br&gt;"===e||""===e}function Ur(e){return e.replace(/&amp;/g,"&").replace(/&amp;lt;/g,"<").replace(/&lt;/g,"<").replace(/&amp;gt;/g,">").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;nbsp;/g," ").replace(/&quot;/g,"")}function Pr(e,t){var n;return t.enableHtmlSanitizer&&((n=j.SanitizeHtmlHelper.beforeSanitize()).selectors.tags[2]&&-1<n.selectors.tags[2].indexOf("iframe")&&(n.selectors.tags[2]="iframe:not(.e-rte-embed-url)"),j.extend(n,n,{cancel:!1,helper:null}),t.trigger("beforeSanitizeHtml",n),n.cancel&&!j.isNullOrUndefined(n.helper)?e=n.helper(e):n.cancel||(e=j.SanitizeHtmlHelper.serializeValue(n,e))),e=Hr(e)}function Hr(e){var t=j.createElement("div");e=e.replace(/&(times|divide|ne)/g,"&amp;amp;$1"),t.innerHTML=e;t.querySelectorAll("font").forEach(function(e){var t=document.createElement("span"),i=(e.getAttribute("style")||"").replace(/style:/gi,"").trim();j.isNullOrUndefined(i)||""===i.trim()||i.endsWith(";")||(i+=";"),Array.from(e.attributes).forEach(function(e){var t=e.name.toLowerCase(),n=e.value;switch(t){case"size":i+="font-size:"+n+";";break;case"face":i+="font-family:"+n+";";break;case"bgcolor":i+="background-color:"+n+";";break;case"style":break;default:i+=t+":"+n+";"}}),j.isNullOrUndefined(i)||""===i.trim()||(i=i.replace(/;;+/g,";"),t.setAttribute("style",i)),t.innerHTML=e.innerHTML,j.isNullOrUndefined(e.parentNode)||e.parentNode.replaceChild(t,e)});e=t.innerHTML;return t.remove(),e}function jr(e){for(var e=e.split(","),t=e[0].match(/:(.*?);/)[1],n=atob(e[1]),i=n.length,o=new Uint8Array(i);i--;)o[i]=n.charCodeAt(i);return new Blob([o],{type:t})}function Fr(e,t,n){for(var i=0;t.length>i;i++)if(t[i].value===n.value||t[i].value===n.subCommand)return e.localeObj.getConstant(t[i].locale);return n.text}function qr(n){Zo.forEach(function(e,t){Zo[t].text=Fr(n,pr,Zo[t])}),tr.forEach(function(e,t){tr[t].text=Fr(n,hr,tr[t])}),or.forEach(function(e,t){or[t].text=Fr(n,ur,or[t])}),rr.forEach(function(e,t){rr[t].text=Fr(n,mr,rr[t])})}_r.prototype.renderPanel=function(){var e=this.parent,t=this.parent.createElement("div",{className:"e-rte-content",id:this.parent.getID()+"rte-view"}),n=Br(e.value,e);this.editableElement=this.parent.createElement("div",{className:"e-content",id:this.parent.getID()+"_rte-edit-view",attrs:{contenteditable:"true"}}),j.isNullOrUndefined(this.parent.fontFamily.default)||(this.editableElement.style.fontFamily=this.parent.fontFamily.default),j.isNullOrUndefined(this.parent.fontSize.default)||(this.editableElement.style.fontSize=this.parent.fontSize.default),this.editableElement.innerHTML=n,t.appendChild(this.editableElement),this.setPanel(t),e.rootContainer.appendChild(t)},_r.prototype.getPanel=function(){return this.contentPanel},_r.prototype.getEditPanel=function(){return this.editableElement},_r.prototype.getText=function(){var e=this.getEditPanel().innerText;return"\n"===e?"":e},_r.prototype.setPanel=function(e){this.contentPanel=e},_r.prototype.getDocument=function(){return this.getEditPanel().ownerDocument};var zr=_r;function _r(e){this.parent=e}Qr.prototype.render=function(){this.parent;this.contentRenderer=this.renderer.getRenderer(m.RenderType.Content),this.contentRenderer.renderPanel()},Qr.prototype.refresh=function(e){this.parent.notify((e=void 0===e?{requestType:"refresh"}:e).requestType+"-begin",e)},Qr.prototype.destroy=function(){j.isNullOrUndefined(this.parent)||(this.removeEventListener(),this.locator.destroy(),this.renderer.destroy())},Qr.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(te,this.refresh,this),this.parent.on(ie,this.keyUp,this))},Qr.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(te,this.refresh),this.parent.off(ie,this.keyUp))},Qr.prototype.keyUp=function(e){if("HTML"===this.parent.editorMode)switch(e.args.which){case 46:case 8:var t=this.parent.contentModule.getEditPanel().childNodes;0!==t.length&&(1!==t.length||0!==t[0].childNodes.length||"BR"!==t[0].tagName&&("P"!==t[0].tagName&&"DIV"!==t[0].tagName||""!==t[0].textContent))||(t=this.parent.contentModule.getEditPanel(),"DIV"===this.parent.enterKey?t.innerHTML="<div><br/></div>":"BR"===this.parent.enterKey?t.innerHTML="<br/>":t.innerHTML="<p><br/></p>",this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),t.childNodes[0],0))}};var Vr=Qr;function Qr(e,t){this.parent=e,this.locator=t,this.renderer=this.locator.getService("rendererFactory"),this.addEventListener()}i.prototype.getFormattedNode=function(e,t,n){e=this.getFormatParent(e,t,n);return null!==e&&e!==n?e:null},i.prototype.getFormatParent=function(e,t,n){for(;(e=e.parentNode)&&e!==n&&!this.isFormattedNode(e,t););return e},i.prototype.isFormattedNode=function(e,t){switch(t){case"bold":return i.isBold(e);case"italic":return i.isItalic(e);case"underline":return i.isUnderline(e);case"strikethrough":return i.isStrikethrough(e);case"superscript":return i.isSuperscript(e);case"subscript":return i.isSubscript(e);case"fontcolor":return this.isFontColor(e);case"fontname":return this.isFontName(e);case"fontsize":return this.isFontSize(e);case"backgroundcolor":return this.isBackgroundColor(e);case"inlinecode":return i.isCode(e);default:return!1}},i.isBold=function(e){return-1!==["strong","b"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"bold"!==e.style.fontWeight)},i.isItalic=function(e){return-1!==["em","i"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"italic"!==e.style.fontStyle)},i.isUnderline=function(e){return-1!==["u"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"underline"!==e.style.textDecoration&&"underline"!==e.style.textDecorationLine)},i.isStrikethrough=function(e){return-1!==["del","strike","s"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"line-through"!==e.style.textDecoration&&"line-through"!==e.style.textDecorationLine)},i.isSuperscript=function(e){return-1!==["sup"].indexOf(e.nodeName.toLowerCase())},i.isSubscript=function(e){return-1!==["sub"].indexOf(e.nodeName.toLowerCase())},i.prototype.isFontColor=function(e){var t=e.style&&e.style.color;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.prototype.isBackgroundColor=function(e){var t=e.style&&e.style.backgroundColor;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.prototype.isFontSize=function(e){var t=e.style&&e.style.fontSize;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.prototype.isFontName=function(e){var t=e.style&&e.style.fontFamily;return-1!==i.inlineTags.indexOf(e.nodeName.toLowerCase())&&null!==t&&""!==t&&void 0!==t},i.isCode=function(e){return-1!==["code"].indexOf(e.nodeName.toLowerCase())},i.inlineTags=["a","abbr","acronym","b","bdo","big","cite","code","dfn","em","font","i","kbd","label","q","samp","small","span","strong","sub","sup","tt","u","var","del"];var Wr=i;function i(){}var Kr="INSERT-IMAGE",Gr="INSERT-AUDIO",Xr="INSERT-VIDEO",Yr="INSERT-TABLE",Jr="INSERT-LINK",$r="INSERT-ROW",Zr="INSERT-COLUMN",es="DELETE-ROW",ts="DELETE-COLUMN",ns="REMOVE-TABLE",is="TABLE-HEADER",os="TABLE_VERTICAL_ALIGN",rs="TABLE_MERGE",ss="TABLE_VERTICAL_SPLIT",as="TABLE_HORIZONTAL_SPLIT",ls="TABLE_DASHED",ds="TABLE_ALTERNATE",cs="TABLE_MOVE",ps="alignment-type",hs="indent-type",us="p",ms=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul","video","body"],gs=["td","th"],fs=["table","tbody","td","tfoot","th","thead","tr"],bs="selection-type",vs="inserthtml-type",ys="insert-text-type",Cs="clear-type",Ns=["area","base","br","embed","hr","img","input","param","source","track","wbr","iframe","td","table"],Es=["word","excel","onenote"],Ss=["article","aside","blockquote","body","canvas","details","div","fieldset","figure","footer","form","header","li","main","nav","noscript","section"],Ts={h6:"###### ",h5:"##### ",h4:"#### ",h3:"### ",h2:"## ",h1:"# ",blockquote:"> ",pre:"```\n",p:""},Os={Bold:"**",Italic:"*",StrikeThrough:"~~",InlineCode:"`",SubScript:"<sub>",SuperScript:"<sup>",UpperCase:"A-Z",LowerCase:"a-z"},Ls={OL:"1. ",UL:"- "},ks={"toolbar-focus":"alt+f10",escape:"escape",backspace:"backspace","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-audio":"ctrl+shift+a","insert-video":"ctrl+alt+v","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",underline:"ctrl+u",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=",indents:"ctrl+]",outdents:"ctrl+[","html-source":"ctrl+shift+h","full-screen":"ctrl+shift+f","decrease-fontsize":"ctrl+shift+<","increase-fontsize":"ctrl+shift+>","justify-center":"ctrl+e","justify-full":"ctrl+j","justify-left":"ctrl+l","justify-right":"ctrl+r","clear-format":"ctrl+shift+r","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o",space:"space",enter:"enter",tab:"tab",delete:"delete","format-copy":"alt+shift+c","format-paste":"alt+shift+v",inlinecode:"ctrl+`"},ws={"toolbar-focus":"alt+f10",escape:"27","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=","full-screen":"ctrl+shift+f","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o"},xs={b:["strong"],strong:["b"],i:["emp","cite"],emp:["i","cite"],cite:["i","emp"]},Ds=["BR","IMG"],Ms={topLeft:[-1,-1],topRight:[1,-1],botRight:[1,1],botLeft:[-1,1]},Bs=["ArrowUp","ArrowDown","Enter","Tab","Escape"];function Rs(){var e=!1;return e=j.Browser.isDevice&&j.Browser.isIos?!0:e}function As(e,t){"BODY"!==e.nodeName||j.isNullOrUndefined(t)||(e=top.window.document.querySelector(t),j.isNullOrUndefined(e))||e.contentWindow.focus()}function Is(){return{bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,unorderedlist:!1,numberFormatList:!1,bulletFormatList:!1,underline:!1,alignments:null,backgroundcolor:null,fontcolor:null,fontname:null,fontsize:null,formats:null,createlink:!1,insertcode:!1,blockquote:!1,inlinecode:!1}}function Us(e,t){var n,i,o,r,s=("BODY"===t.nodeName?t.ownerDocument.defaultView.frameElement:t).closest(".e-richtexteditor"),a=s.style.height;0===e.getSelection().rangeCount||(r=(n=(e="#text"===(e=e.getSelection().getRangeAt(0)).startContainer.nodeName?e.startContainer.parentElement:e.startContainer).getBoundingClientRect()).top,n=n.bottom,i=s.getBoundingClientRect(),o=0<s.querySelectorAll(".e-count-enabled, .e-resize-enabled").length,"BODY"===t.nodeName?"auto"===a?window.innerHeight<r&&e.scrollIntoView(!1):r>t.getBoundingClientRect().height&&e.scrollIntoView({block:"nearest",inline:"nearest"}):"auto"===a?window.innerHeight<r&&e.scrollIntoView({block:"end",inline:"nearest"}):n>i.bottom&&(s.querySelector(".e-rte-content").scrollTop+=n-i.bottom+(o?20:0)),a=t.closest('div[style*="overflow-y: scroll"]'),j.isNullOrUndefined(a))||n>(r=a.getBoundingClientRect()).bottom&&(a.scrollTop+=n-r.bottom)}function Ps(e,t,n){for(var i=0;i<t.length;i++)0===i?e.splice(n+i,1,t[i]):e.splice(n+i,0,t[i])}function g(e,t){j.removeClass(e,t);for(var n=0;n<e.length;n++)0===e[n].classList.length&&e[n].getAttribute("class")&&e[n].removeAttribute("class")}function Hs(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}Fs.prototype.getBlockNodes=function(){var e=[];if(!j.isNullOrUndefined(this.root.querySelector(".e-cell-select"))){var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if(!(j.isNullOrUndefined(t)||t.length<2)){for(var n=0;n<t.length;n++)this.addBlockNodes(t[n],e);this.wrapParagraphNodes(e)}}return e},Fs.prototype.addBlockNodes=function(e,t){var n=e.childNodes;if(0===n.length)t.push(e);else for(var i=0;i<n.length;i++){var o=n[i];0<=t.indexOf(o.parentElement)||(!o.parentElement||"TD"!==o.parentElement.nodeName&&"TH"!==o.parentElement.nodeName||1!==o.parentElement.childNodes.length||"BR"!==o.nodeName&&(o.nodeType,Node.TEXT_NODE),t.push(o.parentElement))}},Fs.prototype.getTextNodes=function(){var e=[];if(!j.isNullOrUndefined(this.root.querySelector(".e-cell-select"))){var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if(!(j.isNullOrUndefined(t)||t.length<2))for(var n=0;n<t.length;n++)this.addTextNodes(t[n],e)}return e},Fs.prototype.addTextNodes=function(e,t){var n,i=e.childNodes;if(0!==i.length||"TD"!==e.nodeName&&"TH"!==e.nodeName)if(1!==i.length||"TD"!==e.nodeName&&"TH"!==e.nodeName||"BR"!==i[0].nodeName)for(var o=0;o<i.length;o++){var r=i[o];r.nodeType===Node.TEXT_NODE?t.push(r):r.nodeType===Node.ELEMENT_NODE&&this.addTextNodes(r,t)}else n=this.currentDocument.createTextNode(""),e.insertBefore(n,i[0]),t.push(n);else n=this.currentDocument.createTextNode(""),e.appendChild(n),t.push(n)},Fs.prototype.wrapParagraphNodes=function(e){for(var t=Array.from(e),n=0;n<t.length;n++){var i,o,r=t[n];"TD"!==r.nodeName&&"TH"!==r.nodeName||(1!==r.childNodes.length||"BR"!==r.childNodes[0].nodeName&&r.childNodes[0].nodeType!==Node.TEXT_NODE?(i=e.indexOf(r),this.wrapInlineNodes(r,e,i)):(i=r.childNodes[0],o=j.createElement("p"),i.parentElement.insertBefore(o,i),o.appendChild(i),r=e.indexOf(r),e[r]=o))}for(n=0;n<e.length;n++){var s,a=e[n];"LI"===a.nodeName&&1===a.childNodes.length&&(s=a.childNodes[0]).nodeType===Node.ELEMENT_NODE&&0<=this.BASIC_FORMATS.indexOf(s.nodeName.toLocaleLowerCase())&&s.textContent===a.textContent&&(e[n]=s)}},Fs.prototype.wrapInlineNodes=function(e,t,n){var i,o=e.childNodes[0],r=j.createElement("p"),s=[];if(j.isNullOrUndefined(o))e.appendChild(r),s.push(r);else for(;o;)if("BR"===o.nodeName)o.parentNode.insertBefore(r,o),r.appendChild(o),0<r.childNodes.length&&s.indexOf(r)<0&&s.push(r),o=r.nextSibling,r=j.createElement("p");else if(0<=this.BLOCK_TAGS.indexOf(o.nodeName.toLocaleLowerCase()))if(s.push(o),0<r.childNodes.length)o=r.nextSibling;else{if(o&&"LI"===o.nodeName&&0<o.querySelectorAll("li").length)for(var a=o.querySelectorAll("li"),l=0;l<a.length;l++)s.push(a[l]);o=("LI"===o.nodeName&&j.isNullOrUndefined(o.nextSibling)?o.parentElement:o).nextSibling}else if(o.nodeType===Node.TEXT_NODE)""===o.textContent.trim()&&o.textContent.indexOf("")<0?(i=o.nextSibling,j.detach(o),o=i):(o.parentNode.insertBefore(r,o),i=o,r.appendChild(i),0<r.childNodes.length&&s.indexOf(r)<0&&s.push(r),o=r.nextSibling);else if("TABLE"===o.nodeName||"UL"===o.nodeName||"OL"===o.nodeName)if("TABLE"===o.nodeName){for(var d=[],c=o.querySelectorAll("td, th"),l=0;l<c.length;l++)this.addBlockNodes(c[l],d);this.wrapParagraphNodes(d);for(l=0;l<d.length;l++)s.push(d[l]);o=o.nextSibling}else o=o.firstElementChild;else this.BLOCK_TAGS.indexOf(o.nodeName.toLocaleLowerCase())<0&&(o.parentNode.insertBefore(r,o),r.appendChild(o),0<r.childNodes.length&&s.indexOf(r)<0&&s.push(r),o=r.nextSibling);Ps(t,s,n)};var js=Fs;function Fs(e,t){this.BLOCK_TAGS=["p","h1","h2","h3","h4","h5","h6","blockquote","li","pre","td","th","div","hr","section","figure"],this.BASIC_FORMATS=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.root=e,this.currentDocument=t}var w={startSelection:"e-editor-select-start",endSelection:"e-editor-select-end"},qs=(t.prototype.contents=function(e){return e&&"IFRAME"!==e.tagName?Array.prototype.slice.call(e.childNodes||[]):[]},t.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&0<=ms.indexOf(e.tagName.toLowerCase())},t.prototype.isLink=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&"a"===e.tagName.toLowerCase()},t.prototype.blockParentNode=function(e){for(;e&&e.parentNode!==this.parent&&(!e.parentNode||!this.hasClass(e.parentNode,"e-node-inner"));)if(e=e.parentNode,this.isBlockNode(e))return e;return e},t.prototype.rawAttributes=function(e){var t={},n=e.attributes;if(0<n.length)for(var i=0;i<n.length;i++){var o=n[i];t[o.nodeName]=o.value}return t},t.prototype.attributes=function(e){if(!e)return"";for(var t="",n=this.rawAttributes(e),i=Object.keys(n).sort(),o=0;o<i.length;o++){var r=i[o],s=n[""+r];s.indexOf("'")<0&&0<=s.indexOf('"')?t+=" "+r+"='"+s+"'":0<=s.indexOf('"')&&0<=s.indexOf("'")?t+=" "+r+'="'+(s=s.replace(/"/g,"&quot;"))+'"':t+=" "+r+'="'+s+'"'}return t},t.prototype.clearAttributes=function(e){for(var t=e.attributes,n=t.length-1;0<=n;n--){var i=t[n];e.removeAttribute(i.nodeName)}},t.prototype.openTagString=function(e){return"<"+e.tagName.toLowerCase()+this.attributes(e)+">"},t.prototype.closeTagString=function(e){return"</"+e.tagName.toLowerCase()+">"},t.prototype.createTagString=function(e,t,n){return"<"+e.toLowerCase()+this.attributes(t)+">"+n+"</"+e.toLowerCase()+">"},t.prototype.isList=function(e){return!!e&&0<=["UL","OL"].indexOf(e.tagName)},t.prototype.isElement=function(e){return e===this.parent},t.prototype.isEditable=function(e){return(!e.getAttribute||"true"===e.getAttribute("contenteditable"))&&["STYLE","SCRIPT"].indexOf(e.tagName)<0},t.prototype.hasClass=function(e,t){return e&&e.classList&&e.classList.contains(t)},t.prototype.replaceWith=function(e,t){e.parentNode.insertBefore(this.parseHTMLFragment(t),e),j.detach(e)},t.prototype.parseHTMLFragment=function(e){var t=j.createElement("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)},t.prototype.wrap=function(e,t){return e.parentNode.insertBefore(t,e),(t=e.previousSibling).appendChild(e),t},t.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},t.prototype.wrapInner=function(e,t){for(e.appendChild(t),(t=e.querySelector(".e-rte-wrap-inner")).classList.remove("e-rte-wrap-inner"),0===t.classList.length&&t.removeAttribute("class");e.firstChild!==t;)t.appendChild(e.firstChild);return t},t.prototype.unWrap=function(e){var t=e&&e.parentNode;if(!t)return[];for(var n=[];e.firstChild&&" "!==e.textContent;)n.push(e.firstChild),t.insertBefore(e.firstChild,e);return n=0<n.length?n:[e.parentNode],t.removeChild(e),n},t.prototype.getSelectedNode=function(e,t){return e.nodeType===Node.ELEMENT_NODE&&0<e.childNodes.length&&e.childNodes[t-1]&&e.childNodes[t-1].nodeType===Node.ELEMENT_NODE&&(e.childNodes[t-1].classList.contains(w.startSelection)||e.childNodes[t-1].classList.contains(w.endSelection))?e=e.childNodes[t-1]:e.nodeType===Node.ELEMENT_NODE&&0<e.childNodes.length&&e.childNodes[t]&&(e=e.childNodes[t]),e=e.nodeType===Node.TEXT_NODE?e.parentNode:e},t.prototype.nodeFinds=function(e,t){for(var n=[],i=0;i<t.length;i++)e.contains(t[i])&&e!==t[i]&&n.push(t[i]);return n},t.prototype.isEditorArea=function(){for(var e=this.getRangePoint(0).commonAncestorContainer;e&&!this.isElement(e);)e=e.parentNode;return!!this.isElement(e)},t.prototype.getRangePoint=function(e){var t=this.getSelection(),n=[];if(t&&t.getRangeAt&&t.rangeCount)for(var n=[],i=0;i<t.rangeCount;i++)n.push(t.getRangeAt(i));else n=[this.currentDocument.createRange()];return void 0!==e?n[e]:n},t.prototype.getSelection=function(){return this.nodeSelection.get(this.currentDocument)},t.prototype.getPreviousNode=function(e){for(e=e.previousElementSibling;e&&"\n"===e.textContent;)e=e.previousElementSibling;return e},t.prototype.encode=function(e){var t=document.createElement("div");return t.innerText=e,t.innerHTML.replace(/<br\s*[\/]?>/gi,"\n")},t.prototype.saveMarker=function(e){var t=this.parent.querySelector("."+w.startSelection),n=this.parent.querySelector("."+w.endSelection),t=(this.hasClass(t,w.startSelection)&&1<t.classList.length?(i=this.createTagString(us,t,this.encode(t.textContent)),this.replaceWith(t,i),(t=this.parent.querySelector("."+w.startSelection)).classList.remove(w.startSelection),t.childNodes):this.unWrap(t))[0],i=this.hasClass(n,w.endSelection)&&1<n.classList.length?(i=this.createTagString(us,n,this.encode(n.textContent)),this.replaceWith(n,i),(n=this.parent.querySelector("."+w.endSelection)).classList.remove(w.endSelection),n.childNodes[0]):n?this.unWrap(n)[0]:t;return e.startContainer=e.getNodeArray(t,!0),e.endContainer=e.getNodeArray(i,!1),e},t.prototype.marker=function(e,t){return'<span class="'+e+'">'+t+"</span>"},t.prototype.setMarker=function(e){var e=e.range,t=e.startContainer.childNodes,n=1<t.length&&"TABLE"===t[0].nodeName,i=1<t.length&&"IMAGE"===t[0].nodeName&&1===e.endOffset&&"#text"===e.endContainer.nodeName&&0===e.endContainer.textContent.length,n=(n?function(e){for(var t=e;0<(t=0<t.childNodes.length?t.childNodes[0]:t).childNodes.length;);return t}(t[e.startOffset+1]):t[0<e.startOffset?e.startOffset-1:e.startOffset])||e.startContainer,t=e.endContainer.childNodes[!(0<e.endOffset)||i?e.endOffset:e.endOffset-1]||e.endContainer;if(n.nodeType===Node.ELEMENT_NODE&&t.nodeType===Node.ELEMENT_NODE&&(n.contains(t)||t.contains(n))){var o=n.contains(t)?n:t;if(o.nodeType!==Node.TEXT_NODE){for(var r=[],s=[],a=o;o.contains(a);)r.indexOf(a)<0&&a.childNodes&&a.childNodes.length?(r.push(a),a=a.childNodes[0]):a.nextSibling?a=a.nextSibling:a.parentNode&&(a=a.parentNode,r.push(a)),s.indexOf(a)<0&&(a.nodeType===Node.TEXT_NODE||0<=gs.indexOf(a.parentNode.tagName.toLocaleLowerCase())&&("BR"===a.tagName||"IMG"===a.tagName))&&s.push(a);s.length&&(n=n.contains(t)?s[0]:n,t=s[s.length-1])}}n!==t?(n.nodeType!==Node.TEXT_NODE&&("BR"===n.tagName&&0<=gs.indexOf(n.parentNode.tagName.toLocaleLowerCase())||"IMG"===n.tagName)?(this.replaceWith(n,this.marker(w.startSelection,this.encode(n.textContent))),e.startContainer.querySelector("."+w.startSelection).appendChild(n)):3!==n.nodeType&&"#text"!==n.nodeName&&"BR"!==n.nodeName?(i=this.marker(w.startSelection,""),j.append([this.parseHTMLFragment(i)],n)):this.replaceWith(n,this.marker(w.startSelection,this.encode(n.textContent))),t.nodeType!==Node.TEXT_NODE&&"BR"===t.tagName&&0<=gs.indexOf(t.parentNode.tagName.toLocaleLowerCase())?(this.replaceWith(t,this.marker(w.endSelection,this.encode(t.textContent))),e.endContainer.querySelector("."+w.endSelection).appendChild(t)):this.ensureSelfClosingTag(t,w.endSelection,e)):this.ensureSelfClosingTag(n,w.startSelection,e)},t.prototype.ensureSelfClosingTag=function(e,t,n){var i=!1;if(3===e.nodeType)this.replaceWith(e,this.marker(t,this.encode(e.textContent)));else if("BR"===e.tagName){this.replaceWith(e,this.marker(t,this.encode(e.textContent)));var o=n.startContainer.querySelector("."+t);o&&o.parentElement.appendChild(e)}else{var o=j.isNullOrUndefined(e.parentElement)?"":e.parentElement.tagName.toLocaleLowerCase();if("IMG"===e.tagName&&"p"!==o&&"div"!==o&&(o=document.createElement("p"),e.parentElement.insertBefore(o,e),o.appendChild(e),e=o.children[0]),"TABLE"===e.tagName)if(i=!0,""===e.textContent){o=e.querySelectorAll("td");e=o[o.length-1],e=j.isNullOrUndefined(e.childNodes[0])?e:e.childNodes[0]}else{for(var r=e.lastChild;3!==r.nodeType&&"#text"!==r.nodeName&&"BR"!==r.nodeName;)r=r.lastChild;e=r}for(var s=0;s<Ds.length;s++)e=e.tagName!==Ds[s]||i?e:e.parentNode;3===e.nodeType&&"#text"===e.nodeName?this.replaceWith(e,this.marker(t,this.encode(e.textContent))):"BR"===e.nodeName?(this.replaceWith(e,this.marker(w.endSelection,this.encode(e.textContent))),n.endContainer.querySelector("."+w.endSelection).appendChild(e)):(o=this.marker(t,""),j.append([this.parseHTMLFragment(o)],e))}},t.prototype.createTempNode=function(e){var t,n,i=e.textContent;return"BR"===e.tagName?(t="<p></p>",n=e.parentNode,0<=gs.indexOf(n.tagName.toLocaleLowerCase())&&(e=this.wrap(e,this.parseHTMLFragment(t)))):(e.nodeType!==Node.TEXT_NODE&&(e.classList.contains(w.startSelection)||e.classList.contains(w.endSelection))||0<i.replace(/\n/g,"").replace(/(^ *)|( *$)/g,"").length||i.length&&i.indexOf("\n")<0)&&(n=e,e=this.wrap(e,this.parseHTMLFragment(t="<p></p>")),n.nodeType!==Node.ELEMENT_NODE||!n.firstChild||"BR"!==n.firstChild.nodeName||!n.classList.contains(w.startSelection)&&!n.classList.contains(w.endSelection))&&e.nextElementSibling&&"BR"===e.nextElementSibling.tagName&&e.appendChild(e.nextElementSibling),e},t.prototype.getImageTagInSelection=function(){var e=this.getSelection();return this.isEditorArea()&&e.rangeCount?e.focusNode.querySelectorAll("img"):null},t.prototype.gatherElementsAround=function(e,t){for(var n=j.createElement(t),i=e.previousSibling,t=e.parentElement,o=("e-editor-select-start"===t.className?t.parentNode.insertBefore(n,t):t&&t.insertBefore(n,e),0);null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var r=i.previousSibling;3!==i.nodeType&&1!==i.nodeType||(0===o?n.appendChild(i):n.insertBefore(i,n.firstChild)),i=r,o++}for(n.appendChild(e),i=n.nextSibling||n.parentElement.nextSibling;null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var s=i.nextSibling||i.parentElement.nextSibling;3!==i.nodeType&&1!==i.nodeType||n.appendChild(i),i=s}return n},t.prototype.convertToBlockNodes=function(e,t){if(1<e.length)for(var n,i,o=0,r=e[0];!j.isNullOrUndefined(r);)"BR"===r.nodeName&&(n=r.nextSibling,j.detach(r),r=n),j.isNullOrUndefined(r)||(e[o]=t?"LI"===r.nodeName||this.isBlockNode(r)?r:this.gatherElementsAround(r,t?"p":"div"):this.isBlockNode(e[o])?e[o]:this.gatherElementsAround(r,t?"p":"div"),i="#text"===(n="LI"===e[o].nodeName?e[o].parentElement:e[o]).nodeName?n.parentElement:n,null!==(r=j.isNullOrUndefined(i.querySelector(".e-editor-select-end"))&&j.isNullOrUndefined(j.closest(r,".e-editor-select-end"))?n.nextSibling:null))||j.isNullOrUndefined(n.nextSibling)||"BR"!==n.nextSibling.nodeName||j.detach(n.nextSibling),o++;else this.isBlockNode(e[0])||(e[0]=this.gatherElementsAround(e[0],t?"p":"div"),j.isNullOrUndefined(e[0].nextSibling))||"BR"!==e[0].nextSibling.nodeName||j.detach(e[0].nextSibling);return e},t.prototype.blockNodes=function(l){var d=[],e=this.getSelection();if(this.isEditorArea()&&e.rangeCount)for(var c=this.getRangePoint(),p=this,t=0;t<c.length;t++)!function(e){for(var t,n=void 0,i=c[e],e=p.getSelectedNode(i.startContainer,i.startOffset),o=p.getSelectedNode(i.endContainer,i.endOffset),r=(p.isBlockNode(e)&&d.indexOf(e)<0&&d.push(e),n=p.blockParentNode(e),p.blockParentNode(o)),s=(n&&d.indexOf(n)<0&&(!j.isNullOrUndefined(l)&&l?(t=["TD","TH"],[i.commonAncestorContainer,n,r].some(function(e){return-1!==t.indexOf(e.nodeName)})?1<(r=p.getPreBlockNodeCollection(i)).length?p.wrapWithBlockNode(r,d):0<r.length&&(e!==o&&"BR"!==e.nodeName||e===o&&"SPAN"===e.nodeName&&(e.classList.contains(w.startSelection)||e.classList.contains(w.endSelection)))&&d.push(p.createTempNode(e)):d.push(n)):0<=gs.indexOf(n.tagName.toLocaleLowerCase())&&("BR"===e.tagName||e.nodeType===Node.TEXT_NODE||e.classList.contains(w.startSelection)||e.classList.contains(w.endSelection))?(r=e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE?e.previousSibling:e,e.nextSibling||e.previousSibling||"BR"!==e.tagName?d.push(p.createTempNode(r)):d.push(r)):d.push(n)),[]),a=e;a!==o&&a!==p.parent;)s.indexOf(a)<0&&a.childNodes&&a.childNodes.length?(s.push(a),a=a.childNodes[0]):a&&8!==a.nodeType&&("BR"===a.tagName||a.nodeType===Node.TEXT_NODE&&""!==a.textContent.trim()||a.nodeType!==Node.TEXT_NODE&&(a.classList.contains(w.startSelection)||a.classList.contains(w.endSelection)))&&0<=gs.indexOf(a.parentNode.tagName.toLocaleLowerCase())?a=p.createTempNode(a):a.nextSibling&&8!==a.nextSibling.nodeType&&("BR"===a.nextSibling.tagName||a.nextSibling.nodeType===Node.TEXT_NODE||a.nextSibling.classList.contains(w.startSelection)||a.nextSibling.classList.contains(w.endSelection))&&0<=gs.indexOf(a.nextSibling.parentNode.tagName.toLocaleLowerCase())?a=p.createTempNode(a.nextSibling):a.nextSibling?a=a.nextSibling:a.parentNode&&(a=a.parentNode,s.push(a)),d.indexOf(a)<0&&a.nodeType===Node.ELEMENT_NODE&&0<=gs.indexOf(a.parentNode.tagName.toLocaleLowerCase())&&(a.classList.contains(w.startSelection)||a.classList.contains(w.endSelection))&&d.push(p.createTempNode(a)),p.isBlockNode(a)&&p.ignoreTableTag(a)&&s.indexOf(a)<0&&d.indexOf(a)<0&&(a!==o||0<i.endOffset)&&d.push(a),"IMG"===a.nodeName&&"true"===a.parentElement.contentEditable&&d.push(a);(n=p.blockParentNode(o))&&p.ignoreTableTag(n)&&d.indexOf(n)<0&&!j.isNullOrUndefined(n.previousElementSibling)&&"IMG"!==n.previousElementSibling.tagName&&d.push(n)}(t);for(var n,i=d.length-1;0<i;i--)this.nodeFinds(d[i],d).length&&(n=d[i].querySelectorAll("ul, ol"),"LI"===d[i].tagName&&0<n.length||d.splice(i,1));e=this.tableSelection.getBlockNodes();return 0<e.length?e:d},t.prototype.ignoreTableTag=function(e){return!(0<=fs.indexOf(e.tagName.toLocaleLowerCase()))},t.prototype.getPreBlockNodeCollection=function(e){var t=this.getSelectedNode(e.startContainer,e.startOffset),e=this.getSelectedNode(e.endContainer,e.endOffset),n=[],i=t.closest("td, th");if(!j.isNullOrUndefined(i))for(var o=Array.from(i.childNodes),r=!0,s=this.getClosestInlineParent(t,i,!0),a=this.getClosestInlineParent(e,i,!1),l=0;l<o.length;l++){var d=o[l];s===a&&d===s?(n.push(d),r=!0):d===s?r=!1:d===a&&(n.push(d),r=!0),r||n.push(d)}return n},t.prototype.getClosestInlineParent=function(e,t,n){if(e.nodeType===Node.TEXT_NODE)return e;if(this.isBlockNode(e))return e;for(var i=e,o=!1;i;){var r=i;if(o){if(this.isBlockNode(i))return r;if(n&&i.previousSibling){if(this.isBlockNode(i.previousSibling)||"BR"===i.previousSibling.nodeName)return r;i=i.previousSibling}else{if(n||!i.nextSibling)return i;if(this.isBlockNode(i.nextSibling)||"BR"===i.nextSibling.nodeName)return r;i=i.nextSibling}}else(i=i.parentElement)===t&&(i=r,o=!0)}return null},t.prototype.wrapWithBlockNode=function(e,t){for(var n=j.createElement("p"),i=0;i<e.length;i++){var o=e[i];if("BR"===o.nodeName)o.parentNode.insertBefore(n,o),n.appendChild(o),0<n.childNodes.length&&t.push(n),n=j.createElement("p");else{if(this.isBlockNode(o))t.push(o);else{if("#text"===o.nodeName&&""===o.textContent.trim())continue;0===n.childElementCount&&o.parentNode.insertBefore(n,o),n.appendChild(o)}i===e.length-1&&n.nextElementSibling&&0===n.querySelectorAll("br").length&&"BR"===n.nextElementSibling.nodeName&&n.appendChild(n.nextElementSibling)}}0<n.childNodes.length&&t.indexOf(n)<0&&t.push(n)},t);function t(e,t){this.parent=e,this.nodeSelection=new gl(e),this.currentDocument=t,this.tableSelection=new js(e,t)}var zs="keydown",_s="action",Vs="format-type",u="keydown-handler",Qs="list-type",Ws="keyup-handler",Ks="keyup",Gs="model_changed_plugin",Xs="model_changed",Ys="ms_word_cleanup_plugin",Js="ms_word_cleanup",$s="onBegin",Zs="actionBegin",ea="format_painter_actions",ta="blockquote_list_handled",na="emoji_picker_actions",ia="mouseDown",oa="destroy",r="internal_destroy",F=(ra.WrapBefore=function(e,t,n){return t.innerText=e.textContent,n?this.AppendBefore(t,e,!0):this.AppendBefore(t,e),e.parentNode&&e.parentNode.removeChild(e),t.childNodes[0]},ra.Wrap=function(e,t){return this.AppendBefore(t,e),t.appendChild(e),e},ra.unwrap=function(e){for(var t=e.parentNode,n=[];e.firstChild;)n.push(t.insertBefore(e.firstChild,e));return t.removeChild(e),n},ra.AppendBefore=function(e,t,n){return t.parentNode?n?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.insertBefore(e,t):t},ra);function ra(){}aa.prototype.GetSpliceNode=function(e,t){return t=this.SplitNode(e,t,!0),t=this.SplitNode(e,t,!1)},aa.prototype.SplitNode=function(e,t,n){var i,o,r;return t?(e=e.cloneRange(),i=t.parentNode,o=this.nodeSelection.getIndex(t),e.collapse(n),n?e.setStartBefore(t):e.setEndAfter(t),e=e.extractContents(),n?(t=i.childNodes[o],(e=this.spliceEmptyNode(e,!1))&&0<e.childNodes.length&&(!(1!==e.childNodes.length||"IMG"===e.childNodes[0].nodeName||0<e.querySelectorAll("img").length||!this.isRteElm(e)||""!==e.textContent.trim()||32===e.textContent.charCodeAt(0)||160===e.textContent.charCodeAt(0))||(t?F.AppendBefore(e,t):(i.appendChild(e),(r=document.createElement("div")).innerHTML="&#65279;&#65279;",t=r.firstChild,i.appendChild(t))))):(t=1<i.childNodes.length?i.childNodes[o]:i.childNodes[0],(e=this.spliceEmptyNode(e,!0))&&0<e.childNodes.length&&(!(1!==e.childNodes.length||"IMG"===e.childNodes[0].nodeName||!this.isRteElm(e)||""!==e.textContent.trim()||32===e.textContent.charCodeAt(0)||160===e.textContent.charCodeAt(0))||(t?F.AppendBefore(e,t,!0):t=1<i.childNodes.length&&i.childNodes.length!==o?(t=i.childNodes[i.childNodes.length-1],F.AppendBefore(e,t,!0),t.nextSibling):(i.appendChild(e),(r=document.createElement("div")).innerHTML="&#65279;&#65279;",i.insertBefore(r.firstChild,i.firstChild),i.firstChild)))),t):null},aa.prototype.isRteElm=function(e){var t=!0;if(1===e.childNodes.length&&"IMG"!==e.childNodes[0].nodeName)for(var n=e.childNodes[0],i=0;!j.isNullOrUndefined(n.childNodes)&&i<n.childNodes.length;i++)("IMG"===n.childNodes[i].nodeName||"SPAN"===n.childNodes[i].nodeName&&(n.childNodes[i].classList.contains("e-video-wrap")||n.childNodes[i].classList.contains("e-embed-video-wrap")||n.childNodes[i].classList.contains("e-audio-wrap")))&&(t=!1);else t=!0;return t},aa.prototype.spliceEmptyNode=function(e,t){var n=1===e.childNodes.length&&"#text"===e.childNodes[0].nodeName&&""===e.childNodes[0].textContent||""===e.textContent?-1:e.childNodes.length-1;return-1<n&&!t?this.spliceEmptyNode(e.childNodes[n],t):-1<n?this.spliceEmptyNode(e.childNodes[0],t):3===e.nodeType||11===e.nodeType||"IMG"===e.nodeName||0<e.querySelectorAll("img").length||e.classList.contains("e-video-wrap")||e.classList.contains("e-audio-wrap")||e.parentNode.removeChild(e),e},aa.prototype.GetCursorStart=function(e,t,n){for(var i=(e=n?e:e.reverse())[0],o=0;o<e.length&&(n?e[o]<t:e[o]>=t);o++)i=e[o];return i},aa.prototype.GetCursorRange=function(e,t,n){for(var e=e.createRange(),i=[],o=(i.push(0),this.TrimLineBreak(n.data)),r=o.indexOf(" ",0);-1!==r;)i.indexOf(r)<0&&i.push(r),new RegExp("\\s").test(o[r-1])&&i.indexOf(r-1)<0&&i.push(r-1),new RegExp("\\s").test(o[r+1])&&i.push(r+1),r=o.indexOf(" ",r+1);return i.push(o.length),0<=i.indexOf(t.startOffset)||0<=i.indexOf(t.startOffset-1)&&(1!==t.startOffset||1===t.startOffset&&new RegExp("\\s").test(o[0]))||i[i.length-1]-1===t.startOffset&&t.endOffset!==o.length-1&&!new RegExp("\\s").test(o[0])?(e=t,this.position=1):(0!==(n=this.GetCursorStart(i,t.startOffset,!0))&&o[n]&&" "===o[n]&&(n+=1),this.position=t.startOffset-n,e.setStart(t.startContainer,n),e.setEnd(t.startContainer,this.GetCursorStart(i,t.startOffset,!1))),e},aa.prototype.GetCursorNode=function(e,t,n){return this.GetSpliceNode(this.GetCursorRange(e,t,n),n)},aa.prototype.TrimLineBreak=function(e){return e.replace(/(\r\n\t|\n|\r\t)/gm," ")};var sa=aa;function aa(){this.enterAction="P",this.position=-1,this.nodeSelection=new gl}da.Insert=function(e,t,n,i,o){r="string"==typeof t?((r=document.createElement("div")).innerHTML=t.replace(/&(times|divide|ne)(;?)/g,"&amp;$1$2"),i?r:r.firstChild):i&&(j.isNullOrUndefined(t)||j.isNullOrUndefined(t.classList)||!t.classList.contains("pasteContent"))?((r=document.createElement("div")).appendChild(t),r):t;var r,s=new gl(n),a=new sa,l=((h=s.getRange(e)).startContainer!==n||h.startContainer!==h.endContainer||0!==h.startOffset||h.startOffset!==h.endOffset||0!==n.textContent.length||"P"!==n.children[0].tagName&&"DIV"!==n.children[0].tagName&&"BR"!==n.children[0].tagName||(s.setSelectionText(e,h.startContainer.children[0],h.startContainer.children[0],0,0),h=s.getRange(e)),h.startContainer===n&&h.startContainer===h.endContainer&&0===h.startOffset&&h.startOffset===h.endOffset&&0<n.textContent.trim().length&&(l=this.findFirstTextNode(h.startContainer),j.isNullOrUndefined(l)||(s.setSelectionText(e,l,l,0,0),h=s.getRange(e))),"BR"===h.startContainer.nodeName&&0===h.startOffset&&h.startOffset===h.endOffset&&h.startContainer===h.endContainer&&(l=Array.prototype.slice.call(h.startContainer.parentElement.childNodes).indexOf(h.startContainer),s.setSelectionText(e,h.startContainer.parentElement,h.startContainer.parentElement,l,l),h=s.getRange(e)),h.startOffset===h.endOffset&&0===h.startOffset&&h.startContainer===h.endContainer),d=h.collapsed,c=this.getNodeCollection(h,s,r),p="table"===r.nodeName.toLowerCase()?j.isNullOrUndefined(c[0])?h.startContainer:this.closestEle(c[0].parentNode,n):c[0];if(p&&"LI"===p.nodeName&&"table"===r.nodeName.toLowerCase())this.insertTableInList(h,r,p,c[0],a);else if(!l||""!==h.startContainer.textContent||"BR"===h.startContainer.nodeName||"BR"===o||"#text"===r.nodeName||j.isNullOrUndefined(r.children[0])||j.isNullOrUndefined(r.children[0].tagName)||"IMG"!==r.children[0].tagName||1!==r.children.length||(h.startContainer.innerHTML=""),i||!j.isNullOrUndefined(r)&&!j.isNullOrUndefined(r.classList)&&r.classList.contains("pasteContent"))this.pasteInsertHTML(c,r,h,s,a,e,d,p,n,o);else if(n!==h.startContainer&&(!d&&(p.nodeType!==Node.ELEMENT_NODE||-1===fs.indexOf(p.tagName.toLocaleLowerCase()))||"table"===r.nodeName.toLowerCase()&&p&&-1===fs.indexOf(p.tagName.toLocaleLowerCase()))){var h,i=a.GetSpliceNode(h,p),o=i.previousSibling,u=i.parentNode;if(1===c.length||"table"===r.nodeName.toLowerCase()&&0===i.childElementCount?s.setSelectionContents(e,i):(d=a.GetSpliceNode(h,c[c.length-1].parentElement),d=j.isNullOrUndefined(d)?i:d,s.setSelectionText(e,i,d,0,(3===d.nodeType?d.textContent:d.childNodes).length)),null!==(h=s.getRange(e)).startContainer.parentElement.closest("ol,ul")&&null!==h.endContainer.parentElement.closest("ol,ul")){var m=h;if(null!==m.startContainer.parentElement.closest("ol,ul")&&null!==m.endContainer.parentElement.closest("ol,ul")){for(m.extractContents();0<("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("li :empty").length||0<("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("ol :empty").length;){var g=("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("li :empty");if(!(0<g.length))break;g.forEach(function(e){e.remove()})}p=("#text"===m.startContainer.nodeName?m.startContainer.parentElement:m.startContainer).querySelectorAll("li");0<p.length&&p.forEach(function(e){j.isNullOrUndefined(e.firstChild)||"OL"!==e.firstChild.nodeName&&"UL"!==e.firstChild.nodeName||(e.style.listStyleType="none")})}}else h.extractContents();"TABLE"===t.tagName&&this.removeEmptyElements(n);for(var f=0;f<c.length;f++)3!==c[f].nodeType&&null!=c[f].parentNode&&"IMG"!==c[f].nodeName&&c[f].parentNode.removeChild(c[f]);if(j.isNullOrUndefined(o)||j.isNullOrUndefined(o.parentNode)){for(var b=null;u!==n&&u.firstChild&&""===u.textContent.trim();)b=u,u=u.parentNode;(u=null!==b?b:u).firstChild&&(u!==n||"TABLE"===r.nodeName&&l&&u===h.startContainer&&u===h.endContainer)?""===u.textContent.trim()&&u!==n?(F.AppendBefore(r,u,!1),j.detach(u)):F.AppendBefore(r,u.firstChild,!1):j.isNullOrUndefined(i.previousSibling)&&"TABLE"===t.tagName?u.prepend(r):u.appendChild(r)}else e.contains(o)?F.AppendBefore(r,o,!0):h.insertNode(r);"IMG"===r.nodeName?this.imageFocus(r,s,e):3!==r.nodeType?s.setSelectionText(e,r,r,0,r.childNodes.length):s.setSelectionText(e,r,r,0,r.textContent.length)}else h.deleteContents(),l&&""===h.startContainer.textContent&&"BR"!==h.startContainer.nodeName&&(h.startContainer.innerHTML=""),j.Browser.isIE?((a=e.createDocumentFragment()).appendChild(r),h.insertNode(a)):1===h.startContainer.nodeType&&"hr"===h.startContainer.nodeName.toLowerCase()&&"hr"===h.endContainer.nodeName.toLowerCase()?(d=h.startContainer.nextElementSibling)&&(d.querySelector("br")&&j.detach(d.querySelector("br")),d.appendChild(r)):"BR"===h.startContainer.nodeName?h.startContainer.parentElement.insertBefore(r,h.startContainer):h.insertNode(r),3!==r.nodeType&&0<r.childNodes.length?s.setSelectionText(e,r,r,1,1):"IMG"===r.nodeName?this.imageFocus(r,s,e):3!==r.nodeType?s.setSelectionContents(e,r):s.setSelectionText(e,r,r,r.textContent.length,r.textContent.length)},da.findFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.findFirstTextNode(e.childNodes[t]);if(!j.isNullOrUndefined(n))return n}return null},da.pasteInsertHTML=function(e,t,n,i,o,r,s,a,l,d){for(var c,p,h,u=n.startOffset===n.endOffset&&n.startContainer===n.endContainer,m=(u&&n.startContainer===l&&""===l.textContent&&0===n.startOffset&&0===n.endOffset&&(O=this.getImmediateBlockNode(e[e.length-1],l),i.setSelectionText(r,O,O,0,0),n=i.getRange(r)),l!==n.startContainer&&(!s&&(a.nodeType!==Node.ELEMENT_NODE||-1===fs.indexOf(a.tagName.toLocaleLowerCase()))||"table"===t.nodeName.toLowerCase()&&a&&-1===fs.indexOf(a.tagName.toLocaleLowerCase()))&&(O=o.GetSpliceNode(n,a),j.isNullOrUndefined(O)||(p=(j.isNullOrUndefined(O.previousSibling)?O.parentNode:O).previousSibling,h=1===e.length?(i.setSelectionContents(r,O),n=i.getRange(r),!0):(c=o.GetSpliceNode(n,e[e.length-1].parentElement),c=j.isNullOrUndefined(c)?O:c,i.setSelectionText(r,O,c,0,(3===c.nodeType?c.textContent:c.childNodes).length),n=i.getRange(r),!1))),!1),g=(this.removingComments(t),t.childNodes),f=0;f<g.length;f++)if(0<=ms.indexOf(g[f].nodeName.toLocaleLowerCase())){m=!0;break}var b=document.createDocumentFragment();if(m){for(var v=n.startContainer;!j.isNullOrUndefined(v)&&"PRE"!==v.nodeName&&v!==l;)v=v.parentElement;if(j.isNullOrUndefined(t)||j.isNullOrUndefined(v)||"PRE"!==v.nodeName){this.insertTempNode(n,t,e,o,l);var y,C,N=!0,E=void 0,S=void 0,T=void 0;for(this.contentsDeleted||(s||0!==n.startContainer.parentElement.textContent.length||"BR"!==n.startContainer.nodeName||"P"!==n.startContainer.parentElement.nodeName||l.removeChild(n.startContainer.parentElement),n.deleteContents());t.firstChild;)"#text"===t.firstChild.nodeName&&""===t.firstChild.textContent.trim()?j.detach(t.firstChild):"#text"===t.firstChild.nodeName&&N||0<=this.inlineNode.indexOf(t.firstChild.nodeName.toLocaleLowerCase())&&N?(C=t.firstChild,j.isNullOrUndefined(t.previousElementSibling)&&(y="DIV"===d?j.createElement("div"):j.createElement("p"),t.parentElement.insertBefore(y,t)),"BR"===t.previousElementSibling.nodeName?t.parentElement.insertBefore(t.firstChild,t):t.previousElementSibling.appendChild(t.firstChild)):(C=t.firstChild,E="#text"===t.firstChild.nodeName||0<=this.inlineNode.indexOf(t.firstChild.nodeName.toLocaleLowerCase())?(E?(T.appendChild(t.firstChild),b.appendChild(T)):((S="DIV"===d?j.createElement("div"):j.createElement("p")).appendChild(t.firstChild),b.appendChild(S)),T=S,!0):(b.appendChild(t.firstChild),!1),N=!1);t.parentNode.replaceChild(b,t)}else n.insertNode(t),C=t.lastChild}else if(u){var a=j.createElement("span",{className:"tempSpan"}),O=j.closest(n.startContainer.parentElement,"a");for(3===n.startContainer.nodeType&&O&&j.closest(O,"span")?(0<(o=this.getImmediateBlockNode(n.startContainer,l)).querySelectorAll("br").length&&j.detach(o.querySelector("br")),j.closest(O,"span").appendChild(a)):"#text"===e[0].nodeName&&e[0].nodeValue.includes("")&&!j.isNullOrUndefined(e[0].parentElement)&&!j.isNullOrUndefined(e[0].parentElement.previousElementSibling)&&e[0].parentElement.previousElementSibling.classList.contains("e-mention-chip")?n.startContainer.parentElement.insertAdjacentElement("afterend",a):n.insertNode(a);t.firstChild;)C=t.firstChild,b.appendChild(t.firstChild);a.parentNode.replaceChild(b,a)}else{for(;t.firstChild;)C=t.firstChild,b.appendChild(t.firstChild);h?(n.deleteContents(),this.removeEmptyElements(l,!0),n.insertNode(b)):(s=l===n.startContainer?n.startContainer:n.startContainer.parentNode,u=Array.prototype.indexOf.call(s.childNodes,-1!==j.Browser.userAgent.indexOf("Firefox")&&l===n.startContainer?n.startContainer.firstChild:n.startContainer),n.deleteContents(),n.setStart(s,u),n.setEnd(s,u),j.isNullOrUndefined(c)||c===l||(j.detach(c),this.removeEmptyElements(l,!0)),j.isNullOrUndefined(p)?n.insertNode(b):(p.parentNode===l?p:p.parentNode).appendChild(b))}"TABLE"===C.nodeName&&((o=j.createElement("p")).appendChild(j.createElement("br")),C.parentElement.insertBefore(o,C.nextSibling),C=o),"#text"===C.nodeName?this.placeCursorEnd(C,t,i,r,l):"HR"===C.nodeName?(O=C.nextSibling||null,(e="DIV"===d?j.createElement("div"):j.createElement("p")).appendChild(j.createElement("br")),C=j.isNullOrUndefined(O)||"HR"!==O.nodeName?j.isNullOrUndefined(O)?(C.parentNode.appendChild(e),C.parentNode.insertBefore(C,e),e):O:(C.parentNode.insertBefore(e,O),e),i.setSelectionText(r,C,C,0,0)):this.cursorPos(C,t,i,r,l),this.alignCheck(l),this.listCleanUp(i,r)},da.listCleanUp=function(e,t){var e=e.getRange(t),t=e.startContainer,n=e.startOffset,i=e.startContainer.parentElement,o=e.endContainer.parentElement;j.isNullOrUndefined(i)||j.isNullOrUndefined(o)||(i=i.closest("ol, ul"),o=o.closest("ol, ul"),!j.isNullOrUndefined(i)&&!j.isNullOrUndefined(o)&&(o=this.cleanUpListItems(i),i=this.cleanUpListContainer(i),o||i)&&(e.setStart(t,n),e.setEnd(t,n)))},da.cleanUpListItems=function(e){var a,t,l=this,d=!1;return j.isNullOrUndefined(e.closest("ol, ul"))||(t=e.closest("ol, ul").querySelectorAll("li")),!j.isNullOrUndefined(t)&&0!==t.length&&(a=null,t.forEach(function(e){var t=e.parentElement;if(!j.isNullOrUndefined(t)&&"OL"!==t.nodeName&&"UL"!==t.nodeName&&(j.isNullOrUndefined(a)&&(a=t.closest("li")),!j.isNullOrUndefined(a))){var n=e.nextSibling;if(!j.isNullOrUndefined(n)&&"LI"!==n.nodeName){for(var i=Array.prototype.indexOf.call(t.childNodes,n),o=t.cloneNode(!1),r=t.childNodes.length,s=i;s<r;s++)o.appendChild(t.childNodes[i]);0<o.childNodes.length?((n=document.createElement("li")).appendChild(o),a.insertAdjacentElement("afterend",n)):o.remove()}n=t.closest("ol, ul");a.insertAdjacentElement("afterend",e),a=a.nextSibling,j.isNullOrUndefined(n)||l.removeEmptyElements(n),d=!0}}),t=this.cleanUpFlattenListContainer(e),d=t||d)},da.cleanUpFlattenListContainer=function(e){var t,n=!1;return j.isNullOrUndefined(e.closest("ol, ul"))||(t=e.closest("ol, ul").querySelectorAll("li")),!j.isNullOrUndefined(t)&&0!==t.length&&(t.forEach(function(e){j.isNullOrUndefined(e.firstChild)||"OL"!==e.firstChild.nodeName&&"UL"!==e.firstChild.nodeName||(e.style.listStyleType="none");var t=Array.from(e.children).find(function(e){return"LI"===e.tagName&&e.parentElement&&"OL"!==e.parentElement.tagName&&"UL"!==e.parentElement.tagName});j.isNullOrUndefined(t)||j.isNullOrUndefined(e.parentNode)||(e.parentNode.replaceChild(t,e),!j.isNullOrUndefined(t.textContent)&&""!==t.textContent.trim()||t.remove(),n=!0)}),n)},da.cleanUpListContainer=function(n){var i=!1,t=[],o=[];return j.isNullOrUndefined(n)||(n.childNodes.forEach(function(e){"LI"!==e.nodeName.toLocaleUpperCase()&&t.push(e),("LI"===e.nodeName.toLocaleUpperCase()||n.lastChild===e)&&0<t.length&&(o.push({elements:t.slice()}),t=[])}),o.forEach(function(e){var e=e.elements,t=document.createElement("li");e[0].parentNode.replaceChild(t,e[0]),e.forEach(function(e){return t.appendChild(e)}),t.textContent&&""===t.textContent.trim()&&n.removeChild(t),i=!0})),i},da.placeCursorEnd=function(e,t,n,i,o){for(e="BR"===e.nodeName?j.isNullOrUndefined(e.previousSibling)?e.parentNode:e.previousSibling:e;!j.isNullOrUndefined(e)&&"#text"!==e.nodeName&&"IMG"!==e.nodeName&&"BR"!==e.nodeName&&"HR"!==e.nodeName;){var r;j.isNullOrUndefined(e.lastChild)||"P"!==e.lastChild.nodeName||""!==e.lastChild.innerHTML||(r=j.createElement("br"),e.lastChild.appendChild(r)),e=e.lastChild}"IMG"===(e=j.isNullOrUndefined(e)?t:e).nodeName?this.imageFocus(e,n,i):n.setSelectionText(i,e,e,e.textContent.length,e.textContent.length),this.removeEmptyElements(o)},da.getNodeCollection=function(e,t,n){var i=[];return e.startOffset===e.endOffset&&e.startContainer===e.endContainer&&"BR"!==e.startContainer.nodeName&&0<e.startContainer.childNodes.length&&("TD"===e.startContainer.nodeName||3!==e.startContainer.nodeType&&n.classList&&n.classList.contains("pasteContent"))?i.push(e.startContainer.childNodes[e.endOffset]):i=t.getInsertNodeCollection(e),i},da.insertTempNode=function(e,t,n,i,o){if(e.startContainer!==o||j.isNullOrUndefined(e.startContainer.childNodes[e.endOffset-1])||"TABLE"!==e.startContainer.childNodes[e.endOffset-1].nodeName)if(e.startContainer!==o||j.isNullOrUndefined(e.startContainer.childNodes[e.endOffset])||"TABLE"!==e.startContainer.childNodes[e.endOffset].nodeName)if(e.startContainer===e.endContainer&&3!==e.startContainer.nodeType&&"HR"===t.firstChild.nodeName)e.startContainer.classList.contains("e-content")||"BODY"===e.startContainer.nodeName?e.startContainer.appendChild(t):e.startContainer.parentNode.insertBefore(t,e.startContainer);else{var r=this.getImmediateBlockNode(n[n.length-1],o);if((j.isNullOrUndefined(r)||j.isNullOrUndefined(r.parentElement))&&3!==e.endContainer.nodeType&&(r=e.endContainer,e.setEnd(r,e.endContainer.textContent.length)),(r=r&&"BODY"===r.nodeName||"DIV"===r.nodeName&&e.startContainer===e.endContainer&&1===e.startContainer.nodeType?e.startContainer:r)&&r.closest("LI")&&o.contains(r.closest("LI"))&&"TD"!==r.nodeName&&"TH"!==r.nodeName&&"TR"!==r.nodeName&&t&&t.firstElementChild&&("OL"===t.firstElementChild.tagName||"UL"===t.firstElementChild.tagName))for(var s=void 0;t.firstElementChild.lastElementChild&&"LI"===t.firstElementChild.lastElementChild.tagName;)(s=t.firstElementChild.lastElementChild).style.removeProperty("margin-left"),s.style.removeProperty("margin-top"),s.style.removeProperty("margin-bottom"),t.firstElementChild.insertAdjacentElement("afterend",s);if(r&&"TD"===r.nodeName||"TH"===r.nodeName||"TR"===r.nodeName){for(var a=e.startContainer;!j.isNullOrUndefined(a)&&a.parentElement!==r;)a=a.parentElement;e.deleteContents(),(d=i.GetSpliceNode(e,a))?d.parentNode.replaceChild(t,d):e.insertNode(t),this.contentsDeleted=!0}else{var l,n=new gl(o),n=this.getNodeCollection(e,n,t)[this.getNodeCollection(e,n,t).length-1],d=void 0;if(!n||"BR"!==n.nodeName&&"HR"!==n.nodeName&&("#text"!==n.nodeName||j.isNullOrUndefined(n.parentElement)||"LI"!==n.parentElement.nodeName)||j.isNullOrUndefined(n.parentElement)||0!==n.parentElement.textContent.trim().length){if(n&&("#text"===n.nodeName||"BR"===n.nodeName)&&!j.isNullOrUndefined(n.parentElement)&&("LI"===n.parentElement.nodeName||n.parentElement.closest("LI")||r===o&&n.parentElement===r)&&0<n.parentElement.textContent.trim().length)return"LI"!==(d=n).parentElement.nodeName||j.isNullOrUndefined(n.nextSibling)||"BR"!==n.nextSibling.nodeName||j.detach(n.nextSibling),e.collapsed||(o=e.startContainer,l=e.startOffset,this.removeListfromPaste(e),e.setStart(o,l),e.setEnd(o,l)),e.insertNode(t),void(this.contentsDeleted=!0);d=i.GetSpliceNode(e,r)}else if("LI"!==(d=n).parentElement.nodeName||j.isNullOrUndefined(n.nextSibling)||"BR"!==n.nextSibling.nodeName||j.detach(n.nextSibling),"LI"===n.parentElement.nodeName&&""===n.parentElement.textContent)return this.removeListfromPaste(e),e.insertNode(t),void(this.contentsDeleted=!0);d.parentNode.replaceChild(t,d)}}else e.startContainer.insertBefore(t,e.startContainer.childNodes[e.endOffset]);else j.isNullOrUndefined(e.startContainer.childNodes[e.endOffset-1].nextSibling)?e.startContainer.appendChild(t):e.startContainer.insertBefore(t,e.startContainer.childNodes[e.endOffset-1].nextSibling)},da.cursorPos=function(e,t,n,i,o){e.classList.add("lastNode"),o.innerHTML=function(e){for(var t=document.createElement("div"),n=(t.innerHTML=e,t.querySelectorAll("table")),i=0;i<n.length;i++)if(0<n[i].classList.length&&!n[i].classList.contains("e-rte-table")&&!n[i].classList.contains("e-rte-custom-table"))if(n[i].classList.add("e-rte-paste-table"),n[i].classList.contains("e-rte-paste-word-table"))n[i].classList.remove("e-rte-paste-word-table");else if(n[i].classList.contains("e-rte-paste-excel-table")){n[i].classList.remove("e-rte-paste-excel-table"),"0"===n[i].getAttribute("border")&&n[i].removeAttribute("border");for(var o=n[i].querySelectorAll("td"),r=0;r<o.length;r++)"none"===o[r].style.borderLeft&&o[r].style.removeProperty("border-left"),"none"===o[r].style.borderRight&&o[r].style.removeProperty("border-right"),"none"===o[r].style.borderBottom&&o[r].style.removeProperty("border-bottom"),"none"===o[r].style.borderTop&&o[r].style.removeProperty("border-top"),"none"===o[r].style.border&&o[r].style.removeProperty("border")}else n[i].classList.contains("e-rte-paste-onenote-table")?n[i].classList.remove("e-rte-paste-onenote-table"):n[i].classList.contains("e-rte-paste-html-table")&&n[i].classList.remove("e-rte-paste-html-table");for(var s=t.querySelectorAll("img"),i=0;i<s.length;i++)s[i].classList.contains("e-rte-image-unsupported")||(s[i].classList.contains("e-rte-image")||s[i].classList.add("e-rte-image"),s[i].classList.contains("e-imginline"))||s[i].classList.contains("e-imgbreak")||s[i].classList.add("e-imginline");return t.innerHTML}(o.innerHTML),e=o.querySelector(".lastNode"),j.isNullOrUndefined(e)||(this.placeCursorEnd(e,t,n,i,o),e.classList.remove("lastNode"),0===e.classList.length&&e.removeAttribute("class"))},da.imageFocus=function(e,t,n){var i,o,r=document.createTextNode(" ");e.parentNode&&"A"===e.parentNode.nodeName?((o=(i=e.parentNode).parentNode).insertBefore(r,i.nextSibling),o.insertBefore(e,r)):e.parentNode.insertBefore(r,e.nextSibling),t.setSelectionText(n,e.nextSibling,e.nextSibling,0,0)},da.getImmediateBlockNode=function(e,t){for(;e&&ms.indexOf(e.nodeName.toLocaleLowerCase())<0;)e=e.parentNode;return e},da.removingComments=function(e){var t=(t=e.innerHTML).replace(/<!--[\s\S]*?-->/g,"");e.innerHTML=t},da.findDetachEmptyElem=function(e,t){return void 0===t&&(t=!1),j.isNullOrUndefined(e.parentElement)?null:!(0<e.parentElement.textContent.length&&e.parentElement.textContent.match(/\u00a0/g)&&0<e.parentElement.textContent.match(/\u00a0/g).length)&&""===e.parentElement.textContent.trim()&&"true"!==e.parentElement.contentEditable&&j.isNullOrUndefined(e.parentElement.querySelector("img"))&&"TD"!==e.parentElement.nodeName&&"TH"!==e.parentElement.nodeName?t&&-1!==ms.indexOf(e.parentElement.tagName.toLowerCase())?e:this.findDetachEmptyElem(e.parentElement,t):t&&-1!==ms.indexOf(e.tagName.toLowerCase())?null:e},da.removeEmptyElements=function(e,t){void 0===t&&(t=!1);for(var e=e.querySelectorAll(":empty"),n=Array.from(e).filter(function(e){return!e.closest("svg")&&!e.closest("canvas")}),i=0;i<n.length;i++){var o=!0;"DIV"===n[i].tagName&&(o="none"===n[i].style.borderBottom||""===n[i].style.borderBottom),Ns.indexOf(n[i].tagName.toLowerCase())<0&&o&&(o=this.findDetachEmptyElem(n[i],t),j.isNullOrUndefined(o)||o.nodeType===Node.ELEMENT_NODE&&"TEXTAREA"===o.nodeName.toUpperCase()||j.detach(o))}},da.closestEle=function(e,t){var n=e;if(j.closest(n,"li"))return j.closest(n,"li");for(;n&&1===n.nodeType;){if(n.parentNode===t||!j.isNullOrUndefined(n.parentNode.tagName)&&(-1!==gs.indexOf(n.parentNode.tagName.toLocaleLowerCase())||-1!==Ss.indexOf(n.parentNode.tagName.toLocaleLowerCase())))return n;n=n.parentNode}return null},da.insertTableInList=function(e,t,n,i,o){var r,s;e.collapsed?(r=0===e.startOffset,s=e.startContainer.textContent.trimEnd().length===e.startOffset,r||s?r?F.AppendBefore(t,i,!1):F.AppendBefore(t,i,!0):o.SplitNode(e,n,!0).previousSibling.appendChild(t)):(e.deleteContents(),n.appendChild(t)),t.classList.add("ignore-table")},da.alignCheck=function(e){for(var t=e.querySelectorAll('span[style*="text-align"]'),n=0;n<t.length;n++){var i=t[n];if(i){var o=this.getImmediateBlockNode(i,null);if(o){for(var r="",s=0;s<t.length;s++){var a=t[s];o.contains(a)&&(r+=a.textContent)}o.textContent.trim()===r.trim()&&(o.style.textAlign=i.style.textAlign)}}}},da.removeListfromPaste=function(e){e.deleteContents();var t=e.startContainer;j.isNullOrUndefined(t)||"LI"!==t.nodeName||j.isNullOrUndefined(t.parentElement)||"OL"!==t.parentElement.nodeName&&"UL"!==t.parentElement.nodeName||""!==t.textContent.trim()||t.parentElement.querySelectorAll("li").forEach(function(e){""===e.textContent.trim()&&e!==t&&e.remove()})},da.inlineNode=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"],da.contentsDeleted=!1;var la=da;function da(){}s.prototype.addEventListener=function(){this.parent.observer.on(Qs,this.applyListsHandler,this),this.parent.observer.on(Ws,this.onKeyUp,this),this.parent.observer.on(u,this.keyDownHandler,this),this.parent.observer.on(Zs,this.spaceKeyAction,this),this.parent.observer.on(r,this.destroy,this)},s.prototype.removeEventListener=function(){this.parent.observer.off(Qs,this.applyListsHandler),this.parent.observer.off(Ws,this.onKeyUp),this.parent.observer.off(u,this.keyDownHandler),this.parent.observer.off(Zs,this.spaceKeyAction),this.parent.observer.off(r,this.destroy)},s.prototype.testList=function(e){var t=[/^[\d]+[.]+$/,/^(?=[MDCLXVI])M*(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})[.]$/gi,/^[a-zA-Z][.]+$/],n=j.isNullOrUndefined(e)?null:e.innerText.trim().split(".")[0]+".";if(!j.isNullOrUndefined(n))for(var i=0;i<t.length;i++)if(t[i].test(n))return!0;return!1},s.prototype.testCurrentList=function(e){var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!j.isNullOrUndefined(e.startContainer.textContent.slice(0,e.startOffset)))for(var n=e.startContainer.textContent.replace(/\u200B/g,"").slice(0,e.startOffset).trim(),i=0;i<t.length;i++)if(t[i].test(n)&&2===n.length)return!0;return!1},s.prototype.createAutoList=function(e,t){var n={BR:{BR:!0,P:!0,DIV:!0},P:{BR:!1,P:!0,DIV:!0},DIV:{BR:!1,P:!0,DIV:!0}};return!(!n[e]||void 0===n[e][t])&&n[e][t]},s.prototype.spaceList=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=(this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument),this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset)),i=(this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset),n.previousElementSibling),n=n.nextElementSibling,o=j.isNullOrUndefined(i)?null:i.innerText.trim().substring(0,1),r=j.isNullOrUndefined(n)?null:n.innerText.trim().substring(0,1),s=this.testCurrentList(t),i=this.testList(i),n=this.testList(n),a=t.startContainer.previousElementSibling&&"BR"===t.startContainer.previousElementSibling.tagName;i||n||"*"===o||"*"===r||!this.createAutoList(e.enterKey,e.shiftEnterKey)&&a||(i=j.createElement("br"),s?(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(i,t.startContainer),this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault()):"*"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()&&"-"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()||(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(i,t.startContainer),this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()))},s.prototype.enterList=function(e){var t,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i="LI"===n.startContainer.nodeName?n.startContainer:n.startContainer.parentElement.closest("LI"),o="LI"===n.endContainer.nodeName?n.endContainer:n.endContainer.parentElement.closest("LI"),r=!1;j.isNullOrUndefined(i)||(t=0<(t=i.querySelectorAll(".e-video-clickelem")).length&&"IFRAME"===t[0].childNodes[0].nodeName,r=0<i.querySelectorAll("IMG").length||0<i.querySelectorAll("AUDIO").length||0<i.querySelectorAll("VIDEO").length||t),j.isNullOrUndefined(i)||j.isNullOrUndefined(o)||i!==o||"LI"!==i.tagName||""!==i.textContent.trim()||r||0<=i.innerHTML.indexOf("&nbsp;")||(65279===i.textContent.charCodeAt(0)&&(i.textContent=""),o=(t=i.parentElement).parentElement,j.isNullOrUndefined(o.closest("UL"))&&j.isNullOrUndefined(o.closest("OL"))&&(n=void(j.isNullOrUndefined(i.nextElementSibling)||(r=this.parent.domNode.blockParentNode(i),this.parent.nodeCutter.GetSpliceNode(n,r))),"DIV"===e.enterAction?(n=j.createElement("div")).innerHTML="<br>":"P"===e.enterAction?(n=j.createElement("p")).innerHTML="<br>":n=j.createElement("br"),j.isNullOrUndefined(o)||"BLOCKQUOTE"!==o.nodeName||this.parent.observer.notify("blockquote_list_handled",{}),this.parent.domNode.insertAfter(n,t),e.event.preventDefault(),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),""===t.textContent&&0===t.querySelectorAll("audio,video").length?j.detach(t):j.detach(i)),j.isNullOrUndefined(o))||j.isNullOrUndefined(o.closest("UL"))&&j.isNullOrUndefined(o.closest("OL"))||"LI"!==o.nodeName||"none"!==o.style.listStyleType||""!==o.textContent||""!==i.textContent||i!==t.firstElementChild||!j.isNullOrUndefined(i.nextSibling)||(j.detach(t),o.style.removeProperty("list-style-type"),e.event.preventDefault())},s.prototype.backspaceList=function(e){var t,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.domNode.getSelectedNode(n.startContainer,n.startOffset),o=this.parent.domNode.getSelectedNode(n.endContainer,n.endOffset);if((i="BR"===i.nodeName?i.parentElement:i)===(o="BR"===o.nodeName?o.parentElement:o)&&!j.isNullOrUndefined(j.closest(i,"li"))&&(""===i.textContent.trim()&&65279===i.textContent.charCodeAt(0)||1===i.textContent.length&&8203===i.textContent.charCodeAt(0))&&(i.textContent=""),i===o&&"LI"===i.tagName&&0===i.textContent.length&&j.isNullOrUndefined(i.previousElementSibling)&&i.removeAttribute("style"),i===o&&""===i.textContent){if("LI"===i.parentElement.tagName&&"LI"===o.parentElement.tagName)j.detach(i);else if(i.closest("ul")||i.closest("ol"))if((t=j.isNullOrUndefined(i.closest("ul"))?i.closest("ol"):i.closest("ul")).firstElementChild===i&&!j.isNullOrUndefined(t.children[1])&&("OL"===t.children[1].tagName||"UL"===t.children[1].tagName))if(t.tagName===t.children[1].tagName){for(;t.children[1].lastChild;)this.parent.domNode.insertAfter(t.children[1].lastChild,t.children[1]);j.detach(t.children[1])}else t.parentElement.insertBefore(t.children[1],t)}else if(!(j.isNullOrUndefined(i.firstChild)||"BR"!==i.firstChild.nodeName||j.isNullOrUndefined(i.childNodes[1])||"UL"!==i.childNodes[1].nodeName&&"OL"!==i.childNodes[1].nodeName))if((t=j.isNullOrUndefined(i.closest("ul"))?i.closest("ol"):i.closest("ul")).tagName===i.childNodes[1].nodeName){for(;i.childNodes[1].lastChild;)this.parent.domNode.insertAfter(i.children[1].lastChild,i);j.detach(i.childNodes[1])}else t.parentElement.insertBefore(i.children[1],t);this.removeList(n,e),this.firstListBackSpace(n,e)},s.prototype.removeList=function(e,t){var n=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset),i=!j.isNullOrUndefined(e.endContainer.parentElement.closest("li"))&&1<e.endContainer.parentElement.closest("li").childElementCount&&"#text"===e.endContainer.nodeName?e.endContainer:this.parent.domNode.getSelectedNode(e.endContainer,e.endOffset),o=("#text"===e.startContainer.nodeName?e.startContainer.parentElement:e.startContainer).closest("li"),r="";if(j.isNullOrUndefined(o)||j.isNullOrUndefined(o.firstChild)||o.childNodes.forEach(function(e){r+=e.textContent}),n="BR"===n.nodeName?n.parentElement:n,i="BR"===i.nodeName?i.parentElement:i,n="LI"===n.nodeName||j.isNullOrUndefined(n.closest("LI"))?n:n.closest("LI"),i="LI"===i.nodeName||"#text"===i.nodeName||j.isNullOrUndefined(i.closest("LI"))?i:i.closest("LI"),(("OL"===e.commonAncestorContainer.nodeName||"UL"===e.commonAncestorContainer.nodeName||"LI"===e.commonAncestorContainer.nodeName)&&j.isNullOrUndefined(i.nextElementSibling)&&i.textContent.length===e.endOffset&&j.isNullOrUndefined(n.previousElementSibling)&&0===e.startOffset||-1!==j.Browser.userAgent.indexOf("Firefox")&&e.startContainer===e.endContainer&&e.startContainer===this.parent.editableElement&&0===e.startOffset&&1===e.endOffset)&&(-1!==j.Browser.userAgent.indexOf("Firefox")?j.detach(e.commonAncestorContainer.childNodes[0]):"LI"===e.commonAncestorContainer.nodeName?j.detach(e.commonAncestorContainer.parentElement):j.detach(e.commonAncestorContainer),t.event.preventDefault(),o=("#text"===e.startContainer.nodeName?e.startContainer.parentElement:e.startContainer).closest("li")),!j.isNullOrUndefined(o)&&(!e.collapsed||""===o.textContent.trim()&&j.isNullOrUndefined(o.previousElementSibling)&&j.isNullOrUndefined(o.nextElementSibling))&&o.textContent===r){e.deleteContents();for(var s=this.parent.editableElement.querySelectorAll("li"),a=0;a<s.length;a++)!function(t){j.isNullOrUndefined(s[t].childNodes)||s[t].childNodes.forEach(function(e){"A"===e.nodeName&&""===e.textContent&&s[t].removeChild(e)}),s[t].firstChild&&""!==s[t].textContent.trim()||s[t]!==n&&s[t]!==i||s[t].parentNode.removeChild(s[t])}(a);this.parent.editableElement.querySelectorAll("ol").forEach(function(e){e.firstChild&&""!==e.textContent.trim()||e.parentNode.removeChild(e)}),this.parent.editableElement.querySelectorAll("ul").forEach(function(e){e.firstChild&&""!==e.textContent.trim()||e.parentNode.removeChild(e)}),t.event.preventDefault()}},s.prototype.onKeyUp=function(e){if(!j.isNullOrUndefined(this.commonLIParent)&&!j.isNullOrUndefined(this.commonLIParent.querySelector(".removeList"))){for(var t=this.commonLIParent.querySelector(".removeList");!j.isNullOrUndefined(t.firstChild);)this.parent.domNode.insertAfter(t.firstChild,t);j.detach(t)}if(13===e.event.keyCode)for(var n=this.parent.editableElement.querySelectorAll("UL, OL"),i=0;i<n.length;i++)j.isNullOrUndefined(n[i])||j.isNullOrUndefined(n[i].parentElement)||j.isNullOrUndefined(n[i].previousElementSibling)||"UL"!==n[i].parentElement.nodeName&&"OL"!==n[i].parentElement.nodeName||n[i].previousElementSibling.appendChild(n[i])},s.prototype.firstListBackSpace=function(e,t){var n=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset);j.isNullOrUndefined(n.closest("OL"))?j.isNullOrUndefined(n.closest("UL"))||(this.commonLIParent=n.closest("UL")):this.commonLIParent=n.closest("OL"),"LI"===n.nodeName&&0===e.startOffset&&0===e.endOffset&&j.isNullOrUndefined(n.previousSibling)&&!j.isNullOrUndefined(this.commonLIParent)&&j.isNullOrUndefined(this.commonLIParent.previousSibling)&&j.isNullOrUndefined(this.commonLIParent.parentElement.closest("OL"))&&j.isNullOrUndefined(this.commonLIParent.parentElement.closest("UL"))&&j.isNullOrUndefined(this.commonLIParent.parentElement.closest("LI"))&&((e=j.createElement("P")).innerHTML="&#8203;",n.classList.add("removeList"),this.commonLIParent.parentElement.insertBefore(e,this.commonLIParent))},s.prototype.keyDownHandler=function(e){if(13===e.event.which&&this.enterList(e),32===e.event.which&&this.spaceList(e),8===e.event.which&&this.backspaceList(e),46===e.event.which&&"delete"===e.event.action&&(s=(t=this.parent.nodeSelection.getRange(this.parent.currentDocument)).commonAncestorContainer,i=t.startContainer,o=t.endContainer,i=3===i.nodeType?this.domNode.blockParentNode(i):i,o=3===o.nodeType?this.domNode.blockParentNode(o):o,"UL"!==s.nodeName&&"OL"!==s.nodeName||i===o||j.isNullOrUndefined(j.closest(i,"ul"))&&j.isNullOrUndefined(j.closest(i,"ol"))||j.isNullOrUndefined(j.closest(o,"ul"))&&j.isNullOrUndefined(j.closest(o,"ol"))||s.lastElementChild!==j.closest(o,"li")||s.lastChild===o||t.collapsed||this.areAllListItemsSelected(s,t)&&j.detach(s),this.removeList(t,e)),9===e.event.which){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=(e.event.action&&"indent"===e.event.action||(this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument)),e.enableTabKey&&this.handleListIndentation(),void 0),i=(t.startOffset,t.endOffset,this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset)),o=this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset);if(i!==o||"BR"!==i.nodeName&&"#text"!==i.nodeName||!(0<=gs.indexOf(i.parentNode.tagName.toLocaleLowerCase()))){e.event.action&&("indent"===e.event.action||this.listTabIndentation)||this.domNode.setMarker(this.saveSelection);for(var n=this.domNode.blockNodes(),r=[],s=!0,a=0;a<n.length;a++)"LI"===n[a].parentNode.tagName?r.push(n[a].parentNode):j.closest(n[a],"OL")||j.closest(n[a],"UL")||!j.closest(n[a],"LI")?"LI"===n[a].tagName&&"P"!==n[a].childNodes[0].tagName&&"OL"!==n[a].childNodes[0].tagName&&"UL"!==n[a].childNodes[0].tagName&&r.push(n[a]):r.push(j.closest(n[a],"LI"));1<r.length||1===r.length?(e.event.preventDefault(),e.event.stopPropagation(),this.currentAction=this.getAction(r[0]),e.event.shiftKey?(this.revertList(r,e),this.revertClean()):e.enableTabKey&&(!e.enableTabKey||this.listTabIndentation)||(s=this.nestedList(r)),s&&(this.cleanNode(),this.parent.editableElement.focus({preventScroll:!0})),e.event.action&&("indent"===e.event.action||this.listTabIndentation)||(this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore(),e.callBack&&e.callBack({requestType:this.currentAction,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes(),event:e.event}))):e.event.action&&("indent"===e.event.action||this.listTabIndentation)||(e.event&&e.event.shiftKey&&"Tab"===e.event.key&&(e.event.action="tab"),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()),this.listTabIndentation=!1}}else switch(e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()}},s.prototype.handleListIndentation=function(){var e=this.parent.nodeSelection.getRange(this.parent.currentDocument),t=this.saveSelection.getParentNodeCollection(e);if(("LI"===t[0].nodeName||j.closest(t[0],"li"))&&!this.isCursorAtStartOfLI(e)){var n=t[t.length-1],i=t[0],t=e.startContainer;if(n&&i){if(e.deleteContents(),n!==i){for(var o=t;o.parentElement;){if(this.parent.domNode.isBlockNode(o.parentElement)){o=o.parentElement;break}o=o.parentElement}var e=void 0,r=(this.parent.domNode.isBlockNode(n.lastChild)?(t.nodeValue+="",e=t.nodeValue.length):n.innerHTML+='&nbsp;&nbsp;&nbsp;&nbsp;<span class="rte-tab-space"></span>',i.firstChild);if(r&&this.parent.domNode.isBlockNode(r)){for(;r.firstChild;)o.appendChild(r.firstChild);r.remove()}for(;i.firstChild;)this.parent.domNode.isBlockNode(i.firstChild)?this.parent.domNode.insertAfter(i.firstChild,o):n.appendChild(i.firstChild);i.remove();var s=n.querySelector(".rte-tab-space");s&&s.previousSibling?(this.saveSelection.setCursorPoint(this.parent.currentDocument,s.previousSibling,s.previousSibling.textContent.length),s.parentNode.removeChild(s)):this.saveSelection.setCursorPoint(this.parent.currentDocument,t,e)}else la.Insert(this.parent.currentDocument,"&nbsp;&nbsp;&nbsp;&nbsp;");this.listTabIndentation=!0}}},s.prototype.isCursorAtStartOfLI=function(e){for(var t,n=e.startContainer;n&&"LI"!==n.nodeName;)n=n.parentNode;return!!n&&((t=e.cloneRange()).selectNodeContents(n),t.setEnd(e.startContainer,e.startOffset),""===t.toString().trim())},s.prototype.spaceKeyAction=function(e){32===e.event.which&&this.spaceList(e)},s.prototype.getAction=function(e){return"OL"===e.parentNode.nodeName?"OL":"UL"},s.prototype.revertClean=function(){for(var e=this.parent.editableElement.querySelectorAll("ul, ol"),t=0;t<e.length;t++){var n=e[t].querySelectorAll("ul, ol");if(0<n.length)for(var i=0;i<n.length;i++){var o=n[i].previousSibling;o&&"LI"===o.tagName&&o.appendChild(n[i])}}},s.prototype.noPreviousElement=function(e){var t,n,i=e.querySelectorAll("ol, ul"),o=e.querySelectorAll("li"),r=this.domNode.contents(o[0])[0];if(0<o.length&&("OL"===r.nodeName||"UL"===r.nodeName)?t=o[0]:n=i[0],t)for(var s=this.domNode.contents(e)[0];s&&!this.domNode.isList(s);){var a=s.nextSibling;j.prepend([s],t),j.setStyleAttribute(e,{"list-style-type":"none"}),j.setStyleAttribute(t,{"list-style-type":""}),s=a}else if(n){var l=j.createElement("li");j.prepend([l],n);for(s=this.domNode.contents(e)[0];s&&!this.domNode.isList(s);){a=s.nextSibling;l.appendChild(s),s=a}j.prepend([n],e.parentNode),j.detach(e);var d=j.createElement("li",{styles:"list-style-type: none;"});j.prepend([d],n.parentNode),j.append([n],d)}else{d=j.createElement("li",{styles:"list-style-type: none;"}),l=(j.prepend([d],e.parentNode),j.createElement(e.parentNode.tagName));j.prepend([l],d),j.append([e],l)}},s.prototype.nestedList=function(e){for(var t=!1,n=0;n<e.length;n++){var i=this.domNode.getPreviousNode(e[n]);if(i){var t=!0,o=void 0,r=void 0,s=e[n].querySelectorAll("ol, ul"),a=e[n].querySelectorAll("li"),l=this.domNode.contents(a[0])[0];if(0<a.length&&("OL"===l.nodeName||"UL"===l.nodeName)?r=a[0]:o=s[0],o){var d=j.createElement("li");j.prepend([d],o);for(var c=this.domNode.contents(e[n])[0];c&&!this.domNode.isList(c);){var p=c.nextSibling;d.appendChild(c),c=p}j.append([o],i),j.detach(e[n])}else if(r){if("LI"===i.tagName){for(c=this.domNode.contents(e[n])[0];c&&!this.domNode.isList(c);){p=c.nextSibling;j.prepend([c],r),j.setStyleAttribute(e[n],{"list-style-type":"none"}),j.setStyleAttribute(r,{"list-style-type":""}),c=p}j.append([r.parentNode],i),j.detach(e[n])}}else"LI"===i.tagName?((d=j.createElement(e[n].parentNode.tagName)).style.listStyleType=e[n].parentNode.style.listStyleType,j.append([d],i),j.append([e[n]],d)):"OL"!==i.tagName&&"UL"!==i.tagName||j.append([e[n]],i)}else{l=e[n];t=!0,this.noPreviousElement(l)}}return t},s.prototype.applyListsHandler=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);if(-1!==j.Browser.userAgent.indexOf("Firefox")&&t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement){for(var n=t.startContainer.childNodes[0<t.startOffset?t.startOffset-1:t.startOffset]||t.startContainer,i=t.endContainer.childNodes[0<t.endOffset?t.endOffset-1:t.endOffset]||t.endContainer,o="BR"===i.lastChild.nodeName?j.isNullOrUndefined(i.lastChild.previousSibling)?i:i.lastChild.previousSibling:i.lastChild;!j.isNullOrUndefined(o)&&"#text"!==o.nodeName&&"IMG"!==o.nodeName&&"BR"!==o.nodeName&&"HR"!==o.nodeName;)o=o.lastChild;this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,n,o,0,o.textContent.length),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)}t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement&&t.startOffset===t.endOffset&&0===t.startOffset&&0===this.parent.editableElement.textContent.length&&"TABLE"!==this.parent.editableElement.childNodes[0].nodeName&&"IMG"!==this.parent.editableElement.childNodes[0].nodeName&&(i=t.startContainer.childNodes[0],this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,i,i,0,0),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)),this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument),this.currentAction=e.subCommand,this.currentAction=e.subCommand="NumberFormatList"===this.currentAction?"OL":"BulletFormatList"===this.currentAction?"UL":this.currentAction,this.domNode.setMarker(this.saveSelection);var r=this.domNode.blockNodes(!0);"BR"===e.enterAction&&(this.setSelectionBRConfig(),this.parent.domNode.convertToBlockNodes(this.parent.domNode.blockNodes(),!0),this.setSelectionBRConfig(),r=this.parent.domNode.blockNodes());for(var s=0;s<r.length;s++)"TABLE"!==r[s].tagName||t.collapsed||r.splice(s,1),0<r.length&&"LI"!==r[s].tagName&&"LI"===r[s].parentNode.tagName&&(r[s]=r[s].parentNode);this.applyLists(r,this.currentAction,e.selector,e.item,e),e.callBack&&e.callBack({requestType:this.currentAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},s.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+w.startSelection),t=this.parent.editableElement.querySelector("."+w.endSelection);j.isNullOrUndefined(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},s.prototype.applyLists=function(e,t,n,i,o){if(this.isRevert(e,t,i)&&j.isNullOrUndefined(i))this.revertList(e,o),this.removeEmptyListElements();else{this.checkLists(e,t,i);var r="";""!==e[0].style.marginLeft&&(r=' style = "margin-left: '+e[0].style.marginLeft+';"');for(var s=0;s<e.length;s++){j.isNullOrUndefined(i)||j.isNullOrUndefined(i.listStyle)||("listImage"===i.listStyle?j.setStyleAttribute(e[s],{"list-style-image":i.listImage}):(j.setStyleAttribute(e[s],{"list-style-image":"none"}),j.setStyleAttribute(e[s],{"list-style-type":i.listStyle.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}))),e[s].style.removeProperty("margin-left");var a,l,d,c,p,h,u="IMG"===e[s].tagName||e[s].classList.contains("e-editor-select-start")?"":this.domNode.attributes(e[s]);"true"===e[s].getAttribute("contenteditable")&&1===e[s].childNodes.length&&"TABLE"===e[s].childNodes[0].nodeName?((a=document.createElement(t)).innerHTML="<li><br/></li>",e[s].appendChild(a)):"LI"!==e[s].tagName&&j.isNullOrUndefined(i)&&"BLOCKQUOTE"===e[s].nodeName?(d="</"+t+">",p=e[s].innerHTML,h=(l="<"+t+r+">")+this.domNode.createTagString(c="li"+u,null,p)+d,e[s].innerHTML=h):"LI"!==e[s].tagName&&j.isNullOrUndefined(i)?(l="<"+t+r+">",d="</"+t+">",c="li"+u,p=e[s].tagName.toLowerCase()===us?e[s].innerHTML:e[s].outerHTML,h=l+this.domNode.createTagString(c,null,p)+d,this.domNode.replaceWith(e[s],h)):j.isNullOrUndefined(i)||"LI"===e[s].tagName||(l="<"+t+("IMG"===e[s].tagName?"":this.domNode.attributes(e[s]))+">",d="</"+t+">",c="li",p=e[s].tagName.toLowerCase()===us?e[s].innerHTML:e[s].outerHTML,h=l+this.domNode.createTagString(c,null,p)+d,this.domNode.replaceWith(e[s],h))}}this.cleanNode(),"BR"===o.enterAction&&document.querySelectorAll("span#removeSpan").forEach(function(e){for(var t=document.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e)}),this.parent.editableElement.focus({preventScroll:!0}),Rs()&&As(this.parent.editableElement,n),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()},s.prototype.removeEmptyListElements=function(){for(var e=this.parent.editableElement.querySelectorAll("ol, ul"),t=0;t<e.length;t++)""===e[t].textContent.trim()&&j.detach(e[t])},s.prototype.isRevert=function(e,t,n){for(var i=!0,o=0;o<e.length;o++){if("LI"!==e[o].tagName)return!1;(e[o].parentNode.tagName!==t||j.isNullOrUndefined(n)&&""!==e[o].parentNode.style.listStyleType)&&(i=!1),e[o].parentNode.tagName===t&&""!==e[o].parentNode.style.listStyleType&&(i=!0)}return i},s.prototype.checkLists=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var r=e[o].parentNode;j.isNullOrUndefined(n)||"LI"!==e[o].tagName||j.isNullOrUndefined(n.listStyle)||("listImage"===n.listStyle?j.setStyleAttribute(r,{"list-style-image":n.listImage}):(j.setStyleAttribute(r,{"list-style-image":"none"}),j.setStyleAttribute(r,{"list-style-type":n.listStyle.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}))),("LI"===e[o].tagName&&r.tagName!==t&&i.indexOf(r)<0||"LI"===e[o].tagName&&r.tagName===t&&i.indexOf(r)<0&&null!==n)&&i.push(r),j.isNullOrUndefined(n)&&(r.tagName===t||("UL"===r.tagName||"OL"===r.tagName)&&r.hasAttribute("style"))&&r.hasAttribute("style")&&r.removeAttribute("style")}for(var s=i.length-1;0<=s;s--){var a=i[s],a="<"+t.toLowerCase()+" "+this.domNode.attributes(a)+">"+a.innerHTML+"</"+t.toLowerCase()+">";this.domNode.replaceWith(i[s],a)}},s.prototype.cleanNode=function(){for(var e=this.parent.editableElement.querySelectorAll("ol + ol, ul + ul"),t=0;t<e.length;t++){for(var n,i,o=e[t],r=o;r.parentElement&&(!r.parentElement||"LI"===r.parentElement.tagName||"OL"===r.parentElement.tagName||"UL"===r.parentElement.tagName);)r=r.parentElement;if("OL"!==e[t].parentElement.parentElement.nodeName&&"UL"!==e[t].parentElement.parentElement.nodeName||(n=e[t].parentElement.parentElement.style.listStyleType,i=o.previousElementSibling),this.domNode.isList(o.previousElementSibling)&&this.domNode.openTagString(o)===this.domNode.openTagString(o.previousElementSibling)){for(var s=this.domNode.contents(o),a=0;a<s.length;a++)o.previousElementSibling.appendChild(s[a]);o.parentNode.removeChild(o)}else if(j.isNullOrUndefined(o.getAttribute("level"))){if(this.domNode.isList(o.previousElementSibling)&&r.contains(o.previousElementSibling)&&("OL"===o.tagName||"UL"===o.tagName)&&("OL"===o.previousElementSibling.nodeName||"UL"===o.previousElementSibling.nodeName)){for(s=this.domNode.contents(o),a=0;a<s.length;a++)o.previousElementSibling.appendChild(s[a]);o.parentNode.removeChild(o)}}else o.tagName===o.previousElementSibling.tagName&&o.previousElementSibling.lastChild.append(o)}if(i){i.style.listStyleType=n;for(var l=this.parent.nodeSelection.getRange(this.parent.currentDocument),d=[],d="UL"===l.commonAncestorContainer.nodeName||"OL"===l.commonAncestorContainer.nodeName?(l.commonAncestorContainer instanceof Element&&d.push(l.commonAncestorContainer),d.concat(Array.from(l.commonAncestorContainer.querySelectorAll("ol, ul")))):Array.from(l.commonAncestorContainer.querySelectorAll("ol, ul")),c=0;c<d.length;c++)for(var p=void 0,h=d[c];h;)"OL"!==h.nodeName&&"OL"!==h.nodeName||(""!==h.style.listStyleType&&"none"!==h.style.listStyleType&&"LI"!==h.nodeName?p=h.style.listStyleType:j.isNullOrUndefined(p)||""!==h.style.listStyleType&&"none"!==h.style.listStyleType||"LI"===h.nodeName||"UL"!==h.nodeName&&"OL"!==h.nodeName||(h.style.listStyleType=p)),h=h.querySelector("UL,OL")}},s.prototype.findUnSelected=function(e,t){if(0<(e=e.slice().reverse()).length){for(var n=[],i=[],o=[],r=[],o=t[t.length-1].childNodes,s=0;s<o.length;s++)if("OL"===o[s].tagName||"UL"===o[s].tagName){var a=o[s].querySelectorAll("li");if(0<a.length)for(var l=0;l<a.length;l++)r.push(a[l])}for(var d=0;d<r.length;d++){for(var c=0,p=0;p<e.length;p++)r[d].contains(e[p])||(c+=1);c===e.length&&i.push(r[d])}if(0<i.length)for(var h=0;h<i.length;h++)"OL"!==this.domNode.contents(i[h])[0].nodeName&&"UL"!==this.domNode.contents(i[h])[0].nodeName&&n.push(i[h]);0<n.length&&this.nestedList(n)}},s.prototype.revertList=function(e,t){for(var n=[],i=e.length-1;0<=i;i--)for(var o=i-1;0<=o;o--)if(e[o].contains(e[i])||e[o]===e[i]){n.push(e[i]),e.splice(i,1);break}this.findUnSelected(n,e);for(var r=[],i=0;i<e.length;i++){var s=e[i],a=(3===this.domNode.contents(s)[0].nodeType&&0===this.domNode.contents(s)[0].textContent.trim().length&&j.detach(this.domNode.contents(s)[0]),e[i].parentNode),l=s.getAttribute("class");if(0===n.length&&(c=e[i].querySelectorAll("ul, ol")[0])&&c.querySelectorAll("li")&&(d=j.createElement(c.tagName),j.append([d],c.parentNode),p=j.createElement("li",{styles:"list-style-type: none;"}),j.append([p],d),j.append([c],p)),s.parentNode.insertBefore(this.closeTag(a.tagName),s),"LI"===a.parentNode.tagName||"OL"===a.parentNode.tagName||"UL"===a.parentNode.tagName)s.parentNode.insertBefore(this.closeTag("LI"),s);else{var d=this.getClosestListParentMargin(s);if(0===s.querySelectorAll(ms.join(", ")).length){var c=j.isNullOrUndefined(l)?' class="e-rte-wrap-inner"':' class="'+l+' e-rte-wrap-inner"',p=a,h=(e.length===p.querySelectorAll("li").length&&(j.isNullOrUndefined(p.style.listStyleType)||a.style.removeProperty("list-style-type"),j.isNullOrUndefined(p.style.listStyleImage)||a.style.removeProperty("list-style-image"),0===p.style.length)&&a.removeAttribute("style"),j.isNullOrUndefined(t.enterAction)?us:t.enterAction),h="<"+h+c+this.domNode.attributes(s)+"></"+h+">",u=document.createElement("div");u.innerHTML=h,""!==d&&(u.firstElementChild.style.marginLeft=d),"BR"!==t.enterAction?this.domNode.wrapInner(s,this.domNode.parseHTMLFragment(u.innerHTML)):(h=document.createElement("br"),this.domNode.wrapInner(s,this.domNode.parseHTMLFragment("<span class=e-rte-wrap-inner id=removeSpan></span>")),s.appendChild(h))}else if(3===this.domNode.contents(s)[0].nodeType){var m=this.domNode.createTagString(us,a,this.parent.domNode.encode(this.domNode.contents(s)[0].textContent));this.domNode.replaceWith(this.domNode.contents(s)[0],m)}else if(this.domNode.contents(s)[0].classList.contains(w.startSelection)||this.domNode.contents(s)[0].classList.contains(w.endSelection)){m=this.domNode.createTagString(us,a,this.domNode.contents(s)[0].outerHTML);this.domNode.replaceWith(this.domNode.contents(s)[0],m)}else{var g=s.firstChild;if(g){var f=s.parentElement.attributes;if(0<f.length)for(var b=0;b<f.length;b++){var v=f[b],y=g.getAttribute(v.nodeName),C=s.parentElement.getAttribute(v.nodeName);g.setAttribute(v.nodeName,y?C+" "+y:C)}}(l=g.getAttribute("class"))&&g.getAttribute("class")&&j.attributes(g,{class:l+" "+g.getAttribute("class")})}j.append([this.openTag("LI")],s),j.prepend([this.closeTag("LI")],s)}this.domNode.insertAfter(this.openTag(a.tagName),s),"LI"===a.parentNode.tagName&&(a=a.parentNode.parentNode),r.indexOf(a)<0&&r.push(a)}for(i=0;i<r.length;i++){var N=r[i],E=N.innerHTML;E=(E=E.replace(/<span class="e-rte-list-close-([a-z]*)"><\/span>/g,"</$1>")).replace(/<span class="e-rte-list-open-([a-z]*)"><\/span>/g,"<$1 "+this.domNode.attributes(N)+">"),this.domNode.replaceWith(N,this.domNode.openTagString(N)+E.trim()+this.domNode.closeTagString(N))}for(var S=this.parent.editableElement.querySelectorAll("ul:empty, ol:empty"),i=0;i<S.length;i++)j.detach(S[i]);for(var T=this.parent.editableElement.querySelectorAll("li:empty"),i=0;i<T.length;i++)j.detach(T[i])},s.prototype.getClosestListParentMargin=function(e){for(var t=e;t&&t!==this.parent.editableElement;){if("UL"===t.nodeName||"OL"===t.nodeName)return t.style.marginLeft;t=t.parentElement}return""},s.prototype.openTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-open-'+e.toLowerCase()+'"></span>')},s.prototype.closeTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-close-'+e.toLowerCase()+'"></span>')},s.prototype.destroy=function(){this.removeEventListener(),this.domNode&&(this.domNode=null)},s.prototype.areAllListItemsSelected=function(e,t){for(var n=e.querySelectorAll("li"),i=0;i<n.length;i++){var o=n[i];if(this.parent.currentDocument.createRange().selectNodeContents(o),!t.intersectsNode(o))return!1}return!0};var ca=s;function s(e){this.listTabIndentation=!1,this.parent=e,this.domNode=this.parent.domNode,this.addEventListener()}a.prototype.addEventListener=function(){this.parent.observer.on(Vs,this.applyFormats,this),this.parent.observer.on(Ws,this.onKeyUp,this),this.parent.observer.on(u,this.onKeyDown,this),this.parent.observer.on(ta,this.blockQuotesHandled,this),this.parent.observer.on(r,this.destroy,this)},a.prototype.removeEventListener=function(){this.parent.observer.off(Vs,this.applyFormats),this.parent.observer.off(Ws,this.onKeyUp),this.parent.observer.off(u,this.onKeyDown),this.parent.observer.off(r,this.destroy)},a.prototype.getParentNode=function(e){for(var t=e,n=["DIV","SECTION","ARTICLE","ASIDE","FOOTER","HEADER","NAV","MAIN"];e.parentNode&&e.parentNode!==this.parent.editableElement;)e=e.parentNode;if(-1!==n.indexOf(e.nodeName.toUpperCase()))for(e=t;-1===n.indexOf(e.nodeName.toUpperCase())&&-1===n.indexOf(e.parentNode.nodeName.toUpperCase());)e=e.parentNode;return e},a.prototype.blockQuotesHandled=function(){this.blockquotePrevent=!0},a.prototype.onKeyUp=function(e){var t,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=n.endContainer,o=i.lastChild;13===e.event.which&&n.startContainer===i&&3!==i.nodeType&&((t=j.createElement("p")).innerHTML="<br>",!j.isNullOrUndefined(o)&&o&&"BR"===o.nodeName&&o.previousSibling&&"TABLE"===o.previousSibling.nodeName?(i.replaceChild(t,o),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)):(o=this.parent.nodeSelection.getSelectionNodeCollectionBr(n)[0],!j.isNullOrUndefined(o)&&"BR"===o.nodeName&&o.previousSibling&&"TABLE"===o.previousSibling.nodeName&&(i.replaceChild(t,o),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)))),"BR"!==e.enterAction&&!j.isNullOrUndefined(n.startContainer)&&!j.isNullOrUndefined(n.startContainer.parentElement)&&n.startContainer===n.endContainer&&"#text"===n.startContainer.nodeName&&n.startContainer.parentElement.classList.contains("e-content")&&n.startContainer.parentElement.isContentEditable&&(t=j.createElement(e.enterAction),n.startContainer.parentElement.insertBefore(t,n.startContainer),t.appendChild(n.startContainer),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,1))},a.prototype.getBlockParent=function(e,t){for(var n=e;e!==t;)e=(n=e).parentElement;return n},a.prototype.onKeyDown=function(e){if(13===e.event.which&&!this.blockquotePrevent){var t=0===(s=this.parent.nodeSelection.getRange(this.parent.currentDocument)).startContainer.textContent.length||"PRE"===s.startContainer.nodeName?s.startContainer:s.startContainer.parentElement,n=0===s.endContainer.textContent.length||"PRE"===s.endContainer.nodeName?s.endContainer:s.endContainer.parentElement,i=j.closest(t,"pre"),o=j.closest(n,"pre"),t=j.closest(t,"blockquote"),r=j.closest(n,"blockquote");if(!j.isNullOrUndefined(i)&&!j.isNullOrUndefined(i.parentElement)&&"LI"===i.parentElement.tagName)return;if((j.isNullOrUndefined(i)&&!j.isNullOrUndefined(o)||!j.isNullOrUndefined(i)&&j.isNullOrUndefined(o))&&(e.event.preventDefault(),this.deleteContent(s),this.removeCodeContent(s),s=this.parent.nodeSelection.getRange(this.parent.currentDocument),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0)),13===e.event.which&&(!j.isNullOrUndefined(t)&&!j.isNullOrUndefined(r)||!j.isNullOrUndefined(t)&&j.isNullOrUndefined(r))&&(8203===(a=this.getBlockParent(s.startContainer,t)).textContent.charCodeAt(0)&&1===a.textContent.length||0===a.textContent.length&&0===a.querySelectorAll("img").length&&0===a.querySelectorAll("table").length)&&(e.event.preventDefault(),j.isNullOrUndefined(a.nextElementSibling)||(new sa).SplitNode(s,a.parentElement,!1).cloneNode(!0),this.paraFocus(a.parentElement===this.parent.editableElement?a:a.parentElement)),13===e.event.which&&!j.isNullOrUndefined(i)&&!j.isNullOrUndefined(o)){e.event.preventDefault(),this.deleteContent(s),this.removeCodeContent(s);var s,n=(s=this.parent.nodeSelection.getRange(this.parent.currentDocument)).startContainer.childNodes[s.endOffset],r=s.startContainer.childNodes[s.endOffset-1],a=s.startContainer;if(j.isNullOrUndefined(n)||j.isNullOrUndefined(r)||!j.isNullOrUndefined(n.nextSibling)||"BR"!==n.nodeName||"BR"!==r.nodeName)if(8203===a.textContent.charCodeAt(0)&&1===a.textContent.length||0===a.textContent.length){for(;"PRE"!==a.parentElement.nodeName&&(1===a.textContent.length||0===a.textContent.length);)a=a.parentElement;!j.isNullOrUndefined(a.previousSibling)&&"BR"===a.previousSibling.nodeName&&j.isNullOrUndefined(a.nextSibling)?this.paraFocus(a.parentElement):this.isNotEndCursor(i,s)}else this.isNotEndCursor(i,s);else this.paraFocus(s.startContainer,e.enterAction)}}this.blockquotePrevent=!1},a.prototype.removeCodeContent=function(e){var t,n=new RegExp("\ufeff","g");j.isNullOrUndefined(e.endContainer.textContent.match(n))||(t=65279===e.endContainer.textContent.charCodeAt(e.endOffset-1)?e.endOffset-2:e.endOffset,e.endContainer.textContent=e.endContainer.textContent.replace(n,""),""===e.endContainer.textContent?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer.parentElement,0):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer,t))},a.prototype.deleteContent=function(e){e.startContainer===e.endContainer&&e.startOffset===e.endOffset||e.deleteContents()},a.prototype.paraFocus=function(e,t){var n;"DIV"===t?(n=j.createElement("div")).innerHTML="<br>":"BR"===t?n=j.createElement("br"):(n=j.createElement("p")).innerHTML="<br>",this.parent.domNode.insertAfter(n,e),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),j.detach(e.lastChild)},a.prototype.isNotEndCursor=function(e,t){var n,i=new sa,o=t.startOffset===e.lastChild.textContent.length&&e.lastChild.textContent===t.startContainer.textContent;0===e.textContent.indexOf(t.startContainer.textContent)&&(0===t.startOffset&&0===t.endOffset||"PRE"===t.startContainer.nodeName)?(this.insertMarker(e,t),n=j.createElement("br"),e.childNodes[t.endOffset].parentElement.insertBefore(n,e.childNodes[t.endOffset])):(n=i.SplitNode(t,e,!0),this.insertMarker(e,t),"PRE"===(i=e.previousElementSibling).tagName&&(i.insertAdjacentHTML("beforeend","<br>"+n.innerHTML),j.detach(e))),this.setCursorPosition(o,e)},a.prototype.setCursorPosition=function(e,t){var n=!1,i=this.parent.editableElement.querySelector(".tempSpan"),o=i.parentElement;""===i.parentNode.textContent?n=!0:this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e?n?o===t?(this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),j.detach(i)):this.focusSelectionParent(i,o):(e=j.createElement("br"),this.parent.domNode.insertAfter(e,i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),j.detach(i)):n?this.focusSelectionParent(i,o):j.detach(i)},a.prototype.focusSelectionParent=function(e,t){j.detach(e),t.innerHTML="",this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)},a.prototype.insertMarker=function(e,t){var n=j.createElement("span",{className:"tempSpan"});"PRE"===t.startContainer.nodeName?e.childNodes[t.endOffset].parentElement.insertBefore(n,e.childNodes[t.endOffset]):t.startContainer.parentElement.insertBefore(n,t.startContainer)},a.prototype.applyFormats=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection.processedTableImageCursor(t);if((n.start||n.end)&&("TABLE"===n.startName||"TABLE"===n.endName))return i=n.start?n.startNode:n.endNode,void this.applyTableSidesFormat(e,n.start,i);var n=!1,i=(this.parent.editableElement!==t.endContainer||j.isNullOrUndefined(this.parent.editableElement.children[t.endOffset-1])||"TABLE"!==this.parent.editableElement.children[t.endOffset-1].tagName||t.collapsed||(n=!0),this.parent.nodeSelection.save(t,this.parent.currentDocument)),o=(this.parent.domNode.setMarker(i),this.parent.domNode.blockNodes(!0));if("BR"===e.enterAction){this.setSelectionBRConfig();var t=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),r=this.parent.nodeSelection.getSelectionNodes(t),s=[];0===r.length&&r.push(o[0]);for(var a=0;a<r.length;a++){for(var l=r[a],d=void 0;!this.parent.domNode.isBlockNode(l)&&l!==this.parent.editableElement;)l=(d=l).parentElement;this.parent.domNode.isBlockNode(l)&&l===this.parent.editableElement&&s.push(d)}for(a=0;a<s.length;a++)if(!this.parent.domNode.isBlockNode(s[a])){for(var c=l=s[a];l===this.parent.editableElement;)l=(c=l).parentElement;for(var p=void 0,h=(this.parent.domNode.isBlockNode(c.parentElement)&&c.parentElement===this.parent.editableElement?(p=j.createElement("div"),c.parentElement.insertBefore(p,c),p.appendChild(c),0===c.textContent.length&&c.appendChild(j.createElement("br"))):p=c,p.previousSibling);!j.isNullOrUndefined(h)&&"BR"!==h.nodeName&&!this.parent.domNode.isBlockNode(h);)p.firstChild.parentElement.insertBefore(h,p.firstChild),h=p.previousSibling;j.isNullOrUndefined(h)||"BR"!==h.nodeName||j.detach(h);for(var u=p.nextSibling;!j.isNullOrUndefined(u)&&"BR"!==u.nodeName&&!this.parent.domNode.isBlockNode(u);)p.appendChild(u),u=p.nextSibling;j.isNullOrUndefined(u)||"BR"!==u.nodeName||j.detach(u)}this.setSelectionBRConfig(),o=this.parent.domNode.blockNodes()}for(var m=!1,g=!1,a=0;a<o.length;a++)(j.isNullOrUndefined(j.closest(o[0],"blockquote"))||j.isNullOrUndefined(j.closest(o[o.length-1],"blockquote")))&&(g=!0);for(a=0;a<o.length;a++){var f,b,v,y,C,N,E=void 0,S=void 0,S="blockquote"===e.subCommand.toLowerCase()?(E=this.getParentNode(o[a]),"BR"===e.enterAction?E.innerHTML:(!j.isNullOrUndefined(j.closest(o[a],"table"))&&this.parent.editableElement.contains(j.closest(o[a],"table"))?j.isNullOrUndefined(j.closest(o[a],"blockquote"))?o[a]:j.closest(o[a],"blockquote"):E).outerHTML):(E=o[a]).innerHTML;"blockquote"===e.subCommand.toLowerCase()&&e.subCommand.toLowerCase()===E.tagName.toLowerCase()&&g||e.subCommand.toLowerCase()===E.tagName.toLowerCase()&&("pre"!==e.subCommand.toLowerCase()&&"blockquote"!==e.subCommand.toLowerCase()||!j.isNullOrUndefined(e.exeValue)&&"dropDownSelect"===e.exeValue.name)||j.isNullOrUndefined(E.parentNode)||"TABLE"===E.tagName&&"pre"===e.subCommand.toLowerCase()||(this.cleanFormats(E,e.subCommand),f="pre"===e.subCommand.toLowerCase()&&"pre"===E.tagName.toLowerCase()?"p":e.subCommand,N=e.subCommand.toLowerCase()===E.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase()&&!j.isNullOrUndefined(j.closest(o[a],"li")),b="TABLE"!==E.tagName||j.isNullOrUndefined(j.closest(o[a],"blockquote"))?E:j.closest(o[a],"blockquote"),b=e.subCommand.toLowerCase()===b.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase(),v=void 0,y=this.getNode(o[a]),C=this.getNode(o[o.length-1]),b&&E.firstChild===y&&E.lastChild===C?v=S.replace(/<blockquote[^>]*>|<\/blockquote>/g,""):N?(m=!0,0===a&&this.createBlockquoteSpan("e-rte-blockquote-close",y,"before"),a===o.length-1&&this.createBlockquoteSpan("e-rte-blockquote-open",C,"after")):b&&j.closest(o[0],"blockquote")&&j.closest(o[o.length-1],"blockquote")?(m=!0,0===a&&this.createBlockquoteSpan("e-rte-blockquote-close",o[a],"before"),a===o.length-1&&this.createBlockquoteSpan("e-rte-blockquote-open",o[a],"after")):v=this.parent.domNode.createTagString(f,"blockquote"===e.subCommand.toLowerCase()?null:E,S.replace(/>\s+</g,"><")),"LI"===E.tagName?(E.innerHTML="",E.insertAdjacentHTML("beforeend",v)):m||(N=!j.isNullOrUndefined(j.closest(o[a],"table"))&&this.parent.editableElement.contains(j.closest(o[a],"table"))?j.isNullOrUndefined(j.closest(o[a],"blockquote"))?o[a]:j.closest(o[a],"blockquote"):E,this.parent.domNode.replaceWith(N,v)))}if(m)for(var T=this.parent.editableElement.querySelectorAll(".e-rte-blockquote-open, .e-rte-blockquote-close"),a=0;a<T.length;a++){var O=T[a].parentElement,L=O.innerHTML;if(L=(L=L.replace(/<span class="e-rte-blockquote-open"><\/span>/g,"<blockquote>")).replace(/<span class="e-rte-blockquote-close"><\/span>/g,"</blockquote>"),T[0].parentElement===T[1].parentElement){this.parent.domNode.replaceWith(O,this.parent.domNode.openTagString(O)+L.trim()+this.parent.domNode.closeTagString(O));break}a!==T.length-1||j.isNullOrUndefined(T[a])||j.isNullOrUndefined(T[a-1])||T[a].parentElement===T[a-1].parentElement?this.parent.domNode.replaceWith(O,this.parent.domNode.openTagString(O)+L.trim()+this.parent.domNode.closeTagString(O)):this.parent.domNode.replaceWith(O,L.trim())}this.preFormatMerge(),this.blockquotesFormatMerge(e.enterAction);var t=this.parent.editableElement.querySelector("."+w.startSelection),k=this.parent.editableElement.querySelector("."+w.endSelection);j.isNullOrUndefined(t)||j.isNullOrUndefined(k)||(t=t.lastChild,k=k.lastChild),i=this.parent.domNode.saveMarker(i),Rs()&&As(this.parent.editableElement,e.selector),n?this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,t,k,0,k.textContent.length):i.restore(),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},a.prototype.getNode=function(e){if("BLOCKQUOTE"===e.nodeName)return e=e.firstChild;for(;e.parentNode&&"BLOCKQUOTE"!==e.parentNode.nodeName;)e=e.parentNode;return e},a.prototype.createBlockquoteSpan=function(e,t,n){var i=j.createElement("span");return i.classList.add(e),"before"===n?t.parentNode.insertBefore(i,t):this.parent.domNode.insertAfter(i,t),i},a.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+w.startSelection),t=this.parent.editableElement.querySelector("."+w.endSelection);j.isNullOrUndefined(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},a.prototype.preFormatMerge=function(){var e=this.parent.editableElement.querySelectorAll("PRE");if(!j.isNullOrUndefined(e))for(var t=0;t<e.length;t++){var n=e[t].previousElementSibling;j.isNullOrUndefined(n)||"PRE"!==n.tagName||(n.insertAdjacentHTML("beforeend","<br>"+e[t].innerHTML),j.detach(e[t]))}},a.prototype.blockquotesFormatMerge=function(e){var t=this.parent.editableElement.querySelectorAll("BLOCKQUOTE");if(!j.isNullOrUndefined(t))for(var n=0;n<t.length;n++){""===t[n].innerHTML.trim()&&j.detach(t[n]);var i=t[n].previousElementSibling;j.isNullOrUndefined(i)||"BLOCKQUOTE"!==i.tagName||(i.insertAdjacentHTML("beforeend",("BR"===e?"<br>":"")+t[n].innerHTML),j.detach(t[n]))}},a.prototype.cleanFormats=function(e,t){var n=["display","font-size","margin-top","margin-bottom","margin-left","margin-right","font-weight"];t=t.toLowerCase();for(var i=0;i<n.length&&"p"!==t&&"blockquote"!==t&&"pre"!==t;i++)e.style.removeProperty(n[i])},a.prototype.applyTableSidesFormat=function(e,t,n){var i=j.createElement(e.subCommand);"BR"!==e.enterAction&&i.appendChild(j.createElement("br")),n.insertAdjacentElement(t?"beforebegin":"afterend",i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},a.prototype.destroy=function(){this.removeEventListener()};var pa=a;function a(e){this.blockquotePrevent=!1,this.parent=e,this.addEventListener()}ua.prototype.getBlockNode=function(){var t=this,e=[],n=this.currentDocument.getSelection().getRangeAt(0);if(n.startContainer===this.editableElement&&n.startContainer===n.endContainer&&"#text"!==n.startContainer.nodeName){if(n.startOffset===n.endOffset?this.editableElement.childNodes[n.startOffset]&&-1<this.directRangeElems.indexOf(this.editableElement.childNodes[n.startOffset].nodeName)&&e.push(this.editableElement.childNodes[n.startOffset]):n.endOffset===n.startOffset+1&&e.push(this.editableElement.childNodes[n.startOffset]),0<e.length);}else{var i=n.startContainer.nodeType===Node.TEXT_NODE?n.startContainer.parentElement:n.startContainer,o=n.endContainer.nodeType===Node.TEXT_NODE?n.endContainer.parentElement:n.endContainer,r=this.isBlockNode(o)?o:this.getParentBlockNode(o),s=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return n.intersectsNode(e)?t.isBlockNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}});for(s.currentNode=i;s.currentNode;)if(this.isBlockNode(s.currentNode)?(this.addToBlockCollection(e,s,n),s.nextNode()):s.previousNode(),s.currentNode===o||s.currentNode===r){this.addToBlockCollection(e,s,n);break}}return e},ua.prototype.addToBlockCollection=function(e,t,n){var i=t.currentNode;!t.currentNode||-1!==e.indexOf(t.currentNode)||"LI"===i.nodeName&&i.parentNode.closest("li")&&("OL"!==(i=n.commonAncestorContainer).nodeName&&"UL"!==i.nodeName||!i.closest("li"))||e.push(t.currentNode)},ua.prototype.getTextNodes=function(e){for(var t=[],n=this.currentDocument.getSelection().getRangeAt(0),i=this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return n.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),o=i.nextNode();o;)t.push(o),o=i.nextNode();return t},ua.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&0<=this.BLOCK_TAGS.indexOf(e.tagName.toLowerCase())},ua.prototype.getLastTextNode=function(e){for(var t=this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),n=null,i=t.nextNode();i;)n=i,i=t.nextNode();return n},ua.prototype.getFirstTextNode=function(e){return this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null).nextNode()},ua.prototype.getParentBlockNode=function(e){var t=this,n=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return t.isBlockNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return n.currentNode=e,n.parentNode()},ua.prototype.getTopMostNode=function(e){var t=new ua(this.editableElement);if(t.isBlockNode(e.parentNode))return e;for(var n=e.parentNode;n;){if(t.isBlockNode(n.parentNode)||e.textContent!==n.textContent)return n;n=n.parentNode}return n};var ha=ua;function ua(e){this.directRangeElems=["IMG","TABLE","AUDIO","VIDEO","HR"],this.BLOCK_TAGS=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","output","p","pre","section","td","tfoot","th","video","body"],this.editableElement=e,this.currentDocument=e.ownerDocument}ga.prototype.addEventListener=function(){this.parent.observer.on(Jr,this.linkCommand,this),this.parent.observer.on(r,this.destroy,this)},ga.prototype.removeEventListener=function(){this.parent.observer.off(Jr,this.linkCommand),this.parent.observer.off(r,this.destroy)},ga.prototype.linkCommand=function(e){switch(e.value.toString().toLocaleLowerCase()){case"createlink":case"editlink":this.createLink(e);break;case"openlink":this.openLink(e);break;case"removelink":this.removeLink(e)}},ga.prototype.createLink=function(e){var t,n,i,o=!j.isNullOrUndefined(e.item.selectParent)&&1===e.item.selectParent.length&&j.closest(e.item.selectParent[0],"a"),o=j.isNullOrUndefined(o)?j.isNullOrUndefined(e.item.selectParent)||1!==e.item.selectParent.length?null:e.item.selectParent[0]:o;j.isNullOrUndefined(o)||"A"!==o.tagName?("#text"!==(n=(t=new gl(this.parent.editableElement)).getRange(this.parent.currentDocument)).endContainer.nodeName||n.startContainer.textContent.length!==n.endOffset+1||" "!==n.endContainer.textContent.charAt(n.endOffset)||j.isNullOrUndefined(n.endContainer.nextSibling)||"A"!==n.endContainer.nextSibling.nodeName||(t.setSelectionText(this.parent.currentDocument,n.startContainer,n.endContainer,n.startOffset,n.endOffset+1),n=t.getRange(this.parent.currentDocument)),t=!!j.isNullOrUndefined(e.item.text)||e.item.text.replace(/ /g,"").localeCompare(n.toString().replace(/\n/g," ").replace(/ /g,""))<0,e.event&&"keydown"===e.event.type&&(32===e.event.keyCode||13===e.event.keyCode)||"Paste"===e.item.action||n.collapsed||t?((n=this.createAchorNode(e)).innerText=""===e.item.text?e.item.url:e.item.text,t=n.innerText.replace(/  +/g,function(e){return"".repeat(e.length)}),n.innerText=t,e.item.selection.restore(),la.Insert(this.parent.currentDocument,n,this.parent.editableElement),j.isNullOrUndefined(n.parentElement)||"LI"!==n.parentElement.nodeName||j.isNullOrUndefined(n.parentNode.childNodes)||""!==n.parentNode.childNodes[0].textContent||n.parentNode.removeChild(n.parentNode.childNodes[0]),e.event&&"keydown"===e.event.type&&(32===e.event.keyCode||13===e.event.keyCode||/[^\w\s\\/\\.\\:]/g.test(e.event.key))?(t=e.item.selection.range.startContainer).textContent=this.removeText(t.textContent,e.item.text):(i="Paste"===e.item.action?n.childNodes[0].textContent.length:0,e.item.selection.setSelectionText(this.parent.currentDocument,n.childNodes[0],n.childNodes[0],i,n.childNodes[0].textContent.length))):this.handleLinkFormat(e)):(t=o,n="",j.isNullOrUndefined(e.item.url)||t.setAttribute("href",e.item.url),j.isNullOrUndefined(e.item.title)||t.setAttribute("title",e.item.title),j.isNullOrUndefined(e.item.text)||""===e.item.text||(n=t.innerText,"#text"===t.firstChild.nodeName?t.innerText=e.item.text:t.firstChild.innerText=e.item.text),j.isNullOrUndefined(e.item.target)?(t.removeAttribute("target"),t.removeAttribute("aria-label")):(t.setAttribute("target",e.item.target),t.setAttribute("aria-label",e.item.ariaLabel)),n===e.item.text?(e.item.selection.setSelectionText(this.parent.currentDocument,t,t,1,1),e.item.selection.restore()):(i="Paste"===e.item.action?t.childNodes[0].textContent.length:0,o=("#text"===t.firstChild.nodeName?t.childNodes[0].textContent:t.childNodes).length,e.item.selection.setSelectionText(this.parent.currentDocument,t.childNodes[0],t.childNodes[0],i,o))),e.callBack&&e.callBack({requestType:"Links",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},ga.prototype.createAchorNode=function(e){var t=j.createElement("a",{className:"e-rte-anchor",attrs:{href:e.item.url,title:j.isNullOrUndefined(e.item.title)||""===e.item.title?e.item.url:e.item.title}});return j.isNullOrUndefined(e.item.target)||t.setAttribute("target",e.item.target),j.isNullOrUndefined(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),t},ga.prototype.removeText=function(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)n[i]===t&&(n.splice(i,1),i--);return n.join(" ")+" "},ga.prototype.openLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},ga.prototype.removeLink=function(e){var t=this.parent.domNode.blockNodes();if(t.length<2){this.parent.domNode.setMarker(e.item.selection);for(var n=j.closest(e.item.selectParent[0],"a"),i=n||e.item.selectParent[0],o=i.parentNode,r=[];i.firstChild&&o;)r.push(o.insertBefore(i.firstChild,i));o.removeChild(i),r&&1===r.length&&(e.item.selection.startContainer=e.item.selection.getNodeArray(r[r.length-1],!0),e.item.selection.endContainer=e.item.selection.startContainer,e.item.selection.startOffset=0,e.item.selection.endOffset=r[r.length-1].textContent.length),e.item.selection=this.parent.domNode.saveMarker(e.item.selection)}else for(var s=0;s<t.length;s++)for(var a=t[s].querySelectorAll("a"),l=0;l<a.length;l++)this.parent.currentDocument.getSelection().containsNode(a[l],!0)&&(a[l].outerHTML=a[l].innerHTML);e.item.selection.restore(),this.callBack(e)},ga.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},ga.prototype.destroy=function(){this.removeEventListener()},ga.prototype.handleLinkFormat=function(e){var t=this.parent.editableElement,n=this.parent.nodeSelection.getRange(t.ownerDocument),i=this.parent.currentDocument.getSelection();if(i&&0!==i.rangeCount){for(var o,r,s,i=new ha(t),a="BR"===e.enterAction?[this.parent.editableElement]:i.getBlockNode(),l=[],t=["IMG","AUDIO","VIDEO"],i=(1===n.startContainer.nodeType&&(o=(s=n.startContainer.childNodes[n.startOffset])&&-1<t.indexOf(s.nodeName)?s:null),1===n.endContainer.nodeType&&(r=(s=n.endContainer.childNodes[1<n.endContainer.childNodes.length?n.endOffset-1:n.endOffset])&&-1<t.indexOf(s.nodeName)?s:null),{startContainer:n.startContainer,endContainer:n.endContainer,endOffset:n.endOffset,startOffset:n.startOffset,collapsed:n.collapsed}),d=0;d<a.length;d++){var c=a[d];this.unwrapLink(c),c.normalize(),this.applyLinkToBlockNode(c,e,l)}0!==l.length&&(o||r?(t=o?o.parentElement:i.startContainer,s=r?r.parentElement:i.endContainer,this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,t,s,o?0:i.startOffset,i.endOffset)):1===l.length?this.parent.nodeSelection.setSelectionContents(this.parent.currentDocument,l[0]):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,l[0],l[l.length-1],0,l[l.length-1].textContent.length))}},ga.prototype.applyLinkToBlockNode=function(e,t,n){for(var i=new ha(this.parent.editableElement),o=i.getTextNodes(e),r=e.querySelectorAll("*"),s=this.parent.nodeSelection.getRange(this.parent.currentDocument),a=[],l=0===r.length,d=0;d<o.length;d++){var c,p=void 0,h=o[d],u=(new Wr).getFormattedNode(h,"fontcolor",e);l?(p=this.getSplitNode(h,s),n.push(F.Wrap(p,this.createAchorNode(t)))):u?(0<a.length&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction),p=this.getSplitNode(u,s),s.intersectsNode(u)&&(F.Wrap(u.firstChild,this.createAchorNode(t)),n.push(h))):(u="#text"===s.startContainer.nodeName&&s.startContainer===h&&0!==s.startOffset,c="#text"===s.endContainer.nodeName&&s.endContainer===h&&s.endOffset!==s.startContainer.textContent.length,0<d&&("BR"===t.enterAction?this.parent.editableElement:i.getParentBlockNode(h))!==e&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction),(u||c)&&(u=i.getTopMostNode(h),p=this.getSplitNode(u,s)),n.push(h),a.push(h),d===o.length-1&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction))}},ga.prototype.unwrapLink=function(e){var t=e.querySelectorAll("a");if(0!==t.length){for(var n,i=this.parent.nodeSelection.getRange(this.parent.currentDocument),e=i.startContainer,o=i.endContainer,r=i.startOffset,s=i.endOffset,a=(this.parent.nodeSelection.save(i,this.parent.currentDocument),this.parent.nodeSelection.get(this.parent.currentDocument)),l=0;l<t.length;l++)i.intersectsNode(t[l])&&(a.containsNode(t[l],!1)?F.unwrap(t[l]):((n=t[l]&&t[l].textContent)&&i.startContainer.textContent&&-1!==n.indexOf(i.startContainer.textContent)&&(r=0),n=this.getSplitNode(t[l],i),F.unwrap(n)));i.setStart(e,r),i.setEnd(o,s)}},ga.prototype.replaceElementsWithAnchor=function(e,t,n){for(var i=new ha(this.parent.editableElement),o=[],r=0;r<e.length;r++){var s=e[r];o.push(i.getTopMostNode(s))}var a,l=o[e.length=0],d=t.cloneNode(!0);l.parentElement.insertBefore(t,l);for(var c=0;c<o.length;c++){var p,h,u,m,g,f=o[c];"BR"!==n||0===c?t.appendChild(f):j.isNullOrUndefined(a)||(p=f.nextSibling&&"BR"===f.nextSibling.nodeName||i.isBlockNode(f.nextSibling),h=f.previousSibling&&"BR"===f.previousSibling.nodeName||i.isBlockNode(f.previousSibling),u=this.parent.editableElement.lastChild===f,m=i.isBlockNode(f.parentElement),p&&h)?(g=d.cloneNode(!0),f.parentElement.insertBefore(g,f),g.appendChild(f),a=g):u?(g=d.cloneNode(!0),f.parentElement.insertBefore(g,f),g.appendChild(f)):m?(g=d.cloneNode(!0),f.parentElement.insertBefore(g,f),g.appendChild(f),a=g):a.appendChild(f)}},ga.prototype.getSplitNode=function(e,t){var n=new sa,n=t.collapsed?n.SplitNode(t,e,!0):n.GetSpliceNode(t,e);return n};var ma=ga;function ga(e){this.parent=e,this.addEventListener()}ba.prototype.addEventListener=function(){this.parent.observer.on(ps,this.applyAlignment,this),this.parent.observer.on(u,this.onKeyDown,this),this.parent.observer.on(r,this.destroy,this)},ba.prototype.removeEventListener=function(){this.parent.observer.off(ps,this.applyAlignment),this.parent.observer.off(u,this.onKeyDown),this.parent.observer.off(r,this.destroy)},ba.prototype.onKeyDown=function(e){switch(e.event.action){case"justify-center":this.applyAlignment({subCommand:"JustifyCenter",callBack:e.callBack}),e.event.preventDefault();break;case"justify-full":this.applyAlignment({subCommand:"JustifyFull",callBack:e.callBack}),e.event.preventDefault();break;case"justify-left":this.applyAlignment({subCommand:"JustifyLeft",callBack:e.callBack}),e.event.preventDefault();break;case"justify-right":this.applyAlignment({subCommand:"JustifyRight",callBack:e.callBack}),e.event.preventDefault()}},ba.prototype.getTableNode=function(e){e=e.startContainer.nodeType===Node.ELEMENT_NODE?e.startContainer:e.startContainer.parentNode;return[j.closest(e,"td,th")]},ba.prototype.applyAlignment=function(e){var t="Table"===e.value,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.nodeSelection.save(n,this.parent.currentDocument);if(t)j.setStyleAttribute(this.getTableNode(n)[0],{"text-align":this.alignments[e.subCommand]});else{this.parent.domNode.setMarker(i);var o=this.parent.domNode.blockNodes();"BR"===e.enterAction&&(o=this.parent.domNode.convertToBlockNodes(o,!1));for(var r=0;r<o.length;r++){var s=o[r];j.setStyleAttribute(s,{"text-align":this.alignments[e.subCommand]})}for(var a=this.parent.domNode.getImageTagInSelection(),r=0;r<a.length;r++){var l=[];l.push(a[r]),this.parent.imgObj.imageCommand({item:{selectNode:l},subCommand:e.subCommand,value:e.subCommand,callBack:e.callBack,selector:e.selector})}this.parent.editableElement.focus({preventScroll:!0}),i=this.parent.domNode.saveMarker(i),Rs()&&As(this.parent.editableElement,e.selector),i.restore()}e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:t?this.getTableNode(n):this.parent.domNode.blockNodes()})},ba.prototype.destroy=function(){this.removeEventListener()};var fa=ba;function ba(e){this.alignments={JustifyLeft:"left",JustifyCenter:"center",JustifyRight:"right",JustifyFull:"justify"},this.parent=e,this.addEventListener()}ya.prototype.addEventListener=function(){this.parent.observer.on(hs,this.applyIndents,this),this.parent.observer.on(u,this.onKeyDown,this),this.parent.observer.on(r,this.destroy,this)},ya.prototype.removeEventListener=function(){this.parent.observer.off(hs,this.applyIndents),this.parent.observer.off(u,this.onKeyDown),this.parent.observer.off(r,this.destroy)},ya.prototype.onKeyDown=function(e){switch(e.event.action){case"indents":this.applyIndents({subCommand:"Indent",callBack:e.callBack}),e.event.preventDefault();break;case"outdents":this.applyIndents({subCommand:"Outdent",callBack:e.callBack}),e.event.preventDefault()}},ya.prototype.applyIndents=function(e){for(var t=this.parent.editableElement,n=t.classList.contains("e-rtl"),i=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.nodeSelection.save(i,this.parent.currentDocument),o=(this.parent.domNode.setMarker(i),this.parent.domNode.blockNodes()),r=(o="BR"===e.enterAction?this.parent.domNode.convertToBlockNodes(o,!1):o).slice(),s=[],a=0;a<r.length;a++)"LI"!==r[a].tagName&&"LI"===r[a].parentNode.tagName?(o.splice(o.indexOf(r[a]),1),s.push(r[a].parentNode)):"LI"===r[a].tagName&&(o.splice(o.indexOf(r[a]),1),s.push(r[a]));0<s.length&&this.parent.observer.notify(u,{event:{preventDefault:function(){},stopPropagation:function(){},shiftKey:"Indent"!==e.subCommand,which:9,action:"indent"}});for(a=0;a<o.length;a++){var l=o[a],d=n?l.style.marginRight:l.style.marginLeft,c=void 0,c="Indent"===e.subCommand?""===d?this.indentValue+"px":parseInt(d,null)+this.indentValue+"px":""===d||"0px"===d||"0in"===d?"":parseInt(d,null)-this.indentValue<0?"0px":parseInt(d,null)-this.indentValue+"px";n?l.style.marginRight=c:l.style.marginLeft=c}t.focus({preventScroll:!0}),Rs()&&As(t,e.selector),(0===o.length||o[0]&&"TABLE"!==o[0].nodeName)&&(i=this.parent.domNode.saveMarker(i)).restore(),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},ya.prototype.destroy=function(){this.removeEventListener()};var va=ya;function ya(e){this.indentValue=20,this.parent=e,this.addEventListener()}var Ca="e-imgright",Na="e-imgleft",Ea="e-imgcenter",Sa="e-video-right",Ta="e-video-left",Oa="e-video-center",La="e-imgbreak",ka="e-audio-break",wa="e-video-break",l="e-img-caption",xa="e-caption-inline",Da="e-imginline",Ma="e-audio-inline",Ba="e-clickelem",Ra="e-video-clickelem",Aa="e-rte-audio",Ia="e-rte-video",Ua="e-audio-wrap",Pa="e-video-wrap",Ha="e-embed-video-wrap",ja="e-audio-focus",Fa="e-video-focus",qa="e-video-inline",za=(_a.prototype.addEventListener=function(){this.parent.observer.on(Kr,this.imageCommand,this),this.parent.observer.on(r,this.destroy,this)},_a.prototype.removeEventListener=function(){this.parent.observer.off(Kr,this.imageCommand),this.parent.observer.off(r,this.destroy)},_a.prototype.imageCommand=function(e){switch(e.value.toString().toLowerCase()){case"image":case"replace":this.createImage(e);break;case"insertlink":this.insertImageLink(e);break;case"openimagelink":this.openImageLink(e);break;case"editimagelink":this.editImageLink(e);break;case"removeimagelink":this.removeImageLink(e);break;case"remove":this.removeImage(e);break;case"alttext":this.insertAltTextImage(e);break;case"dimension":this.imageDimension(e);break;case"caption":this.imageCaption(e);break;case"justifyleft":this.imageJustifyLeft(e);break;case"justifycenter":this.imageJustifyCenter(e);break;case"justifyright":this.imageJustifyRight(e);break;case"inline":this.imageInline(e);break;case"break":this.imageBreak(e)}},_a.prototype.createImage=function(n){var e,i,o,r=this,t=!1;n.item.url=j.isNullOrUndefined(n.item.url)||"undefined"===n.item.url?n.item.src:n.item.url,j.isNullOrUndefined(n.item.selectParent)||"IMG"!==n.item.selectParent[0].tagName?(e=j.createElement("img"),this.setStyle(e,n),j.isNullOrUndefined(n.item.selection)||n.item.selection.restore(),j.isNullOrUndefined(n.selector)||"pasteCleanupModule"!==n.selector?la.Insert(this.parent.currentDocument,e,this.parent.editableElement):j.isNullOrUndefined(this.parent.currentDocument)||n.callBack({requestType:"Images",editorMode:"HTML",event:n.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:[e]})):(e=n.item.selectParent[0],this.setStyle(e,n,t=!0)),n.callBack&&(j.isNullOrUndefined(n.selector)||!j.isNullOrUndefined(n.selector)&&"pasteCleanupModule"!==n.selector)&&(e=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],i="Replace"===n.value||t?n.item.selectParent[0]:j.Browser.isIE?e.previousSibling:e.previousElementSibling,o=function(){var e,t;j.isNullOrUndefined(r.parent.currentDocument)||(e=i.getAttribute("width"),t=i.getAttribute("height"),!j.isNullOrUndefined(e)&&"auto"!==e||i.setAttribute("width",i.offsetWidth.toString()),!j.isNullOrUndefined(t)&&"auto"!==t||i.setAttribute("height",i.offsetHeight.toString()),n.callBack({requestType:"Replace"===n.value?n.item.subCommand="Replace":"Images",editorMode:"HTML",event:n.event,range:r.parent.nodeSelection.getRange(r.parent.currentDocument),elements:[i]})),i.removeEventListener("load",o)},i.addEventListener("load",o))},_a.prototype.setStyle=function(e,t,n){var i;if(j.isNullOrUndefined(t.item.url)||e.setAttribute("src",t.item.url),n)for(var o={"e-imgcenter":"e-imgcenter","e-imgright":"e-imgright","e-imgleft":"e-imgleft"},r=e.classList,s=0;s<r.length;s++)j.isNullOrUndefined(o[r[s]])||(i=o[r[s]]);e.setAttribute("class","e-rte-image"+(j.isNullOrUndefined(t.item.cssClass)?"":" "+t.item.cssClass)+(j.isNullOrUndefined(i)?"":" "+i)),j.isNullOrUndefined(t.item.altText)||e.setAttribute("alt",t.item.altText.replace(/\.[a-zA-Z0-9]+$/,"")),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.width)||e.setAttribute("width",this.calculateStyleValue(t.item.width.width)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.height)||e.setAttribute("height",this.calculateStyleValue(t.item.height.height)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.minWidth)||(e.style.minWidth=this.calculateStyleValue(t.item.width.minWidth)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.maxWidth)||(e.style.maxWidth=this.calculateStyleValue(t.item.width.maxWidth)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.minHeight)||(e.style.minHeight=this.calculateStyleValue(t.item.height.minHeight)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.maxHeight)||(e.style.maxHeight=this.calculateStyleValue(t.item.height.maxHeight))},_a.prototype.calculateStyleValue=function(e){e="string"==typeof e&&(e.indexOf("px")||e.indexOf("%")||e.indexOf("auto"))?e:e+"px";return e},_a.prototype.insertImageLink=function(e){var t=j.createElement("a",{attrs:{href:e.item.url}});e.item.selectNode[0].parentElement.classList.contains("e-img-wrap")&&(e.item.selection.restore(),t.setAttribute("contenteditable","true")),t.appendChild(e.item.selectNode[0]),j.isNullOrUndefined(e.item.target)||t.setAttribute("target",e.item.target),j.isNullOrUndefined(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),la.Insert(this.parent.currentDocument,t,this.parent.editableElement),this.callBack(e)},_a.prototype.openImageLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},_a.prototype.removeImageLink=function(e){var t,n,i,o=e.item.selectParent[0];o.classList.contains("e-img-caption")?(t=j.select(".e-img-wrap",o),i=(n=j.select(".e-img-inner",o)).cloneNode(!0),j.detach(j.select("a",o)),j.detach(n),t.appendChild(e.item.insertElement),t.appendChild(i)):(j.detach(o),j.Browser.isIE&&e.item.selection&&e.item.selection.restore(),la.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement)),this.callBack(e)},_a.prototype.editImageLink=function(e){e.item.selectNode[0].parentElement.href=e.item.url,j.isNullOrUndefined(e.item.target)?(e.item.selectNode[0].parentElement.removeAttribute("target"),e.item.selectNode[0].parentElement.removeAttribute("aria-label")):(e.item.selectNode[0].parentElement.target=e.item.target,e.item.selectNode[0].parentElement.setAttribute("aria-label",e.item.ariaLabel)),this.callBack(e)},_a.prototype.removeImage=function(e){j.closest(e.item.selectNode[0],"a")&&("A"!==e.item.selectNode[0].parentElement.nodeName||j.isNullOrUndefined(e.item.selectNode[0].parentElement.innerText))?j.detach(j.closest(e.item.selectNode[0],"a")):j.isNullOrUndefined(j.closest(e.item.selectNode[0],"."+l))?j.detach(e.item.selectNode[0]):j.detach(j.closest(e.item.selectNode[0],"."+l)),this.callBack(e)},_a.prototype.insertAltTextImage=function(e){e.item.selectNode[0].setAttribute("alt",e.item.altText),this.callBack(e)},_a.prototype.imageDimension=function(e){var t=e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width?t.style.width=j.formatUnit(e.item.width):t.removeAttribute("width"),"auto"!==e.item.height?t.style.height=j.formatUnit(e.item.height):t.removeAttribute("height"),this.callBack(e)},_a.prototype.imageCaption=function(e){la.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement),this.callBack(e)},_a.prototype.imageJustifyLeft=function(e){var t=e.item.selectNode[0];j.isNullOrUndefined(t)||(t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+l))||(j.removeClass([j.closest(t,"."+l)],Ca),j.addClass([j.closest(t,"."+l)],Na)),"A"===t.parentElement.nodeName?(j.removeClass([t.parentElement],Ca),j.addClass([t.parentElement],Na),j.addClass([t],Na)):null!=t.parentElement.nextElementSibling?(j.addClass([t],Na),t.parentElement.nextElementSibling.style.clear="left"):j.addClass([t],Na),this.callBack(e))},_a.prototype.imageJustifyCenter=function(e){var t=e.item.selectNode[0];j.isNullOrUndefined(t)||(t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+l))||(j.removeClass([j.closest(t,"."+l)],Na),j.removeClass([j.closest(t,"."+l)],Ca),j.addClass([j.closest(t,"."+l)],Ea)),"A"===t.parentElement.nodeName&&(j.removeClass([t.parentElement],Na),j.removeClass([t.parentElement],Ca),j.addClass([t.parentElement],Ea)),j.addClass([t],Ea),this.callBack(e))},_a.prototype.imageJustifyRight=function(e){var t=e.item.selectNode[0];j.isNullOrUndefined(t)||(t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+l))||(j.removeClass([j.closest(t,"."+l)],Na),j.addClass([j.closest(t,"."+l)],Ca)),"A"===t.parentElement.nodeName?(j.removeClass([t.parentElement],Na),j.addClass([t.parentElement],Ca),j.addClass([t],Ca)):null!=t.parentElement.nextElementSibling?(j.addClass([t],Ca),t.parentElement.nextElementSibling.style.clear="right"):j.addClass([t],Ca),this.callBack(e))},_a.prototype.imageInline=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),j.addClass([t],"e-rte-image"),j.addClass([t],Da),j.isNullOrUndefined(j.closest(t,"."+l))||(j.removeClass([j.closest(t,"."+l)],La),j.removeClass([j.closest(t,"."+l)],Ea),j.removeClass([j.closest(t,"."+l)],Na),j.removeClass([j.closest(t,"."+l)],Ca),j.addClass([j.closest(t,"."+l)],xa)),this.callBack(e)},_a.prototype.imageBreak=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),j.addClass([t],La),j.addClass([t],"e-rte-image"),j.isNullOrUndefined(j.closest(t,"."+l))||(j.removeClass([j.closest(t,"."+l)],xa),j.removeClass([j.closest(t,"."+l)],Ea),j.removeClass([j.closest(t,"."+l)],Na),j.removeClass([j.closest(t,"."+l)],Ca),j.addClass([j.closest(t,"."+l)],La)),this.callBack(e)},_a.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},_a.prototype.destroy=function(){this.removeEventListener()},_a);function _a(e){this.parent=e,this.addEventListener()}Qa.prototype.addEventListener=function(){this.parent.observer.on(Gr,this.audioCommand,this),this.parent.observer.on(r,this.destroy,this)},Qa.prototype.removeEventListener=function(){this.parent.observer.off(Gr,this.audioCommand),this.parent.observer.off(r,this.destroy)},Qa.prototype.audioCommand=function(e){var t,n,i=e.value.toString().toLowerCase();switch("inline"!==i&&"break"!==i&&"audioremove"!==i||(n=(t=e.item.selectNode[0]).closest("."+Ua)),i){case"audio":case"audioreplace":this.createAudio(e);break;case"inline":t.removeAttribute("class"),n.style.display="inline-block",j.addClass([t],[Aa,Ma,ja]),this.callBack(e);break;case"break":t.removeAttribute("class"),n.style.display="block",j.addClass([t],[ka,Aa,ja]),this.callBack(e);break;case"audioremove":n?j.detach(n):j.detach(t),this.callBack(e)}},Qa.prototype.createAudio=function(e){var t,n,i,o,r,s=this,a=!1;!j.isNullOrUndefined(e.item.selectParent)&&e.item.selectParent[0].classList&&(e.item.selectParent[0].classList.contains(Ba)||e.item.selectParent[0].classList.contains(Ua))?(t=e.item.selectParent[0].querySelector("source"),this.setStyle(t,e),a=!0):(t=j.createElement("span",{className:Ua,attrs:{contentEditable:"false",title:j.isNullOrUndefined(e.item.title)?j.isNullOrUndefined(e.item.fileName)?"":e.item.fileName:e.item.title}}),i=j.createElement("audio",{className:Aa+" "+Ma,attrs:{controls:""}}),n=j.createElement("source"),o=j.createElement("span",{className:Ba}),this.setStyle(n,e),i.appendChild(n),o.appendChild(i),t.appendChild(o),j.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),la.Insert(this.parent.currentDocument,t,this.parent.editableElement),j.isNullOrUndefined(e.item.selection)||(n=e.item.selection.getRange(this.parent.currentDocument),e.item.selection.save(n,this.parent.currentDocument)),null===t.nextElementSibling&&(i=j.createElement("br"),t.parentNode.insertBefore(i,t.nextSibling))),e.callBack&&(j.isNullOrUndefined(e.selector)||!j.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)&&(o=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],(r="AudioReplace"===e.value||a?e.item.selectParent[0].querySelector("audio"):j.Browser.isIE?o:o.querySelector("audio")).addEventListener("loadeddata",function(){"AudioReplace"===e.value&&a||j.isNullOrUndefined(s.parent.currentDocument)||e.callBack({requestType:"Audios",editorMode:"HTML",event:e.event,range:s.parent.nodeSelection.getRange(s.parent.currentDocument),elements:[r]})}),a)&&r.load()},Qa.prototype.setStyle=function(e,t){j.isNullOrUndefined(t.item.url)||e.setAttribute("src",t.item.url);var n=t.item.fileName?t.item.fileName.split(".").pop().toLowerCase():t.item.url?t.item.url.split(".").pop().toLowerCase():"";e.type="opus"===n?"audio/ogg":"m4a"===n?"audio/mp4":t.item.fileName&&0<t.item.fileName.split(".").length?"audio/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&0<t.item.url.split(".").length?"audio/"+t.item.url.split(".")[t.item.url.split(".").length-1]:""},Qa.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},Qa.prototype.destroy=function(){this.removeEventListener()};var Va=Qa;function Qa(e){this.parent=e,this.addEventListener()}Ka.prototype.addEventListener=function(){this.parent.observer.on(Xr,this.videoCommand,this),this.parent.observer.on(r,this.destroy,this)},Ka.prototype.removeEventListener=function(){this.parent.observer.off(Xr,this.videoCommand),this.parent.observer.off(r,this.destroy)},Ka.prototype.videoCommand=function(e){var t,n,i,o="",r=e.value.toString().toLowerCase();switch("video"!==r&&"videoreplace"!==r&&(n=(t=e.item.selectNode[0]).closest("."+Ha),i=t.closest("."+Ra)),t&&(o=t.classList.contains("e-rte-embed-url")?"e-rte-embed-url":""),r){case"video":case"videoreplace":this.createVideo(e);break;case"videodimension":this.videoDimension(e);break;case"inline":t.removeAttribute("class"),n&&(n.style.display="inline-block"),i&&(t.parentElement.style.cssFloat=""),j.addClass([t],[Ia,qa,Fa]),this.callBack(e);break;case"break":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),j.addClass([t],[wa,Ia,Fa]),this.callBack(e);break;case"justifyleft":t.removeAttribute("class"),n&&(n.style.display="block"),i?t.parentElement.style.cssFloat="left":null!=t.parentElement.nextElementSibling?(j.addClass([t],""===o?[Ia,Ta]:[Ia,Ta,o]),t.parentElement.nextElementSibling.style.clear="left"):j.addClass([t],""===o?[Ia,Ta]:[Ia,Ta,o]),this.callBack(e);break;case"justifycenter":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),j.addClass([t],""===o?[Ia,Oa]:[Ia,Oa,o]),this.callBack(e);break;case"justifyright":t.removeAttribute("class"),n&&(n.style.display="block"),i?t.parentElement.style.cssFloat="right":null!=t.parentElement.nextElementSibling?(j.addClass([t],""===o?[Ia,Sa]:[Ia,Ta,o]),t.parentElement.nextElementSibling.style.clear="right"):j.addClass([t],""===o?[Ia,Sa]:[Ia,Sa,o]),this.callBack(e);break;case"videoremove":j.detach(t.parentElement),this.callBack(e)}},Ka.prototype.wrapVideo=function(e){var t,n,i;return e.item.isEmbedUrl?(t=j.createElement("span",{className:Ha,attrs:{contentEditable:"false"}}),n=j.createElement("span",{className:Ra}),(i=j.createElement("template")).innerHTML=e.item.fileName,n.appendChild(i.content),this.vidElement=i=n.firstElementChild,this.setStyle(i,e,this.vidElement),t.style.display=e.item.cssClass===qa?"inline-block":"block",t.appendChild(n)):(t=j.createElement("span",{className:Pa,attrs:{contentEditable:"false",title:j.isNullOrUndefined(e.item.title)?j.isNullOrUndefined(e.item.fileName)?"":e.item.fileName:e.item.title}}),this.vidElement=j.createElement("video",{className:Ia+" "+qa,attrs:{controls:""}}),i=j.createElement("source"),this.setStyle(i,e,this.vidElement),this.vidElement.appendChild(i),t.appendChild(this.vidElement)),t},Ka.prototype.createVideo=function(e){var t,n,i,o,r=this,s=!1;"VideoReplace"!==e.value||j.isNullOrUndefined(e.item.selectParent)||"VIDEO"!==e.item.selectParent[0].tagName?"VideoReplace"===e.value&&!j.isNullOrUndefined(e.item.selectParent)&&j.isNullOrUndefined(e.item.selectParent[0].querySelector("iframe"))&&e.item.selectParent[0].classList&&e.item.selectParent[0].classList.contains(Ra)?(e.item.selectParent[0].innerHTML=e.item.fileName,this.setStyle(e.item.selectParent[0].firstElementChild,e,e.item.selectParent[0].firstElementChild)):"VideoReplace"!==e.value||j.isNullOrUndefined(e.item.selectParent)||j.isNullOrUndefined(e.item.selectParent[0].querySelector("iframe"))||e.item.isEmbedUrl?(t=(e.item.isEmbedUrl||"VideoReplace"===e.value&&(t=e.item.selection.range.startContainer.closest(".e-embed-video-wrap"),j.isNullOrUndefined(t)||t.remove()),this.wrapVideo(e)),j.isNullOrUndefined(e.item.selection)||e.item.selection.restore(),la.Insert(this.parent.currentDocument,t,this.parent.editableElement),j.isNullOrUndefined(e.item.selection)||(n=e.item.selection.getRange(this.parent.currentDocument),e.item.selection.save(n,this.parent.currentDocument)),null===t.nextElementSibling&&(n=j.createElement("br"),t.parentNode.insertBefore(n,t.nextSibling))):(t=this.wrapVideo(e),(i=e.item.selection.range.startContainer).parentNode.replaceChild(t,i)):e.item.isEmbedUrl?(t=this.wrapVideo(e),(i=e.item.selection.range.startContainer).parentNode.replaceChild(t,i)):(n=e.item.selectParent[0].querySelector("source"),this.setStyle(n,e,n),s=!0),e.callBack&&(j.isNullOrUndefined(e.selector)||!j.isNullOrUndefined(e.selector)&&"pasteCleanupModule"!==e.selector)&&(i=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],"VideoReplace"===e.value||s?e.item.isEmbedUrl?e.item.isEmbedUrl?j.isNullOrUndefined(t)||(o=t.querySelector("iframe")):o=e.item.selectParent[0].querySelector("iframe"):o=e.item.selectParent[0]:o=e.item.isEmbedUrl?i.querySelector("iframe"):"VIDEO"===i.tagName?i:i.lastElementChild,o.addEventListener("IFRAME"!==o.tagName?"loadeddata":"load",function(){"VideoReplace"===e.value&&s||(e.item.isEmbedUrl&&o&&o.classList.add("e-rte-embed-url"),j.isNullOrUndefined(r.parent.currentDocument))||e.callBack({requestType:"Videos",editorMode:"HTML",event:e.event,range:r.parent.nodeSelection.getRange(r.parent.currentDocument),elements:[o]})}),s&&o.load(),-1!==j.Browser.userAgent.indexOf("Firefox"))&&(this.vidElement.addEventListener("play",function(){r.editAreaVideoClick(e)}),this.vidElement.addEventListener("pause",function(){r.editAreaVideoClick(e)}))},Ka.prototype.editAreaVideoClick=function(e){e.callBack({requestType:"VideosPlayPause",editorMode:"HTML",event:e.event})},Ka.prototype.setStyle=function(e,t,n){""!==t.item.url&&!j.isNullOrUndefined(t.item.url)&&j.isNullOrUndefined(e)||"iframe"===e.nodeName.toLowerCase()||e.setAttribute("src",t.item.url),t.item.isEmbedUrl||(e.type=t.item.fileName&&0<t.item.fileName.split(".").length?"video/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&0<t.item.url.split(".").length?"video/"+t.item.url.split(".")[t.item.url.split(".").length-1]:""),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.width)||n.setAttribute("width",j.formatUnit(t.item.width.width)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.height)||n.setAttribute("height",j.formatUnit(t.item.height.height)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.minWidth)||(n.style.minWidth=j.formatUnit(t.item.width.minWidth)),j.isNullOrUndefined(t.item.width)||j.isNullOrUndefined(t.item.width.maxWidth)||(n.style.maxWidth=j.formatUnit(t.item.width.maxWidth)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.minHeight)||(n.style.minHeight=j.formatUnit(t.item.height.minHeight)),j.isNullOrUndefined(t.item.height)||j.isNullOrUndefined(t.item.height.maxHeight)||(n.style.maxHeight=j.formatUnit(t.item.height.maxHeight)),j.isNullOrUndefined(t.item.cssClass)||(t.item.cssClass===wa?(j.addClass([n],[wa]),j.removeClass([n],[qa])):(j.addClass([n],[qa]),j.removeClass([n],[wa])))},Ka.prototype.videoDimension=function(e){var t=e.item.selectNode[0].classList.contains(Ra)?e.item.selectNode[0].querySelector("iframe"):e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width&&(t.style.width=j.formatUnit(e.item.width)),"auto"!==e.item.height&&(t.style.height=j.formatUnit(e.item.height)),this.callBack(e)},Ka.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},Ka.prototype.destroy=function(){this.removeEventListener()};var Wa=Ka;function Ka(e){this.parent=e,this.addEventListener()}d.prototype.addEventListener=function(){this.parent.observer.on(Yr,this.createTable,this),this.parent.observer.on($r,this.insertRow,this),this.parent.observer.on(Zr,this.insertColumn,this),this.parent.observer.on(es,this.deleteRow,this),this.parent.observer.on(ts,this.deleteColumn,this),this.parent.observer.on(ns,this.removeTable,this),this.parent.observer.on(is,this.tableHeader,this),this.parent.observer.on(os,this.tableVerticalAlign,this),this.parent.observer.on(rs,this.cellMerge,this),this.parent.observer.on(as,this.HorizontalSplit,this),this.parent.observer.on(ss,this.VerticalSplit,this),this.parent.observer.on(ls,this.tableStyle,this),this.parent.observer.on(ds,this.tableStyle,this),this.parent.observer.on(cs,this.tableMove,this),this.parent.observer.on(r,this.destroy,this)},d.prototype.removeEventListener=function(){this.parent.observer.off(Yr,this.createTable),this.parent.observer.off($r,this.insertRow),this.parent.observer.off(Zr,this.insertColumn),this.parent.observer.off(es,this.deleteRow),this.parent.observer.off(ts,this.deleteColumn),this.parent.observer.off(ns,this.removeTable),this.parent.observer.off(is,this.tableHeader),this.parent.observer.off(os,this.tableVerticalAlign),this.parent.observer.off(rs,this.cellMerge),this.parent.observer.off(as,this.HorizontalSplit),this.parent.observer.off(ss,this.VerticalSplit),this.parent.observer.off(ls,this.tableStyle),this.parent.observer.off(ds,this.tableStyle),this.parent.observer.off(cs,this.tableMove),this.parent.observer.off(r,this.destroy)},d.prototype.createTable=function(e){for(var t,n=j.createElement("table",{className:"e-rte-table"}),i=j.createElement("tbody"),o=(j.isNullOrUndefined(e.item.width.width)||(n.style.width=this.calculateStyleValue(e.item.width.width)),j.isNullOrUndefined(e.item.width.minWidth)||(n.style.minWidth=this.calculateStyleValue(e.item.width.minWidth)),j.isNullOrUndefined(e.item.width.maxWidth)||(n.style.maxWidth=this.calculateStyleValue(e.item.width.maxWidth)),100<parseInt(e.item.width.width,10)?100/e.item.columns:parseInt(e.item.width.width,10)/e.item.columns),r=0;r<e.item.rows;r++){for(var s=j.createElement("tr"),a=0;a<e.item.columns;a++){var l=j.createElement("td");l.appendChild(j.createElement("br")),l.style.width=o+"%",s.appendChild(l)}i.appendChild(s)}return n.appendChild(i),e.item.selection.restore(),la.Insert(this.parent.currentDocument,n,this.parent.editableElement),e.item.selection.setSelectionText(this.parent.currentDocument,n.querySelector("td"),n.querySelector("td"),0,0),null!==n.nextElementSibling||n.classList.contains("ignore-table")||(t=void 0,"DIV"===e.enterAction?(t=j.createElement("div")).appendChild(j.createElement("br")):"BR"===e.enterAction?t=j.createElement("br"):(t=j.createElement("p")).appendChild(j.createElement("br")),this.insertAfter(t,n)),n.classList.contains("ignore-table")&&g([n],["ignore-table"]),n.querySelector("td").classList.add("e-cell-select"),e.callBack&&e.callBack({requestType:"Table",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:[n]}),n},d.prototype.calculateStyleValue=function(e){e="string"==typeof e&&(0<=e.indexOf("px")||0<=e.indexOf("%")||0<=e.indexOf("auto"))?e:e+"px";return e},d.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},d.prototype.getSelectedCellMinMaxIndex=function(e){for(var t=this.curTable.querySelectorAll(".e-cell-select"),n=0,i=e.length,o=0,r=e[0].length,s=0;n<t.length;n++)var a=this.getCorrespondingIndex(t[n],e),l=this.FindIndex(a[0],a[1],e),i=Math.min(a[0],i),o=Math.max(l[0],o),r=Math.min(a[1],r),s=Math.max(l[1],s);return{startRow:i,endRow:o,startColumn:r,endColumn:s}},d.prototype.insertRow=function(e){var t="InsertRowBefore"!==e.item.subCommand,n=e.item.selection.range.startContainer;if("th"!==(n="TH"!==n.nodeName&&"TD"!==n.nodeName?j.closest(n.parentElement,"td,th"):n).nodeName.toLowerCase()||"InsertRowBefore"!==e.item.subCommand){if(this.curTable=j.closest(this.parent.nodeSelection.range.startContainer.parentElement,"table"),0===this.curTable.querySelectorAll(".e-cell-select").length){var n=this.curTable.rows[this.curTable.rows.length-1],i=n.cloneNode(!0);i.removeAttribute("rowspan"),this.insertAfter(i,n)}else{for(var o,r=this.getCorrespondingColumns(),i=this.getSelectedCellMinMaxIndex(r),s=t?i.endRow:i.startRow,a=j.createElement("tr"),l=0<this.curTable.querySelectorAll("th.e-cell-select").length,d=0;d<r[s].length;d++)t&&s<r.length-1&&r[s][d]===r[s+1][d]||!t&&0<s&&r[s][d]===r[s-1][d]?(0===d||0<d&&r[s][d]!==r[s][d-1])&&r[s][d].setAttribute("rowspan",(parseInt(r[s][d].getAttribute("rowspan"),10)+1).toString()):((o=j.createElement("td")).appendChild(j.createElement("br")),a.appendChild(o),o.setAttribute("style",r[l&&t&&r[s+1]?s+1:s][d].getAttribute("style")));n=void 0,n=l&&t?this.curTable.querySelector("tbody").childNodes[0]:this.curTable.rows[s];"InsertRowBefore"===e.item.subCommand||l?n.parentElement.insertBefore(a,n):this.insertAfter(a,n)}e.item.selection.setSelectionText(this.parent.currentDocument,e.item.selection.range.startContainer,e.item.selection.range.startContainer,0,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},d.prototype.insertColumn=function(e){for(var t=e.item.selection.range.startContainer,n=("TH"!==t.nodeName&&"TD"!==t.nodeName&&(t=j.closest(t.parentElement,"td,th")),j.closest(t,"tr")),i=j.closest(n,"table").rows,o=Array.prototype.slice.call(n.querySelectorAll(":scope > td, :scope > th")).indexOf(t),r=parseInt(e.item.width,10)/n.querySelectorAll(":scope > td, :scope > th").length,s=parseInt(e.item.width,10)/(n.querySelectorAll(":scope > td, :scope > th").length+1),a=j.closest(n,"table"),l=j.closest(n,"table").querySelectorAll("th,td"),d=0;d<l.length;d++)l[d].dataset.oldWidth=l[d].offsetWidth/a.offsetWidth*100+"%";!j.isNullOrUndefined(a.style.width)&&""!==a.style.width||(a.style.width=a.offsetWidth+"px");for(d=0;d<i.length;d++){var c,p=(c=i[d].querySelectorAll(":scope > td, :scope > th")[o]).cloneNode(!0);p.innerHTML="",p.appendChild(j.createElement("br")),p.removeAttribute("class"),p.removeAttribute("colspan"),p.removeAttribute("rowspan"),"InsertColumnLeft"===e.item.subCommand?c.parentElement.insertBefore(p,c):this.insertAfter(p,c),p.style.width=s.toFixed(4)+"%",delete p.dataset.oldWidth}for(d=0;d<l.length;d++)l[d].style.width=(Number(l[d].dataset.oldWidth.split("%")[0])*s/r).toFixed(4)+"%",delete l[d].dataset.oldWidth;e.item.selection.setSelectionText(this.parent.currentDocument,t,t,0,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},d.prototype.deleteColumn=function(e){var t=e.item.selection.range.startContainer,n=(3===t.nodeType&&(t=j.closest(t.parentElement,"td,th")),j.closest(t,"TH"===t.tagName?"thead":"tbody")),i=n&&Array.prototype.indexOf.call(n.childNodes,t.parentNode);if(this.curTable=j.closest(t,"table"),1===j.closest(t,"tr").querySelectorAll("th,td").length)e.item.selection.restore(),j.detach(j.closest(t.parentElement,"table"));else{for(var o=void 0,r=this.getCorrespondingColumns(),t=this.getSelectedCellMinMaxIndex(r),s=t.startColumn,a=t.endColumn,l=0;l<r.length;l++)for(var d=r[l],c=0;c<d.length;c++){var p=d[c],h=this.getCorrespondingIndex(p,r),u=parseInt(p.getAttribute("colspan"),10)||1;h[1]+(u-1)>=s&&h[1]<=a&&(1<u?p.setAttribute("colspan",(u-1).toString()):(j.detach(p),o=c,j.Browser.isIE&&(e.item.selection.setSelectionText(this.parent.currentDocument,this.curTable.querySelector("td"),this.curTable.querySelector("td"),0,0),this.curTable.querySelector("td, th").classList.add("e-cell-select"))))}-1<o&&(n=(t=n.children[i])&&t.children[o<=t.children.length-1?o:o-1])&&(e.item.selection.setSelectionText(this.parent.currentDocument,n,n,0,0),n.classList.add("e-cell-select"))}e.callBack&&("TD"!==(i=this.parent.nodeSelection.getRange(this.parent.currentDocument).startContainer).nodeName&&(t=this.parent.nodeSelection.getRange(this.parent.currentDocument).startOffset,n=i.children[t])&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)}))},d.prototype.deleteRow=function(e){var t,n,i,o,r,s=e.item.selection.range.startContainer,a=(3===s.nodeType&&(s=j.closest(s.parentElement,"td,th")),Array.prototype.indexOf.call(s.parentNode.childNodes,s)),l=(this.curTable=j.closest(s,"table"),this.getCorrespondingColumns()),d=this.getSelectedCellMinMaxIndex(l);if(1===this.curTable.rows.length)e.item.selection.restore(),j.detach(j.closest(s.parentElement,"table"));else for(t=d.endRow;t>=d.startRow;t--){for(h=this.curTable.rows[t],n=0;n<l[t].length;n++)if(0!==n&&l[t][n]===l[t][n-1]||1<parseInt(l[t][n].getAttribute("rowspan"),10)&&(1===(i=parseInt(l[t][n].getAttribute("rowspan"),10)-1)?(l[t][n].removeAttribute("rowspan"),(o=this.getMergedRow(this.getCorrespondingColumns())[n])&&((r=o.cloneNode(!0)).innerHTML="<br>",o.parentElement)&&o.parentElement.insertBefore(r,o)):l[t][n].setAttribute("rowspan",i.toString())),t<l.length-1&&l[t][n]===l[t+1][n]&&(0===t||l[t][n]!==l[t-1][n]))for(var c=l[t][n],p=void 0,p=n;0<p&&l[t][p]===l[t][p-1];p--)0===p?this.curTable.rows[t+1].prepend(c):l[t+1][p-1].insertAdjacentElement("afterend",c);var h=h.rowIndex,h=(this.curTable.deleteRow(h),j.isNullOrUndefined(this.curTable.rows[h])?this.curTable.querySelectorAll("tbody tr")[h-1]:this.curTable.querySelectorAll("tbody tr")[h]),h=h&&h.querySelectorAll("td")[a];(h?(e.item.selection.setSelectionText(this.parent.currentDocument,h,h,0,0),h):(e.item.selection.setSelectionText(this.parent.currentDocument,this.curTable.querySelector("td"),this.curTable.querySelector("td"),0,0),this.curTable.querySelector("td, th"))).classList.add("e-cell-select")}e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},d.prototype.getMergedRow=function(e){for(var t,n=0;n<e.length;n++)e[n].length!==this.curTable.rows[0].childNodes.length&&(t=e[n]);return t},d.prototype.removeTable=function(e){var t=3===(t=e.item.selection.range.startContainer).nodeType?t.parentNode:t,t=j.closest(t.parentElement,"table");t&&(e.item.selection.restore(),j.detach(t)),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},d.prototype.tableHeader=function(e){var t=!1,n=3===(n=e.item.selection.range.startContainer).nodeType?n.parentNode:n,i=j.closest(n.parentElement,"table");if([].slice.call(i.childNodes).forEach(function(e){"THEAD"===e.nodeName&&(t=!0)}),i&&!t){for(var o=i.querySelector("tr").childElementCount,r=0,s=0;s<o;s++)r+=parseInt(i.querySelector("tr").children[s].getAttribute("colspan"),10)||1;for(var a=i.createTHead().insertRow(0),l=0;l<r;l++){var d=j.createElement("th");d.appendChild(j.createElement("br")),a.appendChild(d)}}else i.deleteTHead();e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},d.prototype.tableVerticalAlign=function(e){var t="";switch(e.item.subCommand){case"AlignTop":t="top";break;case"AlignMiddle":t="middle";break;case"AlignBottom":t="bottom"}(e.item.tableCell.style.verticalAlign=t)&&""!==t&&e.item.tableCell.getAttribute("valign")&&e.item.tableCell.removeAttribute("valign"),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},d.prototype.cellMerge=function(e){j.isNullOrUndefined(this.curTable)&&(this.curTable=j.closest(this.parent.nodeSelection.range.startContainer.parentElement,"table"));var t=this.curTable.querySelectorAll(".e-cell-select");if(!(t.length<2)){this.mergeCellContent();for(var n=this.getSelectedMinMaxIndexes(this.getCorrespondingColumns()),i=t[0],o=i.parentElement.querySelectorAll(".e-cell-select"),r=0,s=0;s<o.length;s++){var a=o[s].offsetHeight;r<a&&(r=a)}n.startColumn<n.endColumn&&i.setAttribute("colspan",(n.endColumn-n.startColumn+1).toString()),n.startRow<n.endRow&&i.setAttribute("rowspan",(n.endRow-n.startRow+1).toString());for(var l,d,c=0,s=o.length-1;0<=s;s--)j.isNullOrUndefined(o[s].style.width)||""===o[s].style.width?(c+=o[s].offsetWidth/this.curTable.offsetWidth*100,d="%"):(d||(d=(l=o[s].style.width.match(/^([\d.]+)([a-z%]+)$/i))?l[2]:"%"),c+=parseFloat(o[s].style.width));i.style.width=c+d,i.style.height=r+"px";for(var p=1;p<=t.length-1;p++)j.detach(t[p]);for(p=0;p<this.curTable.rows.length;p++)""===this.curTable.rows[p].innerHTML.trim()&&j.detach(this.curTable.rows[p]);g(this.curTable.querySelectorAll("table td, table th"),"e-multi-cells-select"),g(this.curTable.querySelectorAll("table td, table th"),"e-cell-select-end"),this.updateRowSpanStyle(n.startRow,n.endRow,this.getCorrespondingColumns()),this.updateColSpanStyle(n.startColumn,n.endColumn,this.getCorrespondingColumns()),e.item.selection.setSelectionText(this.parent.currentDocument,e.item.selection.range.startContainer,e.item.selection.range.startContainer,0,0),this.parent.nodeSelection&&i&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},d.prototype.updateColSpanStyle=function(e,t,n){var i,o,r,s,a,l=0,d=n;if(e<(t=Math.min(t,d[0].length-1))){for(o=e;o<=t;o++)if(s=Math.min(parseInt(d[0][o].getAttribute("colspan"),10)||1,t-e+1),!(e<o&&d[0][o]===d[0][o-1])&&1<s&&d[0][o]===d[0][o+1])for(l=s-1,i=1;i<d.length;i++){if(d[i][o]!==d[i-1][o])for(r=o;r<o+s;r++)if(1<(a=parseInt(d[i][r].getAttribute("colspan"),10)||1)&&d[i][r]===d[i][r+1])r+=l=Math.min(l,a-1);else if(0===(l=Math.max(0,l-1)))break;if(!l)break}l&&this.updateCellAttribute(d,l,"colspan",0,d.length-1,e,t)}},d.prototype.updateRowSpanStyle=function(e,t,n){var i,o,r,s,a=0,l=0,d=n;if(e<(t=Math.min(t,d.length-1))){for(i=e;i<=t;i++)if(!(e<i&&d[i][0]===d[i-1][0])&&d[i][0]&&1<(a=Math.min(parseInt(d[i][0].getAttribute("rowspan"),10)||1,t-e+1))&&d[i][0]===d[i+1][0])for(l=a-1,o=1;o<d[0].length;o++)if(d[i][o]!==d[i][o-1]){for(r=i;r<i+a;r++)if(1<(s=parseInt(d[r][o].getAttribute("rowspan"),10)||1)&&d[r][o]===d[r+1][o])r+=l=Math.min(l,s-1);else if(!(l=Math.max(0,l-1)))break;if(!l)break}l&&this.updateCellAttribute(d,l,"rowspan",e,t,0,d[0].length-1)}},d.prototype.updateCellAttribute=function(e,t,n,i,o,r,s){for(var a,l,d=i;d<=o;d++)for(a=r;a<=s;a++)l=parseInt(e[d][a].getAttribute(n),10)||1,(i<d&&e[d][a]===e[d-1][a]||r<a&&e[d][a]===e[d][a-1]||1<l)&&(1<l-t?e[d][a].setAttribute(n,(l-t).toString()):e[d][a].removeAttribute(n))},d.prototype.mergeCellContent=function(){for(var e=this.curTable.querySelectorAll(".e-cell-select"),t="<br>"===e[0].innerHTML?"":e[0].innerHTML,n=1;n<e.length;n++)"<br>"!==e[n].innerHTML&&(t=t?t+"<br>"+e[n].innerHTML:t+e[n].innerHTML);e[0].innerHTML=t},d.prototype.getSelectedMinMaxIndexes=function(e){var t=this.curTable.querySelectorAll(".e-cell-select");if(0<t.length){for(var n=e.length,i=0,o=e[0].length,r=0,s=0;s<t.length;s++)var a=this.getCorrespondingIndex(t[s],e),l=this.FindIndex(a[0],a[1],e),n=Math.min(a[0],n),i=Math.max(l[0],i),o=Math.min(a[1],o),r=Math.max(l[1],r);return{startRow:n,endRow:i,startColumn:o,endColumn:r}}return null},d.prototype.HorizontalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=j.closest(t.parentElement,"table"),!(1<this.curTable.querySelectorAll(".e-cell-select").length)){this.activeCell=this.curTable.querySelector(".e-cell-select");var t=this.activeCell.cloneNode(!0),n=(t.removeAttribute("class"),t.innerHTML="</br>",this.getCorrespondingIndex(this.activeCell,this.getCorrespondingColumns())),i=this.getCorrespondingColumns(),o=this.activeCell.getAttribute("rowspan")?parseInt(this.activeCell.getAttribute("rowspan"),10):1;if(1<o){for(var r=Math.ceil(o/2),s=(1<r?this.activeCell.setAttribute("rowspan",r.toString()):this.activeCell.removeAttribute("rowspan"),1<o-r?t.setAttribute("rowspan",(o-r).toString()):t.removeAttribute("rowspan"),void 0),a=n[0]+Math.ceil(o/2),s=0===n[1]?n[1]:n[1]-1;0<=s&&(i[a][s]===i[a][s-1]||0<a&&i[a][s]===i[a-1][s]);)s--;-1===s?this.curTable.rows[a].firstChild?this.curTable.rows[a].prepend(t):this.curTable.appendChild(t):i[a][s].insertAdjacentElement("afterend",t)}else{for(var r=j.createElement("tr"),l=(r.appendChild(t),i[n[0]]),d=0;d<=l.length-1;d++)l[d]!==l[d-1]&&l[d]!==this.activeCell&&l[d].setAttribute("rowspan",((parseInt(l[d].getAttribute("rowspan"),10)?parseInt(l[d].getAttribute("rowspan"),10):1)+1).toString());this.activeCell.parentNode.insertAdjacentElement("afterend",r)}e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},d.prototype.VerticalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=j.closest(t.parentElement,"table"),!(1<this.curTable.querySelectorAll(".e-cell-select").length)){this.activeCell=this.curTable.querySelector(".e-cell-select");var n=this.curTable.rows,t=this.activeCell.cloneNode(!0),i=(t.removeAttribute("class"),t.innerHTML="</br>",this.getCorrespondingIndex(this.activeCell,this.getCorrespondingColumns())),o=this.getCorrespondingColumns(),r=parseInt(this.activeCell.getAttribute("colspan"),10)||1;if(1<r){var s=Math.ceil(r/2),a=this.getColSizes(this.curTable),l=this.getSplitColWidth(i[1],i[1]+s-1,a),a=this.getSplitColWidth(i[1]+s,i[1]+r-1,a),d=this.convertPixelToPercentage(this.activeCell.offsetWidth,this.curTable.offsetWidth),a=d-l<a?d-l:a;1<s?this.activeCell.setAttribute("colspan",s.toString()):this.activeCell.removeAttribute("colspan"),1<r-s?t.setAttribute("colspan",(r-s).toString()):t.removeAttribute("colspan"),this.activeCell.style.width=l+"%",t.style.width=a+"%"}else{for(var c,d=parseFloat(this.activeCell.style.width)/2,p=0;p<=n.length-1;p++)0!==p&&o[p][i[1]]===o[p-1][i[1]]||(c=o[p][i[1]])!==this.activeCell&&c.setAttribute("colspan",((parseInt(c.getAttribute("colspan"),10)?parseInt(c.getAttribute("colspan"),10):1)+1).toString());this.activeCell.style.width=d+"%",t.style.width=d+"%"}this.activeCell.parentNode.insertBefore(t,this.activeCell.nextSibling),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},d.prototype.getSplitColWidth=function(e,t,n){for(var i=0,o=e;o<=t;o++)i+=n[o];return this.convertPixelToPercentage(i,this.curTable.offsetWidth)},d.prototype.getColSizes=function(e){for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var o=new Array(n),r=new Map,s=0;s<e.rows.length;s++)for(var a=0,l=0;l<e.rows[s].cells.length;l++){for(var d=1;d<e.rows[s].cells[l].rowSpan;d++)r.set(""+(s+d)+a,e.rows[s].cells[l]);var c=this.getCellIndex(r,s,l),c=(a<c&&(a=c),e.rows[s].cells[l].offsetWidth);(!o[a]||c<o[a])&&(o[a]=c),a+=1+e.rows[s].cells[l].colSpan-1}return o},d.prototype.getCellIndex=function(e,t,n){var i=e.get(""+t+n);return i?this.getCellIndex(e,t,n+i.colSpan):n},d.prototype.convertPixelToPercentage=function(e,t){return e/t*100},d.prototype.getCorrespondingColumns=function(){for(var e=[],t=this.curTable.rows,n=0;n<=t.length-1;n++)for(var i=t[n],o=0,r=0;r<=i.children.length-1;r++){for(var s=i.children[r],a=s,l=parseInt(a.getAttribute("colspan"),10)||1,d=parseInt(a.getAttribute("rowspan"),10)||1,c=n;c<n+d;c++)for(var p=o;p<o+l;p++)e[c]||(e[c]=[]),e[c][p]?o++:e[c][p]=s;o+=0}return e},d.prototype.FindIndex=function(e,t,n){for(var i=e+1,o=t+1;i<n.length;){if(n[i][t]!==n[e][t]){i--;break}i++}for(i===n.length&&i--;o<n[e].length;){if(n[e][o]!==n[e][t]){o--;break}o++}return o===n[e].length&&o--,[i,o]},d.prototype.getCorrespondingIndex=function(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(t[n][i]===e)return[n,i];return[]},d.prototype.highlightCells=function(e,t,n,i,o){for(var r,s,a,l=e,d=t,c=n,p=i,h=new Xa,u=l;u<=d;u++){for(s=this.getCorrespondingIndex(o[u][c],o),a=this.FindIndex(s[0],s[1],o),((1<(parseInt(o[u][c].getAttribute("rowspan"),10)||1)||1<(parseInt(o[u][c].getAttribute("colspan"),10)||1))&&a||(1<(parseInt(o[u][p].getAttribute("rowspan"),10)||1)||1<(parseInt(o[u][p].getAttribute("colspan"),10)||1))&&(s=this.getCorrespondingIndex(o[u][p],o),a=this.FindIndex(s[0],s[1],o)))&&(l=Math.min(s[0],l),d=Math.max(a[0],d),c=Math.min(s[1],c),p=Math.max(a[1],p)),r=c;r<=p;r++)s=this.getCorrespondingIndex(o[l][r],o),a=this.FindIndex(s[0],s[1],o),((1<(parseInt(o[l][r].getAttribute("rowspan"),10)||1)||1<(parseInt(o[l][r].getAttribute("colspan"),10)||1))&&a||(1<(parseInt(o[d][r].getAttribute("rowspan"),10)||1)||1<(parseInt(o[d][r].getAttribute("colspan"),10)||1))&&(s=this.getCorrespondingIndex(o[d][r],o),a=this.FindIndex(s[0],s[1],o)))&&(l=Math.min(s[0],l),d=Math.max(a[0],d),c=Math.min(s[1],c),p=Math.max(a[1],p));h=l===e&&d===t&&c===n&&p===i?{startRow:e,endRow:t,startColumn:n,endColumn:i}:this.highlightCells(l,d,c,p,o)}return h},d.prototype.restoreRange=function(e){!this.parent.currentDocument.getSelection().rangeCount||"TD"!==e.nodeName&&"TH"!==e.nodeName||this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0)},d.prototype.tableStyle=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},d.prototype.tableMove=function(e){this.activeCell=e.selectNode[0];var t=e.event.target,n=this.activeCell.tagName,i=t.tagName;if(this.curTable=j.closest(t,"table"),"TD"===t.tagName||"TH"===t.tagName||n===i){n=j.closest(this.activeCell,"table");if(!j.isNullOrUndefined(this.curTable)&&!j.isNullOrUndefined(n)&&n===this.curTable){for(var o=this.getCorrespondingColumns(),i=this.getCorrespondingIndex(this.activeCell,o),n=this.getCorrespondingIndex(t,o),r=this.curTable.querySelectorAll(".e-cell-select, .e-multi-cells-select, .e-cell-select-end"),s=r.length-1;0<=s;s--)this.activeCell!==r[s]&&g([r[s]],["e-cell-select"]),g([r[s]],["e-multi-cells-select"]),g([r[s]],["e-cell-select-end"]);if(i[0]===n[0]&&i[1]===n[1])1<r.length&&this.restoreRange(t);else{for(var a=this.highlightCells(Math.min(i[0],n[0]),Math.max(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[1],n[1]),o),l=a.startRow;l<=a.endRow;l++)for(var d=a.startColumn;d<=a.endColumn;d++)o[l][d].classList.add("e-cell-select"),o[l][d].classList.add("e-multi-cells-select");t.classList.add("e-cell-select-end"),e.event.type&&e.event.preventDefault(),this.restoreRange(t)}}}},d.prototype.destroy=function(){this.removeEventListener()};var Ga=d;function d(e){this.parent=e,this.addEventListener()}var Xa=function(){},Ya=(q.applyFormat=function(e,t,n,i,o,r,s,a){this.enterAction=i;if(-1<["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","fontcolor","fontname","fontsize","backgroundcolor","inlinecode"].indexOf(t)||"formatPainter"===r){"backgroundcolor"===t&&""===r&&(r="transparent");var l=new gl(n),d=new qs(n,e),c=new sa,p=new Wr,h=l.getRange(e),u=h.startContainer.parentElement;if(!h.collapsed||j.isNullOrUndefined(u)||"A"!==u.tagName||h.startOffset!==u.textContent.length&&0!==h.startOffset||(m=document.createTextNode(""),0===h.startOffset?u.parentNode.insertBefore(m,u):j.isNullOrUndefined(u.nextSibling)?u.parentNode.appendChild(m):u.parentElement.insertBefore(m,u.nextSibling),u=e.createRange(),h.setStart(m,0),h.setEnd(m,0),h.collapse(!0),l.setRange(e,u)),-1!==j.Browser.userAgent.indexOf("Firefox")&&h.startContainer===h.endContainer&&!j.isNullOrUndefined(n)&&h.startContainer===n){for(var m=h.startContainer.childNodes[0<h.startOffset?h.startOffset-1:h.startOffset]||h.startContainer,u=h.endContainer.childNodes[0<h.endOffset?h.endOffset-1:h.endOffset]||h.endContainer,g="BR"===u.lastChild.nodeName?j.isNullOrUndefined(u.lastChild.previousSibling)?u:u.lastChild.previousSibling:u.firstChild;!j.isNullOrUndefined(g)&&"#text"!==g.nodeName&&"IMG"!==g.nodeName&&"BR"!==g.nodeName&&"HR"!==g.nodeName;)g=g.lastChild;l.setSelectionText(e,m,g,0,0),h=l.getRange(e)}for(var f,b,v,u=l.save(h,e),y=void 0,C=!1,N=((y=n&&o&&"#text"!==n.nodeName?o.getTextNodes():y)&&0<y.length?C=!0:y=h.collapsed?l.getSelectionNodeCollection(h):l.getSelectionNodeCollectionBr(h),!1),E=!1,m=!1,S=-1<["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(t),T=(!C&&h.collapsed&&(b=p.getFormattedNode(h.startContainer,t,n),v=j.isNullOrUndefined(b)?null:null===b.getAttribute("style")?b.nodeName:b.nodeName+"[style='"+b.getAttribute("style")+"']",0<y.length?(N=!0,h=c.GetCursorRange(e,h,y[0])):3===h.startContainer.nodeType&&(0<h.startContainer.parentElement.childElementCount&&0<h.startOffset&&"br"!==h.startContainer.parentElement.firstElementChild.tagName.toLowerCase()||!j.isNullOrUndefined(b)&&b===h.startContainer.parentElement.closest(v)&&0!==h.startContainer.parentElement.closest(v).textContent.replace(new RegExp("","g"),"").trim().length)?(N=!0,h=c.GetCursorRange(e,h,h.startContainer),y.push(h.startContainer)):(b=this.insertCursorNode(e,l,h,p,c,t,r,n),l.endContainer=l.startContainer=l.getNodeArray(b,!0),v="BR"===b.nodeName&&b.parentNode.childNodes,j.isNullOrUndefined(v)||1!==v.length||"BR"!==v[0].nodeName||0!==y.length?l.endOffset=l.startOffset=1:(l.setSelectionText(e,h.startContainer,h.endContainer,0,0),m=!0),"BR"===b.nodeName&&0===b.parentNode.textContent.length&&(m=!0))),f=!C&&h.collapsed,!1),O=0;O<y.length;O++){var L=p.getFormattedNode(y[O],t,n);null===L&&("subscript"===t?T=null!==(L=p.getFormattedNode(y[O],"superscript",n)):"superscript"===t&&(T=null!==(L=p.getFormattedNode(y[O],"subscript",n)))),0===O&&null===L&&(E=!0),y[O]=null===L||E&&!S?this.insertFormat(e,y,O,L,f,C,E,S,h,c,t,r,a,d,n):this.removeFormat(y,O,L,f,C,E,S,h,c,t,r,l,n,d),C||(l=this.applySelection(y,l,c,O,N))}Rs()&&As(n,s),m||C||(this.isSafari()&&!h.collapsed&&this.isUnwrapped?(v=u.range.cloneRange(),this.restoreSelectionForSafari(v,e,l),this.isUnwrapped=!1):u.restore()),T&&this.applyFormat(e,t,n,i,o)}},q.adjustContainerAndOffset=function(e,t,n){var i,o=e.childNodes;return e.nodeType===Node.ELEMENT_NODE&&0<o.length?(i=n||this.isUnwrapped?t-1:t,[i=o[Math.max(Math.min(i,o.length-1),0)],n?i.nodeType===Node.TEXT_NODE?i.textContent.length:t:0]):[e,t]},q.restoreSelectionForSafari=function(e,t,n){var i=this.adjustContainerAndOffset(e.startContainer,e.startOffset,!1),o=i[0],i=i[1],r=this.adjustContainerAndOffset(e.endContainer,e.endOffset,!0),s=r[0],r=r[1],o=(e.setStart(o,i),e.setEnd(s,r),t.getSelection());o&&(o.removeAllRanges(),o.addRange(e)),n.save(e,t)},q.insertCursorNode=function(e,t,n,i,o,r,s,a){var l=t.getNodeCollection(n),d=new qs(a,e),i=0<l.length?1<l.length&&n.startContainer===n.endContainer?this.getCursorFormat(i,l,r,a):""===s&&"fontsize"===r&&null==i.getFormattedNode(l[0],r,a)&&"SPAN"===l[0].parentElement.nodeName?l[0].parentElement:i.getFormattedNode(l[0],r,a):null,c=null;if(i){if(c=l[0],8203===i.firstChild.textContent.charCodeAt(0)&&3===i.firstChild.nodeType){var a=new RegExp("","g"),p=void 0;if("#text"!==c.nodeName)for(var h=0;h<l.length;h++)l[h].nodeType===Node.TEXT_NODE&&(c=l[h]);0===(p=i.firstChild===c?(c.textContent=i.parentElement&&(d.isBlockNode(i.parentElement)&&i.parentElement.textContent.length<=1?1<i.parentElement.childElementCount:0===i.childElementCount)&&(1<i.parentElement.textContent.length||i.parentElement.firstChild&&1===i.parentElement.firstChild.nodeType)?c.textContent:c.textContent.replace(a,""),c):(i.firstChild.textContent=i.firstChild.textContent.replace(a,""),i.firstChild)).textContent.length&&(j.isNullOrUndefined(p.previousSibling)?j.isNullOrUndefined(p.parentElement)||0!==p.parentElement.textContent.length||(a=document.createElement("BR"),p.parentElement.appendChild(a),j.detach(p),t.setCursorPoint(e,(c=a).parentElement,0)):(c=p.previousSibling,a=p.textContent.length-1,t.setCursorPoint(e,p,a)))}-1<["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(r)?("fontcolor"===r?i.style.color=s:"fontname"===r?i.style.fontFamily=s:"fontsize"===r?i.style.fontSize=s:i.style.backgroundColor=s,c=i):(F.unwrap(i),t.setCursorPoint(e,c,0))}else{if(1<l.length&&0<n.startOffset&&l[0].firstElementChild&&"br"===l[0].firstElementChild.tagName.toLowerCase()&&(l[0].innerHTML=""),1!==l.length||0!==n.startOffset||"BR"!==l[0].nodeName&&(j.isNullOrUndefined(l[0].nextSibling)||"BR"!==l[0].nextSibling.nodeName)||j.detach("#text"===l[0].nodeName?l[0].nextSibling:l[0]),!j.isNullOrUndefined(l[0]&&l[0].parentElement)&&-1!==Wr.inlineTags.indexOf(l[0].parentElement.tagName.toLowerCase())&&l[0].textContent.includes("")){p=this.GetFormatNode(r,s),a=l[0];if("fontsize"===r)for(var u=l[0];u;){var m=u.parentElement.textContent.trim()===l[0].textContent.trim(),g=u.parentElement;if(d.isBlockNode(g)||!m||"SPAN"===g.nodeName&&g.classList.contains("e-img-inner"))break;l[0]=u=g}return this.applyStyles(l,0,p),a}c=this.getInsertNode(e,n,r,s).firstChild}return c},q.getCursorFormat=function(e,t,n,i){for(var o,r=0;r<t.length;r++)o=t[r].lastElementChild||t[r];return"fontsize"===n&&null==e.getFormattedNode(o,n,i)&&"SPAN"===o.parentElement.nodeName?o.parentElement:e.getFormattedNode(o,n,i)},q.removeFormat=function(e,t,n,i,o,U,r,s,a,l,d,c,p,h){var u,m,g=null,f="#text"===s.startContainer.nodeName?s.startContainer.textContent.substring(s.startOffset,s.startContainer.textContent.length):s.startContainer.textContent,P=e[t].textContent,b=e[0].parentElement.nodeName===e[0].parentElement.parentElement.nodeName;if(s.startContainer!==s.endContainer||0!==s.startOffset||s.endOffset!==s.startContainer.length||s.startContainer.textContent!==n.textContent&&!b){for(var v=[],y=e[t],b=y;v.push(c.getIndex(y)),(y=y.parentNode)&&y!==n;);if("BR"!==e[t].nodeName&&("#text"===b.nodeName&&b.textContent.includes("")&&b.remove(),o||(y=g=i&&n.textContent.length-1===s.startOffset?a.SplitNode(s,n,!0):a.GetSpliceNode(s,n))),i){for(var C=g;null!==C.firstChild&&3!==C.firstChild.nodeType;)C=C.firstChild;C.innerHTML="&#8203;",e[t]=C.firstChild}else{for(;y&&0<y.childNodes.length&&0<=v.length-1&&y.childNodes.length>v[v.length-1];){if(1<y.childNodes.length&&1<v.length){y=y.childNodes[v[v.length-2]];break}y=y.childNodes[v[v.length-1]],v.pop()}if("BR"!==e[t].nodeName){for(;1===y.nodeType&&0<y.childNodes.length;)y=y.childNodes[0];3!==y.nodeType||i&&""===y.nodeValue?((b=document.createElement("div")).innerHTML="&#8203;",3!==y.nodeType?(y.insertBefore(b.firstChild,y.firstChild),e[t]=y.firstChild):(y.parentNode.insertBefore(b.firstChild,y),e[t]=y.previousSibling,y.parentNode.removeChild(y))):e[t]=y}}}else if(r&&!e[t].contains(n)&&3===e[t].nodeType&&e[t].textContent!==n.textContent){for(var o=e[t].textContent===e[t].wholeText,N=e[t],g=this.GetFormatNode(l,d);N&&N.textContent===N.parentElement.textContent;)N=N.parentElement;if(o&&n.textContent!==N.textContent)return i=[],(b=this.getPriorityFormatNode(N,p))&&b.textContent===N.textContent&&(N=b),i.push(N),this.applyStyles(i,0,g),e[t]}"backgroundcolor"===l&&(u=n.style.fontSize),"fontsize"===l&&(o=j.closest(e[t].parentElement,"span[style*=background-color]"),j.isNullOrUndefined(o)||(m=o.style.backgroundColor));var E,S=n.getAttribute("style"),T=n.tagName;if("A"===T&&"underline"===l?(n.style.textDecoration="none",E=[n]):-1!==Wr.inlineTags.indexOf(T.toLowerCase())&&r&&"span"!==T.toLocaleLowerCase()?((b=n.style).color&&"fontcolor"===l?"A"===n.nodeName?b.color=d:b.color="":b.backgroundColor&&"backgroundcolor"===l?b.backgroundColor="":b.fontSize&&"fontsize"===l?b.fontSize="":b.fontFamily&&"fontname"===l&&(b.fontFamily=""),""===n.getAttribute("style")&&n.removeAttribute("style"),E=[n]):(E=F.unwrap(n),0===t&&(this.isUnwrapped=!0),k=e[t].parentElement,j.isNullOrUndefined(k)||"li"===k.tagName.toLowerCase()||(k=j.closest(k,"li")),j.isNullOrUndefined(k)||"li"!==k.tagName.toLowerCase()||k.textContent.trim()!==e[t].textContent.trim()&&k.innerText.split("\n")[0]!==e[t].textContent.trim()?j.isNullOrUndefined(k)||"li"!==k.tagName.toLowerCase()||k.textContent.trim()===e[t].textContent.trim()||q.conCatenateTextNode(k,l,"","normal",d):"bold"===l?k.style.fontWeight="normal":"italic"===l?k.style.fontStyle="normal":"fontsize"===l&&(k.style.fontSize="")),E[0]&&!r)for(var O=N=E[t]||E[0];N&&N.parentElement&&N.parentElement!==p;){var H=void 0,H="SPAN"===n.nodeName?N.parentElement.tagName.toLocaleLowerCase()===n.tagName.toLocaleLowerCase()&&N.parentElement.getAttribute("style")===S:N.parentElement.tagName.toLocaleLowerCase()===n.tagName.toLocaleLowerCase();N=!(N.parentElement&&H&&(1<N.parentElement.childElementCount||1<s.startOffset))||(O.parentElement&&O.parentElement.tagName.toLocaleLowerCase()===n.tagName.toLocaleLowerCase()&&s.startOffset===s.endOffset&&1!==O.nodeType&&!j.isNullOrUndefined(O.textContent)&&1<O.parentElement.childElementCount&&(s.setStart(O,0),s.setEnd(O,O.textContent.length),a.SplitNode(s,O.parentElement,!1)),"span"===N.parentElement.tagName.toLocaleLowerCase()&&"underline"===n.style.textDecoration&&"underline"!==N.parentElement.style.textDecoration)||(F.unwrap(N.parentElement),j.isNullOrUndefined(N.parentElement))||h.isBlockNode(N.parentElement)?N.parentElement:O}if(0<E.length&&r){for(var L=0;L<E.length;L++)(3!==E[L].nodeType||E[L].textContent&&0<E[L].textContent.trim().length)&&(E[L]=F.Wrap(E[L],this.GetFormatNode(l,d,T,S)),k=e[t].parentElement,j.isNullOrUndefined(k)||"li"===k.tagName.toLowerCase()||(k=j.closest(k,"li")),j.isNullOrUndefined(k)||"li"!==k.tagName.toLowerCase()||k.textContent.trim()!==e[t].textContent.trim()||"fontname"===l&&(k.style.fontFamily=d),j.isNullOrUndefined(k)||"li"!==k.tagName.toLowerCase()||k.textContent.trim()===e[t].textContent.trim()||q.conCatenateTextNode(k,l,k.textContent,l,d),E[L].textContent===f)&&(0===L?s.setStartBefore(E[L]):L===E.length-1&&s.setEndAfter(E[L]));i=e[t].parentElement;if(j.isNullOrUndefined(u)||""===u||(i.style.fontSize=u),j.isNullOrUndefined(m)||""===m||(i.style.backgroundColor=m),"fontsize"===l||"fontcolor"===l){for(var k=e[t].parentElement,w=e[t].parentElement;!j.isNullOrUndefined(w)&&"li"!==w.tagName.toLowerCase();)k=w=w.parentElement;for(var L=t,x="";0<=L&&!j.isNullOrUndefined(k)&&"li"===k.tagName.toLowerCase()&&k.contains(e[L])&&k.textContent.replace("//g","").trim().includes(e[L].textContent.trim());)x=e[L].textContent+x,L--;var D=!1,M=0,B=!1;if(!j.isNullOrUndefined(k)&&k.childNodes)for(var R=0;R<k.childNodes.length;R++)"OL"!==k.childNodes[R].nodeName&&"UL"!==k.childNodes[R].nodeName||(M++,D=!0);if(j.isNullOrUndefined(k)||"li"!==k.tagName.toLowerCase()||k.textContent.split("").join("").trim()!==x.split("").join("").trim()){if(!j.isNullOrUndefined(k)&&"li"===k.tagName.toLowerCase()&&D){if(D&&0<M)for(var A=0;A<k.childNodes.length;A++)e[t].textContent===k.childNodes[A].textContent&&e[t].textContent===P&&k.textContent.replace("//g","").trim().includes(x.split("").join("").trim())&&(B=!0);if(B){for(var I=0;I<k.childNodes.length;I++)"OL"!==k.childNodes[I].nodeName&&"UL"!==k.childNodes[I].nodeName||(k.childNodes[I].style.fontSize="");"fontsize"===l?k.style.fontSize=d:(k.style.color=d,k.style.textDecoration="inherit")}}}else"fontsize"===l?k.style.fontSize=d:(k.style.color=d,k.style.textDecoration="inherit")}}return e[t]},q.insertFormat=function(e,t,n,i,o,r,s,a,l,d,c,p,h,u,m){if(o)"uppercase"!==c&&"lowercase"!==c?(g=this.getInsertNode(e,l,c,p),t[n]=g.firstChild,d.position=1):d.position=l.startOffset;else if(null===i&&s||a){if(r||"BR"===t[n].nodeName||(t[n]=d.GetSpliceNode(l,t[n]),t[n].textContent=d.TrimLineBreak(t[n].textContent)),"uppercase"===c||"lowercase"===c)t[n].textContent="uppercase"===c?t[n].textContent.toLocaleUpperCase():t[n].textContent.toLocaleLowerCase();else if(!0!==a||""!==p){var g=this.GetFormatNode(c,p);if("formatPainter"===p||a){for(var f=t[n].parentElement,b=t[n].parentElement;!j.isNullOrUndefined(b)&&"li"!==b.tagName.toLowerCase();)f=b=b.parentElement;if("fontcolor"===c||"fontname"===c||"fontsize"===c){var v=t[n].parentElement;if(!j.isNullOrUndefined(v)&&v.childNodes)for(var y=0;y<v.childNodes.length;y++){if(this.concatenateTextExcludingList(t,n)===t[n].textContent){var C=void 0;if("LI"===v.tagName?C=v:v.closest("li")&&(C=v.closest("li")),!j.isNullOrUndefined(C))switch(c){case"fontcolor":C.style.color=p;break;case"fontname":C.style.fontFamily=p;break;case"fontsize":C.style.fontSize=p}}var N=v.childNodes[y];if("OL"===N.tagName||"UL"===N.tagName)switch(c){case"fontcolor":N.style.color="initial";break;case"fontname":N.style.fontFamily="initial";break;case"fontsize":N.style.fontSize="initial"}}}if(j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()!==t[n].textContent.trim()||("fontsize"===c?f.style.fontSize=p:"fontcolor"===c?(f.style.color=p,f.style.textDecoration="inherit"):"fontname"===c&&(f.style.fontFamily=p)),"formatPainter"===p)return this.insertFormatPainterElem(t,n,l,d,h,u);o=t[n],e=this.getPriorityFormatNode(o,m);if(!j.isNullOrUndefined(e)||a){var E=j.isNullOrUndefined(e)?o:e,E=j.isNullOrUndefined(e)||""===e.style.fontSize?E:E.firstChild;if(j.isNullOrUndefined(e)||"fontsize"===c)for(;E;){var S=E.parentElement.textContent.trim()===t[n].textContent.trim(),T=E.parentElement;if(u.isBlockNode(T)||!S||"SPAN"===T.nodeName&&T.classList.contains("e-img-inner"))break;E=T}i=[];"fontcolor"===c&&(s=j.closest(t[n].parentElement,"A"),j.isNullOrUndefined(s)||s.firstChild.textContent.trim()!==t[n].textContent.trim()||(E=t[n])),t[n].textContent.trim()!==E.textContent.trim()&&(E=t[n]),i[0]=E,this.applyStyles(i,0,g),j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()===t[n].textContent.trim()||q.conCatenateTextNode(f,c,f.textContent,c,p)}else t[n]=this.applyStyles(t,n,g)}else{f=t[n].parentElement;t[n]=this.applyStyles(t,n,g),j.isNullOrUndefined(f)||"li"===f.tagName.toLowerCase()||(f=j.closest(f,"li")),j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()!==t[n].textContent.trim()&&f.innerText.split("\n")[0]!==t[n].textContent.trim()?j.isNullOrUndefined(f)||"li"!==f.tagName.toLowerCase()||f.textContent.trim()===t[n].textContent.trim()||q.conCatenateTextNode(f,c,f.textContent,c):"bold"===c?f.style.fontWeight="bold":"italic"===c&&(f.style.fontStyle="italic")}}}else r||(t[n]=d.GetSpliceNode(l,t[n]));return t[n]},q.applyStyles=function(e,t,n){return"BR"===e[t].nodeName&&"BR"===this.enterAction||(e[t]=t===e.length-1||"BR"===e[t].nodeName?F.Wrap(e[t],n):F.WrapBefore(e[t],n,!0),e[t]=this.getChildNode(e[t],n)),e[t]},q.getPriorityFormatNode=function(e,t){var n,i,o=new Wr,r=o.getFormattedNode(e,"fontsize",t);return j.isNullOrUndefined(r)?(n=o.getFormattedNode(e,"backgroundcolor",t),j.isNullOrUndefined(n)?(i=o.getFormattedNode(e,"fontname",t),j.isNullOrUndefined(i)?(o=o.getFormattedNode(e,"fontcolor",t),j.isNullOrUndefined(o)?null:o):i):n):r},q.getInsertNode=function(e,t,n,i){n=this.GetFormatNode(n,i);return n.innerHTML="&#8203;",j.Browser.isIE?((i=e.createDocumentFragment()).appendChild(n),t.insertNode(i)):t.insertNode(n),n},q.getChildNode=function(e,t){return null==e&&(t.innerHTML="&#8203;",e=t.firstChild),e},q.isSafari=function(){var e=navigator.userAgent.toLowerCase();return navigator.vendor.toLowerCase().includes("apple")&&e.includes("safari")&&!e.includes("chrome")},q.applySelection=function(e,t,n,i,o){if(1!==e.length||o)if(1===e.length&&o)t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=n.position,t.endOffset=n.position;else if(this.isSafari()&&!o){n=t.range.startContainer.childNodes[t.range.startOffset];if(n instanceof HTMLElement&&!n.isContentEditable);}else 0===i?(t.startContainer=t.getNodeArray(e[i],!0),t.startOffset=0):i===e.length-1&&(t.endContainer=t.getNodeArray(e[i],!1),t.endOffset=e[i].textContent.length);else t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=0,t.endOffset=e[i].textContent.length;return t},q.GetFormatNode=function(e,t,n,i){var o;switch(e){case"bold":return document.createElement("strong");case"italic":return document.createElement("em");case"underline":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.textDecoration="underline",o;case"strikethrough":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.textDecoration="line-through",o;case"superscript":return document.createElement("sup");case"subscript":return document.createElement("sub");case"fontcolor":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.color=t,o.style.textDecoration="inherit",o;case"fontname":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.fontFamily=t,o;case"fontsize":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.fontSize=t,o;case"inlinecode":return document.createElement("code");default:return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.backgroundColor=t,o}},q.updateStyles=function(e,t,n){null!==n&&"SPAN"===t&&e.setAttribute("style",n)},q.insertFormatPainterElem=function(e,t,n,i,o,r){var s=r.isBlockNode(e[t].parentElement)?e[t]:e[t].parentElement;if(!r.isBlockNode(s))for(;s.textContent.trim()===s.parentElement.textContent.trim()&&!r.isBlockNode(s.parentElement);)s=s.parentElement;j.isNullOrUndefined(s)||1!==s.nodeType||s.classList.contains("e-rte-img-caption")||s.classList.contains("e-img-inner")||this.formatPainterCleanup(t,e,s,n,i,r);var a,n=o.element;return j.isNullOrUndefined(n)||(0<(a=(n=n.cloneNode(!(i=void 0))).querySelectorAll(o.lastChild.nodeName)).length?i=a[a.length-1]:j.isNullOrUndefined(n)||n.nodeName!==o.lastChild.nodeName||(i=n),i.textContent=e[t].textContent,a=i.childNodes[0],e[t]=F.Wrap(e[t],n),e[t].textContent="",e[t]=a),e[t]},q.formatPainterCleanup=function(e,t,n,i,o,r){var s=["A","AUDIO","IMG","VIDEO","IFRAME"];if(0===e&&n.textContent.trim()!==t[e].textContent.trim()){o.SplitNode(i,n,!0);for(var a=t[e].parentElement.childNodes,l=0;l<a.length;l++)if(a[l].textContent.trim()===t[l].textContent.trim()){n.parentNode.insertBefore(a[l],n);break}for(var d=n.parentElement.childNodes,c=0;c<d.length;c++)""!==d[c].textContent.trim()&&0!==d[c].textContent.length||160===d[c].textContent.charCodeAt(0)||j.detach(d[c])}else if(n.textContent.trim()!==t[e].textContent.trim())n.parentElement.insertBefore(t[e],n);else for(;!j.isNullOrUndefined(n)&&3!==n.nodeType&&!r.isBlockNode(n);){for(var p=void 0,l=0;l<n.childNodes.length;l++){var h=n.childNodes[l];0!==h.textContent.trim().length&&3!==h.nodeType&&(p=n.childNodes[l])}-1===s.indexOf(n.tagName)&&F.unwrap(n),n=p}},q.concatenateTextExcludingList=function(e,t){var n="",i="#text"===e[t].nodeName?j.closest(e[t].parentElement,"li"):j.closest(e[t],"li");if(!j.isNullOrUndefined(i))for(var o=0;o<i.childNodes.length;o++){var r=i.childNodes[o];(3===r.nodeType||1===r.nodeType&&"OL"!==r.tagName&&"UL"!==r.tagName)&&(n+=r.textContent)}return n},q.conCatenateTextNode=function(e,t,n,i,o){var r,s="";switch(t){case"bold":e.querySelectorAll("strong").forEach(function(e){s+=e.textContent}),s===n&&(e.style.fontWeight=i);break;case"italic":e.querySelectorAll("em").forEach(function(e){s+=e.textContent}),s===n&&(e.style.fontStyle=i);break;case"fontcolor":e.querySelectorAll("span").forEach(function(e){r=e.style.color,q.hasColorsEqual(r,o)&&(s+=e.textContent)}),j.isNullOrUndefined(s)||j.isNullOrUndefined(n)||""===s||""===n||s.replace(/\s+/g,"")!==n.replace(/\s+/g,"")||(e.style.color=o,e.style.textDecoration="inherit");break;case"fontsize":e.querySelectorAll("span").forEach(function(e){e.style.getPropertyValue("font-size")===o&&(s+=e.textContent)}),j.isNullOrUndefined(s)||j.isNullOrUndefined(n)||""===s||""===n||s.replace(/\s+/g,"")!==n.replace(/\s+/g,"")||(e.style.fontSize=o);break;case"fontname":e.querySelectorAll("span").forEach(function(e){e.style.getPropertyValue("font-family").replace(/ /g,"")===o&&(s+=e.textContent)}),j.isNullOrUndefined(s)||j.isNullOrUndefined(n)||""===s||""===n||s.replace(/\s+/g,"")!==n.replace(/\s+/g,"")||(e.style.fontFamily=o)}},q.hasColorsEqual=function(e,t){return j.isNullOrUndefined(e)||j.isNullOrUndefined(t)||""===e.trim()||""===t.trim()?e===t:(e.startsWith("rgb(")&&(e=e.replace("rgb(","rgba(").slice(0,-1)+",1)"),t.startsWith("rgb(")&&(t=t.replace("rgb(","rgba(").slice(0,-1)+",1)"),e.replace(/\s+/g,"")===t.replace(/\s+/g,""))},q.enterAction="P",q.isUnwrapped=!1,q);function q(){}$a.prototype.addEventListener=function(){this.parent.observer.on(bs,this.applySelection,this),this.parent.observer.on(u,this.keyDownHandler,this),this.parent.observer.on(r,this.destroy,this)},$a.prototype.removeEventListener=function(){this.parent.observer.off(bs,this.applySelection),this.parent.observer.off(u,this.keyDownHandler),this.parent.observer.off(r,this.destroy)},$a.prototype.keyDownHandler=function(e){(e.event.ctrlKey||e.event.metaKey)&&-1<["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","inlinecode"].indexOf(e.event.action)&&(e.event.preventDefault(),Ya.applyFormat(this.parent.currentDocument,e.event.action,this.parent.editableElement,e.enterAction,this.parent.tableCellSelection),this.callBack(e,e.event.action))},$a.prototype.applySelection=function(e){Ya.applyFormat(this.parent.currentDocument,e.subCommand.toLocaleLowerCase(),this.parent.editableElement,e.enterAction,this.parent.tableCellSelection,e.value,e.selector),this.callBack(e,e.subCommand)},$a.prototype.callBack=function(e,t){e.callBack&&e.callBack({requestType:t,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},$a.prototype.destroy=function(){this.removeEventListener()};var Ja=$a;function $a(e){this.parent=e,this.addEventListener()}el.prototype.addEventListener=function(){this.parent.observer.on(vs,this.applyHtml,this),this.parent.observer.on(r,this.destroy,this)},el.prototype.removeEventListener=function(){this.parent.observer.off(vs,this.applyHtml),this.parent.observer.off(r,this.destroy)},el.prototype.applyHtml=function(e){var t,n;la.Insert(this.parent.currentDocument,e.value,this.parent.editableElement,!0,e.enterAction),"pasteCleanup"===e.subCommand?(t=this.parent.editableElement.querySelectorAll(".pasteContent_RTE"),t=[].slice.call(t),n=this.parent.editableElement.querySelectorAll(".pasteContent_Img"),n=[].slice.call(n),e.callBack({requestType:e.subCommand,editorMode:"HTML",elements:t,imgElem:n})):e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},el.prototype.destroy=function(){this.removeEventListener()};var Za=el;function el(e){this.parent=e,this.addEventListener()}nl.clear=function(e,t,n,i,o){this.domNode=new qs(t,e),this.defaultTag="P"===n?this.defaultTag:"div";var n=new gl(t),r=new sa,s=n.getRange(e),a=s.collapsed?n.getSelectionNodeCollection(s):n.getSelectionNodeCollectionBr(s),l=n.save(s,e),d=!1;if(s.collapsed&&"ClearFormat"!==o&&(d=!0,s=r.GetCursorRange(e,s,a[0])),!s.collapsed){o=void 0,o=0<a.length&&"BR"===a[0].nodeName&&j.closest(a[0],"table")?r.GetSpliceNode(s,j.closest(a[0],"table")):r.GetSpliceNode(s,a[1<a.length&&"IMG"===a[0].nodeName?1:0]);if(1===a.length)n.setSelectionContents(e,o),s=n.getRange(e);else if(1<a.length){for(var c=1,p=a[a.length-c];a.length<=c&&"BR"===a[a.length-c].nodeName;)p=a[a.length-++c];var h=r.GetSpliceNode(s,p);h&&n.setSelectionText(e,o,h,0,(3===h.nodeType?h.textContent:h.childNodes).length),s=n.getRange(e)}o=n.getNodeCollection(s),h=o.slice(),h=(this.clearInlines(n.getSelectionNodes(h),h,n.getRange(e),r,t),this.reSelection(e,l,o),s=n.getRange(e),(o=n.getNodeCollection(s)).slice());this.clearBlocks(e,h,t,r,n),Rs()&&As(t,i),this.reSelection(e,l,o)}d&&n.setCursorPoint(e,s.endContainer,s.endOffset)},nl.reSelection=function(e,t,n){n=t.getInsertNodes(n),t.startContainer=t.getNodeArray(n[0],!0,e),t.startOffset=0,t.endContainer=t.getNodeArray(n[n.length-1],!1,e),e=n[n.length-1];t.endOffset=(3===e.nodeType?e.textContent:e.childNodes).length,t.restore()},nl.clearBlocks=function(e,t,n,i,o){for(var r=[],s=0;s<t.length;s++)-1<this.BLOCK_TAGS.indexOf(t[s].nodeName.toLocaleLowerCase())&&-1===r.indexOf(t[s])?r.push(t[s]):-1<this.BLOCK_TAGS.indexOf(t[s].parentNode.nodeName.toLocaleLowerCase())&&-1===r.indexOf(t[s].parentNode)&&n!==t[s].parentNode&&r.push(t[s].parentNode);r=this.spliceParent(r,t)[0],r=this.removeParent(r),this.unWrap(e,r,i,o)},nl.spliceParent=function(e,t){for(var n=0;n<e.length;n++)for(var i=e[n].childNodes.length,o=0;o<i;o++)if((t=0<t.indexOf(e[n].childNodes[o])&&0<e[n].childNodes[o].childNodes.length?this.spliceParent([e[n].childNodes[o]],t)[1]:t).indexOf(e[n].childNodes[o])<=-1&&""!==e[n].childNodes[o].textContent.trim()){for(var r=0;r<i;r++)-1<t.indexOf(e[n].childNodes[r])&&t.splice(t.indexOf(e[n].childNodes[r]),1);var o=e[n].childNodes.length,s=e.indexOf(e[n].parentNode),a=t.indexOf(e[n].parentNode),s=(-1<s&&e.splice(s,1),-1<a&&t.splice(a,1),t.indexOf(e[n]));-1<s&&t.splice(s,1),e.splice(n,1),n--}return[e,t]},nl.removeChild=function(e,t){var n=t.childNodes.length;if(0<n)for(var i=0;i<n;i++)-1<e.indexOf(t.childNodes[i])&&(e=this.removeChild(e,t.childNodes[i])).splice(e.indexOf(t.childNodes[i]),1);return e},nl.removeParent=function(e){for(var t=0;t<e.length;t++)-1<e.indexOf(e[t].parentNode)&&((e=this.removeChild(e,e[t])).splice(t,1),t--);return e},nl.unWrap=function(e,t,n,i){for(var o=0;o<t.length;o++){-1<this.NONVALID_TAGS.indexOf(t[o].nodeName.toLowerCase())&&t[o].parentNode&&-1<this.NONVALID_PARENT_TAGS.indexOf(t[o].parentNode.nodeName.toLowerCase())&&(i.setSelectionText(e,t[o],t[o],0,t[o].childNodes.length),F.unwrap(n.GetSpliceNode(i.getRange(e),t[o].parentNode)));var r=j.closest(t[o],"blockquote");if("blockquote"===t[o].nodeName.toLocaleLowerCase()||j.isNullOrUndefined(r)||r.textContent!==t[o].textContent||(a=this.removeParent([r]),this.unWrap(e,a,n,i)),"p"!==t[o].nodeName.toLocaleLowerCase()){!(this.NONVALID_PARENT_TAGS.indexOf(t[o].nodeName.toLowerCase())<0)||("blockquote"===t[o].nodeName.toLocaleLowerCase()||"li"===t[o].nodeName.toLocaleLowerCase())&&-1<this.IGNORE_PARENT_TAGS.indexOf(t[o].childNodes[0].nodeName.toLocaleLowerCase())||1===t[o].childNodes.length&&"p"===t[o].childNodes[0].nodeName.toLocaleLowerCase()||F.Wrap(t[o],e.createElement(this.defaultTag));var s=F.unwrap(t[o]);1===s.length&&"p"===s[0].parentNode.nodeName.toLocaleLowerCase()&&(F.Wrap(t[o],e.createElement(this.defaultTag)),F.unwrap(t[o]));for(var a,l=0;l<s.length;l++)-1<this.NONVALID_TAGS.indexOf(s[l].nodeName.toLowerCase())?this.unWrap(e,[s[l]],n,i):-1<this.BLOCK_TAGS.indexOf(s[l].nodeName.toLocaleLowerCase())&&"p"!==s[l].nodeName.toLocaleLowerCase()?(a=this.removeParent([s[l]]),this.unWrap(e,a,n,i)):-1<this.BLOCK_TAGS.indexOf(s[l].nodeName.toLocaleLowerCase())&&"p"===s[l].nodeName.toLocaleLowerCase()?("p"===s[l].parentNode.nodeName.toLocaleLowerCase()&&F.unwrap(s[l].parentNode),F.Wrap(s[l],e.createElement(this.defaultTag)),F.unwrap(s[l])):-1<this.BLOCK_TAGS.indexOf(s[l].nodeName.toLocaleLowerCase())&&s[l].parentNode.nodeName.toLocaleLowerCase()===s[l].nodeName.toLocaleLowerCase()&&F.unwrap(s[l])}else F.Wrap(t[o],e.createElement(this.defaultTag)),F.unwrap(t[o])}},nl.clearInlines=function(e,t,n,i,o){for(var r=0;r<e.length;r++){for(var s=e[r],a=void 0;!this.domNode.isBlockNode(s)&&s.parentElement&&!s.parentElement.classList.contains("e-img-inner");)s=(a=s).parentElement;a&&-1<Wr.inlineTags.indexOf(a.nodeName.toLocaleLowerCase())&&(i.GetSpliceNode(n,a),this.removeInlineParent(a))}},nl.removeInlineParent=function(e){for(var t=F.unwrap(e),n=0;n<t.length;n++)1===t[n].parentNode.childNodes.length&&!t[n].parentNode.classList.contains("e-img-inner")&&-1<Wr.inlineTags.indexOf(t[n].parentNode.nodeName.toLocaleLowerCase())?this.removeInlineParent(t[n].parentNode):-1<Wr.inlineTags.indexOf(t[n].nodeName.toLocaleLowerCase())&&this.removeInlineParent(t[n])},nl.BLOCK_TAGS=["address","article","aside","blockquote","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","li","main","nav","noscript","ol","p","pre","section","ul"],nl.NONVALID_PARENT_TAGS=["thead","tbody","ul","ol","table","tfoot","tr"],nl.IGNORE_PARENT_TAGS=["ul","ol","table"],nl.NONVALID_TAGS=["thead","tbody","figcaption","td","tr","th","tfoot","figcaption","li"],nl.defaultTag="p";var tl=nl;function nl(){}ol.prototype.addEventListener=function(){this.parent.observer.on(Cs,this.applyClear,this),this.parent.observer.on(u,this.onKeyDown,this),this.parent.observer.on(r,this.destroy,this)},ol.prototype.removeEventListener=function(){this.parent.observer.off(Cs,this.applyClear),this.parent.observer.off(u,this.onKeyDown),this.parent.observer.off(r,this.destroy)},ol.prototype.onKeyDown=function(e){"clear-format"===e.event.action&&(this.applyClear({subCommand:"ClearFormat",callBack:e.callBack,enterAction:e.enterAction}),e.event.preventDefault())},ol.prototype.applyClear=function(e){"ClearFormat"===e.subCommand&&(tl.clear(this.parent.currentDocument,this.parent.editableElement,e.enterAction,e.selector,e.subCommand),e.callBack)&&e.callBack({requestType:e.subCommand,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},ol.prototype.destroy=function(){this.removeEventListener()};var il=ol;function ol(e){this.parent=e,this.addEventListener()}sl.prototype.addEventListener=function(){this.debounceListener=j.debounce(this.keyUp,this.undoRedoTimer),this.parent.observer.on(Ws,this.debounceListener,this),this.parent.observer.on(u,this.keyDown,this),this.parent.observer.on(_s,this.onAction,this),this.parent.observer.on(Gs,this.onPropertyChanged,this),this.parent.observer.on(r,this.destroy,this)},sl.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++)switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}},sl.prototype.removeEventListener=function(){this.parent.observer.off(Ws,this.keyUp),this.parent.observer.off(u,this.keyDown),this.parent.observer.off(_s,this.onAction),this.parent.observer.off(Gs,this.onPropertyChanged),this.parent.observer.off(r,this.destroy),this.debounceListener=null},sl.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},sl.prototype.destroy=function(){this.removeEventListener(),this.element=null,this.steps=null,this.undoRedoStack=[],this.undoRedoSteps=null,this.undoRedoTimer=null},sl.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},sl.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},sl.prototype.getTextContentFromFragment=function(e){for(var t="",n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];i.nodeType===Node.TEXT_NODE?t+=i.textContent:i.nodeType===Node.ELEMENT_NODE&&(t+=this.getTextContentFromFragment(i))}return t},sl.prototype.isElementStructureEqual=function(e,t){if(e.childNodes.length!==t.childNodes.length)return!1;for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n],o=t.childNodes[n];if(!i||!o)return!1;if(i.nodeType!==o.nodeType)return!1;if(i.outerHTML!==o.outerHTML)return!1}return!0},sl.prototype.saveData=function(e){if(this.parent.currentDocument){for(var t=new gl(this.parent.editableElement).getRange(this.parent.currentDocument),n=this.parent.editableElement===t.startContainer.parentElement?t.startContainer.parentElement:t.startContainer,i=n.childNodes.length-1;0<=i;i--)!j.isNullOrUndefined(n.childNodes[i])&&"#text"===n.childNodes[i].nodeName&&0===n.childNodes[i].textContent.length&&"IMG"!==n.childNodes[i].nodeName&&"BR"!==n.childNodes[i].nodeName&&n.childNodes[i].nodeName&&j.detach(n.childNodes[i]);for(var t=new gl(this.parent.editableElement).getRange(this.parent.currentDocument),o=new gl(this.parent.editableElement).save(t,this.parent.currentDocument),r=this.parent.editableElement.cloneNode(!0),s=document.createDocumentFragment();r.firstChild;)s.appendChild(r.firstChild);var a={text:s,range:o};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),1<this.undoRedoStack.length&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.collapsed===t.collapsed&&this.undoRedoStack[this.undoRedoStack.length-1].range.startOffset===o.range.startOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.endOffset===o.range.endOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.startContainer===o.range.startContainer&&this.getTextContentFromFragment(this.undoRedoStack[this.undoRedoStack.length-1].text).trim()===this.getTextContentFromFragment(a.text).trim()&&this.isElementStructureEqual(this.undoRedoStack[this.undoRedoStack.length-1].text,a.text)||(this.undoRedoStack.push(a),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())}},sl.prototype.undo=function(e){var t,n;0<this.steps&&(t=this.undoRedoStack[this.steps-1].range,n=this.undoRedoStack[this.steps-1].text,this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),Us(this.parent.currentDocument,this.parent.editableElement),Rs()&&As(this.parent.editableElement,e.selector),t.restore(),this.steps--,e.callBack)&&e.callBack({requestType:"Undo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})},sl.prototype.redo=function(e){var t,n;null!=this.undoRedoStack[this.steps+1]&&(t=this.undoRedoStack[this.steps+1].range,n=this.undoRedoStack[this.steps+1].text,this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),Us(this.parent.currentDocument,this.parent.editableElement),Rs()&&As(this.parent.editableElement,e.selector),t.restore(),this.steps++,e.callBack)&&e.callBack({requestType:"Redo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})},sl.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return 0<this.steps&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e};var rl=sl;function sl(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=j.isNullOrUndefined(t)?30:t.undoRedoSteps,this.undoRedoTimer=j.isNullOrUndefined(t)?300:t.undoRedoTimer,this.addEventListener()}c.prototype.addEventListener=function(){this.parent.observer.on(Ys,this.wordCleanup,this),this.parent.observer.on(r,this.destroy,this)},c.prototype.removeEventListener=function(){this.parent.observer.off(Ys,this.wordCleanup),this.parent.observer.off(r,this.destroy)},c.prototype.wordCleanup=function(e){var t=j.isNullOrUndefined(e.allowedStylePropertiesArray)?[]:e.allowedStylePropertiesArray,n=[],i=e.args.clipboardData.getData("text/HTML"),o=e.args.clipboardData.getData("text/rtf"),r=j.createElement("p"),s=(r.setAttribute("id","MSWord-Content"),r.innerHTML=i,this.addDoubleBr(r),/style='mso-width-source:/i),a=this.findSource(r);/class='?Mso|style='[^ ]*\bmso-/i.test(i)||/class="?Mso|style="[^ ]*\bmso-/i.test(i)||/(class="?Mso|class='?Mso|class="?Xl|class='?Xl|class=Xl|style="[^"]*\bmso-|style='[^']*\bmso-|w:WordDocument)/gi.test(i)||s.test(i)?(i=i.replace(/<img[^>]+>/i,""),this.addListClass(r),n=this.cleanUp(r,n),j.isNullOrUndefined(n[0])||"UL"===n[0].parentElement.tagName||"OL"===n[0].parentElement.tagName||this.listConverter(n),this.imageConversion(r,o),this.cleanList(r,"UL"),this.cleanList(r,"OL"),this.styleCorrection(r,t),this.removingComments(r),this.removeUnwantedElements(r),this.removeEmptyElements(r),this.removeEmptyAnchorTag(r),this.breakLineAddition(r),this.processMargin(r),this.removeClassName(r),s.test(i)&&this.addTableBorderClass(r),e.callBack(r.innerHTML,this.cropImageDimensions,a)):(a===Es[2]&&this.handleOneNoteContent(r),this.removeEmptyMetaTags(r),e.callBack(r.innerHTML,null,a))},c.prototype.addDoubleBr=function(e){var t=e.querySelector(".Apple-interchange-newline");if(!j.isNullOrUndefined(t)&&-1!==j.Browser.userAgent.indexOf("Chrome")&&"P"===t.parentElement.nodeName&&e!==t.parentElement)for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.COMMENT_NODE&&i.nodeValue.includes("StartFragment")){var o=document.createElement("p"),r=(o.innerHTML="<br>",t.parentElement.style.cssText),s=o.getAttribute("style")||"";o.setAttribute("style",s+r),e.insertBefore(o,i.nextSibling),j.detach(t);break}}},c.prototype.cleanList=function(e,t){for(var n=e.querySelectorAll(t+" div"),i=n.length-1;0<=i;i--){for(var o=n[i].parentNode;n[i].firstChild;)o.insertBefore(n[i].firstChild,n[i]);var r=this.findClosestListElem(n[i]);r&&this.insertAfter(n[i],r)}},c.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},c.prototype.findClosestListElem=function(e){for(var t;!j.isNullOrUndefined(e);)e=j.isNullOrUndefined(e.closest("ul"))||"UL"===e.tagName?"OL"!==e.tagName?e.closest("ol"):null:e.closest("ul"),t=j.isNullOrUndefined(e)?t:e;return t},c.prototype.addListClass=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++)!j.isNullOrUndefined(t[n].getAttribute("style"))&&0<=t[n].getAttribute("style").replace(/ /g,"").replace("\n","").indexOf("mso-list:l")&&-1===t[n].className.toLowerCase().indexOf("msolistparagraph")&&"H"!==t[n].tagName.charAt(0)&&"LI"!==t[n].tagName&&"OL"!==t[n].tagName&&"UL"!==t[n].tagName&&t[n].classList.add("msolistparagraph")},c.prototype.addTableBorderClass=function(e){for(var t=e.querySelectorAll("table"),n=!1,i=0;i<t.length;i++){for(var o=0;o<this.borderStyle.length;o++)if(0<=t[i].innerHTML.indexOf(this.borderStyle[o])){n=!0;break}n&&(t[i].classList.add("e-rte-table-border"),n=!1)}},c.prototype.imageConversion=function(e,t){this.checkVShape(e);for(var n=e.querySelectorAll("img"),i=0;i<n.length;i++)!j.isNullOrUndefined(n[i].getAttribute("v:shapes"))&&n[i].getAttribute("v:shapes").indexOf("Picture")<0&&n[i].getAttribute("v:shapes").indexOf("")<0&&n[i].getAttribute("v:shapes").indexOf("Grafik")<0&&n[i].getAttribute("v:shapes").toLowerCase().indexOf("image")<0&&n[i].getAttribute("v:shapes").indexOf("Graphic")<0&&n[i].getAttribute("v:shapes").indexOf("_x0000_s")<0&&n[i].getAttribute("v:shapes").indexOf("_x0000_i")<0&&n[i].getAttribute("v:shapes").indexOf("img1")<0&&n[i].getAttribute("v:shapes").indexOf("Immagine")<0&&n[i].classList.add("e-rte-image-unsupported"),n[i].removeAttribute("v:shapes");n=e.querySelectorAll("img");var o=[],r=[],s=[],a=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.)|(blob\:))(\S+))/gi);if(0<n.length){for(i=0;i<n.length;i++){o.push(n[i].getAttribute("src"));var l=n[i].getAttribute("src").split("/")[n[i].getAttribute("src").split("/").length-1].split(".")[0]+i;s.push(l)}for(var d=this.hexConversion(t),i=0;i<d.length;i++)r.push({base64Data:j.isNullOrUndefined(d[i].hex)?null:this.convertToBase64(d[i]),isCroppedImage:d[i].isCroppedImage}),d[i].isCroppedImage&&this.cropImageDimensions.push({goalWidth:d[i].goalWidth,goalHeight:d[i].goalHeight,cropLength:d[i].cropLength,cropTop:d[i].cropTop,cropR:d[i].cropR,cropB:d[i].cropB});for(n=e.querySelectorAll("img:not(.e-rte-image-unsupported"),i=0;i<n.length;i++)o[i].match(a)?n[i].setAttribute("src",o[i]):(j.isNullOrUndefined(r[i])||j.isNullOrUndefined(r[i].base64Data)?(n[i].removeAttribute("src"),n[i].classList.add("e-rte-image-unsupported")):n[i].setAttribute("src",r[i].base64Data),!j.isNullOrUndefined(r[i])&&r[i].isCroppedImage&&n[i].classList.add("e-img-cropped")),n[i].setAttribute("id","msWordImg-"+s[i]);n=e.querySelectorAll(".e-rte-image-unsupported");for(i=0;i<n.length;i++)n[i].removeAttribute("src")}},c.prototype.checkVShape=function(e){for(var t,n,i=e.querySelectorAll("*"),o=0;o<i.length;o++)switch(i[o].nodeName){case"V:SHAPETYPE":j.detach(i[o]);break;case"V:SHAPE":"V:IMAGEDATA"===i[o].firstElementChild.nodeName&&(t=i[o].firstElementChild.getAttribute("src"),(n=j.createElement("img")).setAttribute("src",t),i[o].parentElement.insertBefore(n,i[o]),j.detach(i[o]))}},c.prototype.convertToBase64=function(e){var t=this.conHexStringToBytes(e.hex),t=this.conBytesToBase64(t);return e.type?"data:"+e.type+";base64,"+t:null},c.prototype.conBytesToBase64=function(e){for(var t="",n=e.length,i=0;i<n;i+=3){var o=e.slice(i,i+3),r=o.length,s=[];if(r<3)for(var a=r;a<3;a++)o[a]=0;s[0]=(252&o[0])>>2,s[1]=(3&o[0])<<4|o[1]>>4,s[2]=(15&o[1])<<2|(192&o[2])>>6,s[3]=63&o[2];for(a=0;a<4;a++)t+=a<=r?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s[a]):"="}return t},c.prototype.conHexStringToBytes=function(e){for(var t=[],n=e.length/2,i=0;i<n;i++)t.push(parseInt(e.substr(2*i,2),16));return t},c.prototype.hexConversion=function(e){var t,n=RegExp,i=new n("\\{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?(\\{\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s\\}]*?"),n=new n("(?:("+i.source+"))([\\da-fA-F\\s]+)\\}","g"),o=e.match(n),r=[];if(!j.isNullOrUndefined(o))for(var s=0;s<o.length;s++)if(-1===o[s].indexOf("fIsBullet")||-1!==o[s].indexOf("wzName")){var a,l=0,d=0,c=0,p=0,h=0,u=0;if(i.test(o[s])){if(-1!==o[s].indexOf("\\pngblip"))t="image/png";else if(-1!==o[s].indexOf("\\jpegblip"))t="image/jpeg";else{if(-1===o[s].indexOf("\\emfblip"))continue;t=null}(a=!!(0<this.extractCropValue("cropl",o[s])&&0<this.extractCropValue("cropt",o[s])||0<this.extractCropValue("cropr",o[s])||this.extractCropValue("cropb",o[s])))&&(l=this.extractCropValue("wgoal",o[s]),d=this.extractCropValue("hgoal",o[s]),c=this.extractCropValue("cropl",o[s]),p=this.extractCropValue("cropt",o[s]),h=this.extractCropValue("cropr",o[s]),u=this.extractCropValue("cropb",o[s])),r.push({hex:t?o[s].replace(i,"").replace(/[^\da-fA-F]/g,""):null,type:t,isCroppedImage:a,goalWidth:l,goalHeight:d,cropLength:c,cropTop:p,cropR:h,cropB:u})}}return r},c.prototype.extractCropValue=function(e,t){e=new RegExp("\\\\pic"+e+"(\\-?\\d+)\\\\").exec(t.replace(/\r\n\\/g,"\\").replace(/\n/g,"\\"))[1];return parseInt(e,10)},c.prototype.removeClassName=function(e){for(var t=e.querySelectorAll("*[class]:not(.e-img-cropped):not(.e-rte-image-unsupported)"),n=0;n<t.length;n++)t[n].removeAttribute("class")},c.prototype.breakLineAddition=function(e){for(var t,n,i=e.querySelectorAll("*"),o=0;o<i.length;o++)0!==i[o].children.length||"&nbsp;"!==i[o].innerHTML||"&nbsp;"!==i[o].innerHTML||i[o].closest("li")||i[o].closest("td")||!("SPAN"!==i[o].nodeName||"SPAN"===i[o].nodeName&&j.isNullOrUndefined(i[o].previousElementSibling)&&j.isNullOrUndefined(i[o].nextElementSibling))||(t=this.findDetachElem(i[o]),n=j.createElement("br"),0<t.textContent.length&&t.textContent.match(/\u00a0/g)&&0<t.textContent.match(/\u00a0/g).length)||j.isNullOrUndefined(t.parentElement)||(t.parentElement.insertBefore(n,t),j.detach(t))},c.prototype.findDetachElem=function(e){e=!j.isNullOrUndefined(e.parentElement)&&""===e.parentElement.textContent.trim()&&"TD"!==e.parentElement.tagName&&j.isNullOrUndefined(e.parentElement.querySelector("img"))?this.findDetachElem(e.parentElement):e;return e},c.prototype.removeUnwantedElements=function(e){for(var t=e.querySelector("style"),n=(j.isNullOrUndefined(t)||j.detach(t),e.innerHTML),i=0;i<this.removableElements.length;i++){var o=RegExp,r=new o("<"+this.removableElements[i]+"\\s*[^>]*>","g"),o=new o("</"+this.removableElements[i]+">","g");n=(n=n.replace(r,"")).replace(o,"")}e.innerHTML=n,e.querySelectorAll(":empty")},c.prototype.findDetachEmptyElem=function(e){return j.isNullOrUndefined(e.parentElement)?null:0<e.parentElement.textContent.length&&e.parentElement.textContent.match(/\u00a0/g)&&0<e.parentElement.textContent.match(/\u00a0/g).length||""!==e.parentElement.textContent.trim()||"MSWord-Content"===e.parentElement.getAttribute("id")||this.hasParentWithClass(e,"MsoListParagraph")||!j.isNullOrUndefined(e.parentElement.querySelector("img"))?e:this.findDetachEmptyElem(e.parentElement)},c.prototype.hasParentWithClass=function(e,t){for(var n=e.parentElement;!j.isNullOrUndefined(n);){if(n.classList.contains(t))return!0;n=n.parentElement}return!1},c.prototype.removeEmptyElements=function(e){for(var t=e.querySelectorAll(":empty"),n=0;n<t.length;n++){j.isNullOrUndefined(t[n].closest("td"))||j.isNullOrUndefined(t[n].closest("td").querySelector(".MsoNormal"))||(t[n].innerHTML="-");var i=!0;"DIV"===t[n].tagName&&(i="none"===t[n].style.borderBottom||""===t[n].style.borderBottom),"IMG"!==t[n].tagName&&"BR"!==t[n].tagName&&"IFRAME"!==t[n].tagName&&"TD"!==t[n].tagName&&"HR"!==t[n].tagName&&i&&(i=this.findDetachEmptyElem(t[n]),j.isNullOrUndefined(i)||j.detach(i))}},c.prototype.removeEmptyMetaTags=function(e){for(var t=e.querySelectorAll("meta:empty"),n=t.length-1;0<=n;n--){var i=t[n];""===i.textContent&&j.detach(i)}},c.prototype.styleCorrection=function(e,t){var n=e.querySelectorAll("style"),i=[];if(0<n.length){j.isNullOrUndefined(n[0].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi))?1<n.length&&(i=n[1].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi)):i=n[0].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi);var o=j.isNullOrUndefined(i)?null:this.findStyleObject(i);if(!j.isNullOrUndefined(o)){var r=Object.keys(o),s=r.map(function(e){return o[""+e]}),s=this.removeUnwantedStyle(s,t);this.filterStyles(e,t);for(var a=void 0,l=!1,d=/^(p|div|li)\.(1|10|11)$/,c=0;c<r.length;c++){if(""===r[c].split(".")[0])a=e.getElementsByClassName(r[c].split(".")[1]),l=!0;else{if(1===r[c].split(".").length&&0<=r[c].split(".")[0].indexOf("@")||d.test(r[c]))continue;a=1===r[c].split(".").length&&r[c].split(".")[0].indexOf("@")<0?e.getElementsByTagName(r[c]):e.querySelectorAll(r[c])}for(var p=0;p<a.length;p++)if(!a[p].closest("li")||"p"!==r[c]){var h=a[p].getAttribute("style");if(j.isNullOrUndefined(h)||""===h.trim())s[c]=s[c].replace(/text-indent:-.*?;?/g,"").replace(/border:\s*none;?/g,"").trim(),a[p].setAttribute("style",s[c]);else{for(var u=s[c].split(";"),m=0;m<u.length;m++)"border"===u[m].split(":")[0]&&"none"===u[m].split(":")[1]&&(u.splice(m,1),m--);if(!l)for(var g=0;g<u.length;g++){var f=u[g].split(":")[0];h.includes(f+":")&&(u.splice(g,1),g--)}var b=u.join(";")+";"+h;a[p].setAttribute("style",b)}}l=!1}for(var v=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"],c=0;c<v.length;c++)if(-1<r.indexOf("li."+v[c]))for(var y=e.querySelectorAll("ol."+v[c]+", ul."+v[c]),p=0;p<y.length;p++){h=y[p].getAttribute("style");if(!j.isNullOrUndefined(h)&&""!==h.trim()&&""!==y[p].style.marginLeft)for(var C,N,u=s[r.indexOf("li."+v[c])].split(";"),g=0;g<u.length;g++)0<="margin-left".indexOf(u[g].split(":")[0])&&!j.isNullOrUndefined(u[g].split(":")[1])&&0<=u[g].split(":")[1].indexOf("in")&&0<=y[p].style.marginLeft.indexOf("in")&&(C=parseFloat(u[g].split(":")[1].split("in")[0]),N=parseFloat(y[p].style.marginLeft.split("in")[0]),y[p].style.marginLeft=N-C+"in")}}}},c.prototype.filterStyles=function(e,t){for(var n=e.querySelectorAll("*[style]"),i=0;i<n.length;i++){for(var o=n[i].getAttribute("style").split(";"),r="",s=0;s<o.length;s++)0<=t.indexOf(o[s].split(":")[0].trim())&&(r+=o[s]+";");n[i].setAttribute("style",r)}},c.prototype.removeUnwantedStyle=function(e,t){for(var n=0;n<e.length;n++){var i=e[n].split(";");e[n]="";for(var o=0;o<i.length;o++)0<=t.indexOf(i[o].split(":")[0])&&(e[n]+=i[o]+";")}return e},c.prototype.findStyleObject=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n],o=i.replace(/([\S ]+\s+){[\s\S]+?}/gi,"$1"),r=i.replace(/[\S ]+\s+{([\s\S]+?)}/gi,"$1"),o=o.replace(/^[\s]|[\s]$/gm,""),r=r.replace(/^[\s]|[\s]$/gm,"");o=o.replace(/\n|\r|\n\r/g,""),r=r.replace(/\n|\r|\n\r/g,"");for(var s=o.split(", "),a=0;a<s.length;a++)t[s[a]]=r}return t},c.prototype.removingComments=function(e){var t=(t=e.innerHTML).replace(/<!--[\s\S]*?-->/g,"");e.innerHTML=t},c.prototype.cleanUp=function(e,t){for(var n,i=[],o=e.querySelectorAll("*"),r=0;r<o.length;r++)-1===this.ignorableNodes.indexOf(o[r].nodeName)||3===o[r].nodeType&&""===o[r].textContent.trim()?i.push(o[r]):(o[r].className&&-1!==o[r].className.toLowerCase().indexOf("msolistparagraph")&&!j.isNullOrUndefined(o[r].getAttribute("style"))&&0<=o[r].getAttribute("style").indexOf("mso-list:")&&(0<=o[r].className.indexOf("MsoListParagraphCxSpFirst")&&0<t.length&&null!==t[t.length-1]&&t.push(null),t.push(o[r])),!n||-1===this.blockNode.indexOf(o[r].nodeName.toLowerCase())||o[r].className&&-1!==o[r].className.toLowerCase().indexOf("msolistparagraph")&&!j.isNullOrUndefined(o[r].getAttribute("style"))&&0<=o[r].getAttribute("style").indexOf("mso-list:")||t.push(null),-1!==this.blockNode.indexOf(o[r].nodeName.toLowerCase())&&(n=!!(o[r].className&&-1!==o[r].className.toLowerCase().indexOf("msolistparagraph")&&!j.isNullOrUndefined(o[r].getAttribute("style"))&&0<=o[r].getAttribute("style").indexOf("mso-list:"))));return t.length&&null!==t[t.length-1]&&t.push(null),t},c.prototype.listConverter=function(e){for(var t,n,i=[],o=[],r="",s="",a=0;a<e.length;a++)if(null===e[a])i.push({content:this.makeConversion(o),node:e[a-1]}),o=[];else{e[a].getAttribute("style")&&-1!==e[a].getAttribute("style").indexOf("mso-outline-level")&&e[a].setAttribute("style",e[a].getAttribute("style").replace("mso-outline-level","mso-outline")),t=(r=e[a].getAttribute("style"))&&-1!==r.indexOf("level")?parseInt(r.charAt(r.indexOf("level")+5),null):1,r&&-1!==r.indexOf("mso-list:")&&(l=void 0,l=!r.match(/mso-list:[^;]+;?/)||(l=r.replace(new RegExp("\\n","g"),"").split(" ").join("").match(/mso-list:[^;]+;?/)[0].split(":l"),j.isNullOrUndefined(l))?null:parseInt(l[1].split("level")[0],10)),this.listContents=[],this.getListContent(e[a]);var l,d=void 0,c=void 0;if(!j.isNullOrUndefined(this.listContents[0])){var p=1<this.listContents[0].trim().length?"ol":"ul",h=this.getlistStyleType(this.listContents[0],p);"ol"!=p||0!==a&&null!==e[a-1]||(g=this.listContents[0].split(".")[0],-1===["A","a","I","i","","1","01","1-"].indexOf(g)&&("decimal"===h||"decimal-leading-zero"===h?isNaN(parseInt(g,10))||(d=parseInt(g,10)):"upper-alpha"===h?d=g.split(".")[0].charCodeAt(0)-64:"lower-alpha"===h?d=g.split(".")[0].charCodeAt(0)-96:"upper-roman"===h?d=this.upperRomanNumber.indexOf(this.listContents[0].split(".")[0])+1:"lower-roman"===h?d=this.lowerRomanNumber.indexOf(this.listContents[0].split(".")[0])+1:"lower-greek"===h&&(d=this.lowerGreekNumber.indexOf(this.listContents[0].split(".")[0])+1))),""!==e[a].style.marginLeft&&(c=e[a].style.marginLeft);for(var u=[],m=1;m<this.listContents.length;m++)u.push(this.listContents[m]);var g=void 0;j.isNullOrUndefined(e[a].className)||(g=e[a].className),j.isNullOrUndefined(e[a].getAttribute("style"))||(e[a].setAttribute("style",e[a].getAttribute("style").replace("text-align:start;","")),e[a].style.textIndent="",s=e[a].getAttribute("style")),o.push({listType:p,content:u,nestedLevel:t,listFormatOverride:l,class:g,listStyle:s,listStyleTypeName:h,start:d,styleMarginLeft:c})}}for(n=e.shift();n;){for(var f=[],b=0;b<i.length;b++)if(i[b].node===n){for(var v=0;v<i[b].content.childNodes.length;v++)f.push(i[b].content.childNodes[v]);for(v=0;v<f.length;v++)n.parentElement.insertBefore(f[v],n);break}n.remove(),n=(n=e.shift())||e.shift()}},c.prototype.getlistStyleType=function(e,t){var n;if("ol"===t){t=e.split(".")[0].charCodeAt(0);switch(!0){case-1<this.upperRomanNumber.indexOf(e.split(".")[0]):n="upper-roman";break;case-1<this.lowerRomanNumber.indexOf(e.split(".")[0]):n="lower-roman";break;case-1<this.lowerGreekNumber.indexOf(e.split(".")[0]):n="lower-greek";break;case 64<t&&t<91:n="upper-alpha";break;case 96<t&&t<123:n="lower-alpha";break;case 1<e.split(".")[0].length&&"0"===e.split(".")[0][0]&&!isNaN(Number(e.split(".")[0])):n="decimal-leading-zero";break;default:n="decimal"}}else switch(e.split(".")[0]){case"o":n="circle";break;case"":n="square";break;default:n="disc"}return n},c.prototype.makeConversion=function(e){for(var t,n,i=j.createElement("div"),o=1,r=0,s=e[0].listFormatOverride,a=0;a<e.length;a++){for(var l=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"],d=!1,c=0;c<l.length;c++)if(0<=l[c].indexOf(e[a].class)){d=!0;break}j.isNullOrUndefined(u)||0===a||e[a-1].listType===e[a].listType||d||(u=null);var p=j.createElement("p",{className:"MsoNoSpacing"});if(p.innerHTML=e[a].content.join(" "),1!==e[a].nestedLevel||0!==r&&s===e[a].listFormatOverride||!e[a].content){if(e[a].nestedLevel===o&&s===e[a].listFormatOverride)j.isNullOrUndefined(u)||j.isNullOrUndefined(u.parentElement)||u.parentElement.tagName.toLowerCase()!==e[a].listType?j.isNullOrUndefined(u)?((t=j.createElement(e[a].listType)).style.listStyleType=e[a].listStyleTypeName,(u=j.createElement("li")).appendChild(p),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),i.appendChild(t)):((t=j.createElement(e[a].listType)).style.listStyleType=e[a].listStyleTypeName,u.parentElement.parentElement.appendChild(t),(u=j.createElement("li")).appendChild(p),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString())):(u.parentElement.appendChild(u=j.createElement("li")),u.appendChild(p));else if(e[a].nestedLevel>o){if(j.isNullOrUndefined(u))if(e[a].nestedLevel>o&&d){var h=j.createElement(e[a].listType),u=j.createElement("li");h.appendChild(u),h.style.listStyleType="none";for(m=0;m<e[a].nestedLevel-1;m++)u.appendChild(t=j.createElement(e[a].listType)),u=j.createElement("li"),t.appendChild(u),t.style.listStyleType="none";u.appendChild(p),i.appendChild(h),t.setAttribute("level",e[a].nestedLevel.toString())}else i.appendChild(t=j.createElement(e[a].listType)),(u=j.createElement("li")).appendChild(p),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),"msolistparagraph"!==e[a].class?t.style.marginLeft=e[a].styleMarginLeft:j.addClass([t],"marginLeftIgnore");else{for(var m=0;m<e[a].nestedLevel-o;m++)u.appendChild(t=j.createElement(e[a].listType)),u=j.createElement("li"),m!==e[a].nestedLevel-o-1&&1<e[a].nestedLevel-o&&(u.style.listStyleType="none"),t.appendChild(u);u.appendChild(p),t.setAttribute("level",e[a].nestedLevel.toString())}t.style.listStyleType=e[a].listStyleTypeName}else if(1===e[a].nestedLevel)i.lastChild.tagName.toLowerCase()===e[a].listType?t=i.lastChild:(i.appendChild(t=j.createElement(e[a].listType)),t.style.listStyleType=e[a].listStyleTypeName),(u=j.createElement("li")).appendChild(p),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString());else for(n=u;n.parentElement;)if((n=n.parentElement).attributes.getNamedItem("level")){if(parseInt(n.attributes.getNamedItem("level").textContent,10)===e[a].nestedLevel&&s===e[a].listFormatOverride){(u=j.createElement("li")).appendChild(p),n.appendChild(u);break}if(parseInt(n.attributes.getNamedItem("level").textContent,null)===e[a].nestedLevel&&s!==e[a].listFormatOverride){if(t=j.createElement(e[a].listType),u=j.createElement("li"),t.appendChild(u),1<e[a].nestedLevel)for(var g=0;g<e[a].nestedLevel-1;g++)u.appendChild(t=j.createElement(e[a].listType)),u=j.createElement("li"),t.appendChild(u),t.style.listStyleType="none";u.appendChild(p),n.appendChild(t),t.setAttribute("level",e[a].nestedLevel.toString()),t.style.listStyleType=e[a].listStyleTypeName;break}if(e[a].nestedLevel>parseInt(n.attributes.getNamedItem("level").textContent,10)){n.appendChild(t=j.createElement(e[a].listType)),(u=j.createElement("li")).appendChild(p),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),t.style.listStyleType=e[a].listStyleTypeName;break}}}else i.appendChild(t=j.createElement(e[a].listType,{className:e[a].class})),(u=j.createElement("li")).appendChild(p),t.appendChild(u),t.setAttribute("level",e[a].nestedLevel.toString()),"msolistparagraph"!==e[a].class?t.style.marginLeft=e[a].styleMarginLeft:j.addClass([t],"marginLeftIgnore"),t.style.listStyleType=e[a].listStyleTypeName;u.setAttribute("class",e[a].class),u.setAttribute("style",j.isNullOrUndefined(e[a].listStyle)?"":e[a].listStyle),o=e[a].nestedLevel,s=e[a].listFormatOverride,r++,j.isNullOrUndefined(e[a].start&&1!==e[a].start&&"ol"===e[a].listType)||t.setAttribute("start",e[a].start.toString())}return i},c.prototype.getListContent=function(e){var t=e.firstElementChild;if(""!==t.textContent.trim()||j.isNullOrUndefined(t.firstElementChild)||"IMG"!==t.firstElementChild.nodeName){if(0<t.childNodes.length){for(var n=t.querySelectorAll('[style*="mso-list"]'),i=0;i<n.length;i++)n[i].setAttribute("style",n[i].getAttribute("style").replace(/\n/g,""));var o,r=t.querySelector('span[style*="mso-list"]'),r=(r&&(s=r.getAttribute("style"))&&(s=s.replace(/\s*:\s*/g,":"),r.setAttribute("style",s)),t.querySelector('span[style="mso-list:Ignore"]')),s=j.isNullOrUndefined(r),r=s?t:r;j.isNullOrUndefined(r)||(t=r.textContent.trim(),s&&(o=t.match(/^(\d{1,2}|[a-zA-Z]|[*#~])(\.|\)|-)\s*/),j.isNullOrUndefined(o)||(t=o[0].trim(),r.textContent=r.textContent.trim().substring(t.length).trim())),this.listContents.push(t),s||j.detach(r),this.removingComments(e),this.removeUnwantedElements(e))}}else o=e.innerHTML.trim(),this.listContents.push(""),this.listContents.push(o);this.listContents.push(e.innerHTML)},c.prototype.processMargin=function(e){var t=e.querySelectorAll("li");if(0<t.length)for(var n=0;n<t.length;n++)j.isNullOrUndefined(t[n].style.marginLeft)||t[n].parentElement.classList.contains("marginLeftIgnore")||(t[n].style.marginLeft="");var i=e.querySelectorAll("table");if(0<i.length)for(n=0;n<i.length;n++)!j.isNullOrUndefined(i[n].style.marginLeft)&&0<=i[n].style.marginLeft.indexOf("-")&&(i[n].style.marginLeft="");var o=e.querySelectorAll(".marginLeftIgnore li");if(0<o.length)for(var r,n=0;n<o.length;n++)j.isNullOrUndefined(o[n].style.marginLeft)||""===o[n].style.marginLeft||(r=o[n].style.marginLeft,r=parseFloat(r.split("in")[0])-.5,o[n].style.marginLeft=r.toString()+"in")},c.prototype.removeEmptyAnchorTag=function(e){for(var t=e.querySelectorAll("a:not([href])"),n=t.length-1;0<=n;n--){for(var i=t[n].parentNode;t[n].firstChild;)i.insertBefore(t[n].firstChild,t[n]);i.removeChild(t[n])}},c.prototype.findSource=function(e){for(var t=e.querySelectorAll("meta"),n=0;n<t.length;n++){var i=t[n],o=i.getAttribute("content"),i=i.getAttribute("name");if(i&&0<=i.toLowerCase().indexOf("generator")&&o&&0<=o.toLowerCase().indexOf("microsoft"))for(var r=0;r<Es.length;r++)if(0<=o.toLowerCase().indexOf(Es[r]))return Es[r]}return"html"},c.prototype.handleOneNoteContent=function(e){var t=e.querySelectorAll("ul, ol");if(0<t.length)for(var n=0;n<t.length;n++){var i=t[n];0===i.querySelectorAll("li").length&&0<i.childNodes.length&&F.unwrap(i)}},c.prototype.destroy=function(){this.removeEventListener()};var al=c;function c(e){this.olData=["decimal","decimal-leading-zero","lower-alpha","lower-roman","upper-alpha","upper-roman","lower-greek"],this.ulData=["disc","square","circle","disc","square","circle"],this.ignorableNodes=["A","APPLET","B","BLOCKQUOTE","BR","BUTTON","CENTER","CODE","COL","COLGROUP","DD","DEL","DFN","DIR","DIV","DL","DT","EM","FIELDSET","FONT","FORM","FRAME","FRAMESET","H1","H2","H3","H4","H5","H6","HR","I","IMG","IFRAME","INPUT","INS","LABEL","LI","OL","OPTION","P","PARAM","PRE","Q","S","SELECT","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","TEXTAREA","TFOOT","TH","THEAD","TITLE","TR","TT","U","UL"],this.blockNode=["div","p","h1","h2","h3","h4","h5","h6","address","blockquote","button","center","dd","dir","dl","dt","fieldset","frameset","hr","iframe","isindex","li","map","menu","noframes","noscript","object","ol","pre","table","tbody","td","tfoot","th","thead","tr","ul","header","article","nav","footer","section","aside","main","figure","figcaption"],this.borderStyle=["border-top","border-right","border-bottom","border-left"],this.upperRomanNumber=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"],this.lowerRomanNumber=["i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"],this.lowerGreekNumber=["","","","","","","","","","","","","","","","","","","","","","","",""],this.removableElements=["o:p","style","w:sdt"],this.listContents=[],this.cropImageDimensions=[],this.parent=e,this.addEventListener()}dl.prototype.addEventListener=function(){this.parent.observer.on(ys,this.insertText,this),this.parent.observer.on(r,this.destroy,this)},dl.prototype.removeEventListener=function(){this.parent.observer.off(ys,this.insertText),this.parent.observer.off(r,this.destroy)},dl.prototype.insertText=function(e){var t=document.createTextNode(e.value);la.Insert(this.parent.currentDocument,t,this.parent.editableElement),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},dl.prototype.destroy=function(){this.removeEventListener()};var ll=dl;function dl(e){this.parent=e,this.addEventListener()}pl.prototype.addEventListener=function(){this.parent.observer.on(na,this.emojiInsert,this),this.parent.observer.on(r,this.destroy,this)},pl.prototype.removeEventListener=function(){this.parent.observer.off(na,this.emojiInsert),this.parent.observer.off(r,this.destroy)},pl.prototype.emojiInsert=function(e){for(var t=document.createTextNode(e.value),n=this.parent.currentDocument.getSelection(),i=n.getRangeAt(0).startOffset,o=i-1;i-15<=o;o--){var r=n.focusNode.textContent.substring(o-1,o);if(/:$/.test(r)){this.beforeApplyFormat(!0);break}}var s=/:$/.test(n.focusNode.textContent.charAt(i-1)),a=n.focusNode.textContent.charAt(i-2),a=/\s/.test(a),s=(s&&(a||1===n.focusOffset)&&this.beforeApplyFormat(!0),n.focusNode),a=j.closest("#text"===s.nodeName?s.parentNode:s,"a");a?0===i?a.parentNode.insertBefore(t,a):i===s.textContent.length&&(a.parentNode.insertBefore(t,a.nextSibling),new gl(a).setCursorPoint(this.parent.currentDocument,a.nextSibling,a.nextSibling.textContent.length)):la.Insert(this.parent.currentDocument,t,this.parent.editableElement),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},pl.prototype.beforeApplyFormat=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection.getNodeCollection(t)[0],i=!(":"===n.parentElement.innerHTML.replace(/&nbsp;|<br>/g,"").trim()||0===n.textContent.trim().indexOf("/")),o=n;if(i&&e)for(;o!==this.parent.editableElement;)o=o.parentElement;for(var r=t.startOffset;-1===this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument).toString().indexOf(":");)this.parent.nodeSelection.setSelectionText(this.parent.editableElement.ownerDocument,n,n,r,t.endOffset),r--;i=this.parent.nodeSelection.getRange(this.parent.currentDocument),e=this.parent.nodeCutter.GetSpliceNode(i,n);e.parentNode.removeChild(e)},pl.prototype.destroy=function(){this.removeEventListener()};var cl=pl;function pl(e){this.parent=e,this.addEventListener()}f.prototype.addEventListener=function(){this.parent.observer.on(ea,this.actionHandler,this),this.parent.observer.on(Gs,this.onPropertyChanged,this),this.parent.observer.on(r,this.destroy,this)},f.prototype.onPropertyChanged=function(e){e&&"formatPainter"===e.module&&(j.isNullOrUndefined(e.newProp.formatPainterSettings.allowedFormats)||(this.settings.allowedFormats=e.newProp.formatPainterSettings.allowedFormats),j.isNullOrUndefined(e.newProp.formatPainterSettings.deniedFormats)||(this.settings.deniedFormats=e.newProp.formatPainterSettings.deniedFormats,this.setDeniedFormats()))},f.prototype.removeEventListener=function(){this.parent.observer.off(ea,this.actionHandler),this.parent.observer.off(Gs,this.onPropertyChanged),this.parent.observer.off(r,this.destroy)},f.prototype.destroy=function(){this.removeEventListener(),this.INVALID_TAGS=null,this.copyCollection=null,this.deniedFormatsCollection=null,this.newElem=null,this.newElemLastChild=null,this.settings=null,this.parent=null},f.prototype.actionHandler=function(e){if(this.settings.allowedContext=["Text","List","Table"],!j.isNullOrUndefined(e)&&!j.isNullOrUndefined(e.item)&&!j.isNullOrUndefined(e.item.formatPainterAction)){switch(e.item.formatPainterAction){case"format-copy":this.copyAction();break;case"format-paste":this.pasteAction();break;case"escape":this.escapeAction()}this.callBack(e)}},f.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:"FormatPainter",action:e.item.formatPainterAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},f.prototype.generateElement=function(){for(var e,t=this.copyCollection.slice(),n=(t.reverse(),t.length),i=j.createElement("div",{className:"e-format-paste-wrapper"}),o=0;o<n;o++){var r=t[o],s=r.attrs,a=r.className,l=r.styles,r=r.tagName,d=j.createElement(r);""!==a&&(d.className=a);for(var c=0;c<s.length;c++){var p=s[c].name,h=s[c].value;d.setAttribute(p,h)}for(var u=0;u<l.length;u++){var p=l[u].property,h=l[u].value,m=l[u].priority;d.style.setProperty(p,h,m)}e=((0===i.childElementCount?i:e).append(d),d)}for(var g=this.removeDeniedFormats(i),f=g;f;)f=null===f.firstChild?void(e=f):f.firstChild;this.newElem=g,this.newElemLastChild=e},f.prototype.pasteAction=function(){j.isNullOrUndefined(this.copyCollection)||0===this.copyCollection.length?this.paintPlainTextFormat():this.insertFormatNode(this.newElem,this.newElemLastChild)},f.prototype.removeDeniedFormats=function(e){if(!j.isNullOrUndefined(this.deniedFormatsCollection)&&0<this.deniedFormatsCollection.length)for(var t=this.deniedFormatsCollection,n=t.length,i=0;i<n;i++){var o=t[i].tag;if(t[i].tag)for(var r=e.querySelectorAll(o),s=0;s<r.length;s++){if(0<t[i].classes.length){for(var a=t[i].classes,l=a.length,d=0;d<l;d++)r[s].classList.contains(a[d])&&j.removeClass([r[s]],a[d].trim());0===r[s].classList.length&&r[s].removeAttribute("class")}if(0<t[i].styles.length){for(var c=t[i].styles,p=c.length,d=0;d<p;d++)r[s].style.removeProperty(c[d].trim());0===r[s].style.length&&r[s].removeAttribute("style")}if(0<t[i].attributes.length)for(var h=t[i].attributes,u=h.length,d=0;d<u;d++)r[s].removeAttribute(h[d].trim())}}return e.firstElementChild},f.prototype.copyAction=function(){var e=[],t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(0!==i.length||0!==n.getSelectionNodeCollectionBr(t).length){for(var o=(i=0===i.length?n.getSelectionNodeCollectionBr(t):i)[0].parentElement,n=this.findCurrentContext(o),r=-1<this.settings.allowedFormats.indexOf(";")?this.settings.allowedFormats.split(";"):[this.settings.allowedFormats],s=0;s<r.length;s++)r[s]=r[s].trim();var i=this.getRangeParentElem(n,o),a=i[0],i=i[1];if(!j.isNullOrUndefined(n=null===n?i:n)&&-1<this.settings.allowedContext.indexOf(n)){var l=o="#text"===t.startContainer.nodeName?t.startContainer.parentElement:o;do{if(-1<r.indexOf(o.nodeName.toLowerCase())){for(var d=o.attributes,c=[],s=0;s<d.length;s++)"class"!==d[s].name&&"style"!==d[s].name&&c.push(d[s]);for(var p=o.className,h=o.style,u=[],s=0;s<h.length;s++){var m=h[s],g=h.getPropertyValue(m),f=h.getPropertyPriority(m);u.push({property:m,value:g,priority:f})}e.push({attrs:c,className:p,styles:u,tagName:o.nodeName})}}while((a===o?o=void 0:j.isNullOrUndefined(o.parentElement)||(o=o.parentElement),l!==o)&&(!j.isNullOrUndefined(o)||o===this.parent.editableElement));this.copyCollection=e}this.generateElement()}},f.prototype.getRangeParentElem=function(e,t){var n,i=t;switch(3===i.nodeType&&(i=i.parentElement),e){case"Table":n=j.closest(i,"td"),j.isNullOrUndefined(n)&&(n=j.closest(i,"th"));break;case"List":n=j.closest(i,"li");break;case"Text":n=j.closest(i,"p")}return j.isNullOrUndefined(n)&&(t=this.getNearestBlockParentElement(t),j.isNullOrUndefined(t)||"UL"===t||"OL"===t||"LI"===t||(n=j.closest(i,t),e="Text")),[n="List"===e?n.parentElement:n,e]},f.prototype.getNearestBlockParentElement=function(e){var t=e;for(3===t.nodeType&&(t=t.parentNode);t&&t!==this.parent.editableElement;){if(!j.isNullOrUndefined(t)&&this.isBlockElement(t))return t.nodeName;t=t.parentNode}return null},f.prototype.isBlockElement=function(e){return-1<["P","DIV","UL","OL","LI","H1","H2","H3","H4","H5","H6","ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","FIGCAPTION","FIGURE","FOOTER","HEADER","HR","MAIN","NAV","SECTION","SUMMARY","PRE"].indexOf(e.nodeName)},f.prototype.escapeAction=function(){this.copyCollection=[]},f.prototype.paintPlainTextFormat=function(){var e,t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(1<i.length)for(var o=0;o<i.length;o++)e=this.validateELementTag(i[o]);else e=this.validateELementTag(t.startContainer)&&this.validateELementTag(t.endContainer);e||this.parent.execCommand("Clear","ClearFormat",null,null)},f.prototype.validateELementTag=function(e){return 3===e.nodeType&&(e=e.parentElement),-1<this.INVALID_TAGS.indexOf(e.tagName)},f.prototype.findCurrentContext=function(e){var t=j.closest(e,"p"),n=j.closest(e,"li");return t&&!n?"Text":j.closest(e,"li")?j.isNullOrUndefined(t)||j.isNullOrUndefined(n)||t.textContent.trim()===n.textContent.trim()?"List":"Text":j.closest(e,"td")||j.closest(e,"tr")||j.closest(e,"th")?"Table":null},f.prototype.insertFormatNode=function(e,t){for(var n,i=e.cloneNode(!0),e=(this.isBlockElement(e)||((o=j.createElement("P")).appendChild(e),i=o.cloneNode(!0)),this.parent.editableElement),o=this.parent.currentDocument,r=i.firstChild;r;){if(!this.isBlockElement(r)){n=r.parentNode.removeChild(r);break}r=r.firstChild}Ya.applyFormat(o,null,e,"P",null,"formatPainter",null,{element:n,lastChild:t});var e=this.parent.nodeSelection.getRange(o),t=e.collapsed,s=this.parent.domNode.blockNodes();if(this.isListCopied())for(var a=0;a<s.length;a++)j.closest(s[a],"li")&&(s[a]=j.closest(s[a],"li"));var l=!1;1===s.length&&(l=s[0].textContent.trim()===e.toString().trim()),(this.isBlockElement(i)&&t||1<s.length||l)&&this.insertBlockNode(i,e,o,s)},f.prototype.isListCopied=function(){for(var e=!1,t=0;t<this.copyCollection.length;t++)if("OL"===this.copyCollection[t].tagName||"UL"===this.copyCollection[t].tagName){e=!0;break}return e},f.prototype.insertBlockNode=function(e,t,n,i){for(var o,r,n=this.parent.nodeSelection.save(t,n),s=(this.parent.domNode.setMarker(n),!1),a=("UL"!==e.nodeName&&"OL"!==e.nodeName||(o=(r=e.cloneNode(!0)).firstChild),j.isNullOrUndefined(r)?e:e.firstChild),l=0;l<i.length;l++)if(!(-1<this.INVALID_TAGS.indexOf(i[l].nodeName)||0<i[l].querySelectorAll("img,audio,video,iframe").length)){for(var d=a.cloneNode(!1);i[l].firstChild;)0!==i[l].textContent.trim().length?d.appendChild(i[l].firstChild):i[l].removeChild(i[l].firstChild);if("TD"===i[l].nodeName||"TH"===i[l].nodeName)(j.isNullOrUndefined(r)||0!==l||j.isNullOrUndefined(r)?i[l]:(i[l].appendChild(r),r)).appendChild(d);else if(j.isNullOrUndefined(r)||(s=this.isSameListType(e,i[l])),"LI"!==d.nodeName||s?s?this.insertSameList(i,l,r,d):i[l].parentNode.replaceChild(d,i[l]):this.insertNewList(t,i,l,r,d),"LI"!==d.nodeName&&("OL"===d.parentElement.nodeName||"UL"===d.parentElement.nodeName)){var c=d.parentElement;if(this.parent.nodeCutter.SplitNode(t,c,!0),j.isNullOrUndefined(c.previousElementSibling))c.parentElement.prepend(d);else if(c.previousElementSibling.after(d),1<d.childNodes.length)for(var p=0;p<d.childNodes.length;p++){var h=d.childNodes[p];"OL"!==h.nodeName&&"UL"!==h.nodeName||d.after(h)}}}j.isNullOrUndefined(o)||j.detach(o),this.cleanEmptyLists(),this.parent.domNode.saveMarker(n).restore()},f.prototype.insertNewList=function(e,t,n,i,o){if(0===n){var r,s=t[n].nodeName,s=(t[n]=t[n].parentNode.replaceChild(i,t[n]),"LI"===s?i.parentElement:i);if(this.parent.nodeCutter.SplitNode(e,s,!0),"LI"!==t[n].nodeName||j.isNullOrUndefined(s))if(j.isNullOrUndefined(s))i.append(o);else if(j.isNullOrUndefined(s.previousElementSibling)||s.previousElementSibling.nodeName!==i.nodeName)if(j.isNullOrUndefined(s.nextElementSibling)||s.nextElementSibling.nodeName!==i.nodeName)i.append(o);else for((r=s.nextElementSibling).prepend(o);r.firstChild;)i.append(r.firstChild);else for((r=s.previousElementSibling).append(o);r.firstChild;)i.append(r.firstChild);else i.append(o),j.isNullOrUndefined(s.parentNode)||s.parentNode.insertBefore(i,s)}else i.append(o);this.detachEmptyBlockNodes(t[n])},f.prototype.insertSameList=function(e,t,n,i){if(0===t){if(!j.isNullOrUndefined(e[t].parentNode)&&("UL"===e[t].parentNode.nodeName||"OL"===e[t].parentNode.nodeName)){if(1===e.length){for(;i.firstChild;)e[t].append(i.firstChild);for(var o=0;o<e[t].parentNode.childNodes.length;o++){var r=e[t].parentNode.childNodes[o];n.append(r.cloneNode(!0))}}else n.append(i);e[t].parentNode.parentNode.replaceChild(n,e[t].parentNode)}}else n.append(i);this.detachEmptyBlockNodes(e[t])},f.prototype.isSameListType=function(e,t){var n=!1,t=j.closest(t,"ol, ul");return n=!j.isNullOrUndefined(t)&&0<t.querySelectorAll("li").length?t.nodeName===e.nodeName:n},f.prototype.cleanEmptyLists=function(){for(var e=this.parent.editableElement.querySelectorAll("ol, ul"),t=0;t<e.length;t++)""===e[t].textContent.trim()&&j.detach(e[t])},f.prototype.setDeniedFormats=function(){var e=[];if(!j.isNullOrUndefined(this.settings)&&!j.isNullOrUndefined(this.settings.deniedFormats)){for(var t=-1<this.settings.deniedFormats.indexOf(";")?this.settings.deniedFormats.split(";"):[this.settings.deniedFormats],n=t.length,i=0;i<n;i++){var o=t[i];""!==o&&(o.trim(),o=this.makeDeniedFormatsCollection(o),j.isNullOrUndefined(o)||e.push(o))}this.deniedFormatsCollection=e}},f.prototype.detachEmptyBlockNodes=function(e){j.isNullOrUndefined(e)||""!==e.textContent.trim()||j.detach(e)},f.prototype.makeDeniedFormatsCollection=function(e){var t,n=e.indexOf("("),i=e.indexOf(")"),o=e.indexOf("["),r=e.indexOf("]"),s=e.indexOf("{"),a=e.indexOf("}"),l=[],d=[],c=[],i=(-1<n&&-1<i&&(l=e.substring(n+1,i).split(" ")[0].split(")")[0].split(",")),-1<o&&-1<r&&(d=e.substring(o+1,r).split(",")),-1<s&&-1<a&&(c=e.substring(s+1,a).split(",")),[n,o,s]),r=(i=i.filter(function(e){return-1<e})).length;return 1===r?t=i[0]:2===r?t=Math.min(i[0],i[1]):3===r&&(t=Math.min(i[0],i[1],i[2])),{tag:e.substring(0,t).trim(),styles:c,classes:l,attributes:d}};var hl=f;function f(e,t){this.INVALID_TAGS=["A","AUDIO","IMG","VIDEO","IFRAME"],this.parent=e,this.settings=t,this.addEventListener(),this.setDeniedFormats()}ml.prototype.wireEvents=function(){this.observer.on(zs,this.editorKeyDown,this),this.observer.on(Ks,this.editorKeyUp,this),this.observer.on(Ks,this.editorKeyUp,this),this.observer.on(Xs,this.onPropertyChanged,this),this.observer.on(Js,this.onWordPaste,this),this.observer.on($s,this.onBegin,this),this.observer.on(ia,this.editorMouseDown,this),this.observer.on(oa,this.destroy,this)},ml.prototype.unwireEvents=function(){this.observer.off(zs,this.editorKeyDown),this.observer.off(Ks,this.editorKeyUp),this.observer.off(Ks,this.editorKeyUp),this.observer.off(Xs,this.onPropertyChanged),this.observer.off(Js,this.onWordPaste),this.observer.off($s,this.onBegin),this.observer.off(ia,this.editorMouseDown),this.observer.off(oa,this.destroy)},ml.prototype.onWordPaste=function(e){this.observer.notify(Ys,e)},ml.prototype.onPropertyChanged=function(e){this.observer.notify(Gs,e)},ml.prototype.editorKeyDown=function(e){this.observer.notify(u,e)},ml.prototype.editorKeyUp=function(e){this.observer.notify(Ws,e)},ml.prototype.onBegin=function(e){this.observer.notify(Zs,e)},ml.prototype.execCommand=function(e,t,n,i,o,r,s,a){switch(e.toLowerCase()){case"lists":this.observer.notify(Qs,{subCommand:t,event:n,callBack:i,selector:s,item:r,enterAction:a});break;case"formats":this.observer.notify(Vs,{subCommand:t,event:n,callBack:i,selector:s,exeValue:r,enterAction:a});break;case"alignments":this.observer.notify(ps,{subCommand:t,event:n,callBack:i,selector:s,value:r,enterAction:a});break;case"indents":this.observer.notify(hs,{subCommand:t,event:n,callBack:i,selector:s,enterAction:a});break;case"links":this.observer.notify(Jr,{command:e,value:t,item:r,event:n,callBack:i,enterAction:a});break;case"files":this.observer.notify(Kr,{command:e,value:"Image",item:r,event:n,callBack:i,selector:s});break;case"images":this.observer.notify(Kr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"audios":this.observer.notify(Gr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"videos":this.observer.notify(Xr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"table":switch(t.toString().toLocaleLowerCase()){case"createtable":this.observer.notify(Yr,{item:r,event:n,callBack:i,enterAction:a});break;case"insertrowbefore":case"insertrowafter":this.observer.notify($r,{item:r,event:n,callBack:i});break;case"insertcolumnleft":case"insertcolumnright":this.observer.notify(Zr,{item:r,event:n,callBack:i});break;case"deleterow":this.observer.notify(es,{item:r,event:n,callBack:i});break;case"deletecolumn":this.observer.notify(ts,{item:r,event:n,callBack:i});break;case"tableremove":this.observer.notify(ns,{item:r,event:n,callBack:i});break;case"tableheader":this.observer.notify(is,{item:r,event:n,callBack:i});break;case"aligntop":case"alignmiddle":case"alignbottom":this.observer.notify(os,{item:r,event:n,callBack:i});break;case"merge":this.observer.notify(rs,{item:r,event:n,callBack:i});break;case"horizontalsplit":this.observer.notify(as,{item:r,event:n,callBack:i});break;case"verticalsplit":this.observer.notify(ss,{item:r,event:n,callBack:i});break;case"dashed":this.observer.notify(ls,{item:r,event:n,callBack:i});break;case"alternate":this.observer.notify(ds,{item:r,event:n,callBack:i})}break;case"font":case"style":case"effects":case"casing":this.observer.notify(bs,{subCommand:t,event:n,callBack:i,value:o,selector:s,enterAction:a});break;case"inserthtml":this.observer.notify(vs,{subCommand:t,callBack:i,value:o,enterAction:a});break;case"inserttext":this.observer.notify(ys,{subCommand:t,callBack:i,value:o});break;case"clear":this.observer.notify(Cs,{subCommand:t,event:n,callBack:i,selector:s,enterAction:a});break;case"actions":this.observer.notify(_s,{subCommand:t,event:n,callBack:i,selector:s});break;case"formatpainter":this.observer.notify(ea,{item:r,subCommand:t,event:n,callBack:i});break;case"emojipicker":this.observer.notify(na,{item:r,subCommand:t,value:o,event:n,callBack:i})}},ml.prototype.editorMouseDown=function(e){var t;3===e.args.detail&&this.tripleClickSelection(e.args),-1!==j.Browser.userAgent.indexOf("Safari")&&(500<(t=(new Date).getTime())-this.lastClickTime&&(this.clickCount=0),this.clickCount++,this.lastClickTime=t,3===this.clickCount)&&(this.tripleClickSelection(e.args),this.clickCount=0)},ml.prototype.tripleClickSelection=function(e){var t,n=this.nodeSelection.getRange(this.currentDocument),i=this.nodeSelection.get(this.currentDocument),o=new ha(this.editableElement);0<i.rangeCount&&""!==i.toString()&&(i=this.getParentBlockNode(n.startContainer),n=this.getParentBlockNode(n.endContainer),i)&&n&&i===n&&(t=this.currentDocument.createRange(),i=o.getFirstTextNode(i),o=o.getLastTextNode(n),i)&&o&&(t.setStart(i,0),t.setEnd(o,o.textContent.length),this.nodeSelection.setRange(this.currentDocument,t),e.preventDefault())},ml.prototype.getParentBlockNode=function(e){var t=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return window.getComputedStyle(e).display.indexOf("inline")<0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t.currentNode=e,t.parentNode()},ml.prototype.destroy=function(){this.isDestroyed||(this.unwireEvents(),this.observer.notify(r),this.editableElement&&(this.editableElement=null),this.currentDocument=null,this.nodeCutter&&(this.nodeCutter=null),this.domNode&&(this.domNode=null),this.listObj&&(this.listObj=null),this.formatObj&&(this.formatObj=null),this.alignmentObj&&(this.alignmentObj=null),this.indentsObj&&(this.indentsObj=null),this.linkObj&&(this.linkObj=null),this.imgObj&&(this.imgObj=null),this.audioObj&&(this.audioObj=null),this.videoObj&&(this.videoObj=null),this.selectionObj&&(this.selectionObj=null),this.inserthtmlObj&&(this.inserthtmlObj=null),this.insertTextObj&&(this.insertTextObj=null),this.clearObj&&(this.clearObj=null),this.tableObj&&(this.tableObj=null),this.msWordPaste&&(this.msWordPaste=null),this.formatPainterEditor&&(this.formatPainterEditor=null),this.emojiPickerObj&&(this.emojiPickerObj=null),this.tableCellSelection&&(this.tableCellSelection=null),this.isDestroyed=!0)},ml.prototype.beforeSlashMenuApplyFormat=function(){for(var e=this.nodeSelection.getRange(this.currentDocument),t=this.nodeSelection.getNodeCollection(e)[0],n=e.startOffset;-1===this.nodeSelection.getRange(document).toString().indexOf("/");)this.nodeSelection.setSelectionText(document,t,t,n,e.endOffset),n--;var i=this.nodeSelection.getRange(this.currentDocument),i=this.nodeCutter.GetSpliceNode(i,t),o=i.previousSibling;i.parentElement&&1===i.parentElement.innerHTML.length&&i.parentElement.appendChild(document.createElement("br")),i.parentNode.removeChild(i),o&&this.nodeSelection.setCursorPoint(document,o,o.textContent.length)};var ul=ml;function ml(e){this.clickCount=0,this.lastClickTime=0,this.currentDocument=e.document,this.editableElement=e.editableElement,this.nodeSelection=new gl(this.editableElement),this.nodeCutter=new sa,this.domNode=new qs(this.editableElement,this.currentDocument),this.observer=new j.Observer(this),this.listObj=new ca(this),this.formatObj=new pa(this),this.alignmentObj=new fa(this),this.indentsObj=new va(this),this.linkObj=new ma(this),this.imgObj=new za(this),this.audioObj=new Va(this),this.videoObj=new Wa(this),this.selectionObj=new Ja(this),this.inserthtmlObj=new Za(this),this.insertTextObj=new ll(this),this.clearObj=new il(this),this.tableObj=new Ga(this),this.undoRedoManager=new rl(this,e.options),this.msWordPaste=new al(this),this.formatPainterEditor=new hl(this,e.formatPainterSettings),this.emojiPickerObj=new cl(this),this.tableCellSelection=new js(this.editableElement,this.currentDocument),this.wireEvents(),this.isDestroyed=!1}b.prototype.saveInstance=function(e,t){return this.range=e.cloneRange(),this.rootNode=this.documentFromRange(e),this.body=t,this.startContainer=this.getNodeArray(e.startContainer,!0),this.endContainer=this.getNodeArray(e.endContainer,!1),this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.html=this.body.innerHTML,this},b.prototype.documentFromRange=function(e){return 9===e.startContainer.nodeType?e.startContainer:e.startContainer.ownerDocument},b.prototype.getRange=function(e){var t=this.get(e),t=t&&0<t.rangeCount?t.getRangeAt(t.rangeCount-1):e.createRange();return t.startContainer!==e||t.endContainer!==e||t.startOffset||t.endOffset||(t.setStart(e.body,0),t.collapse(!0)),t},b.prototype.get=function(e){return e.defaultView.getSelection()},b.prototype.save=function(e,t){return e=e?e.cloneRange():this.getRange(t),this.saveInstance(e,t.body)},b.prototype.getIndex=function(e){var t=0;if(e=e.previousSibling||"BR"!==e.tagName?e.previousSibling:e)for(e.nodeType;e;)t++,e.nodeType,e=e.previousSibling;return t},b.prototype.isChildNode=function(e,t){for(var n=0;n<t.childNodes.length;n++)if(-1<e.indexOf(t.childNodes[n]))return!0;return!1},b.prototype.getNode=function(e,t,n){return this.editableElement&&(!this.editableElement.contains(e)||this.editableElement===e)||t===e&&(3===e.nodeType||!e.firstChild||-1!==n.indexOf(e.firstChild)||this.isChildNode(n,e))||3===e.nodeType&&e.previousSibling===t&&"IMG"===t.nodeName?null:-1===n.indexOf(e.firstChild)&&e.firstChild&&!this.isChildNode(n,e)?e.firstChild:e.nextSibling||e.parentNode||null},b.prototype.getNodeCollection=function(e){var t=e.startContainer.childNodes[e.startOffset]||e.startContainer,n=e.endContainer.childNodes[0<e.endOffset?e.endOffset-1:e.endOffset]||e.endContainer,i=this.processedTableImageCursor(e);if((i.start||i.end)&&("TABLE"===i.startName||"TABLE"===i.endName))return[i.start?i.startNode:i.endNode];if((t===n||"BR"===t.nodeName&&t===e.endContainer.childNodes[e.endOffset])&&0===t.childNodes.length)return[t];if(e.startOffset===e.endOffset&&0!==e.startOffset&&"PRE"===e.startContainer.nodeName)return["BR"===t.nodeName||"#text"===t.nodeName?t:t.childNodes[0]];for(var o=[];-1===o.indexOf(t)&&o.push(t),t=this.getNode(t,n,o););return o},b.prototype.getParentNodeCollection=function(e){return this.getParentNodes(this.getNodeCollection(e),e)},b.prototype.getParentNodes=function(e,t){e=e.reverse();for(var n=0;n<e.length;n++)-1!==e.indexOf(e[n].parentNode)||3===e[n].nodeType&&t.startContainer!==t.endContainer&&t.startContainer.parentNode!==t.endContainer.parentNode&&t.startContainer.parentNode.tagName&&t.endContainer.parentNode.tagName&&-1!==ms.indexOf(t.startContainer.parentNode.tagName.toLowerCase())&&-1!==ms.indexOf(t.endContainer.parentNode.tagName.toLowerCase())?(e.splice(n,1),n--):3===e[n].nodeType&&(e[n]=e[n].parentNode);return e},b.prototype.getSelectionNodeCollection=function(e){return this.getSelectionNodes(this.getNodeCollection(e))},b.prototype.getSelectionNodeCollectionBr=function(e){return this.getSelectionNodesBr(this.getNodeCollection(e))},b.prototype.getSelectionNodes=function(e){e=e.reverse();for(var t=new RegExp("","g"),n=0;n<e.length;n++)(3!==e[n].nodeType||""===e[n].textContent.trim()||1===e[n].textContent.length&&e[n].textContent.match(t))&&(e.splice(n,1),n--);return e.reverse()},b.prototype.getSelectionNodesBr=function(e){e=e.reverse();for(var t=new RegExp("","g"),n=0;n<e.length;n++)"BR"!==e[n].nodeName&&(3!==e[n].nodeType||""===e[n].textContent.trim()||1===e[n].textContent.length&&e[n].textContent.match(t))&&(e.splice(n,1),n--);return e.reverse()},b.prototype.getInsertNodeCollection=function(e){return this.getInsertNodes(this.getNodeCollection(e))},b.prototype.getInsertNodes=function(e){e=e.reverse();for(var t=0;t<e.length;t++)(0!==e[t].childNodes.length&&3!==e[t].nodeType||3===e[t].nodeType&&""===e[t].textContent)&&(e.splice(t,1),t--);return e.reverse()},b.prototype.getNodeArray=function(e,t,n){var i=[];for(t?this.startNodeName=[]:this.endNodeName=[];e!==(n||this.rootNode)&&!j.isNullOrUndefined(e);)(t?this.startNodeName:this.endNodeName).push(e.nodeName.toLowerCase()),i.push(this.getIndex(e)),e=e.parentNode;return i},b.prototype.setRangePoint=function(e,t,n,i){for(var o=this.rootNode,r=n.length;r--;)o=o&&o.childNodes[n[r]];return o&&0<=i&&"html"!==o.nodeName&&(3===o.nodeType&&"&nbsp;"===o.nodeValue.replace(/\u00a0/g,"&nbsp;")&&(i=o.textContent.length),e[t?"setStart":"setEnd"](o,i)),e},b.prototype.restore=function(){var e=this.range.cloneRange(),e=this.setRangePoint(e,!0,this.startContainer,this.startOffset);return e=this.setRangePoint(e,!1,this.endContainer,this.endOffset),this.selectRange(this.rootNode,e),e},b.prototype.selectRange=function(e,t){this.setRange(e,t),this.save(t,e)},b.prototype.setRange=function(e,t){e=this.get(e);e.removeAllRanges(),e.addRange(t)},b.prototype.setSelectionText=function(e,t,n,i,o){var r=e.createRange();r.setStart(t,i),r.setEnd(n,o),this.setRange(e,r)},b.prototype.setSelectionContents=function(e,t){var n=e.createRange();n.selectNode(t),this.setRange(e,n)},b.prototype.setSelectionNode=function(e,t){var n=e.createRange();n.selectNodeContents(t),this.setRange(e,n)},b.prototype.getSelectedNodes=function(e){return this.getNodeCollection(this.getRange(e))},b.prototype.Clear=function(e){this.get(e).removeAllRanges()},b.prototype.insertParentNode=function(e,t,n){n.surroundContents(t),this.selectRange(e,n)},b.prototype.setCursorPoint=function(e,t,n){var i=e.createRange(),e=e.defaultView.getSelection();i.setStart(t,n),i.collapse(!0),e.removeAllRanges(),e.addRange(i)},b.prototype.isTableOrImageStart=function(e){var t=e.startContainer,n=e.startOffset,n=t.childNodes[n],e=e.collapsed&&1===t.nodeType&&t.isContentEditable&&n&&-1<["TABLE"].indexOf(n.nodeName);return e?{start:e,startNodeName:n.nodeName,startNode:n}:{start:!1,startNodeName:"",startNode:void 0}},b.prototype.isTableOrImageEnd=function(e){var t=e.startContainer,n=e.startOffset,n=t.childNodes[n-1],e=e.collapsed&&1===t.nodeType&&t.isContentEditable&&n&&-1<["TABLE"].indexOf(n.nodeName);return e?{end:e,endNodeName:n.nodeName,endNode:n}:{end:!1,endNodeName:"",endNode:void 0}},b.prototype.processedTableImageCursor=function(e){var t=this.isTableOrImageStart(e),n=t.start,i=t.startNodeName,t=t.startNode,e=this.isTableOrImageEnd(e);return{start:n,startName:i,end:e.end,endName:e.endNodeName,startNode:t,endNode:e.endNode}};var gl=b;function b(e){this.startNodeName=[],this.endNodeName=[],this.editableElement=e}var fl=Is(),bl=(vl.get=function(e,t,n,i,o,r){for(var s=JSON.parse(JSON.stringify(fl)),a=JSON.parse(JSON.stringify(fl)),l=new gl(t),d=l.getRange(e),c=r?[r]:d.collapsed?l.getNodeCollection(d):l.getSelectionNodeCollectionBr(d),p=c.length,h=!1,u=0;u<c.length;u++){for(;3===c[u].nodeType&&3===d.startContainer.nodeType&&c[u].parentNode&&c[u].parentNode.lastElementChild&&"BR"!==c[u].parentNode.lastElementChild.nodeName&&this.getImmediateBlockNode(c[u].parentNode)&&0===this.getImmediateBlockNode(c[u].parentNode).textContent.replace(/\u200B/g,"").length&&0===d.startContainer.textContent.replace(/\u200B/g,"").length&&0===l.get(e).toString().replace(/\u200B/g,"").length;)c[u]=c[u].parentNode.lastElementChild.firstChild,h=!0;h&&c[u]&&(l.setCursorPoint(e,c[u],c[u].textContent.length),h=!1),("BR"!==c[u].nodeName&&3!==c[u].nodeType||1<p&&3===c[u].nodeType&&""===c[u].textContent.trim())&&(c.splice(u,1),u--)}for(u=0;u<c.length;u++)s=this.getFormatParent(e,s,c[u],t,n,i,o),(0===u&&s.bold||!s.bold)&&(a.bold=s.bold),(0===u&&s.insertcode||!s.insertcode)&&(a.insertcode=s.insertcode),(0===u&&s.blockquote||!s.blockquote)&&(a.blockquote=s.blockquote),(0===u&&s.italic||!s.italic)&&(a.italic=s.italic),(0===u&&s.underline||!s.underline)&&(a.underline=s.underline),(0===u&&s.strikethrough||!s.strikethrough)&&(a.strikethrough=s.strikethrough),(0===u&&s.superscript||!s.superscript)&&(a.superscript=s.superscript),(0===u&&s.subscript||!s.subscript)&&(a.subscript=s.subscript),(0===u&&s.fontcolor||!s.fontcolor)&&(a.fontcolor=s.fontcolor),0===u&&s.fontname?a.fontname=s.fontname:a.fontname=s.fontname===a.fontname?s.fontname:"empty",0===u&&s.fontsize?a.fontsize=s.fontsize:a.fontsize=s.fontsize===a.fontsize?s.fontsize:"empty",(0===u&&s.backgroundcolor||!s.backgroundcolor)&&(a.backgroundcolor=s.backgroundcolor),(0===u&&s.orderedlist||!s.orderedlist)&&(a.orderedlist=s.orderedlist),(0===u&&s.unorderedlist||!s.unorderedlist)&&(a.unorderedlist=s.unorderedlist),(0===u&&s.alignments||!s.alignments)&&(a.alignments=s.alignments),0===u&&s.formats?a.formats=s.formats:a.formats=s.formats===a.formats?s.formats:"empty",(0===u&&s.createlink||!s.createlink)&&(a.createlink=s.createlink),(0===u&&s.numberFormatList||!s.numberFormatList)&&(a.numberFormatList=s.numberFormatList),(0===u&&s.bulletFormatList||!s.bulletFormatList)&&(a.bulletFormatList=s.bulletFormatList),(0===u&&s.inlinecode||!s.inlinecode)&&(a.inlinecode=s.inlinecode),s=JSON.parse(JSON.stringify(fl));return a},vl.getImmediateBlockNode=function(e){for(;(e=e.parentNode)&&ms.indexOf(e.nodeName.toLocaleLowerCase())<0;);return e},vl.getFormatParent=function(e,t,n,i,o,r,s){var a=!1,l=!1;if(i.contains(n)||3===n.nodeType&&3!==i.nodeType&&i.contains(n.parentNode))for(;((t=this.isFormattedNode(e,t,n,a,l,o,r,s)).orderedlist||t.unorderedlist)&&(a=!0),(t.bulletFormatList||t.numberFormatList)&&(l=!0),(n=n.parentNode)&&n!==i;);return t},vl.isFormattedNode=function(e,t,n,i,o,r,s,a){if(t.bold||(t.bold=Wr.isBold(n)),t.italic||(t.italic=Wr.isItalic(n)),t.underline||(t.underline=Wr.isUnderline(n)),t.strikethrough||(t.strikethrough=Wr.isStrikethrough(n)),t.superscript||(t.superscript=Wr.isSuperscript(n)),t.subscript||(t.subscript=Wr.isSubscript(n)),t.fontcolor||(t.fontcolor=this.isFontColor(e,n)),t.fontname||(t.fontname=this.isFontName(e,n,a)),t.fontsize||(t.fontsize=this.isFontSize(e,n,s)),t.backgroundcolor||(t.backgroundcolor=this.isBackgroundColor(n)),t.orderedlist||i||(t.orderedlist=this.isOrderedList(n)),t.unorderedlist||i||(t.unorderedlist=this.isUnorderedList(n)),t.alignments||(t.alignments=this.isAlignment(n)),t.formats||(t.formats=this.isFormats(n,r),"pre"===t.formats&&(t.insertcode=!0)),!t.blockquote){a=void 0;if(!j.isNullOrUndefined(r))if(-1<r.indexOf("blockquote"))t.formats=this.isFormats(n,r),a=t.formats;else{r.push("blockquote");for(var a=this.isFormats(n,r),l=r.length-1;0<=l;l--)"blockquote"===r[l]&&r.splice(l,1)}"blockquote"===a&&(t.blockquote=!0)}return t.createlink||(t.createlink=this.isLink(n)),t.numberFormatList||o||(t.numberFormatList=this.isNumberFormatList(n)),t.bulletFormatList||o||(t.bulletFormatList=this.isBulletFormatList(n)),t.inlinecode||(t.inlinecode=Wr.isCode(n)),t},vl.isFontColor=function(e,t){var n=t.style&&t.style.color;return null!==(n=null!=n&&""!==n||3===t.nodeType?n:this.getComputedStyle(e,t,"color"))&&""!==n&&void 0!==n?n:null},vl.isLink=function(e){return"a"===e.nodeName.toLocaleLowerCase()},vl.isBackgroundColor=function(e){e=e.style&&e.style.backgroundColor;return null!==e&&""!==e&&void 0!==e?e:null},vl.isFontSize=function(e,t,n){var i=t.style&&t.style.fontSize;return null!==(i=null!=i&&""!==i||3===t.nodeType||!t.parentElement.classList.contains("e-content")?i:this.getComputedStyle(e,t,"font-size"))&&""!==i&&void 0!==i&&(null==n||-1<n.indexOf(i))?i:null},vl.isFontName=function(e,t,n){var i=t.style&&t.style.fontFamily,o=(null!=i&&""!==i||3===t.nodeType||(i=this.getComputedStyle(e,t,"font-family")),null);return null!==i&&""!==i&&void 0!==i&&(null==n||n.filter(function(e,t){var n=new RegExp(i,"i");(e.replace(/"/g,"").replace(/ /g,"").toLowerCase()===i.replace(/"/g,"").replace(/ /g,"").toLowerCase()||e.split(",")[0]&&!j.isNullOrUndefined(e.split(",")[0].trim().match(n))&&e.split(",")[0].trim()===e.split(",")[0].trim().match(n)[0])&&(o=t)})&&null!==o)?null!==o?n[o]:i.replace(/"/g,""):null},vl.isOrderedList=function(e){return"ol"===e.nodeName.toLocaleLowerCase()},vl.isUnorderedList=function(e){return"ul"===e.nodeName.toLocaleLowerCase()},vl.isAlignment=function(e){e=e.style&&e.style.textAlign;return"left"===e?"justifyleft":"center"===e?"justifycenter":"right"===e?"justifyright":"justify"===e?"justifyfull":null},vl.isFormats=function(e,t){return null==t&&-1<ms.indexOf(e.nodeName.toLocaleLowerCase())||null!=t&&-1<t.indexOf(e.nodeName.toLocaleLowerCase())?e.nodeName.toLocaleLowerCase():null},vl.getComputedStyle=function(e,t,n){return e.defaultView.getComputedStyle(t,null).getPropertyValue(n)},vl.isNumberFormatList=function(e){var t=e.style&&e.style.listStyleType;return"lower-alpha"===t?"Lower Alpha":"number"===t?"Number":"upper-alpha"===t?"Upper Alpha":"lower-roman"===t?"Lower Roman":"upper-roman"===t?"Upper Roman":"lower-greek"===t?"Lower Greek":"none"===t&&this.isOrderedList(e)?"None":!!this.isOrderedList(e)||null},vl.isBulletFormatList=function(e){var t=e.style&&e.style.listStyleType;return"circle"===t?"Circle":"square"===t?"Square":"none"===t&&this.isUnorderedList(e)?"None":"disc"===t?"Disc":!!this.isUnorderedList(e)||null},vl);function vl(){}v.prototype.wireEvent=function(){this.parent.on(o,this.destroy,this),this.parent.on(ln,this.destroyTooltip,this),this.parent.on(gn,this.closeTooltip,this)},v.prototype.destroyTooltip=function(){var e,t=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument();j.isNullOrUndefined(t.querySelector(".e-tooltip-wrap"))||j.isNullOrUndefined(t.querySelector("[data-tooltip-id]"))||(t=t.querySelector("[data-tooltip-id]"),e=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0}),t.dispatchEvent(e))},v.prototype.unWireEvent=function(){this.parent.off(o,this.destroy),this.parent.off(ln,this.destroyTooltip),this.parent.off(gn,this.closeTooltip)},v.prototype.toolbarBeforeCreate=function(e){"Extended"===this.mode&&(e.enableCollision=!1)},v.prototype.toolbarCreated=function(){this.parent.notify(ae,this)},v.prototype.toolbarClicked=function(t){var e,n=this;this.parent.enabled&&(e={item:t.item,originalEvent:t.originalEvent,cancel:!1},this.parent.trigger("toolbarClick",e,function(e){n.parent.readonly&&!j.isNullOrUndefined(t.item)||e.cancel||n.parent.notify(G,e)}))},v.prototype.dropDownSelected=function(e){this.parent.notify(pe,{element:e.element,item:e.item,originalEvent:e.event}),this.destroyTooltip()},v.prototype.beforeDropDownItemRender=function(e){!this.parent.readonly&&this.parent.enabled&&this.parent.notify(he,e)},v.prototype.tooltipBeforeRender=function(e){if(!j.isNullOrUndefined(e.target.getAttribute("title"))){var t=void 0;switch(e.target.getAttribute("title")){case"Minimize":t=this.l10n.getConstant("minimize"),e.target.setAttribute("title",t+" (Esc)");break;case"Maximize":t=this.l10n.getConstant("maximize"),e.target.setAttribute("title",t+" (Ctrl+Shift+F)")}}e.target.querySelector(".e-active")&&(e.cancel=!0,j.isNullOrUndefined(e.target.getAttribute("title"))||this.closeTooltip({target:e.target,isTitle:!0}))},v.prototype.dropDownOpen=function(e){var t,n;!(-1<e.element.parentElement.getAttribute("id").indexOf("TableCell"))||j.isNullOrUndefined(e.element.parentElement.querySelector(".e-cell-merge"))||j.isNullOrUndefined(e.element.parentElement.querySelector(".e-cell-horizontal-split"))&&j.isNullOrUndefined(e.element.parentElement.querySelector(".e-cell-vertical-split"))||(t=e.element.querySelectorAll("li"),1===(n=this.parent.inputElement.querySelectorAll(".e-cell-select")).length?(j.addClass([t[0]],"e-disabled"),j.removeClass([t[1],t[2]],"e-disabled")):1<n.length&&(Array.from(n).every(function(e){return e.tagName.toLowerCase()===n[0].tagName.toLowerCase()})?j.removeClass([t[0]],"e-disabled"):j.addClass([t[0]],"e-disabled"),j.addClass([t[1],t[2]],"e-disabled"))),this.parent.notify(Qe,e)},v.prototype.dropDownClose=function(e){this.isEscapeKey||this.parent.notify(We,e),this.isEscapeKey=!1},v.prototype.dropDownBeforeClose=function(e){j.isNullOrUndefined(e.event)||"Escape"!==e.event.key||27!==e.event.keyCode||(this.isEscapeKey=!0,this.parent.notify(En,e))},v.prototype.renderToolbar=function(e){this.setPanel(e.target),this.renderPanel(),this.mode=e.overflowMode,e.rteToolbarObj.toolbarObj=new R.Toolbar({items:e.items,width:"100%",overflowMode:e.overflowMode,beforeCreate:this.toolbarBeforeCreate.bind(this),created:this.toolbarCreated.bind(this),clicked:this.toolbarClicked.bind(this),enablePersistence:e.enablePersistence,enableRtl:e.enableRtl,cssClass:e.cssClass}),e.rteToolbarObj.toolbarObj.isStringTemplate=!0,e.rteToolbarObj.toolbarObj.createElement=this.parent.createElement,e.rteToolbarObj.toolbarObj.appendTo(e.target),this.parent.showTooltip&&"toolbar"===e.type&&(this.tooltip=new I.Tooltip({target:"#"+this.parent.getID()+"_toolbar_wrapper [title]",showTipPointer:!0,openDelay:400,opensOn:"Hover",beforeRender:this.tooltipBeforeRender.bind(this),beforeOpen:this.tooltipBeforeOpen.bind(this),cssClass:this.parent.getCssClass(),windowCollision:!0,position:"BottomCenter"}),this.tooltip.appendTo(e.target.parentElement))},v.prototype.tooltipBeforeOpen=function(e){e.element&&e.element.setAttribute("data-rte-id",this.parent.getID())},v.prototype.renderDropDownButton=function(e){var t,m=this,g=(e.element.classList.add(Gn),t=e.cssClass+" "+Oi+" "+Li,this.parent.inlineMode.enable&&j.Browser.isDevice&&(t=t+" "+Vn),this),f=new A.DropDownButton({items:e.items,iconCss:e.iconCss,cssClass:t,content:e.content,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,select:this.dropDownSelected.bind(this),beforeOpen:function(e){if(g.parent.readonly||!g.parent.enabled)e.cancel=!0;else{if(Hs()&&"keydown"===e.event.type&&m.parent.formatter.editorManager.nodeSelection&&0<m.parent.formatter.editorManager.nodeSelection.get(m.parent.contentModule.getDocument()).rangeCount&&!m.parent.inputElement.contains(m.parent.getRange().startContainer)&&m.parent.notify(We,e),"Markdown"!==g.parent.editorMode){var t=g.parent.getRange().startContainer.parentElement,n=t.closest("table"),i=t.closest("tr");if(!j.isNullOrUndefined(n)&&n.classList.contains("e-dashed-border"))for(var o=0;o<e.element.childNodes.length;o++)e.element.childNodes[o].classList.contains("e-dashed-borders")&&j.addClass([e.element.childNodes[o]],"e-active");if(!j.isNullOrUndefined(n)&&n.classList.contains("e-alternate-rows")&&""!==window.getComputedStyle(i).backgroundColor)for(o=0;o<e.element.childNodes.length;o++)e.element.childNodes[o].classList.contains("e-alternate-rows")&&j.addClass([e.element.childNodes[o]],"e-active");for(var r=g.parent.getRange().startContainer;r!==g.parent.inputElement&&!j.isNullOrUndefined(r.parentElement);){"#text"===r.nodeName&&(r=r.parentElement);var s=window.getComputedStyle(r).textAlign;if(!j.isNullOrUndefined(e.items[0])&&"Alignments"===e.items[0].command){if("Align Left"===e.items[0].text&&"left"===s||"start"===s){j.addClass([e.element.childNodes[0]],"e-active");break}if("Align Center"===e.items[1].text&&"center"===s){j.addClass([e.element.childNodes[1]],"e-active");break}if("Align Right"===e.items[2].text&&"right"===s){j.addClass([e.element.childNodes[2]],"e-active");break}if("Align Justify"===e.items[3].text&&"justify"===s){j.addClass([e.element.childNodes[3]],"e-active");break}}r=r.parentElement}n=t.closest("img"),i=n||t.querySelector("img"),n=(j.isNullOrUndefined(e.items[0])||"Images"!==e.items[0].command||j.isNullOrUndefined(i)||(o=void 0,i.classList.contains("e-imgleft")||i.classList.contains("e-imginline")?o=0:i.classList.contains("e-imgcenter")||i.classList.contains("e-imgbreak")?o=1:i.classList.contains("e-imgright")&&(o=2),j.isNullOrUndefined(e.element.childNodes[o]))||j.addClass([e.element.childNodes[o]],"e-active"),t.closest(".e-video-wrap")),i=n||t.querySelector("video");if(j.isNullOrUndefined(e.items[0])||"Videos"!==e.items[0].command||j.isNullOrUndefined(i)||(o=void 0,i.classList.contains("e-video-left")||i.classList.contains("e-video-inline")?o=0:i.classList.contains("e-video-center")||i.classList.contains("e-video-break")?o=1:i.classList.contains("e-video-right")&&(o=2),j.isNullOrUndefined(e.element.childNodes[o]))||j.addClass([e.element.childNodes[o]],"e-active"),!j.isNullOrUndefined(e.items[0])&&("Formats"===e.items[0].command||"Font"===e.items[0].command))for(var a=[],l=[],d=!1,c=(m.parent.format.types.forEach(function(e){l.push(e.value.toLocaleLowerCase())}),m.parent.fontFamily.items.forEach(function(e){a.push(e.value)}),bl.get(m.parent.contentModule.getDocument(),m.parent.contentModule.getEditPanel(),l,null,a)),o=0;o<e.element.childNodes.length;o++)(p=m.parent.createElement("div")).innerHTML=f.content.trim(),!d&&(""!==p.textContent.trim()&&e.element.childNodes[o].textContent.trim()===p.textContent.trim()||"Formats"===e.items[0].command&&!j.isNullOrUndefined(c.formats)&&m.parent.format.types[o].value.toLowerCase()===c.formats.toLowerCase()&&e.element.childNodes[o].classList.contains(m.parent.format.types[o].cssClass)||"FontName"===e.items[0].subCommand&&"Font"===e.items[0].command&&!j.isNullOrUndefined(c.fontname)&&!j.isNullOrUndefined(m.parent.fontFamily.items[o])&&m.parent.fontFamily.items[o].value.toLowerCase()===c.fontname.toLowerCase()&&e.element.childNodes[o].classList.contains(m.parent.fontFamily.items[o].cssClass)||"FontName"===e.items[0].subCommand&&""===m.parent.fontFamily.items[o].value&&j.isNullOrUndefined(c.fontname)&&e.element.childNodes[o].classList.contains(m.parent.fontFamily.items[o].cssClass)||"FontSize"===e.items[0].subCommand&&"Default"===e.element.childNodes[o].textContent&&"Font Size"===p.textContent&&""===m.parent.fontSize.items[o].value&&!j.isNullOrUndefined(c.fontsize))?e.element.childNodes[o].classList.contains("e-active")||(j.addClass([e.element.childNodes[o]],"e-active"),d=!0):j.removeClass([e.element.childNodes[o]],"e-active")}else if("Markdown"===g.parent.editorMode&&"Formats"===e.items[0].command)for(var p,h=[],d=!1,u=(m.parent.format.types.forEach(function(e){h.push(e.value.toLocaleLowerCase())}),e.element.childNodes),o=0;o<u.length;o++)(p=m.parent.createElement("div")).innerHTML=f.content.trim(),d||""===p.textContent.trim()||u[o].textContent.trim()!==p.textContent.trim()?j.removeClass([u[o]],"e-active"):u[o].classList.contains("e-active")||(j.addClass([u[o]],"e-active"),d=!0);g.parent.notify(Ve,e)}},close:this.dropDownClose.bind(this),beforeClose:this.dropDownBeforeClose.bind(this),open:this.dropDownOpen.bind(this),beforeItemRender:this.beforeDropDownItemRender.bind(this)});return f.isStringTemplate=!0,f.createElement=g.parent.createElement,f.appendTo(e.element),e.element.tabIndex=-1,document.getElementById(f.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),f},v.prototype.mouseOutHandler=function(){var e;j.isNullOrUndefined(this.tooltipTargetEle)&&(e=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument(),this.tooltipTargetEle=e.querySelector("[data-title]")),this.tooltipTargetEle.setAttribute("title",this.tooltipTargetEle.getAttribute("data-title")),this.tooltipTargetEle.removeAttribute("data-title"),j.EventHandler.remove(this.tooltipTargetEle,"mouseout",this.mouseOutHandler)},v.prototype.closeTooltip=function(e){var t;e.isTitle?(this.tooltipTargetEle=e.target,this.tooltipTargetEle.setAttribute("data-title",this.tooltipTargetEle.getAttribute("title")),this.tooltipTargetEle.removeAttribute("title"),j.EventHandler.add(this.tooltipTargetEle,"mouseout",this.mouseOutHandler,this)):(t=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument(),this.tooltipTargetEle=j.closest(e.target,"[data-tooltip-id]"),j.isNullOrUndefined(this.tooltipTargetEle)||!this.parent.showTooltip||j.isNullOrUndefined(t.querySelector(".e-tooltip-wrap"))||(this.destroyTooltip(),this.tooltipTargetEle.setAttribute("data-title",this.tooltipTargetEle.getAttribute("title")),this.tooltipTargetEle.removeAttribute("title"),j.EventHandler.add(this.tooltipTargetEle,"mouseout",this.mouseOutHandler,this)))},v.prototype.renderListDropDown=function(e){var o=this,r=this,t=Oi+" "+Li+(this.parent.inlineMode?" "+Vn:""),n=(t+=" "+("NumberFormatList"===e.itemName?Di:Mi),r.parent.createElement("span",{className:xi})),i=r.parent.createElement("span",{className:e.cssClass}),s=(n.appendChild(i),new A.DropDownButton({items:e.items,cssClass:t,content:e.content,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,select:this.dropDownSelected.bind(this),beforeOpen:function(e){if("safari"===j.Browser.info.name&&r.parent.notify(We,{}),"Markdown"!==r.parent.editorMode){var t=r.parent.getRange().startContainer.parentElement.closest("LI"),t=j.isNullOrUndefined(t)?null:t.parentElement;if(j.isNullOrUndefined(t)||"OL"!==t.nodeName&&"UL"!==t.nodeName)j.addClass([e.element.childNodes[0]],"e-active");else if("UL"===t.nodeName&&"NumberFormatList"===e.items[0].subCommand)j.addClass([e.element.childNodes[0]],"e-active");else if("OL"===t.nodeName&&"BulletFormatList"===e.items[0].subCommand)j.addClass([e.element.childNodes[0]],"e-active");else for(var n="decimal"===(n=t.style.listStyleType.split("-").join("").toLocaleLowerCase())?"number":n,i=0;i<e.element.childNodes.length;i++){if(n===e.element.childNodes[i].innerHTML.split(" ").join("").toLocaleLowerCase()){j.addClass([e.element.childNodes[i]],"e-active");break}if(""===n&&"None"!==e.element.childNodes[i].innerHTML){j.addClass([e.element.childNodes[i]],"e-active");break}}}o.closeTooltip({target:e.event.target}),r.parent.readonly||!r.parent.enabled||(t=e.event?e.event.target:null,r.currentElement=s.element,r.currentDropdown=s,e.event&&"click"===e.event.type&&(t.classList.contains(xi)||t.parentElement.classList.contains(xi)))?e.cancel=!0:r.parent.notify(Ve,e)},close:this.dropDownClose.bind(this),open:this.dropDownOpen.bind(this),beforeItemRender:this.beforeDropDownItemRender.bind(this)}));return s.isStringTemplate=!0,s.createElement=r.parent.createElement,s.appendTo(e.element),e.element.tabIndex=-1,e.element.setAttribute("role","button"),document.getElementById(s.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),1===e.element.childElementCount&&s.element.insertBefore(n,s.element.querySelector(".e-caret")),e.element.tabIndex=-1,s.element.removeAttribute("type"),s.element.onmousedown=function(){"safari"===j.Browser.info.name&&r.parent.notify(Qe,{})},s.element.onkeydown=function(){"safari"===j.Browser.info.name&&r.parent.notify(Qe,{})},s},v.prototype.paletteSelection=function(e,t){var e=e.element.querySelector(".e-control.e-colorpicker"),e=[].slice.call(j.selectAll(".e-tile",e.parentElement)),n=(j.removeClass(e,"e-selected"),t.querySelector("."+Oi).style.borderBottomColor);e.filter(function(e){e.style.backgroundColor===n&&j.addClass([e],"e-selected")})},v.prototype.renderColorPickerDropDown=function(o,e,n,t){var r,i=this,s=this,a=Oi+" "+Li+(this.parent.inlineMode?" "+Vn:""),l=(a=(a+=" "+("backgroundcolor"===e?Fi:ji))+this.parent.getCssClass(!0),s.parent.createElement("span",{className:Hi})),d=s.parent.createElement("span",{className:o.cssClass}),t=j.isNullOrUndefined(t)?s.parent.backgroundColor.default:t,c=(d.style.borderBottomColor="backgroundcolor"===e?t:s.parent.fontColor.default,l.appendChild(d),new A.DropDownButton({target:n.element.parentElement,cssClass:a,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,beforeOpen:function(e){var t,n,i;s.parent.readonly||!s.parent.enabled?e.cancel=!0:(t=e.event?e.event.target:null,s.currentElement=c.element,s.currentDropdown=c,s.paletteSelection(e,s.currentElement),e.event&&"click"===e.event.type&&(t.classList.contains(Hi)||t.parentElement.classList.contains(Hi))?(e.cancel=!0,t=(t.classList.contains(Oi)?t:t.querySelector("."+Oi)).style.borderBottomColor,s.parent.notify(We,{}),n=(r=s.parent.formatter.editorManager.nodeSelection.getRange(s.parent.contentModule.getDocument())).startContainer.parentNode,i=j.closest(r.startContainer.parentNode,"table"),("TD"===r.startContainer.nodeName||"TH"===r.startContainer.nodeName||j.closest(r.startContainer.parentNode,"td,th")||s.parent.iframeSettings.enable&&!p(n.ownerDocument.querySelector("body"),"e-lib"))&&r.collapsed&&"BackgroundColor"===o.subCommand&&(j.closest(i,"."+Sn)||s.parent.iframeSettings.enable)?s.parent.notify(et,{item:{command:o.command,subCommand:o.subCommand,value:t}}):s.parent.notify(Ze,{item:{command:o.command,subCommand:o.subCommand,value:t}})):(n=e.element.querySelector(".e-control.e-colorpicker"),(i=j.getInstance(n,U.ColorPicker)).showButtons=!e.element.querySelector(".e-color-palette"),i.dataBind(),e.element.onclick=function(e){e.target.classList.contains("e-cancel")&&c.toggle()}))},open:function(e){i.setColorPickerContentWidth(n);var t=e.element.querySelector(".e-control.e-colorpicker"),t=e.element.querySelector(".e-color-palette")?t.parentElement.querySelector(".e-palette"):t.parentElement.querySelector("e-handler");t&&t.focus(),i.pickerRefresh(e)},beforeClose:function(e){var t=e.event?e.event.target:null;i.dropDownBeforeClose(e),e.event&&"click"===e.event.type&&(t.classList.contains(Hi)||t.parentElement.classList.contains(Hi))&&(e=(t.classList.contains(Oi)?t:t.querySelector("."+Oi)).style.borderBottomColor,("TD"===(r=s.parent.formatter.editorManager.nodeSelection.getRange(s.parent.contentModule.getDocument())).startContainer.nodeName||"TH"===r.startContainer.nodeName||j.closest(r.startContainer.parentNode,"td,th"))&&r.collapsed?s.parent.notify(et,{item:{command:o.command,subCommand:o.subCommand,value:e}}):s.parent.notify(Ze,{item:{command:o.command,subCommand:o.subCommand,value:e}}))},close:function(){i.isEscapeKey||s.parent.notify(We,{})}}));return c.isStringTemplate=!0,c.createElement=s.parent.createElement,o.element.setAttribute("role","button"),c.appendTo(o.element),document.getElementById(c.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),c.element.insertBefore(l,c.element.querySelector(".e-caret")),o.element.tabIndex=-1,c.element.removeAttribute("type"),c.element.onmousedown=function(){s.parent.notify(Qe,{})},c.element.onkeydown=function(){(!Hs()||Hs()&&s.parent.inputElement.contains(s.parent.getRange().startContainer))&&s.parent.notify(Qe,{})},c},v.prototype.pickerRefresh=function(e){"Picker"===this.parent.backgroundColor.mode&&((e=e.element.parentElement).style.width=(e.offsetWidth+5).toString()+"px",j.getInstance(e,I.Popup).refreshPosition(e),e.style.width=(e.offsetWidth-5).toString()+"px")},v.prototype.setColorPickerContentWidth=function(e){var t,e=e.element.nextSibling;"0px"===e.style.width&&(e.style.width="",t=parseInt(getComputedStyle(e).borderBottomWidth,10),e.style.width=j.formatUnit(e.children[0].offsetWidth+t+t))},v.prototype.renderColorPicker=function(i,t){var o=this,r=this,n=new U.ColorPicker({enableRtl:this.parent.enableRtl,inline:!0,value:null,cssClass:("backgroundcolor"===t?_i:zi)+" "+i.cssClass,created:function(){var e=("backgroundcolor"===t?r.parent.backgroundColor:r.parent.fontColor).default;n.setProperties({value:e})},mode:("backgroundcolor"===t?r.parent.backgroundColor:r.parent.fontColor).mode,modeSwitcher:("backgroundcolor"===t?r.parent.backgroundColor:r.parent.fontColor).modeSwitcher,presetColors:("backgroundcolor"===t?this.parent.backgroundColor:this.parent.fontColor).colorCode,columns:("backgroundcolor"===t?this.parent.backgroundColor:this.parent.fontColor).columns,beforeTileRender:function(e){if(e.element.classList.add(qi),e.element.classList.add(So),!j.isNullOrUndefined(o.parent.cssClass))for(var t=o.parent.getCssClass().split(" "),n=0;n<t.length;n++)""!==t[n].trim()&&e.element.classList.add(t[n]);""===e.value&&e.element.classList.add(To)},change:function(e){var t=e.currentValue.rgba,t=(e.item={command:i.command,subCommand:i.subCommand,value:t},r.parent.notify(We,{}),r.currentElement&&(r.currentElement.querySelector("."+Oi).style.borderBottomColor=t),r.parent.formatter.editorManager.nodeSelection.getRange(r.parent.contentModule.getDocument())),n=j.closest(t.startContainer.parentNode,"table");("TD"===t.startContainer.nodeName||"TH"===t.startContainer.nodeName||"BODY"===t.startContainer.nodeName||t.startContainer.parentNode&&j.closest(t.startContainer.parentNode,"td,th"))&&t.collapsed&&"BackgroundColor"===i.subCommand&&(n&&j.closest(n,"."+Sn)||r.parent.iframeSettings.enable)?r.parent.notify(et,e):r.parent.notify(Ze,e),r.currentDropdown&&r.currentDropdown.toggle()},beforeModeSwitch:function(e){""===n.value&&n.setProperties({value:"Picker"===e.mode?"#008000ff":""},!0),n.showButtons="Palette"!==e.mode}});return n.isStringTemplate=!0,n.createElement=this.parent.createElement,n.appendTo(document.getElementById(i.target)),n},v.prototype.renderPanel=function(){this.getPanel().classList.add(xn)},v.prototype.getPanel=function(){return this.toolbarPanel},v.prototype.setPanel=function(e){this.toolbarPanel=e},v.prototype.destroy=function(){if(!this.isDestroyed){if(this.tooltip&&!this.tooltip.isDestroyed){this.tooltip.destroy();for(var e=document.querySelectorAll('[data-rte-id="'+this.parent.getID()+'"]'),t=0;t<e.length;t++){var n=e[t];this.parent.getID()===n.getAttribute("data-rte-id")&&j.detach(n)}}this.unWireEvent(),this.mode=null,this.toolbarPanel=null,this.currentElement=null,this.currentDropdown=null,this.tooltip=null,this.tooltipTargetEle=null,this.isDestroyed=!0}};var yl=v;function v(e,t){this.isEscapeKey=!1,this.parent=e,this.isDestroyed=!1,t&&(this.l10n=t.getService("rteLocale")),this.wireEvent()}y.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(Ee,this.linkDialog,this),this.parent.on(Kt,this.showDialog,this),this.parent.on(Gt,this.closeDialog,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(Re,this.showLinkQuickToolbar,this),this.parent.on(ft,this.clearDialogObj,this),this.parent.on(be,this.onToolbarAction,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(Se,this.removeLink,this),this.parent.on(Te,this.editLink,this),this.parent.on(Oe,this.openLink,this),this.parent.on(Ye,this.editAreaClickHandler,this),this.parent.on(on,this.setCssClass,this),this.parent.on(o,this.destroy,this))},y.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"OpenLink":this.parent.notify(Oe,e);break;case"EditLink":this.parent.notify(Te,e);break;case"RemoveLink":this.parent.notify(Se,e)}},y.prototype.removeEventListener=function(){this.parent.off(Ee,this.linkDialog),this.parent.off(Kt,this.showDialog),this.parent.off(Gt,this.closeDialog),this.parent.off(h,this.onKeyDown),this.parent.off(Re,this.showLinkQuickToolbar),this.parent.off(ft,this.clearDialogObj),this.parent.off(be,this.onToolbarAction),this.parent.off(Se,this.removeLink),this.parent.off(K,this.onIframeMouseDown),this.parent.off(Te,this.editLink),this.parent.off(Oe,this.openLink),this.parent.off(Ye,this.editAreaClickHandler),this.parent.off(on,this.setCssClass),this.parent.off(o,this.destroy),j.isNullOrUndefined(this.contentModule)||(this.parent.element.ownerDocument.removeEventListener("mousedown",this.mouseDown),this.mouseDown=null)},y.prototype.onIframeMouseDown=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},y.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},y.prototype.setCssClass=function(e){this.updateCss(this.checkBoxObj,e),this.updateCss(this.dialogObj,e)},y.prototype.showLinkQuickToolbar=function(e){var t,n,i,o,r,s,a,l,d,c,p=this;j.isNullOrUndefined(e.args)||"enter"===e.args.action||"space"===e.args.action||"Links"!==e.type||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.linkQTBar)||(this.quickToolObj=this.parent.quickToolbarModule,t=this.parent.element.getBoundingClientRect().top,n=this.parent.element.getBoundingClientRect().left,i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),[].forEach.call(e.elements,function(e,t){0===t&&(o="#text"===e.nodeName?e.parentNode:e)}),e.isNotify?(a=this.parent.toolbarModule.getToolbarElement(),r=o.getBoundingClientRect().top,c=o.getBoundingClientRect().left,s=r-t,a=a?a.offsetHeight+this.parent.toolbarModule.getExpandTBarPopHeight():0,l=this.parent.iframeSettings.enable?n+c:o.getBoundingClientRect().left,d=window.pageYOffset+(this.parent.iframeSettings.enable?t+a+r:t+s),this.linkQTPopupTime=setTimeout(function(){p.showLinkPopup(l,d,i)},400)):(c=void 0,c=e.args.touches?e.args.changedTouches[0]:e.args,l=this.parent.iframeSettings.enable?window.pageXOffset+n+c.clientX:c.pageX,d=this.parent.iframeSettings.enable?window.pageYOffset+t+c.clientY:c.pageY,this.showLinkPopup(l,d,i)),this.quickToolObj.linkQTBar&&this.quickToolObj.linkQTBar.showPopup(l,d,i.endContainer,"link"))},y.prototype.showLinkPopup=function(e,t,n){this.quickToolObj.linkQTBar&&this.quickToolObj.linkQTBar.showPopup(e,t,n.endContainer,"link")},y.prototype.hideLinkQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.linkQTBar&&document.body.contains(this.quickToolObj.linkQTBar.element)&&this.quickToolObj.linkQTBar.hidePopup()},y.prototype.editAreaClickHandler=function(e){var t,n,i,o;this.parent.readonly?this.hideLinkQuickToolbar():(t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick,i=/Version\/\d+\.\d+.*Safari/.test(navigator.userAgent)&&!/Chrome|Edg|Firefox/.test(navigator.userAgent)&&3===t.which,2===t.which||n&&1===t.which||!n&&3===t.which||"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.linkQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,n=t.target,n=this.getAnchorNode([n]),this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),o=this.quickToolObj.linkQTBar.element.classList.contains("e-rte-pop"),"A"===n.nodeName&&0<n.childNodes.length&&"IMG"!==n.childNodes[0].nodeName&&"IMG"!==e.args.target.nodeName&&!j.isNullOrUndefined(j.closest(this.parent.getRange().startContainer.parentElement,"A"))&&(!j.isNullOrUndefined(j.closest(this.parent.getRange().endContainer.parentElement,"A"))||i)?o||(!1===e.args.ctrlKey?this.showLinkQuickToolbar({args:t,isNotify:!1,type:"Links",elements:[t.target]}):(i=(n=this.parent.formatter.editorManager.nodeSelection).getRange(this.parent.contentModule.getDocument()),o={args:{item:{subCommand:"OpenLink",command:"Links",name:""},originalEvent:e.args},selectNode:n.getNodeCollection(i),selectParent:n.getParentNodeCollection(i),selection:n.save(i,this.parent.contentModule.getDocument())},this.parent.notify(Oe,o))):this.hideLinkQuickToolbar()))},y.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"insert-link":this.openDialog(!0,e),t.preventDefault()}},y.prototype.openDialog=function(e,t){var n,i,o;e||this.parent.contentModule.getEditPanel().focus(),"HTML"===this.parent.editorMode?(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),i=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i),e={args:t?t.args:{item:{command:"Links",subCommand:"CreateLink"},originalEvent:void 0,name:e?null:"showDialog"},selectNode:o,selection:n,selectParent:i},this.linkDialog(e)):(o=this.parent.contentModule.getEditPanel(),this.parent.formatter.editorManager.markdownSelection.save(o.selectionStart,o.selectionEnd),this.linkDialog({args:{item:{command:"Links",subCommand:"Link"},originalEvent:t&&t.args},member:"link",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),module:"Markdown",name:"insertLink"}))},y.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},y.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},y.prototype.clearDialogObj=function(){this.dialogObj&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},y.prototype.linkDialog=function(e,t){var n,i,o,r,s,a,l,d,c,p,h=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):(n="HTML"===this.parent.editorMode?e.selection.getRange(this.parent.contentModule.getDocument()).toString():e.text,!j.isNullOrUndefined(t)&&(!j.isNullOrUndefined(e.selectParent)&&1<e.selectParent.length||!j.isNullOrUndefined(e.selectNode)&&1<e.selectNode.length)&&(t.text=n),"HTML"===this.parent.editorMode&&(this.hasAnchorNodePresent(e.selectParent)||this.hasAnchorNodePresent(e.selectNode))&&j.isNullOrUndefined(t)?this.editLink(e):(c=this.i10n.getConstant("linkWebUrl"),r=this.i10n.getConstant("linkText"),l=this.i10n.getConstant("linkTooltipLabel"),o=this.i10n.getConstant("linkurl"),s=this.i10n.getConstant("textPlaceholder"),a=this.i10n.getConstant("linkTitle"),i=this.parent.createElement("div",{className:"e-rte-link-dialog"+this.parent.getCssClass(!0),id:this.rteID+"_rtelink"}),this.parent.rootContainer.appendChild(i),p=this.parent.createElement("div",{className:"e-rte-linkcontent"+this.parent.getCssClass(!0),id:this.rteID+"_linkContent"}),l="HTML"===this.parent.editorMode?"<label>"+l+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" spellcheck="false" placeholder = "'+a+'"aria-label="'+this.i10n.getConstant("linkTitle")+'" class="e-input e-rte-linkTitle'+this.parent.getCssClass(!0)+'"></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="checkbox" class="e-rte-linkTarget'+this.parent.getCssClass(!0)+'"  data-role ="none"></div>':"",a=xr('<div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+c+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" spellcheck="false" placeholder="'+o+'"aria-label="'+this.i10n.getConstant("linkWebUrl")+'" class="e-input e-rte-linkurl'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+r+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"> <input type="text" data-role ="none" spellcheck="false" class="e-input e-rte-linkText'+this.parent.getCssClass(!0)+'"aria-label="'+this.i10n.getConstant("linkText")+'" placeholder="'+s+'"></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'">'+l),p.appendChild(a),c=p.querySelector(".e-rte-linkTarget"),o=p.querySelector(".e-rte-linkurl"),r=p.querySelector(".e-rte-linkText"),s=p.querySelector(".e-rte-linkTitle"),l=this.i10n.getConstant("linkOpenInNewWindow"),this.checkBoxObj=new P.CheckBox({label:l,checked:!0,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass()}),this.checkBoxObj.isStringTemplate=!0,this.checkBoxObj.createElement=this.parent.createElement,this.checkBoxObj.appendTo(c),a=this.i10n.getConstant("dialogInsert"),l=this.i10n.getConstant("dialogCancel"),d=e.selection,c={selfLink:this,selection:e.selection,selectParent:e.selectParent,args:e.args},p={header:this.i10n.getConstant("linkHeader"),content:p,cssClass:Oi+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"310px",isModal:j.Browser.isDevice,buttons:[{click:this.insertlink.bind(c),buttonModel:{content:a,cssClass:"e-flat e-insertLink"+this.parent.getCssClass(!0),isPrimary:!0}},{click:this.cancelDialog.bind(c),buttonModel:{cssClass:"e-flat"+this.parent.getCssClass(!0),content:l}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){h.parent.isBlur=!1,e&&e.event.returnValue&&("HTML"===h.parent.editorMode?d.restore():h.parent.formatter.editorManager.markdownSelection.restore(h.parent.contentModule.getEditPanel())),h.dialogObj.destroy(),j.detach(h.dialogObj.element);e=h.dialogObj;h.dialogRenderObj.close(e),h.dialogObj=null}},this.dialogObj=this.dialogRenderObj.render(p),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(i),i.style.maxHeight="inherit",j.isNullOrUndefined(this.dialogObj)||(j.isNullOrUndefined(t)||(o.value=t.url,r.value=t.text,s.value=t.title,t.target?this.checkBoxObj.checked=!0:this.checkBoxObj.checked=!1,this.dialogObj.header=t.header,this.dialogObj.element.querySelector(".e-insertLink").textContent=t.btnText),this.checkUrl(!1),("HTML"===this.parent.editorMode&&j.isNullOrUndefined(t)&&(!j.isNullOrUndefined(n)&&""!==n&&0===e.selection.range.startOffset||e.selection.range.startOffset!==e.selection.range.endOffset)||"Markdown"===e.module)&&(r.value=n),this.parent.element.ownerDocument.addEventListener("mousedown",this.mouseDown),this.quickToolObj&&(this.hideLinkQuickToolbar(),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())))},y.prototype.hasAnchorNodePresent=function(e){return!j.isNullOrUndefined(e)&&0<e.length&&e.some(function(e){return e&&e.classList&&e.classList.contains("e-rte-anchor")})},y.prototype.insertlink=function(e){var t,n,i,o=this.selfLink.dialogObj.element,r=o.querySelector(".e-rte-linkurl").value.trim(),s=o.querySelector(".e-rte-linkText").value,o=("HTML"===this.selfLink.parent.editorMode&&(t=o.querySelector(".e-rte-linkTitle").value),this.selfLink.checkBoxObj.checked?"_blank":null),a=this.selfLink.checkBoxObj.checked?this.selfLink.i10n.getConstant("linkAriaLabel"):null;""===(r="Markdown"===this.selfLink.parent.editorMode&&""===r?"http://":r)?this.selfLink.checkUrl(!0):(s="Markdown"===this.selfLink.parent.editorMode?""!==s.trim()?s:"":""===s.trim()?r:s,this.selfLink.isUrl(r)?this.selfLink.checkUrl(!1):this.selfLink.parent.enableAutoUrl||(r=-1<r.indexOf("http")?r:"http://"+r),"HTML"===(n=this.selfLink).parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+n.parent.contentModule.getPanel().id+"']"))&&(n.parent.contentModule.getEditPanel().focus(),j.Browser.isIE&&n.parent.iframeSettings.enable&&this.selection.restore(),i=n.parent.formatter.editorManager.nodeSelection.getRange(n.parent.contentModule.getDocument()),this.selection=n.parent.formatter.editorManager.nodeSelection.save(i,n.parent.contentModule.getDocument()),this.selectParent=n.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i)),i={url:r,text:s,title:t,target:o,ariaLabel:a,selection:this.selection,selectParent:this.selectParent},document.body.contains(n.dialogObj.element)&&this.selfLink.dialogObj.hide({returnValue:!1}),null===this.selfLink.dialogObj&&(Rs()&&n.parent.iframeSettings.enable&&j.select("iframe",n.parent.element).contentWindow.focus(),"HTML"===n.parent.editorMode&&this.selection.restore(),0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),s=j.isNullOrUndefined(this.args)||"KeyK"!==this.args.code?this.args:(r=this.args,j.extend(this.args,{item:{command:"Links",subCommand:"CreateLink"},originalEvent:r},!0),{item:{command:"Links",subCommand:"CreateLink"},originalEvent:r}),this.selfLink.parent.formatter.process(this.selfLink.parent,s,!j.isNullOrUndefined(this.args)&&this.args.originalEvent,i),this.selfLink.parent.contentModule.getEditPanel().focus()))},y.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},y.prototype.checkUrl=function(e){var t=this.dialogObj.element.querySelector(".e-rte-linkurl");e?(j.addClass([t],"e-error"),t.setSelectionRange(0,t.value.length),t.focus()):j.removeClass([t],"e-error")},y.prototype.removeLink=function(e){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var t=this.getAnchorNode(e.selectParent);this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,selectParent:e.selectParent,selection:e.selection,text:t.innerText,subCommand:e.args.item.subCommand}),(Rs()&&this.parent.iframeSettings.enable?j.select("iframe",this.parent.element).contentWindow:this.parent.contentModule.getEditPanel()).focus(),this.hideLinkQuickToolbar()},y.prototype.openLink=function(e){var t,n,i=this.getAnchorNode(e.selectParent);!i.classList.contains("e-rte-anchor")&&"A"!==i.tagName||(t=this.parent.htmlEditorModule.sanitizeHelper(i.outerHTML),(n=document.createElement("div")).innerHTML=t,this.parent.formatter.process(this.parent,e.args,e.args,{url:n.firstChild.href,text:i.innerText,target:""===i.target?"_self":"_blank",selectNode:e.selectNode,subCommand:e.args.item.subCommand}),n.remove())},y.prototype.getAnchorNode=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],i=j.closest(i,"a");if(i)return i}return e[0]},y.prototype.editLink=function(e){var t=this.getAnchorNode(e.selectNode),n=this.getAnchorNode(e.selectParent);!(n="A"===t.nodeName?t:n).classList.contains("e-rte-anchor")&&"A"!==n.tagName||(t=this.i10n.getConstant("dialogUpdate"),n={url:n.getAttribute("href"),text:n.innerText,title:n.title,target:n.target,header:this.i10n.getConstant("editLink"),btnText:t},this.linkDialog(e,n))},y.prototype.cancelDialog=function(e){var t,n;this.selfLink.parent.isBlur=!1,this.selfLink.dialogObj.hide({returnValue:!0}),Rs()?this.selection.restore():(t=window.scrollX,n=window.scrollY,this.selfLink.parent.contentModule.getEditPanel().focus(),window.scrollTo(t,n))},y.prototype.onDocumentClick=function(e){var t=e.target;!j.isNullOrUndefined(this.dialogObj)&&(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||(this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)||this.parent.inlineMode.enable&&!j.closest(t,"#"+this.dialogObj.element.id))&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_CreateLink")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_CreateLink"))&&(this.parent.notify(un,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,wr(this.parent.element,"focusout"))},y.prototype.destroy=function(){this.isDestroyed||(j.isNullOrUndefined(this.linkQTPopupTime)||(clearTimeout(this.linkQTPopupTime),this.linkQTPopupTime=null),this.removeEventListener(),this.isDestroyed=!0)},y.prototype.getModuleName=function(){return"link"};var Cl=y;function y(e,t){this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.addEventListener(),this.serviceLocator=t,this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.isDestroyed=!1,this.mouseDown=this.onDocumentClick.bind(this)}C.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(h,this.onKeyDown,this),this.parent.on(ie,this.onKeyUp,this),this.parent.on(De,this.insertImage,this),this.parent.on(Xt,this.showDialog,this),this.parent.on($t,this.closeDialog,this),this.parent.on(ve,this.onWindowResize,this),this.parent.on(Re,this.showImageQuickToolbar,this),this.parent.on(ft,this.clearDialogObj,this),this.parent.on(me,this.onToolbarAction,this),this.parent.on(je,this.caption,this),this.parent.on(Ue,this.deleteImg,this),this.parent.on(Ae,this.insertImgLink,this),this.parent.on(Ie,this.insertAltText,this),this.parent.on(Ye,this.editAreaClickHandler,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(Fe,this.imageSize,this),this.parent.on(pe,this.alignmentSelect,this),this.parent.on(n,this.afterRender,this),this.parent.on(_t,this.afterRender,this),this.parent.on(st,this.imagePaste,this),this.parent.on(on,this.setCssClass,this),this.parent.on(o,this.destroy,this))},C.prototype.removeEventListener=function(){var e;this.parent.isDestroyed||(this.parent.off(h,this.onKeyDown),this.parent.off(ie,this.onKeyUp),this.parent.off(ve,this.onWindowResize),this.parent.off(De,this.insertImage),this.parent.off(Xt,this.showDialog),this.parent.off($t,this.closeDialog),this.parent.off(Re,this.showImageQuickToolbar),this.parent.off(ft,this.clearDialogObj),this.parent.off(je,this.caption),this.parent.off(me,this.onToolbarAction),this.parent.off(Ue,this.deleteImg),this.parent.off(Ae,this.insertImgLink),this.parent.off(Ie,this.insertAltText),this.parent.off(Ye,this.editAreaClickHandler),this.parent.off(K,this.onIframeMouseDown),this.parent.off(Fe,this.imageSize),this.parent.off(pe,this.alignmentSelect),this.parent.off(n,this.afterRender),this.parent.off(_t,this.afterRender),this.parent.off(st,this.imagePaste),this.parent.off(on,this.setCssClass),this.parent.off(o,this.destroy),(e=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement).removeEventListener("drop",this.drop,!0),e.removeEventListener("dragstart",this.drag,!0),e.removeEventListener("dragenter",this.enter,!0),e.removeEventListener("dragover",this.start,!0),this.drop=null,this.drag=null,this.enter=null,this.start=null,j.isNullOrUndefined(this.contentModule))||(j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.imageClick),this.parent.formatter.editorManager.observer.off(pt,this.undoStack),this.parent.insertImageSettings.resize&&(j.EventHandler.remove(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null,j.EventHandler.remove(this.contentModule.getEditPanel(),"cut",this.onCutHandler),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing)))},C.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},C.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)||j.removeClass([this.popupObj.element],e.oldCssClass),j.addClass([this.popupObj.element],e.cssClass)),this.updateCss(this.checkBoxObj,e),this.updateCss(this.widthNum,e),this.updateCss(this.heightNum,e),this.updateCss(this.uploadObj,e),this.updateCss(this.dialogObj,e)},C.prototype.onIframeMouseDown=function(e){e=e.target;this.dialogObj&&this.dialogObj.hide({returnValue:!0}),(j.isNullOrUndefined(this.parent.currentTarget)||"IMG"!==this.parent.currentTarget.nodeName)&&this.imgEle&&this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&this.cancelResizeAction(),this.contentModule.getEditPanel().querySelector(".e-img-resize")&&"IMG"===this.parent.currentTarget.nodeName&&!j.isNullOrUndefined(this.prevSelectedImgEle)&&this.prevSelectedImgEle!==e&&(this.prevSelectedImgEle.style.outline="")},C.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),j.EventHandler.add(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.imageClick,this),this.parent.insertImageSettings.resize&&(j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick),j.EventHandler.add(this.contentModule.getEditPanel(),"cut",this.onCutHandler,this));var e=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement;e.addEventListener("drop",this.drop,!0),e.addEventListener("dragstart",this.drag,!0),e.addEventListener("dragenter",this.enter,!0),e.addEventListener("dragover",this.start,!0)},C.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text,o=(n.appendChild(i.cloneNode(!0)),n.querySelectorAll("img"));if(n.querySelector(".e-img-resize")&&0<o.length){for(var r=0;r<o.length;r++)o[r].style.outline="";j.detach(n.querySelector(".e-img-resize"));for(var s=n.cloneNode(!0),a=document.createDocumentFragment();s.firstChild;)a.appendChild(s.firstChild);this.parent.formatter.getUndoRedoStack()[t].text=a}}},C.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.imgEle.parentElement&&(this.imgEle.parentElement.style.cursor="auto"),j.Browser.isDevice&&j.removeClass([e.target.parentElement],"e-mob-span"),this.parent.trigger(Ne,{event:e,requestType:"images"}),this.parent.formatter.editorManager.observer.on(pt,this.undoStack,this),this.parent.formatter.saveData()},C.prototype.resizeStart=function(e,t){var n=this;if(!this.parent.readonly){var i=t||e.target;if(this.prevSelectedImgEle=this.imgEle,"IMG"===i.tagName&&(this.parent.preventDefaultResize(e),t=i,this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&j.detach(this.imgResizeDiv),this.imageResize(t)),i.classList.contains("e-rte-imageboxmark")){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.imageQTBar.hidePopup();for(var o=["topLeft","topRight","botLeft","botRight"],r=0;r<o.length;r++){var s=o[r];if(i.classList.contains("e-rte-"+s)){this.resizeBtnStat[s]=!0,this.currentResizeHandler=s,this.aspectRatio=this.findAspectRatio(this.imgEle);break}}j.Browser.isDevice&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&!this.imgResizeDiv.classList.contains("e-mob-span")?j.addClass([this.imgResizeDiv],"e-mob-span"):this.parent.trigger(ye,{event:e,requestType:"images"},function(e){e.cancel&&n.cancelResizeAction()}),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing,this),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd,this)}}},C.prototype.imageClick=function(e){j.Browser.isDevice&&("IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName||"IMG"===e.target.tagName?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),"IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName&&e.preventDefault()},C.prototype.onCutHandler=function(){this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&this.cancelResizeAction()},C.prototype.imageResize=function(e){this.resizeBtnInit(),this.imgEle=e,j.addClass([this.imgEle],"e-resize"),this.imgResizeDiv=this.parent.createElement("span",{className:"e-img-resize"+this.parent.getCssClass(!0),id:this.rteID+"_imgResize"}),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-topLeft"+this.parent.getCssClass(!0),styles:"cursor: nwse-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-topRight"+this.parent.getCssClass(!0),styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-botLeft"+this.parent.getCssClass(!0),styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-botRight"+this.parent.getCssClass(!0),styles:"cursor: nwse-resize"})),j.Browser.isDevice&&j.addClass([this.imgResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.imgResizePos(e,this.imgResizeDiv),this.resizeImgDupPos(e),this.contentModule.getEditPanel().appendChild(this.imgResizeDiv),"auto"===this.parent.element.style.height&&this.imgResizePos(e,this.imgResizeDiv)},C.prototype.getPointX=function(e){return this.parent.iframeSettings.enable?(e.touches&&e.touches.length?e.touches[0]:e).screenX:(e.touches&&e.touches.length?e.touches[0]:e).pageX},C.prototype.getPointY=function(e){return this.parent.iframeSettings.enable?(e.touches&&e.touches.length?e.touches[0]:e).screenY:(e.touches&&e.touches.length?e.touches[0]:e).pageY},C.prototype.imgResizePos=function(e,t){var n=this.calcPos(e),i=n.top,n=n.left,o=e.getBoundingClientRect().width,r=e.getBoundingClientRect().height,e=j.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,s=j.Browser.isDevice?0:2;t.querySelector(".e-rte-botLeft").style.left=n-e+"px",t.querySelector(".e-rte-botLeft").style.top=r-e+i+"px",t.querySelector(".e-rte-botRight").style.left=o-(e-s)+n+"px",t.querySelector(".e-rte-botRight").style.top=r-e+i+"px",t.querySelector(".e-rte-topRight").style.left=o-(e-s)+n+"px",t.querySelector(".e-rte-topRight").style.top=i-e+"px",t.querySelector(".e-rte-topLeft").style.left=n-e+"px",t.querySelector(".e-rte-topLeft").style.top=i-e+"px"},C.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,o=(e.offsetParent&&(e.offsetParent.classList.contains("e-img-caption")||-1<["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName))?j.closest(e,"#"+this.parent.getID()+"_rte-edit-view"):e.offsetParent)||i.documentElement;o&&(o===i.body||o===i.documentElement)&&"static"===o.style.position;)o=o.parentNode;return o&&o!==e&&1===o.nodeType&&(n=o.getBoundingClientRect()),e.offsetParent&&e.offsetParent.classList.contains("e-img-caption")?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},C.prototype.setAspectRatio=function(e,t,n){var i,o,r,s;j.isNullOrUndefined(e.width)||(i=e.width,o=e.height,r=this.parent.insertImageSettings.resizeByPercent?"%":"px",s=""===e.style.width&&""===e.style.height,i===o||s?(this.setImageWidth(e,t,r),this.parent.insertImageSettings.resizeByPercent?this.removeImageHeight(e):this.setImageHeight(e,n,r)):""!==e.style.width&&""!==e.style.height?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):(this.setImageWidth(e,t,r),this.setImageHeight(e,n,r)):""!==e.style.width?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):this.setImageWidth(e,t,r):""!==e.style.height&&(this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):this.setImageHeight(e,n,r)))},C.prototype.setImageWidth=function(e,t,n){e.style.width=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("width",t.toString())},C.prototype.setImageHeight=function(e,t,n){e.style.height=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("height",t.toString())},C.prototype.removeImageHeight=function(e){e.style.height="",e.removeAttribute("height")},C.prototype.getImageDimension=function(e,t){return this.parent.insertImageSettings.resizeByPercent?(t=t.parentElement,this.pixToPerc(e,t)):e},C.prototype.adjustDimensionsByAspectRatio=function(e,t,n,i){return i?(t=Math.round(e/n),e=Math.round(t*n)):(e=Math.round(t*n),t=Math.round(e/n)),{width:e,height:t}},C.prototype.pixToPerc=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},C.prototype.imgDupMouseMove=function(t,n,e){var i=this;this.parent.trigger(Ce,{event:e,requestType:"images"},function(e){e.cancel?i.cancelResizeAction():parseInt(i.parent.insertImageSettings.minWidth,10)>=parseInt(t,10)||parseInt(i.parent.getInsertImgMaxWidth(),10)<=parseInt(t,10)&&j.isNullOrUndefined(i.imgEle.style.width)||!i.parent.insertImageSettings.resizeByPercent&&(parseInt(i.parent.insertImageSettings.minHeight,10)>=parseInt(n,10)||parseInt(i.parent.insertImageSettings.maxHeight,10)<=parseInt(n,10))||(i.imgEle.parentElement.style.cursor="pointer",i.setAspectRatio(i.imgEle,parseInt(t,10),parseInt(n,10)),i.resizeImgDupPos(i.imgEle),i.imgResizePos(i.imgEle,i.imgResizeDiv))})},C.prototype.resizing=function(e){var t,n,i,o,r,s,a,l,d,c;this.parent?(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)&&(this.parent.iframeSettings.enable?(i=this.getResizeFactor(this.currentResizeHandler),n=this.getPointX(e),o=this.getPointY(e),s=this.imgEle.clientWidth,a=this.imgEle.clientHeight,c=n-this.pageX,t=o-this.pageY,l=c*i[0]+s,d=t*i[1]+a,c=this.adjustDimensions(l,d,c,t,this.aspectRatio),this.pageX=n,this.pageY=o,this.imgDupMouseMove(c.width+"px",c.height+"px",e),this.parent.autoResize()):(t=this.getPointX(e),n=this.getPointY(e),i=this.getResizeFactor(this.currentResizeHandler),o=t-this.pageX,r=n-this.pageY,s=this.imgEle.clientWidth,a=this.imgEle.clientHeight,l=o*i[0]+s,d=r*i[1]+a,c=this.adjustDimensions(l,d,o,r,this.aspectRatio),this.pageX=t,this.pageY=n,this.imgDupMouseMove(c.width+"px",c.height+"px",e))):this.cancelResizeAction()},C.prototype.adjustDimensions=function(e,t,n,i,o){return this.adjustDimensionsByAspectRatio(e=e<16?16:e,t=t<16?16:t,o,t<e)},C.prototype.getResizeFactor=function(e){return Ms[e]},C.prototype.findAspectRatio=function(e){return e.clientWidth/e.clientHeight},C.prototype.cancelResizeAction=function(){j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.imgEle&&this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&(j.detach(this.imgResizeDiv),this.imgEle.style.outline="",this.imgResizeDiv=null,this.pageX=null,this.pageY=null,this.currentResizeHandler=null,this.aspectRatio=null)},C.prototype.resizeImgDupPos=function(e){this.imgDupPos={width:""!==e.style.width&&this.parent.insertImageSettings&&!this.parent.insertImageSettings.resizeByPercent?this.imgEle.style.width:e.width+"px",height:""!==e.style.height?this.imgEle.style.height:e.height+"px"}},C.prototype.resizeBtnInit=function(){return this.aspectRatio=null,this.currentResizeHandler=null,this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},C.prototype.onToolbarAction=function(e){switch(Rs()&&this.parent.notify(We,{}),e.args.item.subCommand){case"Replace":this.parent.fileManagerSettings.enable?this.parent.notify(qt,e):this.parent.notify(De,e);break;case"Caption":this.parent.notify(je,e);break;case"InsertLink":this.parent.notify(Ae,e);break;case"AltText":this.parent.notify(Ie,e);break;case"Remove":this.parent.notify(Ue,e);break;case"Dimension":this.parent.notify(Fe,e);break;case"OpenImageLink":this.openImgLink(e);break;case"EditImageLink":this.editImgLink(e);break;case"RemoveImageLink":this.removeImgLink(e)}},C.prototype.openImgLink=function(e){var t=this.parent.htmlEditorModule.sanitizeHelper(e.selectParent[0].parentNode.outerHTML),n=document.createElement("div"),t=(n.innerHTML=t,""===e.selectParent[0].parentNode.target?"_self":"_blank");this.parent.formatter.process(this.parent,e.args,e.args,{url:n.firstChild.href,target:t,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),n.remove()},C.prototype.editImgLink=function(e){var t=e.selectParent[0].parentNode,n=this.i10n.getConstant("dialogUpdate"),t={url:t.href,target:t.target,header:"Edit Link",btnText:n};this.insertImgLink(e,t)},C.prototype.removeImgLink=function(e){j.Browser.isIE&&this.contentModule.getEditPanel().focus(),e.selection.restore();var t=!(!this.contentModule.getEditPanel().contains(this.captionEle)||!j.select("a",this.captionEle)),n=t?[this.captionEle]:[e.selectNode[0].parentElement];this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:e.selectNode[0],selectParent:n,selection:e.selection,subCommand:e.args.item.subCommand}),this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.isNullOrUndefined(e.selectParent)||j.removeClass([e.selectParent[0]],"e-img-focus")),t&&j.select(".e-img-inner",this.captionEle).focus()},C.prototype.onKeyDown=function(e){var t,n,i,o,r,s,a,l=e.args;this.deletedImg=[];if(!(r="HTML"===this.parent.editorMode?(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===t.endContainer&&t.startOffset===t.endOffset:r)&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(l.which)<0)for(var d=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),c=0;c<d.length;c++)"IMG"===d[c].nodeName&&this.deletedImg.push(d[c]);switch("HTML"===this.parent.editorMode&&(8===l.which&&"Backspace"===l.code||46===l.which&&"Delete"===l.code)&&(e=t.startContainer===t.endContainer&&t.startOffset===t.endOffset,8===l.which&&"Backspace"===l.code&&e?this.checkImageBack(t):46===l.which&&"Delete"===l.code&&e&&this.checkImageDel(t)),j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===l.code||(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),o=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),l.ctrlKey)||!l.key||1!==l.key.length&&"enter"!==l.action||j.isNullOrUndefined(o[0])||"IMG"!==o[0].tagName||!o[0].parentElement||(this.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),j.removeClass([o[0]],"e-img-focus"),this.quickToolObj&&this.quickToolObj.imageQTBar&&this.quickToolObj.imageQTBar.hidePopup()),!l.ctrlKey||89!==l.keyCode&&90!==l.keyCode||"Markdown"!==this.parent.editorMode&&this.undoStack({subCommand:90===l.keyCode?"undo":"redo"}),8!==l.keyCode&&46!==l.keyCode||(i&&i[0]&&"IMG"===i[0].nodeName&&i.length<1&&(j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),l.preventDefault(),this.deleteImg({selectNode:i,selection:n,selectParent:o,args:{item:{command:"Images",subCommand:"Remove"},originalEvent:l}},l.keyCode)),this.parent.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle()),"Backspace"===l.code&&(l.action="backspace"),l.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":"Markdown"!==this.parent.editorMode&&(3===t.startContainer.nodeType?"Backspace"===l.code?t.startContainer.previousElementSibling&&0===t.startOffset&&t.startContainer.previousElementSibling.classList.contains(ui)&&t.startContainer.previousElementSibling.classList.contains(gi)&&j.detach(t.startContainer.previousElementSibling):t.startContainer.nextElementSibling&&t.endContainer.textContent.length===t.endOffset&&t.startContainer.nextElementSibling.classList.contains(ui)&&t.startContainer.nextElementSibling.classList.contains(gi)&&j.detach(t.startContainer.nextElementSibling):1===t.startContainer.nodeType&&(t.startContainer.querySelector("."+ui+"."+gi)?j.detach(t.startContainer.querySelector("."+ui+"."+gi)):t.startContainer.querySelector("."+ui+"."+si)?j.detach(t.startContainer.querySelector("."+ui+"."+si)):t.startContainer.classList.contains("e-img-wrap")&&j.closest(t.startContainer,"."+ui)&&(s=t.startContainer.parentElement.parentElement,j.detach(j.closest(t.startContainer,"."+ui)),s)&&""===s.textContent.trim()&&((a=this.parent.createElement("br")).classList.add("e-rte-image-remove-focus"),s.appendChild(a))));break;case"insert-image":j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),this.openDialog(!0,l,n,i,o),l.preventDefault()}l.ctrlKey&&"a"===l.key&&this.handleSelectAll()},C.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll("."+po);j.removeClass(e,po)},C.prototype.openDialog=function(e,t,n,i,o){var r,s,i=e||j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=n,s=i,o):(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n));"HTML"===this.parent.editorMode?this.insertImage({args:{item:{command:"Images",subCommand:"Image"},originalEvent:t,name:e?null:"showDialog"},selectNode:s,selection:r,selectParent:i}):this.insertImage({args:{item:{command:"Images",subCommand:"Image"},originalEvent:t,name:e?null:"showDialog"},member:"image",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),module:"Markdown",name:"insertImage"})},C.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},C.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},C.prototype.onKeyUp=function(){if(!j.isNullOrUndefined(this.deletedImg)&&0<this.deletedImg.length)for(var e=Array.from(this.deletedImg).length-1;0<=e;e--){var t={element:this.deletedImg[e],src:this.deletedImg[e].getAttribute("src")};this.parent.trigger(Rt,t),this.deletedImg.splice(e,1)}},C.prototype.checkImageBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||j.isNullOrUndefined(e.startContainer.previousSibling)||"IMG"!==e.startContainer.previousSibling.nodeName?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])||"IMG"!==e.startContainer.childNodes[e.startOffset-1].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedImg.push(e.startContainer.previousSibling)},C.prototype.checkImageDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||j.isNullOrUndefined(e.startContainer.nextSibling)||"IMG"!==e.startContainer.nextSibling.nodeName?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])||"IMG"!==e.startContainer.childNodes[e.startOffset].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset]):this.deletedImg.push(e.startContainer.nextSibling)},C.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Images"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),i={args:e,selectNode:n="IMG"===n[0].nodeName?n:[this.imgEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":this.alignImage(i);break;case"Inline":this.inline(i);break;case"Break":this.break(i)}this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.removeClass([n[0]],"e-img-focus")),this.cancelResizeAction()}},C.prototype.imageWithLinkQTBarItemUpdate=function(){for(var e=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item"),t=0;t<e.length;t++)e[t].getAttribute("title")===this.i10n.getConstant("openLink")||e[t].getAttribute("title")===this.i10n.getConstant("editLink")||e[t].getAttribute("title")===this.i10n.getConstant("removeLink")?(j.addClass([e[t]],"e-link-groups"),e[t].style.display="none"):"Insert Link"===e[t].getAttribute("title")?e[t].style.display="":e[t].classList.contains("e-rte-horizontal-separator")&&j.detach(e[t]);var n=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item:not(.e-link-groups)");this.quickToolObj.imageQTBar.addQTBarItem(["-"],Math.round(n.length/2))},C.prototype.showImageQuickToolbar=function(e){var t,n,i,o,r=this;"Images"!==e.type&&"Replace"!==e.type||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar)||j.isNullOrUndefined(e.args)||(this.quickToolObj=this.parent.quickToolbarModule,t=e.args,n=e.elements,[].forEach.call(e.elements,function(e,t){0===t&&(n=e)}),n&&!j.closest(n,"a")&&this.imageWithLinkQTBarItemUpdate(),"IMG"===n.nodeName&&j.addClass([n],["e-img-focus"]),i=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+t.clientY:t.pageY,this.parent.quickToolbarModule.imageQTBar&&(e.isNotify?this.imageQTPopupTime=setTimeout(function(){r.parent.formatter.editorManager.nodeSelection.Clear(r.contentModule.getDocument()),r.parent.formatter.editorManager.nodeSelection.setSelectionContents(r.contentModule.getDocument(),n),r.quickToolObj.imageQTBar.showPopup(t.pageX,i,n),!0===r.parent.insertImageSettings.resize&&r.resizeStart(e.args,n)},400):(o=n.getBoundingClientRect(),this.quickToolObj.imageQTBar.showPopup(o.left,o.top,n,"Image"))))},C.prototype.hideImageQuickToolbar=function(){j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-img-focus"))||(j.removeClass([this.contentModule.getEditPanel().querySelector(".e-img-focus")],"e-img-focus"),this.quickToolObj&&this.quickToolObj.imageQTBar&&document.body.contains(this.quickToolObj.imageQTBar.element)&&this.quickToolObj.imageQTBar.hidePopup())},C.prototype.editAreaClickHandler=function(e){if(this.parent.readonly)this.hideImageQuickToolbar();else{var t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick;if(2===t.which||n&&1===t.which||!n&&3===t.which)n&&1===t.which&&!j.isNullOrUndefined(t.target)&&"IMG"===t.target.tagName&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),t.target));else if("HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.imageQTBar){this.quickToolObj=this.parent.quickToolbarModule;var n=t.target,i=(this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),this.quickToolObj.imageQTBar.element.classList.contains("e-rte-pop"));if("IMG"===n.nodeName&&this.parent.quickToolbarModule){if(!i){this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n),Rs()&&this.parent.notify(Qe,e),j.addClass([n],"e-img-focus");var o=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item");if(j.closest(n,"a")){for(var r=0;r<o.length;r++)o[r].getAttribute("title")===this.i10n.getConstant("openLink")||o[r].getAttribute("title")===this.i10n.getConstant("editLink")||o[r].getAttribute("title")===this.i10n.getConstant("removeLink")?(o[r].style.display="",j.removeClass([o[r]],"e-link-groups")):"Insert Link"===o[r].getAttribute("title")?o[r].style.display="none":o[r].classList.contains("e-rte-horizontal-separator")&&(o[r],j.detach(o[r]));i=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item:not(.e-link-groups)");this.quickToolObj.imageQTBar.addQTBarItem(["-"],Math.round(i.length/2))}else j.closest(n,"a")||this.imageWithLinkQTBarItemUpdate();this.showImageQuickToolbar({args:t,type:"Images",elements:[t.target]})}}else this.hideImageQuickToolbar()}}},C.prototype.insertImgLink=function(e,t){var n,i,o,r,s,a,l=this;"IMG"!==e.selectNode[0].nodeName||(this.imagDialog(e),j.isNullOrUndefined(this.dialogObj))||(n=this.parent.createElement("div",{className:"e-img-linkwrap"+this.parent.getCssClass(!0)}),s=this.i10n.getConstant("linkurl"),s=xr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" class="e-input e-img-link'+this.parent.getCssClass(!0)+'" spellcheck="false" placeholder="'+s+'"/></div><div class="e-rte-label"></div><div class="e-rte-field"><input type="checkbox" class="e-rte-linkTarget'+this.parent.getCssClass(!0)+'"  data-role ="none"></div>'),n.appendChild(s),s=n.querySelector(".e-rte-linkTarget"),i=n.querySelector(".e-img-link"),r=this.i10n.getConstant("linkOpenInNewWindow"),this.checkBoxObj=new P.CheckBox({label:r,checked:!0,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),change:function(e){o=e.checked?"_blank":null}}),this.checkBoxObj.isStringTemplate=!0,this.checkBoxObj.createElement=this.parent.createElement,this.checkBoxObj.appendTo(s),o="_blank",r=this.i10n.getConstant("imageLinkAriaLabel"),s=this.i10n.getConstant("dialogUpdate"),a={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode,selectParent:e.selectParent,link:i,target:o,ariaLabel:r},this.dialogObj.setProperties({width:"290px",header:this.parent.localeObj.getConstant("imageInsertLinkHeader"),content:n,buttons:[{click:function(e){l.insertlink(a)},buttonModel:{content:s,cssClass:"e-flat e-update-link"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-link-dialog"}),j.isNullOrUndefined(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),j.isNullOrUndefined(t)||(i.value=t.url,this.checkBoxObj.checked=!!t.target,this.dialogObj.header=t.header),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},C.prototype.insertAltText=function(e){var t,n,i,o,r,s,a=this;"IMG"!==e.selectNode[0].nodeName||(this.imagDialog(e),o=this.i10n.getConstant("altText"),j.isNullOrUndefined(this.dialogObj))||(t=this.parent.createElement("div",{className:"e-img-altwrap"+this.parent.getCssClass(!0)}),n=this.i10n.getConstant("alternateHeader"),i=this.i10n.getConstant("dialogUpdate"),r=null===e.selectNode[0].getAttribute("alt")?"":e.selectNode[0].getAttribute("alt"),(o=xr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" spellcheck="false"  class="e-input e-img-alt'+this.parent.getCssClass(!0)+'" placeholder="'+o+'"/></div>')).querySelector("input").setAttribute("value",r),t.appendChild(o),r=t.querySelector(".e-img-alt"),s={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode,alt:r},this.dialogObj.setProperties({width:"290px",header:n,content:t,buttons:[{click:function(e){a.insertAlt(s)},buttonModel:{content:i,cssClass:"e-flat e-update-alt"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-alt-dialog"}),j.isNullOrUndefined(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},C.prototype.insertAlt=function(e){var t;j.isNullOrUndefined(e.alt)||(e.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t=e.alt.value,this.parent.formatter.process(this.parent,e.args,e.args,{altText:t,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.dialogObj.hide({returnValue:!1}),this.parent.inputElement.focus({preventScroll:!0}))},C.prototype.insertlink=function(e){var t,n;"IMG"===e.selectNode[0].nodeName&&(""===(n=e.link.value)?(j.addClass([e.link],"e-error"),e.link.setSelectionRange(0,n.length),e.link.focus()):(this.isUrl(n)?j.removeClass([e.link],"e-error"):n="http://"+n,"HTML"===(t=e.selfImage).parent.editorMode&&e.selection.restore(),0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),"A"===e.selectNode[0].parentElement.nodeName?(t.parent.formatter.process(t.parent,e.args,e.args,{url:n,target:t.checkBoxObj.checked?"_blank":null,ariaLabel:t.checkBoxObj.checked?this.i10n.getConstant("imageLinkAriaLabel"):null,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),t.dialogObj.hide({returnValue:!0})):(t.parent.formatter.process(t.parent,e.args,e.args,{url:n,target:t.checkBoxObj.checked?"_blank":null,ariaLabel:t.checkBoxObj.checked?this.i10n.getConstant("imageLinkAriaLabel"):null,selectNode:e.selectNode,subCommand:e.args.item.subCommand,selection:e.selection}),(n=j.closest(e.selectNode[0],".e-img-caption"))&&(e=j.select("."+yo,n),n)&&e.focus(),t.dialogObj.hide({returnValue:!1}))))},C.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},C.prototype.deleteImg=function(e,t){if("IMG"===e.selectNode[0].nodeName){var n={element:e.selectNode[0],src:e.selectNode[0].getAttribute("src")},i=(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.range.startContainer);if("SPAN"===e.selection.range.startContainer.nodeName&&i.classList.contains("e-img-wrap")&&i.parentElement.classList.contains("e-img-caption"))if(i=i.parentElement,j.isNullOrUndefined(i.previousSibling)){if(!j.isNullOrUndefined(i.nextSibling)){for(var o=i.nextSibling;"#text"!==o.nodeName&&"BR"!==o.nodeName;)o=o.firstChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),o,0)}}else{for(var r=i.previousSibling;"#text"!==r.nodeName&&"BR"!==r.nodeName;)r=r.lastChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),r,"BR"!==r.nodeName?r.textContent.length:0)}else e.selection.restore();this.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,captionClass:ui,subCommand:e.args.item.subCommand}),this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&this.quickToolObj.imageQTBar.hidePopup(),this.cancelResizeAction(),j.isNullOrUndefined(t)&&this.parent.trigger(Rt,n)}},C.prototype.caption=function(e){var t,n,i,o,r=e.selectNode[0];"IMG"===r.nodeName&&(e.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.cancelResizeAction(),j.addClass([r],"e-rte-image"),t=e.args.item?e.args.item.subCommand:"Caption",j.isNullOrUndefined(j.closest(r,"."+ui))?(this.captionEle=this.parent.createElement("span",{className:ui+" "+mi+this.parent.getCssClass(!0),attrs:{contenteditable:"false",draggable:"false",style:"width:"+this.parent.insertImageSettings.width}}),n=this.parent.createElement("span",{className:"e-img-wrap"+this.parent.getCssClass(!0)}),i=this.parent.createElement("span",{className:"e-img-inner"+this.parent.getCssClass(!0),attrs:{contenteditable:"true"}}),"A"===(o=e.selectNode[0].parentElement).tagName&&o.setAttribute("contenteditable","true"),n.appendChild("A"===o.tagName?o:e.selectNode[0]),n.appendChild(i),o=this.i10n.getConstant("imageCaption"),i.innerHTML=o,this.captionEle.appendChild(n),r.classList.contains(fi)&&j.addClass([this.captionEle],gi),r.classList.contains(si)&&j.addClass([this.captionEle],si),r.classList.contains(oi)&&j.addClass([this.captionEle],oi),r.classList.contains(ii)&&j.addClass([this.captionEle],ii),r.classList.contains(ri)&&j.addClass([this.captionEle],ri),this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:this.captionEle,selectNode:e.selectNode,subCommand:t}),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),i.childNodes[0],i.childNodes[0],0,i.childNodes[0].textContent.length)):(j.detach(j.closest(r,"."+ui)),j.Browser.isIE&&(this.contentModule.getEditPanel().focus(),e.selection.restore()),"A"===r.parentElement.tagName?this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:r.parentElement,selectNode:e.selectNode,subCommand:t}):this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:r,selectNode:e.selectNode,subCommand:t})),this.quickToolObj)&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.removeClass([r],"e-img-focus"))},C.prototype.imageSize=function(e){var t,n,i,o,r=this;"IMG"!==e.selectNode[0].nodeName||(this.imagDialog(e),j.isNullOrUndefined(this.dialogObj))||(t=this.i10n.getConstant("imageSizeHeader"),n=this.i10n.getConstant("dialogUpdate"),i=this.imgsizeInput(e),o={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode},this.dialogObj.setProperties({width:"290px",header:t,content:i,buttons:[{click:function(e){r.insertSize(o)},buttonModel:{content:n,cssClass:"e-flat e-update-size"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-size-dialog"}),j.isNullOrUndefined(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},C.prototype.break=function(e){var t;"IMG"===e.selectNode[0].nodeName&&(t=e.args.item.subCommand,this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t}))},C.prototype.inline=function(e){var t;"IMG"===e.selectNode[0].nodeName&&(t=e.args.item.subCommand,this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t}))},C.prototype.alignImage=function(e){var t=e.args.item.subCommand;this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})},C.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),j.detach(this.uploadObj.element),this.uploadObj=null),this.checkBoxObj&&!this.checkBoxObj.isDestroyed&&(this.checkBoxObj.destroy(),j.detach(this.checkBoxObj.element),this.checkBoxObj=null),this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.destroy(),j.detach(this.popupObj.element),this.popupObj=null),this.widthNum&&!this.widthNum.isDestroyed&&(this.widthNum.destroy(),j.detach(this.widthNum.element),this.widthNum=null),this.heightNum&&!this.heightNum.isDestroyed&&(this.heightNum.destroy(),j.detach(this.heightNum.element),this.heightNum=null),this.browseButton&&!this.browseButton.isDestroyed&&(this.browseButton.destroy(),j.detach(this.browseButton.element),this.browseButton=null),this.dialogObj&&!this.dialogObj.isDestroyed&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},C.prototype.imagDialog=function(e){var t,n,i,o,r,s,a=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-img-dialog"+this.parent.getCssClass(!0),id:this.rteID+"_image"}),this.parent.rootContainer.appendChild(t),r=this.i10n.getConstant("dialogInsert"),s=this.i10n.getConstant("dialogCancel"),i=this.i10n.getConstant("imageHeader"),n=e.selection,o={selfImage:this,selection:e.selection,args:e.args,selectParent:e.selectParent},i={header:i,cssClass:Oi+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",isModal:j.Browser.isDevice,buttons:[{click:this.insertImageUrl.bind(o),buttonModel:{content:r,cssClass:"e-flat e-insertImage"+this.parent.getCssClass(!0),isPrimary:!0,disabled:"Markdown"!==this.parent.editorMode}},{click:this.cancelDialog.bind(this),buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:s}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){e&&"user action"!==e.closedBy&&a.uploadObj&&0<a.uploadObj.filesData.length&&a.uploadObj.remove(),a.parent.isBlur=!1,e&&!j.isNullOrUndefined(e.event)&&e.event.returnValue&&("HTML"===a.parent.editorMode?n.restore():a.parent.formatter.editorManager.markdownSelection.restore(a.parent.contentModule.getEditPanel())),a.clearDialogObj(),a.dialogRenderObj.close(e)}},o=this.parent.createElement("div",{className:"e-img-content"+this.parent.getCssClass(!0)}),(j.isNullOrUndefined(this.parent.insertImageSettings.path)||"Markdown"!==this.parent.editorMode)&&"HTML"!==this.parent.editorMode||o.appendChild(this.imgUpload(e)),r=this.parent.createElement("div",{className:"e-linkheader"+this.parent.getCssClass(!0)}),s=this.i10n.getConstant("imageLinkHeader"),"HTML"===this.parent.editorMode?r.innerHTML=s:r.innerHTML=this.i10n.getConstant("mdimageLink"),o.appendChild(r),o.appendChild(this.imageUrlPopup(e)),e.selectNode&&"IMG"===e.selectNode[0].nodeName?(i.header=this.parent.localeObj.getConstant("editImageHeader"),i.content=o,i.buttons[0].buttonModel.cssClass=i.buttons[0].buttonModel.cssClass+" e-updateImage"):i.content=o,this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),j.isNullOrUndefined(this.dialogObj)||(e.selectNode&&"IMG"===e.selectNode[0].nodeName&&"insertImage"===e.name&&(this.dialogObj.element.querySelector(".e-insertImage").textContent=this.parent.localeObj.getConstant("dialogUpdate")),t.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.imageQTBar&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),j.isNullOrUndefined(e.selectParent)||j.removeClass([e.selectParent[0]],"e-img-focus")),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup()))},C.prototype.cancelDialog=function(){this.parent.isBlur=!1,!j.isNullOrUndefined(this.uploadObj)&&0<this.uploadObj.filesData.length&&this.uploadObj.remove(),this.dialogObj.hide({returnValue:!0})},C.prototype.onDocumentClick=function(e){var t=e.target;if(!j.isNullOrUndefined(this.contentModule.getEditPanel())&&("IMG"===t.nodeName&&(this.imgEle=t),this.parent)){if("#document"!==t.nodeName&&(this.parent.currentTarget=e.target),j.isNullOrUndefined(this.dialogObj)||!(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_Image")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Image"))||e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(un,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,wr(this.parent.element,"focusout")),this.parent.iframeSettings.enable&&!j.isNullOrUndefined(this.parent.currentTarget)&&"IMG"===this.parent.currentTarget.nodeName||"IMG"===e.target.tagName||!this.imgResizeDiv||this.quickToolObj&&this.quickToolObj.imageQTBar&&this.quickToolObj.imageQTBar.element.contains(e.target)||!this.contentModule.getEditPanel().contains(this.imgResizeDiv)||this.cancelResizeAction(),!this.contentModule.getEditPanel().querySelector(".e-img-resize")||this.parent.iframeSettings.enable&&"IMG"===this.parent.currentTarget.nodeName||("IMG"!==t.tagName&&this.removeResizeEle(),"IMG"===t.tagName||j.isNullOrUndefined(this.imgEle)?j.isNullOrUndefined(this.prevSelectedImgEle)||this.prevSelectedImgEle===t||(this.prevSelectedImgEle.style.outline=""):this.imgEle.style.outline=""),"IMG"!==t.tagName)for(var n=this.contentModule.getEditPanel().querySelectorAll("img"),i=0;i<n.length;i++)j.removeClass([n[i]],"e-img-focus"),j.removeClass([n[i]],"e-resize");this.parent.inlineMode.enable&&t&&this.dialogObj&&!j.closest(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide()}},C.prototype.removeResizeEle=function(){j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),j.detach(this.contentModule.getEditPanel().querySelector(".e-img-resize"))},C.prototype.onWindowResize=function(){j.isNullOrUndefined(this.contentModule)||j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-img-resize"))||this.cancelResizeAction()},C.prototype.imageUrlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"imgUrl"+this.parent.getCssClass(!0)}),i=this.i10n.getConstant("imageUrl");return this.inputUrl=this.parent.createElement("input",{className:"e-input e-img-url"+this.parent.getCssClass(!0),attrs:{placeholder:i,spellcheck:"false","aria-label":this.i10n.getConstant("imageLinkHeader")}}),this.inputUrl.addEventListener("input",function(){j.isNullOrUndefined(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),e.selectNode&&"IMG"===e.selectNode[0].nodeName&&(i=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),this.inputUrl.value=e.selectNode[0].src.match(i)?e.selectNode[0].src:""),n.appendChild(this.inputUrl),n},C.prototype.insertImageUrl=function(e){var t=this.selfImage,n=(t.isImgUploaded=!1,t.inputUrl.value),i=(e.target&&"BUTTON"===e.target.nodeName&&e.target.classList.contains("e-updateImage")&&(i=this.selectNode&&this.selectNode[0]&&"IMG"===this.selectNode[0].nodeName?this.selectNode[0]:null,t.parent.trigger(Rt,{element:i,src:n})),"Markdown"===t.parent.editorMode&&""===n&&(n="http://"),0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),this.args.item.subCommand);if(this.args.item.subCommand="Update"===e.target.innerHTML?"Replace":this.args.item.subCommand,j.isNullOrUndefined(t.uploadUrl)||""===t.uploadUrl.url){if(""!==n){"HTML"===t.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+t.contentModule.getPanel().id+"']"))&&(t.contentModule.getEditPanel().focus(),e=t.parent.formatter.editorManager.nodeSelection.getRange(t.contentModule.getDocument()),this.selection=t.parent.formatter.editorManager.nodeSelection.save(e,t.contentModule.getDocument()),this.selectParent=t.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(e));e=/[\w-]+.(jpg|png|jpeg|gif)/g,e=j.isNullOrUndefined(n.match(e))||"HTML"!==t.parent.editorMode?"":n.match(e)[0],n={cssClass:"inline"===t.parent.insertImageSettings.display?fi:si,url:n,selection:this.selection,altText:e,selectParent:this.selectParent,width:{width:t.parent.insertImageSettings.width,minWidth:t.parent.insertImageSettings.minWidth,maxWidth:t.parent.getInsertImgMaxWidth()},height:{height:t.parent.insertImageSettings.height,minHeight:t.parent.insertImageSettings.minHeight,maxHeight:t.parent.insertImageSettings.maxHeight}};if(t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,n)}}else{if(t.uploadUrl.cssClass="inline"===t.parent.insertImageSettings.display?fi:si,t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,t.uploadUrl),t.uploadUrl.url="",t.contentModule.getEditPanel().querySelector(".e-img-resize")&&(t.imgEle.style.outline="",t.removeResizeEle())}this.args.item.subCommand=i},C.prototype.imgsizeInput=function(e){var t=this,e=e.selectNode[0],n=this.i10n.getConstant("imageHeight"),i=this.i10n.getConstant("imageWidth"),o=this.parent.createElement("div",{className:"e-img-sizewrap"+this.parent.getCssClass(!0)}),r=!j.isNullOrUndefined(this.changedWidthValue)||"auto"!==e.style.width.toString()&&""===e.style.width?j.isNullOrUndefined(this.changedWidthValue)?parseInt(e.getClientRects()[0].width.toString(),10).toString():this.changedWidthValue:e.style.width,s=!j.isNullOrUndefined(this.changedHeightValue)||"auto"!==e.style.height.toString()&&""===e.style.height?j.isNullOrUndefined(this.changedHeightValue)?parseInt(e.getClientRects()[0].height.toString(),10).toString():this.changedHeightValue:e.style.height;""===e.style.width&&(r="auto"),""===e.style.height&&(s="auto"),this.changedWidthValue=null,this.changedHeightValue=null;e=xr('<div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+i+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" id="imgwidth" class="e-img-width'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+n+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"> <input type="text" id="imgheight" class="e-img-height'+this.parent.getCssClass(!0)+'"/></div>');return e.getElementById("imgwidth").setAttribute("value",r),e.getElementById("imgheight").setAttribute("value",s),o.appendChild(e),this.widthNum=new U.TextBox({value:j.formatUnit(r),enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),input:function(e){t.inputWidthValue=j.formatUnit(t.inputValue(e.value))}}),this.widthNum.createElement=this.parent.createElement,this.widthNum.appendTo(o.querySelector("#imgwidth")),this.heightNum=new U.TextBox({value:j.formatUnit(s),enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),input:function(e){t.inputHeightValue=j.formatUnit(t.inputValue(e.value))}}),this.heightNum.createElement=this.parent.createElement,this.heightNum.appendTo(o.querySelector("#imgheight")),o},C.prototype.inputValue=function(e){return"auto"===e||-1!==e.indexOf("%")||-1!==e.indexOf("px")||e.match(/(\d+)/)?e:"auto"},C.prototype.insertSize=function(e){e.selection.restore();var t=e.selfImage,n=(0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),t.dialogObj.element),i=(this.changedWidthValue=this.inputWidthValue,this.changedHeightValue=this.inputHeightValue,n.querySelector(".e-img-width").value),n=n.parentElement.querySelector(".e-img-height").value;t.parent.formatter.process(this.parent,e.args,e.args,{width:i,height:n,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.imgResizeDiv&&t.imgResizePos(e.selectNode[0],this.imgResizeDiv),t.dialogObj.hide({returnValue:!0}),t.parent.inputElement.focus({preventScroll:!0})},C.prototype.insertImage=function(e){this.imagDialog(e),j.isNullOrUndefined(this.dialogObj)||(this.dialogObj.element.style.maxHeight="inherit",e=this.dialogObj.element.querySelector(".e-img-content"),(!j.isNullOrUndefined(this.parent.insertImageSettings.path)&&"Markdown"===this.parent.editorMode||"HTML"===this.parent.editorMode?document.getElementById(this.rteID+"_insertImage"):e.querySelector(".e-img-url")).focus())},C.prototype.imgUpload=function(e){var o,r,s,a=this,l=this,t=l.parent.iframeSettings.enable,t=(r="HTML"===l.parent.editorMode&&(!t&&j.isNullOrUndefined(j.closest(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||t&&!p(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))?(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)):(o=e.selection,e.selectParent),this.parent.createElement("div",{className:"e-img-uploadwrap e-droparea"+this.parent.getCssClass(!0)})),e=this.i10n.getConstant("imageDeviceUploadMessage"),n=this.i10n.getConstant("imageUploadMessage"),i=this.parent.createElement("span",{className:"e-droptext"+this.parent.getCssClass(!0)}),e=this.parent.createElement("span",{className:"e-rte-upload-text"+this.parent.getCssClass(!0),innerHTML:j.Browser.isDevice?e:n}),n=(i.appendChild(e),this.parent.createElement("button",{className:"e-browsebtn"+this.parent.getCssClass(!0),id:this.rteID+"_insertImage",attrs:{autofocus:"true",type:"button"}})),e=(i.appendChild(n),t.appendChild(i),this.i10n.getConstant("browse")),e=(this.browseButton=new P.Button({content:e,enableRtl:this.parent.enableRtl}),this.browseButton.isStringTemplate=!0,this.browseButton.createElement=this.parent.createElement,this.browseButton.appendTo(n),j.Browser.isDevice?i:n),n=(j.EventHandler.add(e,"click",this.fileSelect,this),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"},className:this.parent.getCssClass()})),d=(t.appendChild(n),null);return this.uploadObj=new U.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},dropArea:i,multiple:!1,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),selected:function(e){l.isImgUploaded=!0,e.filesData,a.parent.trigger(St,e,function(n){var i;n.cancel||j.isNullOrUndefined(n.filesData[0])||(a.checkExtension(n.filesData[0]),s=n.filesData[0].name.replace(/\.[a-zA-Z0-9]+$/,""),"HTML"===a.parent.editorMode&&j.isNullOrUndefined(a.parent.insertImageSettings.path)&&((i=new FileReader).addEventListener("load",function(e){var t="Base64"===a.parent.insertImageSettings.saveFormat?i.result:URL.createObjectURL(jr(i.result));l.uploadUrl={url:t,selection:o,altText:s,selectParent:r,width:{width:l.parent.insertImageSettings.width,minWidth:l.parent.insertImageSettings.minWidth,maxWidth:l.parent.getInsertImgMaxWidth()},height:{height:l.parent.insertImageSettings.height,minHeight:l.parent.insertImageSettings.minHeight,maxHeight:l.parent.insertImageSettings.maxHeight}},l.inputUrl.setAttribute("disabled","true"),j.isNullOrUndefined(a.dialogObj)||(t=a.dialogObj.getButtons(0),j.isNullOrUndefined(t))||(j.isNullOrUndefined(l.parent.insertImageSettings.saveUrl)&&a.isAllowedTypes&&n.filesData[0].size<=a.uploadObj.maxFileSize?t.element.removeAttribute("disabled"):t.element.setAttribute("disabled","true"))}),i.readAsDataURL(n.filesData[0].rawFile)))})},beforeUpload:function(e){a.parent.trigger(Ht,e)},uploading:function(e){a.parent.isServerRendered||a.parent.trigger(Tt,e)},success:function(e){e.detectImageSource=m.ImageInputSource.Uploaded,a.parent.trigger(Ot,e,function(e){var t;j.isNullOrUndefined(a.parent.insertImageSettings.path)||(t=a.parent.insertImageSettings.path+e.file.name,j.isNullOrUndefined(d)||"upload"!==e.operation||a.uploadObj.remove(d),l.uploadUrl={url:t,selection:o,altText:s,selectParent:r,width:{width:l.parent.insertImageSettings.width,minWidth:l.parent.insertImageSettings.minWidth,maxWidth:l.parent.getInsertImgMaxWidth()},height:{height:l.parent.insertImageSettings.height,minHeight:l.parent.insertImageSettings.minHeight,maxHeight:l.parent.insertImageSettings.maxHeight}},e&&e.operation&&"REMOVE"!==e.operation.toLocaleUpperCase()&&l.inputUrl.setAttribute("disabled","true"),d=e.file),"upload"!==e.operation||j.isNullOrUndefined(a.dialogObj)||a.dialogObj.getButtons(0).element.removeAttribute("disabled")})},failure:function(e){a.parent.trigger(Lt,e)},removing:function(e){a.parent.trigger(kt,e,function(e){l.isImgUploaded=!1,a.dialogObj.getButtons(0).element.disabled=!0,l.inputUrl.removeAttribute("disabled"),l.uploadUrl&&(l.uploadUrl.url="")})}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(n),t},C.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&e.type&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},C.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},C.prototype.dragStart=function(t){if("IMG"!==t.target.nodeName)return!0;this.parent.trigger(Le,t,function(e){e.cancel?t.preventDefault():(t.dataTransfer.effectAllowed="copyMove",t.target.classList.add(mo))})},C.prototype.dragEnter=function(e){e.dataTransfer.dropEffect="copy",e.preventDefault()},C.prototype.dragOver=function(e){if(!("edge"===j.Browser.info.name&&-1<e.dataTransfer.items[0].type.split("/")[0].indexOf("image")||j.Browser.isIE&&"Files"===e.dataTransfer.types[0]))return!0;e.preventDefault()},C.prototype.dragDrop=function(e){var i=this;this.parent.trigger(zt,e,function(e){var t,n=i.parent.inputElement.ownerDocument.querySelector("."+mo),n=n&&"IMG"===n.tagName||0<e.dataTransfer.files.length;!e.cancel&&n?j.closest(e.target,"#"+i.parent.getID()+"_toolbar")||"false"===i.parent.inputElement.contentEditable?e.preventDefault():(i.parent.element.querySelector("."+bo)&&j.detach(i.imgResizeDiv),e.preventDefault(),t=void 0,i.contentModule.getDocument().caretRangeFromPoint?t=i.contentModule.getDocument().caretRangeFromPoint(e.clientX,e.clientY):e.rangeParent?(t=i.contentModule.getDocument().createRange()).setStart(e.rangeParent,e.rangeOffset):t=i.getDropRange(e.clientX,e.clientY),i.parent.notify(it,{range:t}),i.parent.element.querySelector("."+vo)||i.insertDragImage(e)):n&&e.preventDefault()})},C.prototype.getDropRange=function(e,t){var n=this.contentModule.getDocument().createRange(),t=(this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(),n),this.contentModule.getDocument().elementFromPoint(e,t)),i=0<t.childNodes.length?t.childNodes[0]:t,o=0;if("<br>"===this.parent.inputElement.firstChild.innerHTML)n.setStart(i,o),n.setEnd(i,o);else for(;n.setStart(i,++o),n.setEnd(i,o+1),n.getBoundingClientRect().left<e&&o<i.length-1;);return n},C.prototype.insertDragImage=function(n){var i=this,e=(n.preventDefault(),this.parent.element.querySelector(fo)),o=(this.parent.notify(It,{args:n}),e&&e.classList.add(Zn),this.parent.inputElement.ownerDocument.querySelector("."+mo)),t={requestType:"Images",name:"ImageDragAndDrop",cancel:!1,originalEvent:n};if(0<n.dataTransfer.files.length&&null===o){if(!(1<n.dataTransfer.files.length))for(var r=n.dataTransfer.files,e=r[0].name,s=e.substring(e.lastIndexOf(".")),a=this.parent.insertImageSettings.allowedTypes,l=0;l<a.length;l++)s.toLocaleLowerCase()===a[l].toLowerCase()&&(this.parent.insertImageSettings.saveUrl?this.onSelect(n):this.parent.trigger(Le,t,function(e){e.cancel?e.originalEvent.preventDefault():(e={args:n,text:"",file:r[0]},n.preventDefault(),i.imagePaste(e))}))}else this.parent.trigger(Le,t,function(e){var t;e.cancel?e.originalEvent.preventDefault():(e=i.parent.formatter.editorManager.nodeSelection.getRange(i.parent.contentModule.getDocument()),o&&"IMG"===o.tagName&&(o.nextElementSibling&&o.nextElementSibling.classList.contains(yo)?e.insertNode(o.parentElement.parentElement):e.insertNode(o),o.classList.remove(mo),t={elements:[o]},o.addEventListener("load",function(){i.parent.trigger(ke,t)}),i.parent.formatter.editorManager.nodeSelection.Clear(i.contentModule.getDocument()),i.resizeStart(n,o),i.hideImageQuickToolbar()))})},C.prototype.onSelect=function(n){var i=this,t=this,o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.createElement("ul",{className:Co}),e=(this.parent.rootContainer.appendChild(r),{name:n.dataTransfer.files[0].name,size:n.dataTransfer.files[0].size,status:"",statusCode:"",type:n.dataTransfer.files[0].type,rawFile:n.dataTransfer.files[0],validationMessages:{}}),s=this.parent.createElement("IMG"),e=(s.style.opacity="0.5",s.classList.add(lo),s.classList.add(fi),s.classList.add(co),e.rawFile),a=new FileReader,l=(a.addEventListener("load",function(){var e=URL.createObjectURL(jr(a.result));s.src="Blob"===t.parent.insertImageSettings.saveFormat?e:a.result}),e&&a.readAsDataURL(e),this.parent.formatter.editorManager.nodeSelection.save(o,this.parent.contentModule.getDocument())),l={cssClass:"inline"===this.parent.insertImageSettings.display?fi:si,url:this.parent.insertImageSettings.path+e.name,selection:l,altText:e.name.replace(/\.[a-zA-Z0-9]+$/,""),width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.parent.getInsertImgMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}};this.parent.trigger(Le,{requestType:"Image",name:"ImageDragAndDrop",cancel:!1,originalEvent:n,itemCollection:l},function(e){var t;e.cancel?e.originalEvent.preventDefault():(e=e.itemCollection,(t=j.createElement("img",{className:e.cssClass,attrs:{src:e.url,alt:e.altText}})).style.opacity="0.5",t.classList.add(lo),t.classList.add(fi),t.classList.add(co),o.insertNode(t),i.uploadMethod(n,t),t.addEventListener("load",function(e){i.parent.trigger(ke,{requestType:"Image",name:"InsertDropImage",elements:[t],event:e,editorMode:"HTML"})}),j.detach(r))})},C.prototype.uploadMethod=function(n,i){var o=this,r=!1,e=this,t=this.parent.createElement("div"),s=(this.parent.rootContainer.appendChild(t),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}})),a=this.parent.iframeSettings.enable?-50:-90,t=(this.popupObj=new I.Popup(t,{relateTo:i,height:"85px",width:"300px",offsetY:a,content:s,viewPortElement:this.parent.element,position:{X:"center",Y:"top"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){o.parent.isBlur=!1,o.popupObj.destroy(),j.detach(o.popupObj.element),o.popupObj=null,o.parent.inlineMode.enable||o.parent.toolbarModule.baseToolbar.toolbarObj.disable(!1)}}),this.popupObj.element.style.display="none",j.addClass([this.popupObj.element],fo),j.addClass([this.popupObj.element],go),j.isNullOrUndefined(this.parent.cssClass)||j.addClass([this.popupObj.element],this.parent.cssClass.replace(/\s+/g," ").trim().split(" ")),this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())),a=1e6<n.dataTransfer.files[0].size?300:100;this.imageDragPopupTime=setTimeout(function(){e.refreshPopup(i)},a),this.uploadObj=new U.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},cssClass:No+this.parent.getCssClass(!0),dropArea:this.parent.element,allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),removing:function(){o.parent.inputElement.contentEditable="true",r=!1,j.detach(i),o.popupObj.close()},canceling:function(){o.parent.inputElement.contentEditable="true",r=!1,j.detach(i),o.popupObj.close(),o.quickToolObj.imageQTBar.hidePopup(),o.uploadCancelTime=setTimeout(function(){o.uploadObj.destroy()},900)},beforeUpload:function(e){o.parent.trigger(Ht,e),o.parent.inlineMode.enable||o.parent.toolbarModule.baseToolbar.toolbarObj.disable(!0)},uploading:function(e){o.parent.isServerRendered||(r=!0,o.parent.trigger(Tt,e,function(e){e.cancel?(j.isNullOrUndefined(i)||j.detach(i),j.isNullOrUndefined(o.popupObj.element)||j.detach(o.popupObj.element)):o.parent.inputElement.contentEditable="false"}))},selected:function(e){r&&(e.cancel=!0)},failure:function(e){r=!1,o.parent.inputElement.contentEditable="true";var t={args:n,type:"Images",isNotify:void 0,elements:i};o.uploadFailureTime=setTimeout(function(){o.uploadFailure(i,t,e)},900)},success:function(e){var t;"cancel"!==e.operation&&(r=!1,o.parent.inputElement.contentEditable="true",t={args:n,type:"Images",isNotify:void 0,elements:i},o.uploadSuccessTime=setTimeout(function(){o.uploadSuccess(i,n,t,e)},900))}}),this.uploadObj.appendTo(this.popupObj.element.childNodes[0]),this.popupObj.element.querySelector(".e-rte-dialog-upload .e-file-select-wrap").style.display="none",t.selectNodeContents(i),this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(),t)},C.prototype.refreshPopup=function(e){var t=this.parent.iframeSettings.enable?this.parent.element.offsetTop+e.offsetTop:e.offsetTop;this.parent.element.offsetTop+this.parent.element.offsetHeight<t?(this.popupObj.relateTo=this.parent.inputElement,this.popupObj.offsetY=this.parent.iframeSettings.enable?-30:-65,this.popupObj.element.style.display="block"):this.popupObj&&(this.popupObj.refreshPosition(e),this.popupObj.element.style.display="block")},C.prototype.uploadFailure=function(e,t,n){j.detach(e),this.popupObj&&this.popupObj.close(),this.parent.trigger(Lt,n),this.uploadObj.destroy()},C.prototype.uploadSuccess=function(n,e,t,i){var o=this;n.style.opacity="1",n.classList.add(po),i.element=n,i.detectImageSource=m.ImageInputSource.Dropped,this.parent.trigger(Ot,i,function(e){var t;j.isNullOrUndefined(o.parent.insertImageSettings.path)||(t=o.parent.insertImageSettings.path+e.file.name,n.src=t,n.setAttribute("alt",e.file.name))}),this.popupObj&&(this.popupObj.close(),this.uploadObj.destroy()),this.showImageQuickToolbar(t),this.resizeStart(e,n)},C.prototype.imagePaste=function(n){var i,o,r=this;0!==n.text.length||j.isNullOrUndefined(n.file)||(i=this,o=new FileReader,n.args.preventDefault(),o.addEventListener("load",function(e){var t={cssClass:"inline"===i.parent.insertImageSettings.display?fi:si,url:"Base64"!==r.parent.insertImageSettings.saveFormat&&j.isNullOrUndefined(n.callBack)?URL.createObjectURL(jr(o.result)):o.result,width:{width:i.parent.insertImageSettings.width,minWidth:i.parent.insertImageSettings.minWidth,maxWidth:i.parent.getInsertImgMaxWidth()},height:{height:i.parent.insertImageSettings.height,minHeight:i.parent.insertImageSettings.minHeight,maxHeight:i.parent.insertImageSettings.maxHeight}};j.isNullOrUndefined(n.callBack)?(i.parent.formatter.process(i.parent,{item:{command:"Images",subCommand:"Image"}},n.args,t),r.showPopupToolBar(n,t)):n.callBack(t)}),o.readAsDataURL(n.file))},C.prototype.showPopupToolBar=function(e,t){var n=this,t='img[src="'+t.url+'"]',i=this.parent.inputElement.querySelector(t),o=(this.parent.quickToolbarModule.createQTBar("Image","MultiRow",this.parent.quickToolbarSettings.image,m.RenderType.ImageToolbar),{args:e.args,type:"Images",isNotify:void 0,elements:i});i&&(this.showImageQTbarTime=setTimeout(function(){n.showImageQuickToolbar(o),n.parent.insertImageSettings.resize&&n.resizeStart(e.args,i)},0))},C.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedImgEle=void 0,j.isNullOrUndefined(this.imageQTPopupTime)||(clearTimeout(this.imageQTPopupTime),this.imageQTPopupTime=null),j.isNullOrUndefined(this.imageDragPopupTime)||(clearTimeout(this.imageDragPopupTime),this.imageDragPopupTime=null),j.isNullOrUndefined(this.uploadCancelTime)||(clearTimeout(this.uploadCancelTime),this.uploadCancelTime=null),j.isNullOrUndefined(this.uploadFailureTime)||(clearTimeout(this.uploadFailureTime),this.uploadFailureTime=null),j.isNullOrUndefined(this.showImageQTbarTime)||(clearTimeout(this.showImageQTbarTime),this.showImageQTbarTime=null),j.isNullOrUndefined(this.uploadSuccessTime)||(clearTimeout(this.uploadSuccessTime),this.uploadSuccessTime=null),this.removeEventListener(),this.clearDialogObj(),this.cancelResizeAction(),this.isDestroyed=!0)},C.prototype.getModuleName=function(){return"image"};var Nl=C;function C(e,t){this.isImgUploaded=!1,this.isAllowedTypes=!0,this.pageX=null,this.pageY=null,this.deletedImg=[],this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.drop=this.dragDrop.bind(this),this.drag=this.dragOver.bind(this),this.enter=this.dragEnter.bind(this),this.start=this.dragStart.bind(this),this.docClick=this.onDocumentClick.bind(this),this.isDestroyed=!1}N.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(h,this.onKeyDown,this),this.parent.on(ie,this.onKeyUp,this),this.parent.on(Me,this.insertingAudio,this),this.parent.on(n,this.afterRender,this),this.parent.on(_t,this.afterRender,this),this.parent.on(Yt,this.showDialog,this),this.parent.on(Zt,this.closeDialog,this),this.parent.on(ge,this.onToolbarAction,this),this.parent.on(pe,this.alignmentSelect,this),this.parent.on(Pe,this.deleteAudio,this),this.parent.on(Ye,this.editAreaClickHandler,this),this.parent.on(Re,this.showAudioQuickToolbar,this),this.parent.on(o,this.destroy,this),this.parent.on(K,this.closeDialog,this))},N.prototype.removeEventListener=function(){this.parent.off(h,this.onKeyDown),this.parent.off(ie,this.onKeyUp),this.parent.off(Me,this.insertingAudio),this.parent.off(n,this.afterRender),this.parent.off(_t,this.afterRender),this.parent.off(Yt,this.showDialog),this.parent.off(Zt,this.closeDialog),this.parent.off(ge,this.onToolbarAction),this.parent.off(pe,this.alignmentSelect),this.parent.off(Pe,this.deleteAudio),this.parent.off(Ye,this.editAreaClickHandler),this.parent.off(Re,this.showAudioQuickToolbar),this.parent.off(o,this.destroy),this.parent.off(K,this.closeDialog),j.isNullOrUndefined(this.contentModule)||(j.EventHandler.remove(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.touchStart),j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.audioClick),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null)},N.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.touchStart,this),j.EventHandler.add(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.audioClick,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick)},N.prototype.checkAudioBack=function(e){"#text"===e.startContainer.nodeName&&0===e.startOffset&&!j.isNullOrUndefined(e.startContainer.previousSibling)&&this.isAudioElem(e.startContainer.previousSibling)?this.deletedAudio.push(e.startContainer.previousSibling):"#text"!==e.startContainer.nodeName&&!j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset-1])&&this.deletedAudio.push(e.startContainer.childNodes[e.startOffset-1])},N.prototype.checkAudioDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||j.isNullOrUndefined(e.startContainer.nextSibling)||"AUDIO"!==e.startContainer.nextSibling.nodeName?"#text"!==e.startContainer.nodeName&&!j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset])&&this.deletedAudio.push(e.startContainer.childNodes[e.startOffset]):this.deletedAudio.push(e.startContainer.nextSibling)},N.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text;n.appendChild(i.cloneNode(!0))}},N.prototype.touchStart=function(e,t){this.parent.readonly||(this.prevSelectedAudEle=this.audEle)},N.prototype.onToolbarAction=function(e){switch(Rs()&&this.parent.notify(We,{}),e.args.item.subCommand){case"AudioReplace":this.parent.notify(Me,e);break;case"AudioRemove":this.parent.notify(Pe,e)}},N.prototype.onKeyUp=function(e){if(!j.isNullOrUndefined(this.deletedAudio)&&0<this.deletedAudio.length)for(var t=0;t<this.deletedAudio.length;t++){var n=this.deletedAudio[t],n="SOURCE"===n.tagName?n:n.querySelector("source"),n={element:this.deletedAudio[t].querySelector("audio"),src:n.getAttribute("src")};this.parent.trigger(At,n)}},N.prototype.onKeyDown=function(e){var t,n,i,o,r,s=e.args;this.deletedAudio=[];if(!(n="HTML"===this.parent.editorMode?(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===i.endContainer&&i.startOffset===i.endOffset:n)&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(s.which)<0)for(var a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),l=0;l<a.length;l++)this.isAudioElem(a[l])&&this.deletedAudio.push(a[l]);switch("HTML"===this.parent.editorMode&&(8===s.which&&"Backspace"===s.code||46===s.which&&"Delete"===s.code)&&(e=i.startContainer===i.endContainer&&i.startOffset===i.endOffset,8===s.which&&"Backspace"===s.code&&e?this.checkAudioBack(i):46===s.which&&"Delete"===s.code&&e&&this.checkAudioDel(i)),j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===s.code||(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i),!s.ctrlKey&&s.key&&(1===s.key.length||"enter"===s.action)&&this.isAudioElem(r[0])&&r[0].parentElement&&(n=r[0].parentElement.childNodes[0],this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),n,n,n.textContent.length,n.textContent.length),j.removeClass([r[0]],ho),this.quickToolObj.audioQTBar.hidePopup())),!s.ctrlKey||89!==s.keyCode&&90!==s.keyCode||this.undoStack({subCommand:90===s.keyCode?"undo":"redo"}),8!==s.keyCode&&46!==s.keyCode||o&&this.isAudioElem(o[0])&&o.length<1&&(j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),s.preventDefault(),this.deleteAudio({selectNode:o,selection:t,selectParent:r,args:{item:{command:"Audios",subCommand:"AudioRemove"},originalEvent:s}},s.keyCode)),s.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":for(l=0;l<this.deletedAudio.length;l++){var d=this.deletedAudio[l].src;this.audioRemovePost(d)}"Markdown"!==this.parent.editorMode&&(3===i.startContainer.nodeType?"Backspace"===s.code?i.startContainer.previousElementSibling&&0===i.startOffset&&i.startContainer.previousElementSibling.classList.contains(ci)&&j.detach(i.startContainer.previousElementSibling):i.startContainer.nextElementSibling&&i.endContainer.textContent.length===i.endOffset&&i.startContainer.nextElementSibling.classList.contains(ci)&&j.detach(i.startContainer.nextElementSibling):1===i.startContainer.nodeType&&i.startContainer.classList&&(i.startContainer.classList.contains(ci)||i.startContainer.classList.contains(li)||i.startContainer.classList.contains(di))&&j.detach(i.startContainer));break;case"insert-audio":j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),this.openDialog(!0,s,t,o,r),s.preventDefault()}s.ctrlKey&&"a"===s.key&&this.handleSelectAll()},N.prototype.handleSelectAll=function(){var e=this.parent.inputElement.querySelectorAll("."+ho);j.removeClass(e,ho)},N.prototype.openDialog=function(e,t,n,i,o){var r,s,i=e||j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=n,s=i,o):(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n));"HTML"===this.parent.editorMode&&this.insertAudio({args:{item:{command:"Audios",subCommand:"Audio"},originalEvent:t,name:e?null:"showDialog"},selectNode:s,selection:r,selectParent:i})},N.prototype.showDialog=function(){this.openDialog(!1)},N.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},N.prototype.deleteAudio=function(e,t){var n;this.isAudioElem(e.selectNode[0])&&(this.audEle&&(3===e.selectNode[0].nodeType?e.selectNode[0]=this.audEle:this.isAudioElem(e.selectNode[0])&&(e.selectNode[0]=e.selectNode[0].classList.contains(ci)?e.selectNode[0]:e.selectNode[0].parentElement)),n={element:e.selectNode[0].querySelector("audio"),src:e.selectNode[0].querySelector("source").getAttribute("src")},0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.restore(),this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.audioRemovePost(n.src),this.quickToolObj&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup(),j.isNullOrUndefined(t))&&this.parent.trigger(At,n)},N.prototype.audioRemovePost=function(e){var t=this,n="";j.isNullOrUndefined(this.parent.insertAudioSettings.removeUrl)||""===this.parent.insertAudioSettings.removeUrl||(n=-1<e.indexOf("http://")||-1<e.indexOf("https://")?e:new URL(e,document.baseURI).href,this.removingAudioName=n.replace(/^.*[\\/]/,""),(e=new XMLHttpRequest).addEventListener("readystatechange",function(){4===this.readyState&&200===this.status&&t.triggerPost(this.response)}),e.open("GET",n),e.responseType="blob",e.send())},N.prototype.triggerPost=function(e){var t,n=this.parent.insertAudioSettings.removeUrl;j.isNullOrUndefined(n)||""===n||(e=new File([e],this.removingAudioName),n=new j.Ajax(n,"POST",!0,null),(t=new FormData).append("UploadFiles",e),n.send(t))},N.prototype.audioClick=function(e){j.Browser.isDevice&&(this.isAudioElem(e.target)?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),this.isAudioElem(e.target)&&(this.audEle=e.target.querySelector("audio"),e.preventDefault())},N.prototype.onDocumentClick=function(e){var t=e.target;j.isNullOrUndefined(this.contentModule.getEditPanel())||(this.isAudioElem(t)&&(this.audEle=t.querySelector("audio")),j.isNullOrUndefined(this.dialogObj)||!(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_Audio")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Audio"))||e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(un,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,wr(this.parent.element,"focusout")),this.contentModule.getEditPanel().querySelector("."+ho)&&(this.isAudioElem(e.target)||j.isNullOrUndefined(this.audEle)?j.isNullOrUndefined(this.prevSelectedAudEle)||this.prevSelectedAudEle===t||(this.prevSelectedAudEle.style.outline=""):this.audEle.style.outline=""),this.parent.inlineMode.enable&&t&&this.dialogObj&&!j.closest(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide())},N.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Audios"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),i={args:e,selectNode:n=this.audEle?[this.audEle]:n};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"Inline":this.inline(i);break;case"Break":this.break(i)}this.quickToolObj&&document.body.contains(this.quickToolObj.audioQTBar.element)&&(this.quickToolObj.audioQTBar.hidePopup(),j.removeClass([n[0]],ho))}},N.prototype.break=function(e){var t;"AUDIO"===e.selectNode[0].nodeName&&(t=e.args.item&&e.args.item.subCommand?e.args.item.subCommand:"Break",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},N.prototype.inline=function(e){var t;"AUDIO"===e.selectNode[0].nodeName&&(t=e.args.item&&e.args.item.subCommand?e.args.item.subCommand:"Inline",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},N.prototype.editAreaClickHandler=function(e){var t,n,i;this.parent.readonly?this.hideAudioQuickToolbar():(t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick,2===t.which||n&&1===t.which||!n&&3===t.which?n&&1===t.which&&!j.isNullOrUndefined(t.target)&&this.isAudioElem(t.target)&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),t.target)):"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.audioQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,n=t.target,this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),i=this.quickToolObj.audioQTBar.element.classList.contains("e-rte-pop"),this.isAudioElem(n)&&this.parent.quickToolbarModule?i||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n),Rs()&&this.parent.notify(Qe,e),n.querySelector("audio")&&(n.querySelector("audio").style.outline="2px solid #4a90e2"),this.showAudioQuickToolbar({args:t,type:"Audios",elements:[t.target]})):this.hideAudioQuickToolbar()))},N.prototype.isAudioElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&(e.classList.contains(ci)||e.classList.contains("e-rte-audio")||e.classList.contains(li)))},N.prototype.showAudioQuickToolbar=function(e){var t,n,i,o=this;"Audios"!==e.type||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.audioQTBar)||j.isNullOrUndefined(e.args)||(this.quickToolObj=this.parent.quickToolbarModule,t=e.args,n=e.elements,[].forEach.call(e.elements,function(e,t){0===t&&(n=e)}),this.isAudioElem(n)&&(i="AUDIO"===n.tagName?n:n.querySelector("audio"),j.addClass([i],[ho]),i.style.outline="2px solid #4a90e2"),this.parent.quickToolbarModule.audioQTBar&&(e.isNotify?this.showPopupTime=setTimeout(function(){o.parent.formatter.editorManager.nodeSelection.Clear(o.contentModule.getDocument()),o.parent.formatter.editorManager.nodeSelection.setSelectionContents(o.contentModule.getDocument(),n),o.quickToolObj.audioQTBar.showPopup(t.pageX-50,n.getBoundingClientRect().top+34,n)},400):this.quickToolObj.audioQTBar.showPopup(t.pageX-50,n.getBoundingClientRect().top+34,n)))},N.prototype.hideAudioQuickToolbar=function(){j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector("."+ho))||(j.removeClass([this.contentModule.getEditPanel().querySelector("."+ho)],ho),j.isNullOrUndefined(this.audEle)||(this.audEle.style.outline=""),this.quickToolObj&&this.quickToolObj.audioQTBar&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup())},N.prototype.insertingAudio=function(e){this.insertAudio(e),j.isNullOrUndefined(this.dialogObj)||(this.dialogObj.element.style.maxHeight="inherit",e=this.dialogObj.element.querySelector(".e-audio-content"),(j.isNullOrUndefined(this.parent.insertAudioSettings.path)&&"HTML"!==this.parent.editorMode?e.querySelector(".e-audio-url"):document.getElementById(this.rteID+"_insertAudio")).focus())},N.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),j.detach(this.uploadObj.element),this.uploadObj=null),this.button&&!this.button.isDestroyed&&(this.button.destroy(),j.detach(this.button.element),this.button=null),this.dialogObj&&!this.dialogObj.isDestroyed&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},N.prototype.insertAudio=function(e){var t,n,i,o,r,s,a=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-audio-dialog",id:this.rteID+"_audio"}),this.parent.rootContainer.appendChild(t),r=this.i10n.getConstant("dialogInsert"),s=this.i10n.getConstant("dialogCancel"),i=this.i10n.getConstant("audioHeader"),n=e.selection,o={selfAudio:this,selection:e.selection,args:e.args,selectParent:e.selectParent},i={header:i,cssClass:Oi,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",isModal:j.Browser.isDevice,buttons:[{click:this.insertAudioUrl.bind(o),buttonModel:{content:r,cssClass:"e-flat e-insertAudio",isPrimary:!0,disabled:!0}},{click:function(e){a.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel",content:s}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){a.isAudioUploaded&&(a.dialogObj.element.querySelector(".e-file-abort-btn")?a.dialogObj.element.querySelector(".e-file-abort-btn").click():a.uploadObj.remove()),a.parent.isBlur=!1,e&&!j.isNullOrUndefined(e.event)&&e.event.returnValue&&"HTML"===a.parent.editorMode&&n.restore(),a.clearDialogObj(),a.dialogRenderObj.close(e)}},o=this.parent.createElement("div",{className:"e-audio-content"}),j.isNullOrUndefined(this.parent.insertAudioSettings.path)&&"HTML"!==this.parent.editorMode||o.appendChild(this.audioUpload(e)),r=this.parent.createElement("div",{className:"e-audioheader"}),s=this.i10n.getConstant("audioLinkHeader"),"HTML"===this.parent.editorMode&&(r.innerHTML=s),o.appendChild(r),o.appendChild(this.audioUrlPopup(e)),e.selectNode&&1===e.selectNode[0].nodeType&&this.isAudioElem(e.selectNode[0])&&(i.header=this.parent.localeObj.getConstant("editAudioHeader")),i.content=o,this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),e.selectNode&&1===e.selectNode[0].nodeType&&this.isAudioElem(e.selectNode[0])&&"insertAudio"===e.name&&(this.dialogObj.element.querySelector(".e-insertAudio").textContent=this.parent.localeObj.getConstant("dialogUpdate")),t.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.audioQTBar&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup(),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())},N.prototype.audioUrlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"audioUrl"}),i=this.i10n.getConstant("audioUrl");return this.inputUrl=this.parent.createElement("input",{className:"e-input e-audio-url",attrs:{placeholder:i,spellcheck:"false","aria-label":this.i10n.getConstant("audioLinkHeader")}}),this.inputUrl.addEventListener("input",function(){j.isNullOrUndefined(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),e.selectNode&&this.isAudioElem(e.selectNode[0])&&(i=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),e=e.selectNode[0].querySelector("source"),this.inputUrl.value=e.src.match(i)?e.src:""),n.appendChild(this.inputUrl),n},N.prototype.audioUpload=function(e){var i,o,r,s=this,a=this,t=a.parent.iframeSettings.enable,t=(o="HTML"===a.parent.editorMode&&(!t&&j.isNullOrUndefined(j.closest(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||t&&!p(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))?(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)):(i=e.selection,e.selectParent),this.parent.createElement("div",{className:"e-aud-uploadwrap e-droparea"})),n=this.i10n.getConstant("audioDeviceUploadMessage"),l=this.i10n.getConstant("audioUploadMessage"),d=this.parent.createElement("span",{className:"e-droptext"}),n=this.parent.createElement("span",{className:"e-rte-upload-text",innerHTML:j.Browser.isDevice?n:l}),l=(d.appendChild(n),this.parent.createElement("button",{className:"e-browsebtn",id:this.rteID+"_insertAudio",attrs:{autofocus:"true",type:"button"}})),n=(d.appendChild(l),t.appendChild(d),this.i10n.getConstant("browse")),n=(this.button=new P.Button({content:n,enableRtl:this.parent.enableRtl}),this.button.isStringTemplate=!0,this.button.createElement=this.parent.createElement,this.button.appendTo(l),j.Browser.isDevice?d:l),l=(j.EventHandler.add(n,"click",this.fileSelect,this),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}}));return t.appendChild(l),this.uploadObj=new U.Uploader({asyncSettings:{saveUrl:this.parent.insertAudioSettings.saveUrl,removeUrl:this.parent.insertAudioSettings.removeUrl},dropArea:d,multiple:!1,enableRtl:this.parent.enableRtl,allowedExtensions:this.parent.insertAudioSettings.allowedTypes.toString(),selected:function(e){a.isAudioUploaded=!0,e.filesData,s.parent.trigger(wt,e,function(e){var n;e.cancel||j.isNullOrUndefined(e.filesData[0])||(s.checkExtension(e.filesData[0]),r=e.filesData[0].name,"HTML"===s.parent.editorMode&&j.isNullOrUndefined(s.parent.insertAudioSettings.path)&&((n=new FileReader).addEventListener("load",function(e){var t="Base64"===s.parent.insertAudioSettings.saveFormat?n.result:URL.createObjectURL(jr(n.result));a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o},a.inputUrl.setAttribute("disabled","true"),j.isNullOrUndefined(a.parent.insertAudioSettings.saveUrl)&&s.isAllowedTypes&&!j.isNullOrUndefined(s.dialogObj)&&s.dialogObj.getButtons(0).element.removeAttribute("disabled")}),n.readAsDataURL(e.filesData[0].rawFile)))})},beforeUpload:function(e){s.parent.trigger(jt,e)},uploading:function(e){s.parent.isServerRendered||s.parent.trigger(xt,e)},success:function(e){s.parent.trigger(Dt,e,function(e){var t;j.isNullOrUndefined(s.parent.insertAudioSettings.path)||(t=s.parent.insertAudioSettings.path+e.file.name,a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o},a.inputUrl.setAttribute("disabled","true")),"upload"!==e.operation||j.isNullOrUndefined(s.dialogObj)||s.dialogObj.getButtons(0).element.removeAttribute("disabled")})},failure:function(e){s.parent.trigger(Mt,e)},removing:function(){s.parent.trigger(Bt,e,function(e){a.isAudioUploaded=!1,s.dialogObj.getButtons(0).element.disabled=!0,a.inputUrl.removeAttribute("disabled"),a.uploadUrl&&(a.uploadUrl.url="")})}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(l),t},N.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},N.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},N.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0}),this.isAudioUploaded&&this.uploadObj.removing()},N.prototype.insertAudioUrl=function(e){var t,n=this.selfAudio,i=(n.isAudioUploaded=!1,n.inputUrl.value);0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),j.isNullOrUndefined(n.uploadUrl)||""===n.uploadUrl.url?""!==i&&("HTML"===n.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+n.contentModule.getPanel().id+"']"))&&(n.contentModule.getEditPanel().focus(),t=n.parent.formatter.editorManager.nodeSelection.getRange(n.contentModule.getDocument()),this.selection=n.parent.formatter.editorManager.nodeSelection.save(t,n.contentModule.getDocument()),this.selectParent=n.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)),t="HTML"===n.parent.editorMode?i.split("/")[i.split("/").length-1]:"",i={cssClass:"Inline"===n.parent.insertAudioSettings.layoutOption?bi:ai,url:i,selection:this.selection,fileName:t,selectParent:this.selectParent},n.dialogObj.hide({returnValue:!1}),null===n.dialogObj)&&n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,i):(n.uploadUrl.cssClass="Inline"===n.parent.insertAudioSettings.layoutOption?bi:ai,n.dialogObj.hide({returnValue:!1}),null===n.dialogObj&&(n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,n.uploadUrl),n.uploadUrl.url=""))},N.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedAudEle=void 0,this.showPopupTime&&(clearTimeout(this.showPopupTime),this.showPopupTime=null),this.removeEventListener(),this.clearDialogObj(),this.isDestroyed=!0)},N.prototype.getModuleName=function(){return"audio"};var El=N;function N(e,t){this.isAudioUploaded=!1,this.isAllowedTypes=!0,this.deletedAudio=[],this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.docClick=this.onDocumentClick.bind(this),this.isDestroyed=!1}E.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(h,this.onKeyDown,this),this.parent.on(ie,this.onKeyUp,this),this.parent.on(Be,this.insertingVideo,this),this.parent.on(n,this.afterRender,this),this.parent.on(_t,this.afterRender,this),this.parent.on(ve,this.onWindowResize,this),this.parent.on(Jt,this.showDialog,this),this.parent.on(en,this.closeDialog,this),this.parent.on(pe,this.alignmentSelect,this),this.parent.on(He,this.deleteVideo,this),this.parent.on(fe,this.onToolbarAction,this),this.parent.on(Ye,this.editAreaClickHandler,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(qe,this.videoSize,this),this.parent.on(Re,this.showVideoQuickToolbar,this),this.parent.on(ft,this.clearDialogObj,this),this.parent.on(o,this.destroy,this))},E.prototype.removeEventListener=function(){this.parent.off(h,this.onKeyDown),this.parent.off(ie,this.onKeyUp),this.parent.off(Be,this.insertingVideo),this.parent.off(ve,this.onWindowResize),this.parent.off(n,this.afterRender),this.parent.off(_t,this.afterRender),this.parent.off(Jt,this.showDialog),this.parent.off(en,this.closeDialog),this.parent.off(pe,this.alignmentSelect),this.parent.off(He,this.deleteVideo),this.parent.off(fe,this.onToolbarAction),this.parent.off(Ye,this.editAreaClickHandler),this.parent.off(K,this.onIframeMouseDown),this.parent.off(qe,this.videoSize),this.parent.off(Re,this.showVideoQuickToolbar),this.parent.off(ft,this.clearDialogObj),this.parent.off(o,this.destroy),j.isNullOrUndefined(this.contentModule)||(j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.videoClick),this.parent.formatter.editorManager.observer.off(pt,this.undoStack),this.parent.insertVideoSettings.resize&&(j.EventHandler.remove(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null,j.EventHandler.remove(this.contentModule.getEditPanel(),"cut",this.onCutHandler),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing)))},E.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),j.EventHandler.add(this.contentModule.getEditPanel(),j.Browser.touchEndEvent,this.videoClick,this),this.parent.insertVideoSettings.resize&&(j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick),j.EventHandler.add(this.contentModule.getEditPanel(),"cut",this.onCutHandler,this))},E.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),j.detach(this.uploadObj.element),this.uploadObj=null),this.webUrlBtn&&!this.webUrlBtn.isDestroyed&&(this.webUrlBtn.destroy(),j.detach(this.webUrlBtn.element),this.webUrlBtn=null),this.embedUrlBtn&&!this.embedUrlBtn.isDestroyed&&(this.embedUrlBtn.destroy(),j.detach(this.embedUrlBtn.element),this.embedUrlBtn=null),this.widthNum&&!this.widthNum.isDestroyed&&(this.widthNum.destroy(),j.detach(this.widthNum.element),this.widthNum=null),this.heightNum&&!this.heightNum.isDestroyed&&(this.heightNum.destroy(),j.detach(this.heightNum.element),this.heightNum=null),this.button&&!this.button.isDestroyed&&(this.button.destroy(),j.detach(this.button.element),this.heightNum=null),this.dialogObj&&this.dialogObj.element&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element),this.dialogObj=null)},E.prototype.onKeyUp=function(e){if(!j.isNullOrUndefined(this.deletedVid)&&0<this.deletedVid.length)for(var t=0;t<this.deletedVid.length;t++){var n={element:this.deletedVid[t],src:"IFRAME"!==this.deletedVid[t].tagName?this.deletedVid[t].querySelector("source").getAttribute("src"):this.deletedVid[t].src};this.parent.trigger(At,n)}},E.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text,o=(n.appendChild(i.cloneNode(!0)),n.querySelectorAll("video"));if(n.querySelector(".e-vid-resize")&&0<o.length){for(var r=0;r<o.length;r++)o[r].style.outline="";j.detach(n.querySelector(".e-vid-resize"));for(var s=n.cloneNode(!0),a=document.createDocumentFragment();s.firstChild;)a.appendChild(s.firstChild);this.parent.formatter.getUndoRedoStack()[t].text=a}}},E.prototype.onIframeMouseDown=function(e){e=e.target;this.dialogObj&&this.dialogObj.hide({returnValue:!0}),(j.isNullOrUndefined(this.parent.currentTarget)||"VIDEO"!==this.parent.currentTarget.nodeName)&&this.videoEle&&this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&this.cancelResizeAction(),this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&"VIDEO"===this.parent.currentTarget.nodeName&&!j.isNullOrUndefined(this.prevSelectedVidEle)&&this.prevSelectedVidEle!==("IFRAME"===e.tagName||"VIDEO"===e.tagName?e:e.querySelector("iframe"))&&(this.prevSelectedVidEle.style.outline="")},E.prototype.videoSize=function(e){var t,n,i,o,r=this;"VIDEO"!==e.selectNode[0].nodeName&&!this.isEmbedVidElem(e.selectNode[0])||(this.insertVideo(e),j.isNullOrUndefined(this.dialogObj))||(t=this.i10n.getConstant("videoSizeHeader"),n=this.i10n.getConstant("dialogUpdate"),i=this.vidsizeInput(e),o={args:e.args,selfVideo:this,selection:e.selection,selectNode:e.selectNode},this.dialogObj.setProperties({width:"290px",header:t,content:i,buttons:[{click:function(e){r.insertSize(o)},buttonModel:{content:n,cssClass:"e-flat e-update-size",isPrimary:!0}}]}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus())},E.prototype.vidsizeInput=function(e){var t=this,e=e.selectNode[0],n=this.i10n.getConstant("videoHeight"),i=this.i10n.getConstant("videoWidth"),o=this.parent.createElement("div",{className:"e-video-sizewrap"}),r=!j.isNullOrUndefined(this.changedWidthValue)||"auto"!==e.style.width.toString()&&""===e.style.width?j.isNullOrUndefined(this.changedWidthValue)?parseInt(e.getClientRects()[0].width.toString(),10).toString():this.changedWidthValue:e.style.width,s=!j.isNullOrUndefined(this.changedHeightValue)||"auto"!==e.style.height.toString()&&""===e.style.height?j.isNullOrUndefined(this.changedHeightValue)?parseInt(e.getClientRects()[0].height.toString(),10).toString():this.changedHeightValue:e.style.height;""===e.style.width&&(r="auto"),""===e.style.height&&(s="auto"),this.changedWidthValue=null,this.changedHeightValue=null;e=xr('<div class="e-rte-label"><label>'+i+'</label></div><div class="e-rte-field"><input type="text" id="vidwidth" class="e-vid-width" value='+r+' /></div><div class="e-rte-label"><label>'+n+'</label></div><div class="e-rte-field"> <input type="text" id="vidheight" class="e-vid-height" value='+s+" /></div>");return o.appendChild(e),this.widthNum=new U.TextBox({value:j.formatUnit(r),enableRtl:this.parent.enableRtl,input:function(e){t.inputWidthValue=j.formatUnit(e.value)}}),this.widthNum.createElement=this.parent.createElement,this.widthNum.appendTo(o.querySelector("#vidwidth")),this.heightNum=new U.TextBox({value:j.formatUnit(s),enableRtl:this.parent.enableRtl,input:function(e){t.inputHeightValue=j.formatUnit(e.value)}}),this.heightNum.createElement=this.parent.createElement,this.heightNum.appendTo(o.querySelector("#vidheight")),o},E.prototype.insertSize=function(e){e.selection.restore();var t=e.selfVideo,n=(0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),t.dialogObj.element),i=(this.changedWidthValue=this.inputWidthValue,this.changedHeightValue=this.inputHeightValue,n.querySelector(".e-vid-width").value),n=n.parentElement.querySelector(".e-vid-height").value;t.parent.formatter.process(this.parent,e.args,e.args,{width:i,height:n,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.vidResizeDiv&&(e.selectNode[0]="VIDEO"===e.selectNode[0].tagName||"IFRAME"===e.selectNode[0].tagName?e.selectNode[0]:e.selectNode[0].querySelector("iframe"),t.vidResizePos(e.selectNode[0],this.vidResizeDiv)),t.dialogObj.hide({returnValue:!0})},E.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.videoEle.parentElement.style.cursor="auto",j.Browser.isDevice&&j.removeClass([e.target.parentElement],"e-mob-span");this.parent.trigger(Ne,{event:e,requestType:"videos"}),this.getPointX(e),this.parent.iframeSettings.enable?(window.pageYOffset,this.parent.element.getBoundingClientRect().top,e.clientY):e.pageY;this.parent.formatter.editorManager.observer.on(pt,this.undoStack,this),this.parent.formatter.saveData()},E.prototype.resizeStart=function(e,t){var n,i=this;this.parent.readonly||(t=t||(this.isEmbedVidElem(e.target)?e.target.querySelector("iframe"):e.target),j.isNullOrUndefined(t))||(this.prevSelectedVidEle=this.videoEle,"VIDEO"!==t.tagName&&"IFRAME"!==t.tagName||(this.parent.preventDefaultResize(e),n=t,this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&j.detach(this.vidResizeDiv),this.videoResize(n)),t.classList.contains("e-rte-videoboxmark")&&(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.videoQTBar.hidePopup(),t.classList.contains("e-rte-topLeft")&&(this.resizeBtnStat.topLeft=!0),t.classList.contains("e-rte-topRight")&&(this.resizeBtnStat.topRight=!0),t.classList.contains("e-rte-botLeft")&&(this.resizeBtnStat.botLeft=!0),t.classList.contains("e-rte-botRight")&&(this.resizeBtnStat.botRight=!0),j.Browser.isDevice&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&!this.vidResizeDiv.classList.contains("e-mob-span")?j.addClass([this.vidResizeDiv],"e-mob-span"):this.parent.trigger(ye,{event:e,requestType:"videos"},function(e){e.cancel&&i.cancelResizeAction()}),this.isResizeBind)&&(j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing,this),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd,this),this.isResizeBind=!1))},E.prototype.videoClick=function(e){j.Browser.isDevice&&("VIDEO"===e.target.tagName||this.isEmbedVidElem(e.target)?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),"VIDEO"!==e.target.tagName&&!this.isEmbedVidElem(e.target)||e.preventDefault()},E.prototype.onCutHandler=function(){this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&this.cancelResizeAction()},E.prototype.videoResize=function(e){this.resizeBtnInit(),this.videoEle=e,j.addClass([this.videoEle],"e-resize"),this.vidResizeDiv=this.parent.createElement("span",{className:"e-vid-resize",id:this.rteID+"_vidResize"}),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-topLeft",styles:"cursor: nwse-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-topRight",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-botLeft",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-botRight",styles:"cursor: nwse-resize"})),j.Browser.isDevice&&j.addClass([this.vidResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.vidResizePos(e,this.vidResizeDiv),this.resizeVidDupPos(e),this.contentModule.getEditPanel().appendChild(this.vidResizeDiv),"auto"===this.parent.element.style.height&&this.vidResizePos(e,this.vidResizeDiv)},E.prototype.getPointX=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageX},E.prototype.getPointY=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageY},E.prototype.vidResizePos=function(e,t){var n,i,o,r,s;j.isNullOrUndefined(t)||(n=(i=this.calcPos(e)).top,i=i.left,o=(0!==e.width&&"auto"!==e.width&&"NaN"!==e.width?e:e.getBoundingClientRect()).width,r=(0!==e.height&&"auto"!==e.height&&"NaN"!==e.height?e:e.getBoundingClientRect()).height,e=j.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,s=j.Browser.isDevice?0:2,t.querySelector(".e-rte-botLeft").style.left=i-e+"px",t.querySelector(".e-rte-botLeft").style.top=parseInt(r.toString(),10)-e+n+"px",t.querySelector(".e-rte-botRight").style.left=parseInt(o.toString(),10)-(e-s)+i+"px",t.querySelector(".e-rte-botRight").style.top=parseInt(r.toString(),10)-e+n+"px",t.querySelector(".e-rte-topRight").style.left=parseInt(o.toString(),10)-(e-s)+i+"px",t.querySelector(".e-rte-topRight").style.top=n-e+"px",t.querySelector(".e-rte-topLeft").style.left=i-e+"px",t.querySelector(".e-rte-topLeft").style.top=n-e+"px")},E.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,o=(e.offsetParent&&(e.offsetParent.classList.contains("e-video-clickelem")||-1<["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName))?j.closest(e,"#"+this.parent.getID()+"_rte-edit-view"):e.offsetParent)||i.documentElement;o&&(o===i.body||o===i.documentElement)&&"static"===o.style.position;)o=o.parentNode;return o&&o!==e&&1===o.nodeType&&(n=o.getBoundingClientRect()),e&&1===e.nodeType&&"IFRAME"===e.tagName?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},E.prototype.setAspectRatio=function(e,t,n,i){var o,r,s,a,l=getComputedStyle(e);j.isNullOrUndefined(l)||(o=RegExp,s=""!==l.width?l.width.match(new o("^\\d+(\\.\\d*)?%$","g"))?parseFloat(l.width):parseInt(l.width,10):(""!==e.style.width?e.style:e).width,a=""!==l.height?parseInt(l.height,10):(""!==e.style.height?e.style:e).height,s=s.toString().match(new o("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(s.toString()):parseInt(s.toString(),10),(a=a.toString().match(new o("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(a.toString()):parseInt(a.toString(),10))<s?(e.style.minWidth=0===this.parent.insertVideoSettings.minWidth?"200px":j.formatUnit(this.parent.insertVideoSettings.minWidth),e.style.minHeight=0===this.parent.insertVideoSettings.minHeight?"90px":j.formatUnit(this.parent.insertVideoSettings.minHeight),this.parent.insertVideoSettings.resizeByPercent?this.updateVidEleWidth(e,s,a,t,n):""===e.style.width&&""!==e.style.height||""===l.width&&""!==l.height?e.style.height=n+"px":""!==e.style.width&&""===e.style.height||""!==l.width&&""===l.height?(r=s/a*n+s/a<this.parent.inputElement.getBoundingClientRect().right-32?s/a*n+s/a:this.parent.inputElement.getBoundingClientRect().right-32,e.style.width=r.toString()+"px"):""!==e.style.width||""!==l.width?(r=s/a*n<this.parent.inputElement.getBoundingClientRect().right-32?s/a*n:this.parent.inputElement.getBoundingClientRect().right-32,e.style.width=r+"px",e.style.height=n+"px"):e.setAttribute("width",parseInt((s/a*n+s/a).toString(),10).toString())):s<a?this.parent.insertVideoSettings.resizeByPercent?this.updateVidEleWidth(e,s,a,t,n):""!==l.width||""!==e.style.width?(e.style.width=t+"px",e.style.height=a/s*t+"px"):e.setAttribute("width",(this.resizeBtnStat.botRight?this.getPointX(i.event)-e.getBoundingClientRect().left:t).toString()):this.parent.insertVideoSettings.resizeByPercent?(e.style.width=this.pixToPerc(t,e.previousElementSibling||e.parentElement)+"%",e.style.height=null,e.removeAttribute("height")):(e.style.width=t+"px",e.style.height=t+"px"))},E.prototype.updateVidEleWidth=function(e,t,n,i,o){var r;0!==parseInt(""+e.getBoundingClientRect().width,10)&&0!==parseInt(""+t,10)?(r=(e.offsetWidth+this.mouseX)/e.offsetWidth*("NaN"===parseFloat(e.style.width).toString()?e.offsetWidth/parseFloat(getComputedStyle(this.parent.element).width)*100:parseFloat(e.style.width)),e.style.width=(3<r?r:3)+"%"):e.style.width=n<t?this.pixToPerc(t/n*o,e.previousElementSibling||e.parentElement)+"%":this.pixToPerc(i/n*o,e.previousElementSibling||e.parentElement)+"%",e.style.height=null,e.removeAttribute("height")},E.prototype.pixToPerc=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},E.prototype.vidDupMouseMove=function(t,n,e){var i=this,o={event:e,requestType:"videos"};this.parent.trigger(Ce,o,function(e){e.cancel?i.cancelResizeAction():parseInt(i.parent.insertVideoSettings.minWidth,10)>=parseInt(t,10)||parseInt(i.parent.getInsertVidMaxWidth(),10)<=parseInt(t,10)&&j.isNullOrUndefined(i.videoEle.style.width)||!i.parent.insertVideoSettings.resizeByPercent&&(parseInt(i.parent.insertVideoSettings.minHeight,10)>=parseInt(n,10)||parseInt(i.parent.insertVideoSettings.maxHeight,10)<=parseInt(n,10))||(i.videoEle.parentElement.style.cursor="pointer",i.setAspectRatio(i.videoEle,parseInt(t,10),parseInt(n,10),o),i.resizeVidDupPos(i.videoEle),i.vidResizePos(i.videoEle,i.vidResizeDiv))})},E.prototype.resizing=function(e){this.videoEle.offsetWidth>=this.parent.getInsertVidMaxWidth()&&(this.videoEle.style.maxHeight=this.videoEle.offsetHeight+"px");var t=this.getPointX(e),n=this.getPointY(e),i=this.resizeBtnStat.botLeft||this.resizeBtnStat.topLeft?-(t-this.pageX):t-this.pageX,o=this.resizeBtnStat.topLeft||this.resizeBtnStat.topRight?-(n-this.pageY):n-this.pageY,r=parseInt(this.vidDupPos.width,10)+i,o=parseInt(this.vidDupPos.height,10)+o;this.pageX=t,this.pageY=n,this.mouseX=i,(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)&&this.vidDupMouseMove(r+"px",o+"px",e)},E.prototype.cancelResizeAction=function(){this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.videoEle&&this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&(j.detach(this.vidResizeDiv),this.videoEle.style.outline="",this.vidResizeDiv=null,this.pageX=null,this.pageY=null)},E.prototype.resizeVidDupPos=function(e){this.vidDupPos={width:""!==e.style.width&&this.parent.insertVideoSettings&&!this.parent.insertVideoSettings.resizeByPercent?this.videoEle.style.width:"auto"!==e.width&&0!==e.width&&"NaN"!==e.width?e.width+"px":parseInt(getComputedStyle(e).width,10)+"px",height:""!==e.style.height?this.videoEle.style.height:"auto"!==e.height&&0!==e.height&&"NaN"!==e.height?e.height+"px":parseInt(getComputedStyle(e).height,10)+"px"}},E.prototype.resizeBtnInit=function(){return this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},E.prototype.onToolbarAction=function(e){switch(Rs()&&this.parent.notify(We,{}),e.args.item.subCommand){case"VideoReplace":this.parent.notify(Be,e);break;case"VideoRemove":this.parent.notify(He,e);break;case"VideoDimension":this.parent.notify(qe,e)}},E.prototype.onKeyDown=function(e){var t,n,i,o,r,s=e.args;this.deletedVid=[];if(!(n="HTML"===this.parent.editorMode?(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===i.endContainer&&i.startOffset===i.endOffset:n)&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(s.which)<0)for(var a=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),l=0;l<a.length;l++)"VIDEO"!==a[l].nodeName&&"IFRAME"!==a[l].nodeName||this.deletedVid.push(a[l]);switch("HTML"===this.parent.editorMode&&(8===s.which&&"Backspace"===s.code||46===s.which&&"Delete"===s.code)&&(e=i.startContainer===i.endContainer&&i.startOffset===i.endOffset,8===s.which&&"Backspace"===s.code&&e?this.checkVideoBack(i):46===s.which&&"Delete"===s.code&&e&&this.checkVideoDel(i)),j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===s.code||(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i),s.ctrlKey)||!s.key||1!==s.key.length&&"enter"!==s.action||(j.isNullOrUndefined(r[0])||"VIDEO"!==r[0].tagName)&&!this.isEmbedVidElem(r[0])||!r[0].parentElement||(n=r[0].parentElement.childNodes[0],this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle(),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),n,n,n.textContent.length,n.textContent.length),j.removeClass([r[0]],uo),this.quickToolObj.videoQTBar.hidePopup()),!s.ctrlKey||89!==s.keyCode&&90!==s.keyCode||this.undoStack({subCommand:90===s.keyCode?"undo":"redo"}),8!==s.keyCode&&46!==s.keyCode||(o&&o[0]&&("VIDEO"===o[0].nodeName||this.isEmbedVidElem(o[0]))&&o.length<1&&(j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),s.preventDefault(),this.deleteVideo({selectNode:o,selection:t,selectParent:r,args:{item:{command:"Videos",subCommand:"VideoRemove"},originalEvent:s}},s.keyCode)),this.parent.contentModule.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle()),"Backspace"===s.code&&(s.action="backspace"),s.action){case"escape":j.isNullOrUndefined(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":for(l=0;l<this.deletedVid.length;l++){var d=this.deletedVid[l].src;this.videoRemovePost(d)}"Markdown"!==this.parent.editorMode&&(3===i.startContainer.nodeType?"Backspace"===s.code?i.startContainer.previousElementSibling&&0===i.startOffset&&i.startContainer.previousElementSibling.classList.contains(pi)&&j.detach(i.startContainer.previousElementSibling):i.startContainer.nextElementSibling&&i.endContainer.textContent.length===i.endOffset&&i.startContainer.nextElementSibling.classList.contains(pi)&&j.detach(i.startContainer.nextElementSibling):1===i.startContainer.nodeType&&i.startContainer.classList&&i.startContainer.classList.contains(pi)&&j.detach(i.startContainer));break;case"insert-video":j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)||(t=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument())),this.openDialog(!0,s,t,o,r),s.preventDefault()}s.ctrlKey&&"a"===s.key&&this.handleSelectAll()},E.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll("."+uo);j.removeClass(e,uo)},E.prototype.openDialog=function(e,t,n,i,o){var r,s,i=e||j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)?(r=n,s=i,o):(n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n));"HTML"===this.parent.editorMode&&this.insertVideo({args:{item:{command:"Videos",subCommand:"Video"},originalEvent:t,name:e?null:"showDialog"},selectNode:s,selection:r,selectParent:i})},E.prototype.showDialog=function(){this.openDialog(!1)},E.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},E.prototype.checkVideoBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||j.isNullOrUndefined(e.startContainer.previousSibling)||"VIDEO"!==e.startContainer.previousSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.previousSibling)?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset-1])||"VIDEO"!==e.startContainer.childNodes[e.startOffset-1].nodeName&&!this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset-1])||this.deletedVid.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedVid.push(e.startContainer.previousSibling)},E.prototype.checkVideoDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||j.isNullOrUndefined(e.startContainer.nextSibling)||"VIDEO"!==e.startContainer.nextSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.nextSibling)?"#text"===e.startContainer.nodeName||j.isNullOrUndefined(e.startContainer.childNodes[e.startOffset])||"VIDEO"!==e.startContainer.childNodes[e.startOffset].nodeName&&!this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset])||this.deletedVid.push(e.startContainer.childNodes[e.startOffset]):this.deletedVid.push(e.startContainer.nextSibling)},E.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Videos"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),i={args:e,selectNode:n="VIDEO"===n[0].nodeName?n:[this.videoEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":this.alignVideo(i,t.subCommand);break;case"Inline":this.inline(i);break;case"Break":this.break(i)}this.quickToolObj&&document.body.contains(this.quickToolObj.videoQTBar.element)&&(this.quickToolObj.videoQTBar.hidePopup(),j.removeClass([n[0]],uo)),this.cancelResizeAction()}},E.prototype.deleteVideo=function(e,t){var n;("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0]))&&(this.isEmbedVidElem(e.selectNode[0])&&(e.selectNode[0]=e.selectNode[0].classList.contains(di)?e.selectNode[0]:e.selectNode[0].parentElement),n={element:this.isEmbedVidElem(e.selectNode[0])?e.selectNode[0]:e.selectNode[0].querySelector("iframe"),src:(this.isEmbedVidElem(e.selectNode[0])?e.selectNode[0].querySelector("iframe"):e.selectNode[0].querySelector("source")).getAttribute("src")},0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.restore(),this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.videoRemovePost(n.src),this.quickToolObj&&document.body.contains(this.quickToolObj.videoQTBar.element)&&this.quickToolObj.videoQTBar.hidePopup(),this.cancelResizeAction(),j.isNullOrUndefined(t))&&this.parent.trigger(At,n)},E.prototype.videoRemovePost=function(e){var t=this,n="";j.isNullOrUndefined(this.parent.insertVideoSettings.removeUrl)||""===this.parent.insertVideoSettings.removeUrl||(n=-1<e.indexOf("http://")||-1<e.indexOf("https://")?e:new URL(e,document.baseURI).href,this.removingVideoName=n.replace(/^.*[\\\/]/,""),(e=new XMLHttpRequest).addEventListener("readystatechange",function(){4===this.readyState&&200===this.status&&t.triggerPost(this.response)}),e.open("GET",n),e.responseType="blob",e.send())},E.prototype.triggerPost=function(e){var t,n=this.parent.insertVideoSettings.removeUrl;j.isNullOrUndefined(n)||""===n||(e=new File([e],this.removingVideoName),n=new j.Ajax(n,"POST",!0,null),(t=new FormData).append("UploadFiles",e),n.send(t))},E.prototype.onDocumentClick=function(e){var t=e.target;j.isNullOrUndefined(this.contentModule.getEditPanel())||("VIDEO"!==t.nodeName&&!this.isEmbedVidElem(t)||(this.videoEle=this.isEmbedVidElem(t)?t.querySelector("iframe"):t),j.isNullOrUndefined(this.dialogObj)||!(!j.closest(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!j.closest(t,"#"+this.parent.getID()+"_toolbar_Video")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Video"))||e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(un,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,wr(this.parent.element,"focusout")),this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&("VIDEO"===t.tagName||this.isEmbedVidElem(t)||this.removeResizeEle(),"VIDEO"===t.tagName||this.isEmbedVidElem(t)||j.isNullOrUndefined(this.videoEle)?j.isNullOrUndefined(this.prevSelectedVidEle)||this.prevSelectedVidEle===("IFRAME"===t.tagName||"VIDEO"===t.tagName?t:t.querySelector("iframe"))||(this.prevSelectedVidEle.style.outline=""):this.videoEle.style.outline=""),this.parent.inlineMode.enable&&t&&this.dialogObj&&!j.closest(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide())},E.prototype.removeResizeEle=function(){this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),j.detach(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))},E.prototype.onWindowResize=function(){j.isNullOrUndefined(this.contentModule)||j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))||this.cancelResizeAction()},E.prototype.break=function(e){var t;"VIDEO"!==e.selectNode[0].nodeName&&!this.isEmbedVidElem(e.selectNode[0])||(t=e.args.item?e.args.item.subCommand:"Break",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},E.prototype.inline=function(e){var t;"VIDEO"!==e.selectNode[0].nodeName&&!this.isEmbedVidElem(e.selectNode[0])||(t=e.args.item?e.args.item.subCommand:"Inline",this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t}))},E.prototype.alignVideo=function(e,t){t=e.args.item?e.args.item.subCommand:t;this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t})},E.prototype.editAreaClickHandler=function(e){var t,n,i;this.parent.readonly?this.hideVideoQuickToolbar():(t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick,2===t.which||n&&1===t.which||!n&&3===t.which?!n||1!==t.which||j.isNullOrUndefined(t.target)||"VIDEO"!==t.target.tagName&&!this.isEmbedVidElem(t.target)||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),t.target)):"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.videoQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,n=t.target,this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),i=this.quickToolObj.videoQTBar.element.classList.contains("e-rte-pop"),("VIDEO"===n.nodeName||this.isEmbedVidElem(n))&&this.parent.quickToolbarModule?i||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n),Rs()&&this.parent.notify(Qe,e),j.addClass([this.isEmbedVidElem(n)?n.querySelector("iframe"):n],uo),this.showVideoQuickToolbar({args:t,type:"Videos",elements:[t.target]})):this.hideVideoQuickToolbar()))},E.prototype.showVideoQuickToolbar=function(e){var t,n,i,o=this;"Videos"!==e.type||!j.isNullOrUndefined(e.args)&&2===e.args.detail||j.isNullOrUndefined(this.parent.quickToolbarModule)||j.isNullOrUndefined(this.parent.quickToolbarModule.videoQTBar)||j.isNullOrUndefined(e.args)||(this.quickToolObj=this.parent.quickToolbarModule,t=e.args,n=e.elements,[].forEach.call(e.elements,function(e,t){0===t&&(n=e)}),"VIDEO"!==n.tagName&&!this.isEmbedVidElem(n)||j.addClass([this.isEmbedVidElem(n)&&"IFRAME"!==n.tagName?n.querySelector("iframe"):n],[uo]),i=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+t.clientY:t.pageY,this.parent.quickToolbarModule.videoQTBar&&(e.isNotify?this.showPopupTime=setTimeout(function(){o.parent.formatter.editorManager.nodeSelection.Clear(o.contentModule.getDocument()),o.parent.formatter.editorManager.nodeSelection.setSelectionContents(o.contentModule.getDocument(),n),o.quickToolObj.videoQTBar.showPopup(t.pageX-50,i+n.getBoundingClientRect().height/2-n.offsetTop,n),!0===o.parent.insertVideoSettings.resize&&o.resizeStart(e.args,n)},400):this.quickToolObj.videoQTBar.showPopup(t.pageX-50,i+n.getBoundingClientRect().height/2-n.offsetTop,n)))},E.prototype.hideVideoQuickToolbar=function(){j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector("."+uo))||(j.removeClass([this.contentModule.getEditPanel().querySelector("."+uo)],uo),j.isNullOrUndefined(this.videoEle)||(this.videoEle.style.outline=""),j.isNullOrUndefined(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))||j.detach(this.contentModule.getEditPanel().querySelector(".e-vid-resize")),this.quickToolObj&&this.quickToolObj.videoQTBar&&document.body.contains(this.quickToolObj.videoQTBar.element)&&this.quickToolObj.videoQTBar.hidePopup())},E.prototype.isEmbedVidElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&(e.classList.contains(pi)||e.classList.contains(di))||e&&"IFRAME"===e.nodeName)},E.prototype.insertingVideo=function(e){this.insertVideo(e),j.isNullOrUndefined(this.dialogObj)||(this.dialogObj.element.style.maxHeight="inherit",e=this.dialogObj.element.querySelector(".e-video-content"),(j.isNullOrUndefined(this.parent.insertVideoSettings.path)&&"HTML"!==this.parent.editorMode?e.querySelector(".e-video-url"):document.getElementById(this.rteID+"_insertVideo")).focus())},E.prototype.insertVideo=function(e){var t,n,i,o,r,s,a,l,d=this;this.dialogObj?this.dialogObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-video-dialog",id:this.rteID+"_video"}),this.parent.rootContainer.appendChild(t),r=this.i10n.getConstant("dialogInsert"),s=this.i10n.getConstant("dialogCancel"),i=this.i10n.getConstant("videoHeader"),n=e.selection,o={selfVideo:this,selection:e.selection,args:e.args,selectParent:e.selectParent},i={header:i,cssClass:Oi,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",isModal:j.Browser.isDevice,buttons:[{click:this.insertVideoUrl.bind(o),buttonModel:{content:r,cssClass:"e-flat e-insertVideo",isPrimary:!0,disabled:!0}},{click:function(e){d.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel",content:s}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){d.isVideoUploaded&&(d.dialogObj.element.querySelector(".e-file-abort-btn")?d.dialogObj.element.querySelector(".e-file-abort-btn").click():d.uploadObj.remove()),d.parent.isBlur=!1,e&&!j.isNullOrUndefined(e.event)&&e.event.returnValue&&"HTML"===d.parent.editorMode&&n.restore(),d.clearDialogObj(),d.dialogRenderObj.close(e)}},o=this.parent.createElement("div",{className:"e-video-content"}),j.isNullOrUndefined(this.parent.insertVideoSettings.path)&&"HTML"!==this.parent.editorMode||o.appendChild(this.videoUpload(e)),r=this.parent.createElement("div",{className:"e-videoheader"}),s=this.parent.createElement("div",{className:"e-embed-videoheader"}),a=this.i10n.getConstant("videoLinkHeader"),l=this.i10n.getConstant("embedVideoLinkHeader"),"HTML"===this.parent.editorMode&&(r.innerHTML=a,s.innerHTML=l),o.appendChild(this.urlPopup(e)),e.selectNode&&1===e.selectNode[0].nodeType&&("VIDEO"===e.selectNode[0].tagName||this.isEmbedVidElem(e.selectNode[0]))&&(i.header=this.parent.localeObj.getConstant("editVideoHeader")),i.content=o,this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),e.selectNode&&1===e.selectNode[0].nodeType&&("VIDEO"===e.selectNode[0].tagName||this.isEmbedVidElem(e.selectNode[0]))&&"insertVideo"===e.name&&(this.dialogObj.element.querySelector(".e-insertVideo").textContent=this.parent.localeObj.getConstant("dialogUpdate")),t.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.videoQTBar&&document.body.contains(this.quickToolObj.videoQTBar.element)&&(this.quickToolObj.videoQTBar.hidePopup(),j.isNullOrUndefined(e.selectParent)||j.removeClass([e.selectParent[0]],uo)),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar)&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())},E.prototype.urlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"e-video-url-wrap"}),i=this.parent.createElement("div",{id:"urlcontent"}),o=this.i10n.getConstant("videoUrl"),r=xr('<input id="embedURL" type="radio"><input id="webURL" type="radio" >'),s=(n.appendChild(r),n.appendChild(i),this.embedInputUrl=this.parent.createElement("textarea",{className:"e-input e-embed-video-url",attrs:{placeholder:this.i10n.getConstant("pasteEmbeddedCodeHere"),type:"text",tabindex:"-1","aria-label":this.i10n.getConstant("embedVideoLinkHeader")}}),this.embedInputUrl.addEventListener("input",function(){j.isNullOrUndefined(t.embedInputUrl)||(0===t.embedInputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),this.inputUrl=this.parent.createElement("input",{className:"e-input e-video-url",attrs:{placeholder:o,spellcheck:"false"}}),this.inputUrl.addEventListener("input",function(){j.isNullOrUndefined(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))}),e.selectNode&&e.selectNode[0]&&("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0]))&&("VIDEO"===e.selectNode[0].nodeName||e.selectNode[0].classList.contains("e-video-wrap")?(r=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),o=e.selectNode[0].querySelector("source"),this.inputUrl.value=o&&o.src&&o.src.match(r)?o.src:""):this.embedInputUrl.value=("IFRAME"===e.selectNode[0].nodeName?e.selectNode[0]:e.selectNode[0].querySelector("iframe")).outerHTML),!!this.inputUrl.value);return this.embedUrlBtn=new P.RadioButton({label:this.i10n.getConstant("embeddedCode"),checked:!s,name:"URL",created:function(){s||i.appendChild(t.embedInputUrl)},change:function(){i.innerHTML="",i.appendChild(t.embedInputUrl)}}),this.embedUrlBtn.appendTo(n.querySelector("#embedURL")),this.webUrlBtn=new P.RadioButton({label:this.i10n.getConstant("webUrl"),checked:s,name:"URL",created:function(){s&&i.appendChild(t.inputUrl)},change:function(){i.innerHTML="",i.appendChild(t.inputUrl)}}),this.webUrlBtn.appendTo(n.querySelector("#webURL")),n},E.prototype.videoUpload=function(e){var i,o,r,s=this,a=this,t=a.parent.iframeSettings.enable,t=(o="HTML"===a.parent.editorMode&&(!t&&j.isNullOrUndefined(j.closest(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||t&&!p(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))?(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)):(i=e.selection,e.selectParent),this.parent.createElement("div",{className:"e-vid-uploadwrap e-droparea"})),n=this.i10n.getConstant("videoDeviceUploadMessage"),l=this.i10n.getConstant("videoUploadMessage"),d=this.parent.createElement("span",{className:"e-droptext"}),n=this.parent.createElement("span",{className:"e-rte-upload-text",innerHTML:j.Browser.isDevice?n:l}),l=(d.appendChild(n),this.parent.createElement("button",{className:"e-browsebtn",id:this.rteID+"_insertVideo",attrs:{autofocus:"true",type:"button"}})),n=(d.appendChild(l),t.appendChild(d),this.i10n.getConstant("browse")),n=(this.button=new P.Button({content:n,enableRtl:this.parent.enableRtl}),this.button.isStringTemplate=!0,this.button.createElement=this.parent.createElement,this.button.appendTo(l),j.Browser.isDevice?d:l),l=(j.EventHandler.add(n,"click",this.fileSelect,this),this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}}));return t.appendChild(l),this.uploadObj=new U.Uploader({asyncSettings:{saveUrl:this.parent.insertVideoSettings.saveUrl,removeUrl:this.parent.insertVideoSettings.removeUrl},dropArea:d,multiple:!1,enableRtl:this.parent.enableRtl,allowedExtensions:this.parent.insertVideoSettings.allowedTypes.toString(),selected:function(e){a.isVideoUploaded=!0,e.filesData,s.parent.trigger(wt,e,function(e){var n;e.cancel||j.isNullOrUndefined(e.filesData[0])||(s.checkExtension(e.filesData[0]),r=e.filesData[0].name,"HTML"===s.parent.editorMode&&j.isNullOrUndefined(s.parent.insertVideoSettings.path)&&((n=new FileReader).addEventListener("load",function(e){var t="Base64"===s.parent.insertVideoSettings.saveFormat?n.result:URL.createObjectURL(jr(n.result));a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o},a.inputUrl.setAttribute("disabled","true"),a.embedInputUrl.setAttribute("disabled","true"),j.isNullOrUndefined(a.parent.insertVideoSettings.saveUrl)&&s.isAllowedTypes&&!j.isNullOrUndefined(s.dialogObj)&&s.dialogObj.getButtons(0).element.removeAttribute("disabled")}),n.readAsDataURL(e.filesData[0].rawFile)))})},beforeUpload:function(e){s.parent.trigger(jt,e)},uploading:function(e){s.parent.isServerRendered||s.parent.trigger(xt,e)},success:function(e){s.parent.trigger(Dt,e,function(e){var t;j.isNullOrUndefined(s.parent.insertVideoSettings.path)||(t=s.parent.insertVideoSettings.path+e.file.name,a.uploadUrl={url:t,selection:i,fileName:r,selectParent:o,width:{width:a.parent.insertVideoSettings.width,minWidth:a.parent.insertVideoSettings.minWidth,maxWidth:a.parent.getInsertImgMaxWidth()},height:{height:a.parent.insertVideoSettings.height,minHeight:a.parent.insertVideoSettings.minHeight,maxHeight:a.parent.insertVideoSettings.maxHeight}},a.embedInputUrl.setAttribute("disabled","true")),"upload"!==e.operation||j.isNullOrUndefined(s.dialogObj)||s.dialogObj.getButtons(0).element.removeAttribute("disabled")})},failure:function(e){s.parent.trigger(Mt,e)},removing:function(){s.parent.trigger(Bt,e,function(e){a.isVideoUploaded=!1,s.dialogObj.getButtons(0).element.disabled=!0,a.inputUrl.getAttribute("disabled")&&a.inputUrl.removeAttribute("disabled"),a.embedInputUrl.getAttribute("disabled")&&a.embedInputUrl.removeAttribute("disabled"),a.uploadUrl&&(a.uploadUrl.url="")})}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(l),t},E.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},E.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},E.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0}),this.isVideoUploaded&&this.uploadObj.removing()},E.prototype.insertVideoUrl=function(e){var t,n=this.selfVideo,i=(n.isVideoUploaded=!1,n.inputUrl.value),o=n.embedInputUrl.value;0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),j.isNullOrUndefined(n.uploadUrl)||""===n.uploadUrl.url?"HTML"!==n.parent.editorMode||""===i&&""===o||("HTML"===n.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selection.range.startContainer.parentNode,"[id='"+n.contentModule.getPanel().id+"']"))&&(n.contentModule.getEditPanel().focus(),t=n.parent.formatter.editorManager.nodeSelection.getRange(n.contentModule.getDocument()),this.selection=n.parent.formatter.editorManager.nodeSelection.save(t,n.contentModule.getDocument()),this.selectParent=n.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)),o=(t=document.getElementById("webURL")).checked?i.split("/")[i.split("/").length-1]:o,i={cssClass:"Inline"===n.parent.insertVideoSettings.layoutOption?vi:hi,url:i,selection:this.selection,fileName:o,isEmbedUrl:!t.checked,selectParent:this.selectParent,width:{width:n.parent.insertVideoSettings.width,minWidth:n.parent.insertVideoSettings.minWidth,maxWidth:n.parent.getInsertImgMaxWidth()},height:{height:n.parent.insertVideoSettings.height,minHeight:n.parent.insertVideoSettings.minHeight,maxHeight:n.parent.insertVideoSettings.maxHeight}},n.dialogObj.hide({returnValue:!1}),null===n.dialogObj&&n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,i)):(n.uploadUrl.cssClass="Inline"===n.parent.insertVideoSettings.layoutOption?vi:hi,n.uploadUrl.width={width:n.parent.insertVideoSettings.width,minWidth:n.parent.insertVideoSettings.minWidth,maxWidth:n.parent.getInsertImgMaxWidth()},n.uploadUrl.height={height:n.parent.insertVideoSettings.height,minHeight:n.parent.insertVideoSettings.minHeight,maxHeight:n.parent.insertVideoSettings.maxHeight},n.dialogObj.hide({returnValue:!1}),null===n.dialogObj&&(n.parent.formatter.process(n.parent,this.args,this.args.originalEvent,n.uploadUrl),n.uploadUrl.url=""))},E.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedVidEle=void 0,this.removeEventListener(),this.showPopupTime&&(clearTimeout(this.showPopupTime),this.showPopupTime=null),this.clearDialogObj(),this.isDestroyed=!0)},E.prototype.getModuleName=function(){return"video"};var Sl=E;function E(e,t){this.isVideoUploaded=!1,this.isAllowedTypes=!0,this.pageX=null,this.pageY=null,this.mouseX=null,this.deletedVid=[],this.isResizeBind=!0,this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1,this.docClick=this.onDocumentClick.bind(this)}Tl=function(e,t){return(Tl=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Tl,Ol,Ll,kl=function(e,t){function n(){this.constructor=e}Tl(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},wl=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},xl={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,space:32,escape:27,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,semicolon:186,plus:187,comma:188,minus:189,dot:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222,"]":221,"[":219,"=":187,"<":188,">":190,"`":192},Dl=(Ol=j.Base,kl(Ml,Ol),(Ll=Ml).prototype.destroy=function(){this.unwireEvents(),Ol.prototype.destroy.call(this)},Ml.prototype.onPropertyChanged=function(e,t){},Ml.prototype.bind=function(){this.wireEvents()},Ml.prototype.getModuleName=function(){return"keyboard"},Ml.prototype.wireEvents=function(){this.element.addEventListener(this.eventName,this.keyPressHandler)},Ml.prototype.unwireEvents=function(){this.element.removeEventListener(this.eventName,this.keyPressHandler)},Ml.getKeyConfigData=function(e){var t,n;return e in this.configCache?this.configCache[""+e]:(n={altKey:-1!==(t=e.toLowerCase().split("+")).indexOf("alt"),ctrlKey:-1!==t.indexOf("ctrl"),shiftKey:-1!==t.indexOf("shift"),keyCode:null},1<t[t.length-1].length&&Number(t[t.length-1])?n.keyCode=Number(t[t.length-1]):n.keyCode=Ll.getKeyCode(t[t.length-1]),Ll.configCache[""+e]=n)},Ml.getKeyCode=function(e){return xl[""+e]||e.toUpperCase().charCodeAt(0)},Ml.configCache={},wl([j.Property({})],Ml.prototype,"keyConfigs",void 0),wl([j.Property("keyup")],Ml.prototype,"eventName",void 0),wl([j.Event()],Ml.prototype,"keyAction",void 0),Ll=wl([j.NotifyPropertyChanges],Ml));function Ml(e,t){var h=Ol.call(this,t,e)||this;return h.keyPressHandler=function(e){for(var t=e.altKey,n=e.ctrlKey,i=e.shiftKey,o=e.metaKey,r=e.which,s=0,a=Object.keys(h.keyConfigs);s<a.length;s++)for(var l=a[s],d=0,c=h.keyConfigs[""+l].split(",");d<c.length;d++){var p=c[d],p=Ll.getKeyConfigData(p.trim());t!==p.altKey||n!==p.ctrlKey&&!o||i!==p.shiftKey||r!==p.keyCode||(e.action=l)}h.keyAction&&h.keyAction(e)},h.bind(),h}Rl.prototype.addEventListener=function(){this.parent.on(ze,this.sourceCode,this),this.parent.on(n,this.onInitialEnd,this),this.parent.on(_e,this.updateSourceCode,this),this.parent.on(o,this.destroy,this)},Rl.prototype.onInitialEnd=function(){this.parent.formatter.editorManager.observer.on(u,this.onKeyDown,this)},Rl.prototype.removeEventListener=function(){this.unWireEvent(),this.parent.off(ze,this.sourceCode),this.parent.off(_e,this.updateSourceCode),this.parent.off(n,this.onInitialEnd),this.parent.off(o,this.destroy),this.parent.formatter.editorManager.observer.off(u,this.onKeyDown)},Rl.prototype.getSourceCode=function(){return this.parent.createElement("textarea",{className:Do+this.parent.getCssClass(!0)})},Rl.prototype.wireEvent=function(e){this.keyboardModule=new Dl(e,{keyAction:this.previewKeyDown.bind(this),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"}),j.EventHandler.add(this.previewElement,"mousedown",this.mouseDownHandler,this)},Rl.prototype.unWireEvent=function(){this.previewElement&&j.EventHandler.remove(this.previewElement,"mousedown",this.mouseDownHandler),this.keyboardModule&&!this.keyboardModule.isDestroyed&&this.keyboardModule.destroy()},Rl.prototype.wireBaseKeyDown=function(){this.parent.keyboardModule=new Dl(this.contentModule.getEditPanel(),{keyAction:this.parent.keyDown.bind(this.parent),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"})},Rl.prototype.unWireBaseKeyDown=function(){this.parent.keyboardModule.destroy()},Rl.prototype.mouseDownHandler=function(e){this.parent.notify(Xe,{args:e})},Rl.prototype.previewKeyDown=function(e){switch(e.action){case"html-source":this.updateSourceCode(e),e.preventDefault();break;case"toolbar-focus":var t;this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&((t=this.parent.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]")).firstElementChild.removeAttribute("tabindex"),t.firstElementChild.focus())}},Rl.prototype.onKeyDown=function(e){"html-source"===e.event.action&&(e.event.preventDefault(),this.sourceCode(e),e.callBack({requestType:"SourceCode",editorMode:"HTML",event:e.event}))},Rl.prototype.sourceCode=function(i){var o=this;this.parent.notify(dn,{}),this.parent.isBlur=!1,this.parent.trigger(Le,{requestType:"SourceCode",targetItem:"SourceCode",args:i,cancel:!1},function(e){var t,n;e.cancel||(e=j.selectAll("."+Yn,o.parent.element),o.contentModule=o.rendererFactory.getRenderer(m.RenderType.Content),t=o.parent.inputElement.getBoundingClientRect().height,o.parent.rootContainer.classList.add("e-source-code-enabled"),o.parent.notify(xe,{targetItem:"SourceCode",updateItem:"Preview",baseToolbar:o.parent.getBaseToolbarObject()}),j.isNullOrUndefined(o.previewElement)&&(o.previewElement=o.getSourceCode()),o.parent.inputElement.innerHTML=o.replaceAmpersand(o.parent.inputElement.innerHTML),n=void o.parent.updateValueData(),j.isNullOrUndefined(o.parent.element.querySelector("#"+o.parent.getID()+"_source-view"))?n=o.parent.createElement("div",{className:"e-source-content",id:o.parent.getID()+"_source-view",attrs:{style:"height:"+t+"px"}}):(n=o.parent.element.querySelector("#"+o.parent.getID()+"_source-view")).style.height=t+"px",n.appendChild(o.previewElement),o.parent.rootContainer.appendChild(n),o.getPanel().value=o.getTextAreaValue(),o.parent.isBlur=!1,o.parent.disableToolbarItem(o.parent.toolbarSettings.items),o.parent.enableToolbarItem("SourceCode"),o.parent.getToolbar()&&j.removeClass([o.parent.getToolbar()],[Ti]),j.removeClass(e,[Si]),o.wireEvent(o.previewElement),o.unWireBaseKeyDown(),o.previewElement.focus(),o.parent.inputElement.innerHTML=o.replaceAmpersand(o.parent.inputElement.innerHTML),o.parent.updateValue(),o.parent.trigger(ke,{requestType:"SourceCode",targetItem:"SourceCode",args:i}),o.parent.invokeChangeEvent(),!j.isNullOrUndefined(o.parent.saveInterval)&&0<o.parent.saveInterval&&o.parent.autoSaveOnIdle&&(o.codeViewTimeInterval=setInterval(function(){o.parent.notify(hn,{})},o.parent.saveInterval)))})},Rl.prototype.updateSourceCode=function(n){var i=this;this.parent.isBlur=!1,this.parent.trigger(Le,{requestType:"Preview",targetItem:"Preview",args:n,cancel:!1},function(e){var t;e.cancel||(i.parent.rootContainer.classList.remove("e-source-code-enabled"),e=i.getPanel(),i.parent.notify(xe,{targetItem:"Preview",updateItem:"SourceCode",baseToolbar:i.parent.getBaseToolbarObject()}),j.isNullOrUndefined(e)||(e.value=i.replaceAmpersand(e.value)),t=void 0,t=null===(e=i.parent.serializeValue(e.value))||""===e?"DIV"===i.parent.enterKey?"<div><br/></div>":"BR"===i.parent.enterKey?"<br/>":"<p><br/></p>":e,i.contentModule.getEditPanel().innerHTML=i.replaceAmpersand(t),i.parent.isBlur=!1,i.parent.enableToolbarItem(i.parent.toolbarSettings.items),i.parent.getToolbar()&&j.removeClass([i.parent.getToolbar()],[Ti]),i.unWireEvent(),i.wireBaseKeyDown(),i.contentModule.getEditPanel().focus(),i.parent.updateValue(),i.parent.trigger(ke,{requestType:"Preview",targetItem:"Preview",args:n}),i.parent.formatter.enableUndo(i.parent),i.parent.addAudioVideoWrapper(),clearTimeout(i.codeViewTimeInterval),i.parent.invokeChangeEvent(),i.parent.notify(_,{}))})},Rl.prototype.replaceAmpersand=function(i){var o=this;return"HTML"===this.parent.editorMode&&["times","divide","ne"].forEach(function(e){var t,n=new RegExp("&(amp;)*("+e+")","g");i=o.parent.enableHtmlSanitizer?(t=o.parent.enableHtmlEncode?"&amp;amp;amp;amp;"+e:"&amp;amp;"+e,i.replace(n,t)):i.replace(n,"&amp;"+e)}),i},Rl.prototype.getTextAreaValue=function(){return"<p><br></p>"===this.contentModule.getEditPanel().innerHTML||"<div><br></div>"===this.contentModule.getEditPanel().innerHTML||"<br>"===this.contentModule.getEditPanel().innerHTML||1===this.contentModule.getEditPanel().childNodes.length&&"P"===this.contentModule.getEditPanel().childNodes[0].tagName&&7===this.contentModule.getEditPanel().innerHTML.length||"DIV"===this.contentModule.getEditPanel().childNodes[0].tagName&&11===this.contentModule.getEditPanel().innerHTML.length?"":this.parent.value},Rl.prototype.getPanel=function(){return this.parent.element&&this.parent.element.querySelector(".e-rte-srctextarea")},Rl.prototype.destroy=function(){j.isNullOrUndefined(this.parent)||this.removeEventListener()};var Bl=Rl;function Rl(e,t){this.parent=e;e=t;this.rendererFactory=e.getService("rendererFactory"),this.addEventListener()}S.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(lt,this.renderDlgContent,this),this.parent.on(n,this.afterRender,this),this.parent.on(_t,this.afterRender,this),this.parent.on(tn,this.showDialog,this),this.parent.on(nn,this.closeDialog,this),this.parent.on(dt,this.docClick,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(Ye,this.editAreaClickHandler,this),this.parent.on(ft,this.clearDialogObj,this),this.parent.on(ct,this.onToolbarAction,this),this.parent.on(pe,this.dropdownSelect,this),this.parent.on(h,this.keyDown,this),this.parent.on(ne,this.tableModulekeyUp,this),this.parent.on(on,this.setCssClass,this),this.parent.on(o,this.destroy,this),this.parent.on(pn,this.afterKeyDown,this))},S.prototype.removeEventListener=function(){this.parent.off(lt,this.renderDlgContent),this.parent.off(n,this.afterRender),this.parent.off(_t,this.afterRender),this.parent.off(dt,this.docClick),this.parent.off(K,this.onIframeMouseDown),this.parent.off(tn,this.showDialog),this.parent.off(nn,this.closeDialog),this.parent.off(Ye,this.editAreaClickHandler),this.parent.off(ft,this.clearDialogObj),this.parent.off(ct,this.onToolbarAction),this.parent.off(pe,this.dropdownSelect),this.parent.off(Ge,this.cellSelect),this.parent.off(et,this.setBGColor),this.parent.off(h,this.keyDown),this.parent.off(ne,this.tableModulekeyUp),this.parent.off(on,this.setCssClass),this.parent.off(o,this.destroy),this.parent.off(pn,this.afterKeyDown),!j.Browser.isDevice&&this.parent.tableSettings.resize&&(j.EventHandler.remove(this.contentModule.getEditPanel(),"mouseover",this.resizeHelper),j.EventHandler.remove(this.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart))},S.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},S.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)||g([this.popupObj.element],e.oldCssClass),j.addClass([this.popupObj.element],e.cssClass)),this.updateCss(this.createTableButton,e),this.updateCss(this.editdlgObj,e);for(var t=[this.columnTextBox,this.rowTextBox,this.tableWidthNum,this.tableCellPadding,this.tableCellSpacing],n=0;n<t.length;n++)this.updateCss(t[n],e)},S.prototype.afterRender=function(){j.isNullOrUndefined(this.contentModule)&&(this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),this.parent.on(et,this.setBGColor,this),this.parent.on(Ge,this.cellSelect,this),this.parent.tableSettings.resize&&j.EventHandler.add(this.parent.contentModule.getEditPanel(),j.Browser.touchStartEvent,this.resizeStart,this),!j.Browser.isDevice)&&this.parent.tableSettings.resize&&j.EventHandler.add(this.contentModule.getEditPanel(),"mouseover",this.resizeHelper,this)},S.prototype.dropdownSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Table"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i={args:e,selection:this.parent.formatter.editorManager.nodeSelection.save(n,this.contentModule.getDocument()),selectParent:this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)};switch(t.subCommand){case"InsertRowBefore":case"InsertRowAfter":this.addRow(i.selection,e);break;case"InsertColumnLeft":case"InsertColumnRight":this.addColumn(i.selection,e);break;case"DeleteColumn":case"DeleteRow":this.removeRowColumn(i.selection,e);break;case"AlignTop":case"AlignMiddle":case"AlignBottom":this.verticalAlign(i,e);break;case"Dashed":case"Alternate":case"Custom":this.tableStyles(i,e);break;case"Merge":case"VerticalSplit":case"HorizontalSplit":this.UpdateCells(i.selection,e)}}},S.prototype.UpdateCells=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar()},S.prototype.keyDown=function(e){var t,n=e.args;switch(n.action){case"escape":break;case"insert-table":this.openDialog(!0,e),n.preventDefault()}if(!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&"KeyK"!==n.code){var i=void 0,o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(o)[0];if(r=r&&"TD"!==r.tagName&&"TH"!==r.tagName?r.parentElement:r,(8===n.keyCode||46===n.keyCode||n.ctrlKey&&88===n.keyCode)&&(r&&"TBODY"===r.tagName?(!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(i=this.parent.formatter.editorManager.nodeSelection.save(o,this.contentModule.getDocument())),n.preventDefault(),this.removeTable(i,n,!0)):r&&0<r.querySelectorAll("table").length&&(this.removeResizeElement(),this.hideTableQuickToolbar())),r&&"TD"!==r.tagName&&"TH"!==r.tagName&&(s=j.closest(r,"td"),r=!j.isNullOrUndefined(s)&&this.parent.inputElement.contains(s)?s:r),r&&("TD"===r.tagName||"TH"===r.tagName)){var s=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");if(!j.isNullOrUndefined(this.activeCell)&&this.activeCell===r||j.isNullOrUndefined(s)||0!==s.length||(this.activeCell=r),!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(i=this.parent.formatter.editorManager.nodeSelection.save(o,this.contentModule.getDocument())),!n.shiftKey||n.shiftKey&&9===n.keyCode)switch(n.keyCode){case 9:case 37:case 39:this.removeCellSelectClasses(),this.tabSelection(n,i,r);break;case 40:case 38:this.removeCellSelectClasses(),this.tableArrowNavigation(n,i,r)}}}!n.shiftKey||39!==n.keyCode&&37!==n.keyCode&&38!==n.keyCode&&40!==n.keyCode||(this.keyDownEventInstance=n,j.EventHandler.add(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection,this)),n.ctrlKey&&"a"===n.key&&this.handleSelectAll(),("Delete"===n.code&&46===n.which||"Backspace"===n.code&&8===n.which)&&"HTML"===this.parent.editorMode?(o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer.nodeType===Node.ELEMENT_NODE&&"DIV"===o.startContainer.nodeName&&o.startContainer.classList.contains("e-table-fake-selection")?(this.deleteTable(),n.preventDefault()):(t="Delete"===n.code&&46===n.which?this.getAdjacentTableElement(o,!0):this.getAdjacentTableElement(o,!1))&&(this.updateTableSelection(t),n.preventDefault()):(s=n.shiftKey&&"Enter"===n.key,o=-1!==Mo.indexOf(n.key),(s||o||n.key&&1===n.key.length)&&((t=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select"))&&(39===n.keyCode||37===n.keyCode?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),t,0):(s=t.querySelector("tr").cells[0],this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),s,s,0,0))),this.removeTableSelection()))},S.prototype.tableCellsKeyboardSelection=function(e){j.EventHandler.remove(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection);var t,n,i,o=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.keyDownEventInstance,o=!(j.isNullOrUndefined(o)||j.isNullOrUndefined(o.commonAncestorContainer)||o.commonAncestorContainer.nodeType!==Node.ELEMENT_NODE||"TR"!==o.commonAncestorContainer.tagName&&"TBODY"!==o.commonAncestorContainer.tagName||j.isNullOrUndefined(this.activeCell)),s=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");!j.isNullOrUndefined(s)&&0<s.length&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),s[0],s[0],0,0),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),s[0],0)),(o||!j.isNullOrUndefined(s)&&0<s.length)&&(o=this.getCorrespondingColumns(),n=!j.isNullOrUndefined(s)&&0<s.length?s[0]:this.activeCell,t=(n=this.getCorrespondingIndex(n,o))[0],n=n[1],i=void 0,39===r.keyCode?n<o[0].length-1?i=o[t][n+1]:t<o.length-1?(i=o[t+1][n],0===s.length&&t<o.length-1&&(this.activeCell=o[t][0])):this.resetTableSelection():37===r.keyCode?0<n?i=o[t][n-1]:0<t?(i=o[t-1][n],0===s.length&&0<t&&(this.activeCell=o[t][o[t].length-1])):this.resetTableSelection():38===r.keyCode?0<t?i=o[t-1][n]:this.resetTableSelection():40===r.keyCode&&(t<o.length-1?i=o[t+1][n]:this.resetTableSelection()),i)&&this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:{target:i},selectNode:[this.activeCell]}),0<s.length&&(r.preventDefault(),e.preventDefault())},S.prototype.resetTableSelection=function(){var e=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");!j.isNullOrUndefined(e)&&0<e.length&&this.parent.formatter.editorManager.nodeSelection.setSelectionNode(this.parent.contentModule.getDocument(),this.curTable),this.activeCell=null,this.removeCellSelectClasses(),this.removeTableSelection()},S.prototype.getCorrespondingColumns=function(){for(var e=[],t=this.curTable.rows,n=0;n<=t.length-1;n++)for(var i=t[n],o=0,r=0;r<=i.children.length-1;r++){for(var s=i.children[r],a=s,l=parseInt(a.getAttribute("colspan"),10)||1,d=parseInt(a.getAttribute("rowspan"),10)||1,c=n;c<n+d;c++)for(var p=o;p<o+l;p++)e[c]||(e[c]=[]),e[c][p]?o++:e[c][p]=s;o+=0}return e},S.prototype.getCorrespondingIndex=function(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(t[n][i]===e)return[n,i];return[]},S.prototype.getAdjacentTableElement=function(e,t){if(!e.collapsed||!t&&this.quickToolObj&&this.quickToolObj.tableQTBar&&document.body.contains(this.quickToolObj.tableQTBar.element))return null;var n=this.getNodeCollection(e),i=e.collapsed&&this.parent.contentModule.getEditPanel()===e.startContainer&&n&&0<n.length&&n[0]?n[0]:e.startContainer,o=this.getSelectedTableEle(n),n=this.getBrElement(e,n);if(i&&i.nodeType===Node.ELEMENT_NODE&&("IMG"===i.tagName||i.querySelector("img")||"AUDIO"===i.tagName||i.querySelector("audio")||"VIDEO"===i.tagName||i.querySelector("video")||i.querySelector(".e-video-clickelem"))){var r=this.contentModule.getDocument().createRange(),s=(r.collapse(!0),r.selectNodeContents(i),this.parent.formatter.editorManager.nodeSelection.getIndex(i));if(t&&r.startOffset>=e.startOffset||!t&&("IMG"!==i.tagName&&r.startOffset!==e.startOffset||"IMG"===i.tagName&&s!==e.startOffset))return null}if(i&&i.nodeType===Node.TEXT_NODE)if(t){if(e.endOffset!==e.endContainer.textContent.length&&e.endOffset!==e.endContainer.textContent.trim().length)return null}else if(0!==e.startOffset)return null;return(o=i&&i.nodeType===Node.ELEMENT_NODE&&"TABLE"===i.tagName?i:o)&&(r=this.parent.formatter.editorManager.nodeSelection.getIndex(o),e.startOffset===r&&t||e.startOffset!==r&&!t||(o=null)),(o=!o&&i?this.getAdjacentElementFromDom(i,n,t):o)&&o.nodeType===Node.ELEMENT_NODE&&"TABLE"===o.tagName?(this.setSelection(o,n),o):null},S.prototype.getAdjacentElementFromDom=function(e,t,n){for(var i,o=t||e.parentNode,r=e;o&&!i&&o.parentNode;){var s=Array.from(o.childNodes),a=s.indexOf(r);if(-1!==a&&(n&&a<s.length-1||!n&&0<a)?i=s[n?a+1:a-1]:(i=n?o.nextSibling:o.previousSibling,r=o),!t&&e.nodeType===Node.TEXT_NODE&&i&&i.tagName&&"BR"===i.tagName.toUpperCase()&&(t=r=o=i,i=null),t||!i||i.nodeType===Node.ELEMENT_NODE&&"TABLE"===i.tagName||j.isNullOrUndefined(i.textContent)||i.textContent.trim()||(r=o=i.parentNode,i=null),i&&i.tagName&&-1!==["UL","OL","LI"].indexOf(i.tagName.toUpperCase())&&!(i=this.getAdjacentElementFromList(i,n)))return null;o&&o.tagName&&"LI"===o.tagName.toUpperCase()&&!n&&(i=o),o=o.parentNode}return i},S.prototype.getAdjacentElementFromList=function(e,t){for(;e;){if(e.tagName&&-1===["UL","OL","LI"].indexOf(e.tagName.toUpperCase())){e.nodeType===Node.ELEMENT_NODE&&"TABLE"===e.tagName||(e=t?e.firstChild:e.lastChild);break}e=t?e.firstChild:e.lastChild}return e},S.prototype.getNodeCollection=function(e){var t,n=[];return e.collapsed&&this.parent.contentModule.getEditPanel()===e.startContainer&&0<e.startContainer.childNodes.length?(t=Math.max(0,Math.min(e.startContainer.childNodes.length-1,e.endOffset-1)),n.push(e.startContainer.childNodes[t])):n=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(e),n},S.prototype.getSelectedTableEle=function(e){if(e&&0<e.length)for(var t=0,n=Array.from(e);t<n.length;t++){var i=n[t];if(i&&"TABLE"===i.tagName)return i}return null},S.prototype.getBrElement=function(e,t){return"BR"===e.endContainer.tagName?e.endContainer:1===t.length&&t[0]&&"BR"===t[0].tagName?t[0]:null},S.prototype.setSelection=function(e,t){e.classList.contains("e-cell-select")||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),t&&(t.parentNode&&1===t.parentNode.childNodes.length&&"BR"===t.parentNode.firstChild.nodeName?j.detach(t.parentNode):j.detach(t)),(e=this.parent.createElement("div",{className:"e-table-fake-selection"})).setAttribute("contenteditable","false"),this.contentModule.getEditPanel().appendChild(e),this.parent.formatter.editorManager.nodeSelection.setSelectionNode(this.contentModule.getDocument(),e))},S.prototype.removeAllFakeSelectionEles=function(){var e=this.parent.contentModule.getEditPanel().querySelectorAll(".e-table-fake-selection");e&&0<e.length&&e.forEach(function(e){j.detach(e)})},S.prototype.deleteTable=function(){var e,t,n=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select");this.removeResizeElement(),n&&(t=e=document.createElement("br"),"DIV"===this.parent.enterKey?(t=document.createElement("div")).appendChild(e):"P"===this.parent.enterKey&&(t=document.createElement("p")).appendChild(e),n.parentNode.replaceChild(t,n),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),t,t,0,0),this.removeTableSelection())},S.prototype.removeTableSelection=function(){var e=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select");e&&g([e],Qi),this.removeAllFakeSelectionEles()},S.prototype.updateTableSelection=function(e){j.addClass([e],"e-cell-select")},S.prototype.handleSelectAll=function(){this.cancelResizeAction(),g(this.parent.inputElement.querySelectorAll("."+Qi),Qi),this.removeTableSelection()},S.prototype.tableModulekeyUp=function(e){var t,n;!j.isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),(t=(t=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)[0])&&"TD"!==t.tagName&&"TH"!==t.tagName?t.parentElement:t)&&"TD"!==t.tagName&&"TH"!==t.tagName&&(n=j.closest(t,"td"),t=!j.isNullOrUndefined(n)&&this.parent.inputElement.contains(n)?n:t),n=e.args,this.previousTableElement===t||j.isNullOrUndefined(this.previousTableElement)||n.shiftKey||39!==n.keyCode&&37!==n.keyCode&&38!==n.keyCode&&40!==n.keyCode||(g([this.previousTableElement],Qi),this.removeTableSelection()))},S.prototype.openDialog=function(e,t){var n,i;e||this.parent.contentModule.getEditPanel().focus(),"HTML"===this.parent.editorMode&&(i=this.parent.contentModule.getDocument(),n=this.parent.formatter.editorManager.nodeSelection.getRange(i),n=this.parent.formatter.editorManager.nodeSelection.save(n,i),i={originalEvent:t?t.args:{action:"insert-table"},item:{command:"Table",subCommand:"CreateTable"},name:e?null:"showDialog"},this.insertTableDialog({self:this,args:i,selection:n}))},S.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},S.prototype.closeDialog=function(){this.editdlgObj&&this.editdlgObj.hide({returnValue:!0})},S.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"TableHeader":this.tableHeader(e.selection,e.args);break;case"TableRemove":this.removeTable(e.selection,e.args);break;case"TableEditProperties":this.editTable(e)}},S.prototype.verticalAlign=function(e,t){e=j.closest(e.selectParent[0],"th")||j.closest(e.selectParent[0],"td");e&&this.parent.formatter.process(this.parent,t,t,{tableCell:e,subCommand:t.item.subCommand})},S.prototype.tableStyles=function(e,t){var n=t.item.subCommand,i=j.closest(e.selectParent[0],"table");if("Dashed"===n&&(this.parent.element.classList.contains(Gi)?g([this.parent.element],Gi):this.parent.element.classList.add(Gi),i.classList.contains(Gi)?g([i],Gi):i.classList.add(Gi)),"Alternate"===n&&(this.parent.element.classList.contains(Xi)?g([this.parent.element],Xi):this.parent.element.classList.add(Xi),i.classList.contains(Xi)?g([i],Xi):i.classList.add(Xi)),e.args&&e.args.item.cssClass)for(var o=e.args.item.cssClass.split(" "),r=0;r<o.length;r++)i.classList.contains(o[r])?g([i],o[r]):i.classList.add(o[r]);this.parent.formatter.process(this.parent,t,t,{subCommand:t.item.subCommand}),this.parent.formatter.saveData(),this.hideTableQuickToolbar(),this.parent.formatter.editorManager.nodeSelection.restore()},S.prototype.insideList=function(e){for(var t=this.getBlockNodesInSelection(e),n=[],i=0;i<t.length;i++)"LI"===t[i].parentNode.tagName?n.push(t[i].parentNode):"LI"===t[i].tagName&&"P"!==t[i].childNodes[0].tagName&&"OL"!==t[i].childNodes[0].tagName&&"UL"!==t[i].childNodes[0].tagName&&n.push(t[i]);return 1<n.length||n.length&&0===e.startOffset&&0===e.endOffset?this.ensureInsideTableList=!0:this.ensureInsideTableList=!1},S.prototype.getBlockNodesInSelection=function(t){var e,n=["DIV","SECTION","HEADER","FOOTER","ARTICLE","NAV","P","H1","H2","H3","BLOCKQUOTE","LI","PRE","TD","TH","FORM","FIELDSET","LEGEND","LABEL","TEXTAREA"],i=new Set,o=this.contentModule.getDocument().createTreeWalker(t.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return t.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});if(t.collapsed)(e=this.getImmediateBlockNode(t.startContainer,n))&&i.add(e);else for(;o.nextNode();)(e=this.getImmediateBlockNode(o.currentNode,n))&&i.add(e);return Array.from(i)},S.prototype.getImmediateBlockNode=function(e,t){for(var n=e.nodeType===Node.TEXT_NODE?e.parentNode:e;n&&n.nodeType===Node.ELEMENT_NODE;){var i=n;if(-1<t.indexOf(i.tagName))return i;n=n.parentNode}return null},S.prototype.removeEmptyTextNodes=function(e){for(var t=e.childNodes,n=t.length-1;0<=n;n--){var i=t[n];i.nodeType===Node.TEXT_NODE&&""===i.nodeValue.trim()&&e.removeChild(i)}},S.prototype.tabSelection=function(e,t,n){for(var i=n.closest("table").querySelectorAll("thead, tbody, tr"),o=0;o<i.length;o++)this.removeEmptyTextNodes(i[o]);this.previousTableElement=n;var r=this.insideList(t.range);if(37!==e.keyCode&&39!==e.keyCode&&!r)if(e.preventDefault(),g([n],Qi),this.removeTableSelection(),e.shiftKey||37===e.keyCode){r=j.isNullOrUndefined(n.previousSibling)?j.isNullOrUndefined(j.closest(n,"tr").previousSibling)?!j.isNullOrUndefined(j.closest(n,"table").previousSibling)&&"td"===j.closest(n,"table").previousSibling.nodeName.toLowerCase()?j.closest(n,"table").previousSibling:n:j.closest(n,"tr").previousSibling.childNodes[j.closest(n,"tr").previousSibling.childNodes.length-1]:n.previousSibling;if(n===r&&0===n.cellIndex&&j.closest(n,"table").tHead&&"TH"!==n.nodeName&&(r=(a=j.closest(n,"table")).rows[0].cells[a.rows[0].cells.length-1]),37===e.keyCode&&n===r&&(r=j.closest(n,"table").previousSibling),!j.isNullOrUndefined(r)&&"TABLE"===r.firstChild.nodeName){for(var s=r;!j.isNullOrUndefined(s.firstChild)&&"TABLE"===s.firstChild.nodeName&&0<s.firstChild.rows.length&&0<s.firstChild.rows[0].cells.length;)s=s.firstChild.rows[0].cells[0];r=s}r&&(""!==r.textContent.trim()&&j.closest(r,"td")?t.setSelectionNode(this.contentModule.getDocument(),r):t.setSelectionText(this.contentModule.getDocument(),r,r,0,0))}else{var a=j.isNullOrUndefined(n.nextSibling)?j.isNullOrUndefined(j.closest(n,"tr").nextSibling)?!j.isNullOrUndefined(j.closest(n,"table").nextSibling)&&"td"===j.closest(n,"table").nextSibling.nodeName.toLowerCase()?j.closest(n,"table").nextSibling:n:j.closest(n,"tr").nextSibling.childNodes[0]:n.nextSibling;n===a&&"TH"===n.nodeName&&(a=j.closest(n,"table").rows[1].cells[0]),(a=39===e.keyCode&&n===a?j.closest(n,"table").nextSibling:a)&&(""!==a.textContent.trim()&&j.closest(a,"td")?t.setSelectionNode(this.contentModule.getDocument(),a):t.setSelectionText(this.contentModule.getDocument(),a,a,0,0)),n===a&&39!==e.keyCode&&a&&(n.classList.add(Qi),this.addRow(t,e,!0),g([n],Qi),this.removeTableSelection(),""!==(a=(a.parentElement.nextSibling||a.parentElement).firstChild).textContent.trim()&&j.closest(a,"td")?t.setSelectionNode(this.contentModule.getDocument(),a):t.setSelectionText(this.contentModule.getDocument(),a,a,0,0))}},S.prototype.tableArrowNavigation=function(e,t,n){var i=t.range.startContainer;40===e.keyCode&&3===i.nodeType&&(i.nextSibling&&"BR"===i.nextSibling.nodeName||i.parentNode&&"TD"!==i.parentNode.nodeName)||38===e.keyCode&&3===i.nodeType&&(i.previousSibling&&"BR"===i.previousSibling.nodeName||i.parentNode&&"TD"!==i.parentNode.nodeName)||(e.preventDefault(),g([n],Qi),this.removeTableSelection(),(n=40===e.keyCode?j.isNullOrUndefined(j.closest(n,"tr").nextElementSibling)?j.closest(n,"table").tHead&&"TH"===n.nodeName?j.closest(n,"table").rows[1].cells[n.cellIndex]:j.isNullOrUndefined(j.closest(n,"table").nextSibling)?n:j.closest(n,"table").nextSibling:j.closest(n,"tr").nextElementSibling.children[n.cellIndex]:j.isNullOrUndefined(j.closest(n,"tr").previousElementSibling)?j.closest(n,"table").tHead&&"TH"!==n.nodeName?j.closest(n,"table").tHead.rows[0].cells[n.cellIndex]:j.isNullOrUndefined(j.closest(n,"table").previousSibling)?n:j.closest(n,"table").previousSibling:j.closest(n,"tr").previousElementSibling.children[n.cellIndex])&&t.setSelectionText(this.contentModule.getDocument(),n,n,0,0))},S.prototype.setBGColor=function(e){for(var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),n=(this.parent.formatter.editorManager.nodeSelection.save(t,this.contentModule.getDocument()),this.curTable.querySelectorAll(".e-cell-select")),i=0;i<n.length;i++)n[i].style.backgroundColor=e.item.value;this.parent.formatter.process(this.parent,e,e.originalEvent,e.item.value),this.parent.formatter.saveData(),this.hideTableQuickToolbar()},S.prototype.hideTableQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.tableQTBar&&document.body.contains(this.quickToolObj.tableQTBar.element)&&this.quickToolObj.tableQTBar.hidePopup()},S.prototype.tableHeader=function(e,t){this.parent.formatter.process(this.parent,t,t.originalEvent,{selection:e,subCommand:t.item.subCommand})},S.prototype.getAnchorNode=function(e){var t=j.closest(e,"a");return t||e},S.prototype.editAreaClickHandler=function(e){var t,n,i,o,r,s,a,l,d;this.parent.readonly||!j.isNullOrUndefined(j.closest(e.args.target,".e-img-caption"))||(t=e.args,n=this.parent.quickToolbarSettings.showOnRightClick,2===t.which)||n&&1===t.which||!n&&3===t.which||"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.tableQTBar&&(this.quickToolObj=this.parent.quickToolbarModule,n=t.target,this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content),this.quickToolObj.tableQTBar.element.classList.contains("e-rte-pop")||(i=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument())).collapsed&&(o=j.closest(n,"table"),l=this.parent.getRange().startContainer.parentElement,d=this.parent.getRange().endContainer.parentElement,a=this.getAnchorNode(n),r=(new Date).getTime(),s=/Version\/\d+\.\d+.*Safari/.test(j.Browser.userAgent)&&!/Chrome|Edg|Firefox/.test(j.Browser.userAgent)&&3===t.which,!(n&&"A"!==n.nodeName&&"A"!==a.nodeName&&"IMG"!==n.nodeName&&"VIDEO"!==n.nodeName&&!n.classList.contains(li)&&"AUDIO"!==n.nodeName&&(l===d||s)&&("TD"===n.nodeName||"TH"===n.nodeName||"TABLE"===n.nodeName||o&&this.parent.contentModule.getEditPanel().contains(o))&&(3!==i.startContainer.nodeType||i.collapsed||s)&&100<r-this.resizeEndTime)||s&&i.collapsed&&0!==i.startOffset||s&&"#text"===i.endContainer.nodeName?this.hideTableQuickToolbar():(a=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.save(a,this.contentModule.getDocument()),l=void this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),d=void 0,d=j.Browser.isDevice&&e.args.touches?(l=this.parent.iframeSettings.enable?window.pageXOffset+this.parent.element.getBoundingClientRect().left+e.args.changedTouches[0].clientX:e.args.changedTouches[0].pageX,this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+(this.parent.inlineMode.enable?0:this.parent.toolbarModule.getToolbarHeight())+e.args.changedTouches[0].clientY:e.args.changedTouches[0].pageY):(l=this.parent.iframeSettings.enable?window.pageXOffset+this.parent.element.getBoundingClientRect().left+t.clientX:t.pageX,this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+this.parent.toolbarModule.getToolbarHeight()+t.clientY:t.pageY),this.quickToolObj.tableQTBar.showPopup(l,d,n),this.parent.formatter.editorManager.nodeSelection.restore())))},S.prototype.tableCellSelect=function(e){var e=e.target,i=Array.prototype.slice.call(e.parentElement.parentElement.children).indexOf(e.parentElement),o=Array.prototype.slice.call(e.parentElement.children).indexOf(e),e=this.dlgDiv.querySelectorAll(".e-rte-tablecell");Array.prototype.forEach.call(e,function(e){var t=Array.prototype.slice.call(e.parentElement.parentElement.children).indexOf(e.parentElement),n=Array.prototype.slice.call(e.parentElement.children).indexOf(e);g([e],"e-active"),t<=i&&n<=o&&j.addClass([e],"e-active")}),this.tblHeader.innerHTML=o+1+"x"+(i+1)},S.prototype.tableMouseUp=function(){this.unwireTableSelectionEvents(),this.isTableMoveActive=!1},S.prototype.tableMouseLeave=function(){this.unwireTableSelectionEvents(),this.isTableMoveActive=!1,this.resetTableSelection()},S.prototype.tableCellLeave=function(e){g(this.dlgDiv.querySelectorAll(".e-rte-tablecell"),"e-active"),j.addClass([this.dlgDiv.querySelector(".e-rte-tablecell")],"e-active"),this.tblHeader.innerHTML="1x1"},S.prototype.tableCellClick=function(e){var t=e.target,n=Array.prototype.slice.call(t.parentElement.parentElement.children).indexOf(t.parentElement)+1,t=Array.prototype.slice.call(t.parentElement.children).indexOf(t)+1;this.self.tableInsert(n,t,e,this)},S.prototype.tableInsert=function(e,t,n,i){var o=i.self||this,r=i.selection.range.startContainer,r=("P"!==r.nodeName||""!==r.textContent.trim()||0<r.childNodes.length||(r.innerHTML="<br />"),r.parentNode),r=("HTML"===o.parent.editorMode&&(o.parent.iframeSettings.enable&&!p(r.ownerDocument.querySelector("body"),"e-lib")||!o.parent.iframeSettings.enable&&j.isNullOrUndefined(j.closest(r,"[id='"+o.contentModule.getPanel().id+"']")))&&(o.contentModule.getEditPanel().focus(),r=o.parent.formatter.editorManager.nodeSelection.getRange(o.contentModule.getDocument()),i.selection=o.parent.formatter.editorManager.nodeSelection.save(r,o.contentModule.getDocument())),{rows:e,columns:t,width:{minWidth:o.parent.tableSettings.minWidth,maxWidth:o.parent.tableSettings.maxWidth,width:o.parent.tableSettings.width},selection:i.selection});if(o.popupObj){for(var s=Array.prototype.slice.call(n.target.parentElement.parentElement.children),a=0;a<s.length;a++){j.EventHandler.remove(s[a],"mouseleave",this.tableCellLeave);for(var l=Array.prototype.slice.call(s[a].children),d=0;d<l.length;d++)j.EventHandler.remove(l[d],"mousemove",this.tableCellSelect),j.EventHandler.remove(l[d],"mouseup",this.tableCellClick)}o.popupObj.hide()}o.editdlgObj&&o.editdlgObj.hide();e=window.scrollX,t=window.scrollY,o.parent.formatter.process(o.parent,i.args,i.args.originalEvent,r),o.contentModule.getEditPanel().focus(),window.scrollTo(e,t),o.parent.on(Ge,o.cellSelect,o),n=o.parent.formatter.editorManager.nodeSelection.get(o.contentModule.getDocument());j.isNullOrUndefined(n)||j.isNullOrUndefined(n.anchorNode)||n.anchorNode.nodeType!==Node.ELEMENT_NODE||"TD"!==n.anchorNode.tagName&&"TH"!==n.anchorNode.tagName||(o.curTable=j.closest(n.anchorNode,"table"),o.activeCell=n.anchorNode)},S.prototype.cellSelect=function(e){var t=e.args.target,n=j.closest(t,"td,th"),t="TD"!==t.nodeName&&n&&this.parent.contentModule.getEditPanel().contains(n)?n:t;j.isNullOrUndefined(this.activeCell)||!e.args.shiftKey||j.isNullOrUndefined(t)||j.isNullOrUndefined(t.tagName)||"TD"!==t.tagName&&"TH"!==t.tagName||this.activeCell===t?(this.parent.quickToolbarSettings.showOnRightClick&&3===e.args.which&&t.classList.contains(Qi)||(this.isTableMoveActive&&(this.unwireTableSelectionEvents(),this.isTableMoveActive=!1),this.activeCell=null,this.heightcheck(),this.removeCellSelectClasses(),this.removeTableSelection()),!t||"TD"!==t.tagName&&"TH"!==t.tagName||(j.addClass([t],Qi),this.activeCell=t,this.curTable=this.curTable||j.closest(t,"table"),this.wireTableSelectionEvents(),this.isTableMoveActive=!0,this.removeResizeElement(),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&j.detach(this.helper))):(this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:e.args,selectNode:[this.activeCell]}),e.args.preventDefault())},S.prototype.heightcheck=function(){var e=this.parent.contentModule.getEditPanel().querySelector("td.e-cell-select");e&&e.querySelector("img")&&e.querySelector("img").style.height.includes("%")&&(e.style.height="inherit")},S.prototype.wireTableSelectionEvents=function(){j.EventHandler.add(this.curTable,"mousemove",this.tableMove,this),j.EventHandler.add(this.curTable,"mouseup",this.tableMouseUp,this),j.EventHandler.add(this.curTable,"mouseleave",this.tableMouseLeave,this)},S.prototype.unwireTableSelectionEvents=function(){j.EventHandler.remove(this.curTable,"mousemove",this.tableMove),j.EventHandler.remove(this.curTable,"mouseup",this.tableMouseUp),j.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave)},S.prototype.removeCellSelectClasses=function(){g(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),Wi),g(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),Ki),g(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),Qi)},S.prototype.tableMove=function(e){this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:e,selectNode:[this.activeCell]})},S.prototype.resizeHelper=function(e){var t,n,i;this.parent.readonly||this.isTableMoveActive||e&&e.buttons&&0<e.buttons||(t=e.target||e.targetTouches[0].target,n=j.closest(t,"table.e-rte-table, table.e-rte-paste-table, table.e-rte-custom-table"),(i=0<this.parent.contentModule.getEditPanel().querySelectorAll(".e-table-box.e-rbox-select, .e-table-rhelper.e-column-helper, .e-table-rhelper.e-row-helper").length)||j.isNullOrUndefined(this.curTable)||j.isNullOrUndefined(n)||n===this.curTable||!this.parent.contentModule.getEditPanel().contains(n)||(this.removeResizeElement(),this.removeHelper(e),this.cancelResizeAction()),i)||"TABLE"!==t.nodeName&&"TD"!==t.nodeName&&"TH"!==t.nodeName||(this.curTable=n&&this.parent.contentModule.getEditPanel().contains(n)&&("TD"===t.nodeName||"TH"===t.nodeName)?n:t,this.removeResizeElement(),this.tableResizeEleCreation(this.curTable,e))},S.prototype.tableResizeEleCreation=function(e,t){this.parent.preventDefaultResize(t);for(var n=this.calMaxCol(this.curTable),i=[],o=0;o<e.rows.length;o++)for(var r=0;r<e.rows[o].cells.length;r++)if(!e.rows[o].cells[r].hasAttribute("rowspan")){i.push(Array.prototype.slice.call(e.rows[o].cells,0,e.rows[o].cells.length)[r]);break}for(var s=parseInt(getComputedStyle(e).height,10),a=parseInt(getComputedStyle(e).width,10),l=this.calcPos(e),o=0;n.length>=o;o++){var d=this.parent.createElement("span",{attrs:{"data-col":o.toString(),unselectable:"on",contenteditable:"false"}});d.classList.add(Lo,Yi),n.length===o?d.style.cssText="height: "+s+"px; width: 4px; top: "+l.top+"px; left:"+((n[o-1].classList.contains("e-multi-cells-select")?0:l.left)+this.calcPos(n[o-1]).left+n[o-1].offsetWidth-2)+"px;":d.style.cssText="height: "+s+"px; width: 4px; top: "+l.top+"px; left:"+((n[o].classList.contains("e-multi-cells-select")?0:l.left)+this.calcPos(n[o]).left-2)+"px;",this.contentModule.getEditPanel().appendChild(d)}for(o=0;o<i.length;o++){var c=this.parent.createElement("span",{attrs:{"data-row":o.toString(),unselectable:"on",contenteditable:"false"}}),p=(c.classList.add(Lo,Ji),j.isNullOrUndefined(e.getAttribute("cellspacing"))&&""===e.getAttribute("cellspacing")?this.calcPos(i[o]).left:0);c.style.cssText="width: "+a+"px; height: 4px; top: "+(this.calcPos(i[o]).top+(i[o].classList.contains("e-multi-cells-select")?0:l.top)+i[o].offsetHeight-2)+"px; left:"+(p+l.left)+"px;",this.contentModule.getEditPanel().appendChild(c)}t=this.parent.createElement("span",{className:$i+this.parent.getCssClass(!0),attrs:{"data-col":n.length.toString(),unselectable:"on",contenteditable:"false"}});t.style.cssText="top: "+(l.top+s-4)+"px; left:"+(l.left+a-4)+"px;",j.Browser.isDevice&&t.classList.add("e-rmob"),this.contentModule.getEditPanel().appendChild(t)},S.prototype.removeResizeElement=function(){var e=this.parent.contentModule.getEditPanel().querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box");if(0<e.length)for(var t=0;t<e.length;t++)j.detach(e[t])},S.prototype.calcPos=function(e){for(var t={top:0,left:0},n=e.getBoundingClientRect(),i=e.ownerDocument,o=e.offsetParent||i.documentElement,r=!1;o&&(o===i.body||o===i.documentElement)&&"static"===o.style.position;)o=o.parentNode;return"TD"===o.nodeName&&"TABLE"===e.nodeName&&(o=j.closest(o,".e-rte-content"),r=!0),o&&o!==e&&1===o.nodeType&&(t=o.getBoundingClientRect()),r?(r=!1,{top:this.parent.inputElement&&0<this.parent.inputElement.scrollTop?this.parent.inputElement.scrollTop+n.top-t.top:n.top-t.top,left:this.parent.inputElement&&0<this.parent.inputElement.scrollLeft?this.parent.inputElement.scrollLeft+n.left-t.left:n.left-t.left}):{top:e.offsetTop,left:e.offsetLeft}},S.prototype.getPointX=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageX},S.prototype.getPointY=function(e){return(e.touches&&e.touches.length?e.touches[0]:e).pageY},S.prototype.resizeStart=function(e){var t=this;if(!this.parent.readonly){j.Browser.isDevice&&this.resizeHelper(e);var n=e.target;if(n.classList.contains(Yi)||n.classList.contains(Ji)||n.classList.contains($i)){if(this.resetResizeHelper(this.curTable),e.preventDefault(),this.parent.preventDefaultResize(e),g(this.curTable.querySelectorAll("td,th"),Qi),this.removeTableSelection(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),this.resizeBtnInit(),this.hideTableQuickToolbar(),n.classList.contains(Yi)){if(this.resizeBtnStat.column=!0,parseInt(n.getAttribute("data-col"),10)===this.calMaxCol(this.curTable).length)this.currentColumnResize="last",this.colIndex=parseInt(n.getAttribute("data-col"),10)-1;else{if(0===parseInt(n.getAttribute("data-col"),10))this.currentColumnResize="first";else{this.currentColumnResize="middle";for(var i=this.curTable.rows[0].cells,o=0,r=0;r<i.length;r++)o+=i[r].colSpan;for(var s=new Array(o),a=j.createElement("colgroup"),l=new Map,d=0;d<this.curTable.rows.length;d++)for(var c=0,p=0;p<this.curTable.rows[d].cells.length;p++){for(var h=1;h<this.curTable.rows[d].cells[p].rowSpan;h++)l.set(""+(d+h)+c,this.curTable.rows[d].cells[p]);var u=this.getCellIndex(l,d,p),u=(c<u&&(c=u),this.curTable.rows[d].cells[p].offsetWidth);(!s[c]||u<s[c])&&(s[c]=u),c+=1+this.curTable.rows[d].cells[p].colSpan-1}for(var m=0;m<s.length;m++)(r=j.createElement("col")).appendChild(j.createElement("br")),r.style.width=this.convertPixelToPercentage(s[m],parseInt(getComputedStyle(this.curTable).width,10))+"%",a.appendChild(r);this.curTable.insertBefore(a,this.curTable.firstChild);for(d=0;d<this.curTable.rows.length;d++)for(p=0;p<this.curTable.rows[d].cells.length;p++)this.curTable.rows[d].cells[p].style.width=""}this.colIndex=parseInt(n.getAttribute("data-col"),10)}this.columnEle=this.calMaxCol(this.curTable)[this.colIndex],this.moveEle=e.target,this.appendHelper()}n.classList.contains(Ji)&&(this.rowEle=this.curTable.rows[parseInt(n.getAttribute("data-row"),10)],this.resizeBtnStat.row=!0,this.appendHelper()),n.classList.contains($i)&&(this.resizeBtnStat.tableBox=!0),j.Browser.isDevice&&this.helper&&!this.helper.classList.contains("e-reicon")?(this.helper.classList.add("e-reicon"),j.EventHandler.add(document,j.Browser.touchStartEvent,this.removeHelper,this),j.EventHandler.add(this.helper,j.Browser.touchStartEvent,this.resizeStart,this)):this.parent.trigger(ye,{event:e,requestType:"Table"},function(e){e.cancel&&t.cancelResizeAction()}),this.isResizeBind&&(j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing,this),j.EventHandler.add(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd,this),this.isResizeBind=!1)}}},S.prototype.getCellIndex=function(e,t,n){var i=e.get(""+t+n);return i?this.getCellIndex(e,t,n+i.colSpan):n},S.prototype.removeHelper=function(e){!e.target.classList.contains("e-reicon")&&this.helper&&(j.EventHandler.remove(document,j.Browser.touchStartEvent,this.removeHelper),j.EventHandler.remove(this.helper,j.Browser.touchStartEvent,this.resizeStart),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&j.detach(this.helper),this.pageX=null,this.helper=null)},S.prototype.appendHelper=function(){this.helper=this.parent.createElement("div",{className:"e-table-rhelper"+this.parent.getCssClass(!0)}),j.Browser.isDevice&&this.helper.classList.add("e-reicon"),this.contentModule.getEditPanel().appendChild(this.helper),this.setHelperHeight()},S.prototype.setHelperHeight=function(){var e=this.calcPos(this.curTable);this.resizeBtnStat.column?(this.helper.classList.add("e-column-helper"),this.helper.style.cssText="height: "+getComputedStyle(this.curTable).height+"; top: "+e.top+"px; left:"+(e.left+this.calcPos(this.columnEle).left+("last"===this.currentColumnResize?this.columnEle.offsetWidth:0)-1)+"px;"):(this.helper.classList.add("e-row-helper"),this.helper.style.cssText="width: "+getComputedStyle(this.curTable).width+"; top: "+(this.calcPos(this.rowEle).top+e.top+this.rowEle.offsetHeight-1)+"px; left:"+(this.calcPos(this.rowEle).left+e.left)+"px;")},S.prototype.updateHelper=function(){var e,t=this.calcPos(this.curTable);this.resizeBtnStat.column?(e=t.left+this.calcPos(this.columnEle).left+("last"===this.currentColumnResize?this.columnEle.offsetWidth:0)-1,this.helper.style.left=e+"px",this.helper.style.height=this.curTable.offsetHeight+"px"):(e=this.calcPos(this.rowEle).top+t.top+this.rowEle.offsetHeight-1,this.helper.style.top=e+"px")},S.prototype.calMaxCol=function(e){for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var o=new Array(n),r=new Map,s=0;s<e.rows.length;s++)for(var a=0,l=0;l<e.rows[s].cells.length;l++){for(var d=1;d<e.rows[s].cells[l].rowSpan;d++)r.set(""+(s+d)+a,e.rows[s].cells[l]);var c=this.getCellIndex(r,s,l),c=(a<c&&(a=c),e.rows[s].cells[l].offsetWidth);(!o[a]||c<o[a].offsetWidth)&&(o[a]=e.rows[s].cells[l]),a+=1+e.rows[s].cells[l].colSpan-1}return o},S.prototype.resizing=function(v){var y,C=this,e=this.getPointX(v),t=this.getPointY(v),N=this.parent.enableRtl?-(e-this.pageX):e-this.pageX,E=this.parent.enableRtl?-(t-this.pageY):t-this.pageY,S=(this.pageX=e,this.pageY=t,this.curTable.closest("td"));this.parent.trigger(Ce,{event:v,requestType:"table"},function(e){if(e.cancel)C.cancelResizeAction();else{var e=C.contentModule.getEditPanel().querySelector(".e-table-box"),t=parseInt(getComputedStyle(C.curTable).width,10),n=isNaN(parseInt(C.curTable.style.height,10))?parseInt(getComputedStyle(C.curTable).height,10):parseInt(C.curTable.style.height,10),i=+getComputedStyle(C.contentModule.getEditPanel()).paddingRight.match(/\d/g).join(""),i=C.contentModule.getEditPanel().offsetWidth-(C.contentModule.getEditPanel().offsetWidth-C.contentModule.getEditPanel().clientWidth)-2*i,o=void 0;if(o=j.isNullOrUndefined(C.curTable.parentElement.closest("table"))||j.isNullOrUndefined(C.curTable.closest("td"))||!C.contentModule.getEditPanel().contains(C.curTable.closest("td"))?i:(r=C.curTable.closest("td"),s=+getComputedStyle(r).paddingRight.match(/\d/g).join(""),r.offsetWidth-(r.offsetWidth-r.clientWidth)-2*s),C.resizeBtnStat.column){C.curTable.closest("li")&&(o=C.curTable.closest("li").offsetWidth);var r=C.curTable.querySelectorAll("colgroup > col"),s=void 0,s=""!==C.curTable.style.width&&C.curTable.style.width.includes("%")?parseFloat(C.curTable.style.width.split("%")[0]):C.getCurrentTableWidth(C.curTable.offsetWidth,C.parent.inputElement.offsetWidth),a=C.calMaxCol(C.curTable)[C.colIndex],a=C.getCurrentColWidth(a,t);if("first"===C.currentColumnResize){if(N-=.75,C.removeResizeElement(),S&&(y=C.curTable.getBoundingClientRect().right-C.calcPos(S).left,C.curTable.style.maxWidth=y+"px"),(0!==N&&5<a||N<0)&&s<=100&&C.convertPixelToPercentage(t-N,o)<=100){var l,d=C.findFirstLastColCells(C.curTable,!0),c=(C.curTable.style.width=100<C.convertPixelToPercentage(t-N,o)?"100%":C.convertPixelToPercentage(t-N,o)+"%",s-C.convertPixelToPercentage(t-N,o)),p=0;if(!(l=-1<C.curTable.style.width.indexOf("%"))&&C.curTable.offsetWidth>C.contentModule.getEditPanel().offsetWidth)return void(C.curTable.style.width=i+"px");if(l&&100<parseFloat(C.curTable.style.width.split("%")[0]))return void(C.curTable.style.width="100%");var h=(p=j.isNullOrUndefined(C.curTable.style.marginLeft)||""===C.curTable.style.marginLeft||(h=C.curTable.style.marginLeft.match(/[-+]?\d*\.\d+|\d+/),j.isNullOrUndefined(h))?p:parseFloat(h[0]))+c;if(h&&100<h&&(h=100-parseFloat(C.curTable.style.width)),!C.curTable.classList.contains("e-rte-paste-table")&&h&&h<1)return C.curTable.style.marginLeft=null,void(C.curTable.style.width="100%");C.curTable.style.marginLeft="calc("+("100%"===C.curTable.style.width?0:h)+"%)";for(var u=0;u<d.length;u++){var m=C.getCurrentColWidth(d[u],t);d[u].style.width=m-c+"%"}}}else if("last"===C.currentColumnResize){if(N+=.75,C.removeResizeElement(),S&&(y=S.getBoundingClientRect().right-C.curTable.getBoundingClientRect().left,C.curTable.style.maxWidth=y+"px"),(0!==N&&5<a||0<N)&&s<=100&&C.convertPixelToPercentage(t+N,o)<=100)for(var g=C.findFirstLastColCells(C.curTable,!1),c=(C.curTable.style.width=100<C.convertPixelToPercentage(t+N,o)?"100%":C.convertPixelToPercentage(t+N,o)+"%",s-C.convertPixelToPercentage(t+N,o)),u=0;u<g.length;u++){m=C.getCurrentColWidth(g[u],t);g[u].style.width=m-c+"%"}}else{p=r[C.colIndex].offsetWidth-N,h=r[C.colIndex].offsetWidth+r[C.colIndex-1].offsetWidth;20<h-p&&20<p&&(r[C.colIndex-1].style.width=C.convertPixelToPercentage(h-(a=p),t)+"%",r[C.colIndex].style.width=C.convertPixelToPercentage(a,t)+"%")}C.updateHelper()}else if(C.resizeBtnStat.row){C.parent.preventDefaultResize(v);for(var f=[],b=C.curTable.querySelectorAll("tr"),u=0;u<b.length;u++)C.rowEle!==b[u]&&(f[u]=parseFloat(b[u].clientHeight.toString()));C.curTable.style.height=parseFloat(C.curTable.clientHeight.toString())+(0<E?0:E)+"px";for(u=0;u<b.length;u++)C.rowEle===b[u]?b[u].style.height=parseFloat(b[u].clientHeight.toString())+E+"px":b[u].style.height=f[u]+"px";j.isNullOrUndefined(e)||(e.style.cssText="top: "+(C.calcPos(C.curTable).top+n-4)+"px; left:"+(C.calcPos(C.curTable).left+t-4)+"px;"),C.updateHelper()}else C.resizeBtnStat.tableBox&&(S&&(s=C.curTable.getBoundingClientRect().left-S.getBoundingClientRect().left,y=Math.abs(s-S.getBoundingClientRect().width)-5,C.curTable.style.maxWidth=y+"px"),C.curTable.style.height=n+E+"px",j.isNullOrUndefined(e)||(e.classList.add("e-rbox-select"),e.style.cssText="top: "+(C.calcPos(C.curTable).top+parseInt(getComputedStyle(C.curTable).height,10)-4)+"px; left:"+(C.calcPos(C.curTable).left+t-4)+"px;"),C.curTable.closest("li")&&(o=C.curTable.closest("li").offsetWidth),(l=-1<C.curTable.style.width.indexOf("%"))&&100<parseFloat(C.curTable.style.width.split("%")[0])?C.curTable.style.width="100%":!l&&C.curTable.offsetWidth>C.contentModule.getEditPanel().offsetWidth?C.curTable.style.width=i+"px":C.curTable.style.width=l?C.convertPixelToPercentage(t+N,o)+"%":t+N+"px")}})},S.prototype.getCurrentColWidth=function(e,t){return""!==e.style.width&&e.style.width.includes("%")?parseFloat(e.style.width.split("%")[0]):this.convertPixelToPercentage(e.offsetWidth,t)},S.prototype.getCurrentTableWidth=function(e,t){return e/t*100},S.prototype.findFirstLastColCells=function(e,r){for(var s=[],a=e.rows,l=[],t=0;t<a.length;t++)!function(t){for(var e=r?0:a[t].cells.length-1,n=a[t].cells[e],i=1;i<n.rowSpan;i++)l.push(t+i+"-"+e);var o=t+"-"+e;(0===l.length||r&&-1===l.indexOf(o)||!r&&-1===l.indexOf(o)&&l.every(function(e){return e.split("-")[0]!==t.toString()}))&&s.push(n)}(t);return s},S.prototype.convertPixelToPercentage=function(e,t){return e/t*100},S.prototype.cancelResizeAction=function(){this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.removeResizeElement()},S.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.isResizeBind=!0,j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchMoveEvent,this.resizing),j.EventHandler.remove(this.contentModule.getDocument(),j.Browser.touchEndEvent,this.resizeEnd),this.contentModule.getEditPanel().querySelector(".e-table-box")&&this.contentModule.getEditPanel().contains(this.contentModule.getEditPanel().querySelector(".e-table-box"))&&this.removeResizeElement(),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&(j.detach(this.helper),this.helper=null),this.resetResizeHelper(this.curTable),this.pageX=null,this.pageY=null,this.moveEle=null;for(var t=this.curTable.querySelectorAll("tr"),n=[],i=0;i<t.length;i++){var o=parseFloat(t[i].clientHeight.toString())/parseFloat(this.curTable.clientHeight.toString())*100;n[i]=o}for(i=0;i<t.length;i++)"THEAD"===t[i].parentElement.nodeName&&(t[i].parentElement.style.height=n[i]+"%"),t[i].style.height=n[i]+"%";this.parent.trigger(Ne,{event:e,requestType:"table"}),this.parent.formatter.saveData(),this.resizeEndTime=(new Date).getTime()},S.prototype.resetResizeHelper=function(e){var t=this.parent.element.querySelectorAll(".e-table-rhelper.e-column-helper"),t=(Array.from(t).forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),this.parent.element.querySelectorAll(".e-table-rhelper.e-row-helper")),t=(Array.from(t).forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),e.style.width||(e.style.width=e.offsetWidth+"px"),e.querySelector("colgroup"));if(t){for(var n=0;n<e.rows.length;n++)for(var i=0;i<e.rows[n].cells.length;i++){var o=this.convertPixelToPercentage(e.rows[n].cells[i].offsetWidth,parseInt(getComputedStyle(e).width,10))+"%";e.rows[n].cells[i].style.width=o}e.removeChild(t)}},S.prototype.resizeBtnInit=function(){return this.resizeBtnStat={column:!1,row:!1,tableBox:!1}},S.prototype.addRow=function(e,t,n){n&&(i={item:{command:"Table",subCommand:"InsertRowAfter"}});var i,e={selection:e,subCommand:(n?i:t).item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t,e)},S.prototype.addColumn=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,width:this.parent.tableSettings.width,subCommand:t.item.subCommand})},S.prototype.removeRowColumn=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar()},S.prototype.removeTable=function(e,t,n){n&&(i={item:{command:"Table",subCommand:"TableRemove"}});var i,e={selection:e,subCommand:(n?i:t).item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t.originalEvent,e),this.contentModule.getEditPanel().focus(),null!==this.parent.inputElement.innerHTML&&""!==this.parent.inputElement.innerHTML||("DIV"===this.parent.enterKey?this.contentModule.getEditPanel().innerHTML="<div><br/></div>":"BR"===this.parent.enterKey?this.contentModule.getEditPanel().innerHTML="<br/>":this.contentModule.getEditPanel().innerHTML="<p><br/></p>"),this.removeResizeElement(),this.hideTableQuickToolbar()},S.prototype.renderDlgContent=function(e){var t,n,i=this,o=e.args.originalEvent.target;j.Browser.isDevice||this.parent.inlineMode.enable||!j.isNullOrUndefined(j.closest(o,".e-rte-text-popup"))?this.insertTableDialog(e):this.popupObj?this.popupObj.hide():(this.hideTableQuickToolbar(),o=this.l10n.getConstant("inserttablebtn"),this.dlgDiv=this.parent.createElement("div",{className:"e-rte-table-popup"+this.parent.getCssClass(!0),id:this.rteID+"_table"}),this.createTablePopupBoundFn=this.createTablePopupKeyDown.bind(this),this.dlgDiv.addEventListener("keydown",this.createTablePopupBoundFn),this.tblHeader=this.parent.createElement("div",{className:"e-rte-popup-header"+this.parent.getCssClass(!0)}),this.tblHeader.innerHTML="1X1",this.dlgDiv.appendChild(this.tblHeader),n=this.parent.createElement("div",{className:"e-rte-table-span"+this.parent.getCssClass(!0)}),this.drawTable(n,e),this.dlgDiv.appendChild(n),this.dlgDiv.appendChild(this.parent.createElement("span",{className:"e-span-border"+this.parent.getCssClass(!0)})),t=this.parent.createElement("button",{className:"e-insert-table-btn"+this.parent.getCssClass(!0),id:this.rteID+"_insertTable",attrs:{type:"button",tabindex:"0"}}),j.isNullOrUndefined(this.parent.getToolbarElement().querySelector(".e-expended-nav"))||this.parent.getToolbarElement().querySelector(".e-expended-nav").setAttribute("tabindex","1"),this.dlgDiv.appendChild(t),this.createTableButton=new P.Button({iconCss:"e-icons e-create-table",content:o,cssClass:"e-flat"+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.createTableButton.isStringTemplate=!0,this.createTableButton.appendTo(t),j.EventHandler.add(t,"click",this.insertTableDialog,{self:this,args:e.args,selection:e.selection}),this.parent.getToolbar().parentElement.appendChild(this.dlgDiv),n=(n=e.args.originalEvent.target).classList.contains("e-toolbar-item")?n.firstChild:n.parentElement,this.popupObj=new I.Popup(this.dlgDiv,{targetType:"relative",relateTo:n,collision:{X:"fit",Y:"none"},offsetY:8,viewPortElement:this.parent.element,position:{X:"left",Y:"bottom"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){j.EventHandler.remove(t,"click",i.insertTableDialog),i.dlgDiv.removeEventListener("keydown",i.createTablePopupBoundFn),j.detach(t),i.createTableButton&&!i.createTableButton.isDestroyed&&(i.createTableButton.destroy(),i.createTableButton.element=null,i.createTableButton=null),i.parent.isBlur=!1,i.popupObj.destroy(),j.detach(i.popupObj.element),i.popupObj=null}}),j.addClass([this.popupObj.element],"e-popup-open"),j.isNullOrUndefined(this.parent.cssClass)||j.addClass([this.popupObj.element],this.parent.getCssClass()),t.focus(),this.popupObj.refreshPosition(n))},S.prototype.onIframeMouseDown=function(){this.popupObj&&this.popupObj.hide(),this.parent.inlineMode.enable&&this.editdlgObj&&this.editdlgObj.hide(),j.isNullOrUndefined(this.parent)||j.isNullOrUndefined(this.parent.contentModule)||j.isNullOrUndefined(this.parent.contentModule.getEditPanel())||this.removeResizeElement()},S.prototype.docClick=function(e){var e=e.args.target,t=(e&&e.classList&&(this.popupObj&&!j.closest(e,"[id='"+this.popupObj.element.id+"']")||this.editdlgObj&&!j.closest(e,"#"+this.editdlgObj.element.id))&&!e.classList.contains("e-create-table")&&e.offsetParent&&!e.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")&&(this.popupObj&&this.popupObj.hide(),this.editdlgObj&&(this.parent.notify(un,{closedBy:"outside click"}),this.editdlgObj.hide()),this.parent.isBlur=!0,wr(this.parent.element,"focusout")),j.closest(e,"td")),t=!(!t||!this.parent.contentModule.getEditPanel().contains(t));!e||"TD"===e.tagName||"TH"===e.tagName||t||null!==j.closest(e,".e-rte-quick-popup")||!e.offsetParent||e.offsetParent.classList.contains("e-quick-dropdown")||e.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")||j.closest(e,".e-rte-dropdown-popup")||j.closest(e,".e-rte-elements")||(e&&e.closest(".e-toolbar")||this.removeCellSelectClasses(),this.removeTableSelection(),j.Browser.isIE)||this.hideTableQuickToolbar(),!e||!e.classList||e.classList.contains(Yi)||e.classList.contains(Ji)||e.classList.contains($i)||this.removeResizeElement()},S.prototype.drawTable=function(e,t){for(var n,i,o=0;o<3;o++){n=this.parent.createElement("div",{className:"e-rte-table-row"+this.parent.getCssClass(!0),attrs:{"data-column":""+o}}),j.EventHandler.add(n,"mouseleave",this.tableCellLeave,this);for(var r=0;r<10;r++)i=this.parent.createElement("div",{className:"e-rte-tablecell e-default"+this.parent.getCssClass(!0),attrs:{"data-cell":""+r}}),n.appendChild(i),i.style.display="inline-block",0===r&&0===o&&j.addClass([i],"e-active"),j.EventHandler.add(i,"mousemove",this.tableCellSelect,this),j.EventHandler.add(i,"mouseup",this.tableCellClick,{self:this,args:t.args,selection:t.selection});e.appendChild(n)}},S.prototype.editTable=function(e){var t=this,n=(this.createDialog(e),this.tableDlgContent(e)),i=this.l10n.getConstant("dialogUpdate"),o=this.l10n.getConstant("dialogCancel"),r=this.l10n.getConstant("tableEditHeader");this.editdlgObj.setProperties({height:"initial",width:"290px",content:n,header:r,buttons:[{click:this.applyProperties.bind(this,e),buttonModel:{content:i,cssClass:"e-flat e-size-update"+this.parent.getCssClass(!0),isPrimary:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:o}}],cssClass:this.editdlgObj.cssClass+" e-rte-edit-table-prop-dialog"}),this.editdlgObj.element.style.maxHeight="none",this.editdlgObj.content.querySelector("input").focus(),this.hideTableQuickToolbar()},S.prototype.insertTableDialog=function(e){var t=this.self||this,n=(t.popupObj&&t.popupObj.hide(),t.createDialog(e),t.tableCellDlgContent()),i=t.l10n.getConstant("dialogInsert"),o=t.l10n.getConstant("dialogCancel");j.isNullOrUndefined(t.editdlgObj)||(t.editdlgObj.setProperties({height:"initial",width:"290px",content:n,buttons:[{click:t.customTable.bind(this,e),buttonModel:{content:i,cssClass:"e-flat e-insert-table "+t.parent.cssClass,isPrimary:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel "+t.parent.cssClass,content:o}}]}),j.isNullOrUndefined(t.parent.cssClass)||t.editdlgObj.setProperties({cssClass:t.parent.cssClass}),t.editdlgObj.element.style.maxHeight="none",t.editdlgObj.content.querySelector("input").focus())},S.prototype.tableCellDlgContent=function(){var e=this.l10n.getConstant("columns"),t=this.l10n.getConstant("rows"),n=this.parent.createElement("div",{className:"e-cell-wrap"+this.parent.getCssClass(!0)}),i=xr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text"  data-role ="none" id="tableColumn" class="e-table-column'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="tableRow" class="e-table-row'+this.parent.getCssClass(!0)+'" /></div>');return n.appendChild(i),this.columnTextBox=new U.NumericTextBox({format:"n0",min:1,value:3,placeholder:e,floatLabelType:"Auto",max:50,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:this.parent.getCssClass()}),this.columnTextBox.isStringTemplate=!0,this.columnTextBox.appendTo(n.querySelector("#tableColumn")),this.rowTextBox=new U.NumericTextBox({format:"n0",min:1,value:3,placeholder:t,floatLabelType:"Auto",max:1e3,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:this.parent.getCssClass()}),this.rowTextBox.isStringTemplate=!0,this.rowTextBox.appendTo(n.querySelector("#tableRow")),n},S.prototype.clearDialogObj=function(){this.editdlgObj&&(this.editdlgObj.destroy(),j.detach(this.editdlgObj.element),this.editdlgObj=null)},S.prototype.createDialog=function(e){var t,n,i,o=this;this.editdlgObj?this.editdlgObj.hide({returnValue:!0}):(t=this.parent.createElement("div",{className:"e-rte-edit-table"+this.parent.getCssClass(!0),id:this.rteID+"_tabledialog"}),this.parent.rootContainer.appendChild(t),i=this.l10n.getConstant("dialogInsert"),n=this.l10n.getConstant("dialogCancel"),i={header:this.l10n.getConstant("tabledialogHeader"),cssClass:Oi+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:j.Browser.isDevice?"290px":"340px",height:"initial",position:{X:"center",Y:j.Browser.isDevice?"center":"top"},isModal:j.Browser.isDevice,buttons:[{buttonModel:{content:i,cssClass:"e-flat e-insert-table"+this.parent.getCssClass(!0),isPrimary:!0}},{click:function(e){o.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:n}}],target:j.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){o.parent.isBlur=!1,o.editdlgObj.destroy(),j.detach(o.editdlgObj.element),o.dialogRenderObj.close(e),o.editdlgObj=null}},this.editdlgObj=this.dialogRenderObj.render(i),this.editdlgObj.appendTo(t),this.quickToolObj&&this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj&&this.quickToolObj.textQTBar&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())},S.prototype.customTable=function(e,t){var n=this.self||this;n&&n.rowTextBox&&n.rowTextBox.value&&n.columnTextBox&&n.columnTextBox.value&&(e=j.Browser.isDevice||!j.isNullOrUndefined(e.args)&&!j.isNullOrUndefined(e.args.originalEvent)&&"insert-table"===e.args.originalEvent.action||n.parent.inlineMode.enable||!j.isNullOrUndefined(n.parent.quickToolbarSettings.text)&&!(e instanceof PointerEvent)?e:this,n.tableInsert(n.rowTextBox.value,n.columnTextBox.value,t,e))},S.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.editdlgObj.hide({returnValue:!0})},S.prototype.applyProperties=function(e,t){var n=this.editdlgObj.element;if(n&&e&&0<e.selectNode.length&&e.selectNode[0]){e=e.selectNode[0]&&3===e.selectNode[0].nodeType?e.selectNode[0].parentNode:e.selectNode[0],e=e?j.closest(e,"table"):null;if(e){if(e.style.width=n.querySelector(".e-table-width")?n.querySelector(".e-table-width").value+"px":e.style.width,n.querySelector(".e-cell-padding")&&""!==n.querySelector(".e-cell-padding").value)for(var i=e.querySelectorAll("td"),o=0;o<i.length;o++){var r="",r=""===i[o].style.padding?i[o].getAttribute("style")+" padding:"+n.querySelector(".e-cell-padding").value+"px;":(i[o].style.padding=n.querySelector(".e-cell-padding").value+"px",i[o].getAttribute("style"));i[o].setAttribute("style",r)}e.cellSpacing=n.querySelector(".e-cell-spacing")?n.querySelector(".e-cell-spacing").value:e.cellSpacing,j.isNullOrUndefined(e.cellSpacing)||"0"===e.cellSpacing?g([e],Oo):j.addClass([e],Oo),this.parent.formatter.saveData(),this.editdlgObj.hide({returnValue:!0})}}},S.prototype.tableDlgContent=function(e){var e=e.selectParent[0],t=this.l10n.getConstant("tableWidth"),n=this.l10n.getConstant("cellpadding"),i=this.l10n.getConstant("cellspacing"),o=this.parent.createElement("div",{className:"e-table-sizewrap"+this.parent.getCssClass(!0)}),r=j.closest(e,"table").getClientRects()[0].width,s=j.closest(e,"td").style.padding,e=j.closest(e,"table").getAttribute("cellspacing"),a=xr('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="tableWidth" class="e-table-width'+this.parent.getCssClass(!0)+'"  /></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="cellPadding" class="e-cell-padding'+this.parent.getCssClass(!0)+'" /> </div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="cellSpacing" class="e-cell-spacing'+this.parent.getCssClass(!0)+'" /></div>');return o.appendChild(a),this.tableWidthNum=new U.NumericTextBox({format:"n0",min:0,value:r,placeholder:t,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableWidthNum.isStringTemplate=!0,this.tableWidthNum.appendTo(o.querySelector("#tableWidth")),this.tableCellPadding=new U.NumericTextBox({format:"n0",min:0,value:""!==s?parseInt(s,null):0,placeholder:n,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableCellPadding.isStringTemplate=!0,this.tableCellPadding.appendTo(o.querySelector("#cellPadding")),this.tableCellSpacing=new U.NumericTextBox({format:"n0",min:0,value:""===e||j.isNullOrUndefined(e)?0:parseInt(e,null),placeholder:i,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableCellSpacing.isStringTemplate=!0,this.tableCellSpacing.appendTo(o.querySelector("#cellSpacing")),o},S.prototype.destroy=function(){this.isDestroyed||(this.resizeIconPositionTime&&(clearTimeout(this.resizeIconPositionTime),this.resizeIconPositionTime=null),this.removeEventListener(),j.EventHandler.remove(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection),this.curTable&&j.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave),this.tableCellSpacing&&!this.tableCellSpacing.isDestroyed&&(this.tableCellSpacing.destroy(),this.tableCellSpacing=null),this.tableCellPadding&&!this.tableCellPadding.isDestroyed&&(this.tableCellPadding.destroy(),this.tableCellPadding=null),this.tableWidthNum&&!this.tableWidthNum.isDestroyed&&(this.tableWidthNum.destroy(),this.tableWidthNum=null),this.rowTextBox&&!this.rowTextBox.isDestroyed&&(this.rowTextBox.destroy(),this.rowTextBox=null),this.columnTextBox&&!this.columnTextBox.isDestroyed&&(this.columnTextBox.destroy(),this.columnTextBox=null),this.createTableButton&&!this.createTableButton.isDestroyed&&(this.createTableButton.destroy(),this.createTableButton=null),this.createTablePopupBoundFn=null,this.isDestroyed=!0)},S.prototype.getModuleName=function(){return"table"},S.prototype.afterKeyDown=function(){var e=this;this.curTable&&(this.resizeIconPositionTime=setTimeout(function(){e.updateResizeIconPosition()},1))},S.prototype.updateResizeIconPosition=function(){var e,t=this.parent.contentModule.getEditPanel().querySelector(".e-table-box");j.isNullOrUndefined(t)||(e=this.calcPos(this.curTable),t.style.cssText="top: "+(e.top+parseInt(getComputedStyle(this.curTable).height,10)-4)+"px; left:"+(e.left+parseInt(getComputedStyle(this.curTable).width,10)-4)+"px;")},S.prototype.createTablePopupKeyDown=function(e){var t;"Escape"===e.key&&(e=e.target.closest(".e-rte-table-popup"),t=(e=j.getComponent(e,"popup")).relateTo,e.hide(),t.focus({preventScroll:!0}))};kl=S;function S(e,t){this.ensureInsideTableList=!0,this.pageX=null,this.pageY=null,this.moveEle=null,this.currentColumnResize="",this.resizeEndTime=0,this.isTableMoveActive=!1,this.isResizeBind=!0,this.parent=e,this.rteID=e.element.id,this.l10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1}Il.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(o,this.removeEventListener,this),this.parent.on(un,this.documentClickClosedBy,this))},Il.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(o,this.removeEventListener),this.parent.off(un,this.documentClickClosedBy))},Il.prototype.render=function(e){return e.beforeOpen=this.beforeOpen.bind(this),e.open=this.open.bind(this),e.position={X:"center",Y:"string"===e.target||"BODY"!==e.target.nodeName||j.isNullOrUndefined(e.position)?this.getDialogPosition():e.position.Y},j.isNullOrUndefined(e.close)&&(e.close=this.close.bind(this)),e.beforeClose=this.beforeClose.bind(this),(e=new I.Dialog(e)).isStringTemplate=!0,e},Il.prototype.beforeOpen=function(e){var t;e.element.classList.contains("e-dialog")&&(t=j.closest(e.target,"form"),j.isNullOrUndefined(t)||(this.dialogEle=e.element,this.dialogEle.addEventListener("keydown",this.handleEnterKeyDown))),this.parent.trigger(gt,e,this.beforeOpenCallback.bind(this,e))},Il.prototype.handleEnterKeyDown=function(e){"Enter"===e.key&&e.preventDefault()},Il.prototype.beforeOpenCallback=function(e){e.cancel&&this.parent.notify(ft,null)},Il.prototype.open=function(e){this.parent.trigger(bt,e)},Il.prototype.documentClickClosedBy=function(e){this.outsideClickClosedBy=e.closedBy},Il.prototype.beforeClose=function(e){this.dialogEle&&this.dialogEle.removeEventListener("keydown",this.handleEnterKeyDown),e.closedBy="outside click"===this.outsideClickClosedBy?this.outsideClickClosedBy:e.closedBy,this.parent.trigger(vt,e,function(e){e.cancel||e.container.classList.contains("e-popup-close")&&(e.cancel=!0)}),this.outsideClickClosedBy=""},Il.prototype.getDialogPosition=function(){var e=this.parent.element.getBoundingClientRect().top;if(e<0){for(var t=0,n=this.parent.element;"BODY"!==n.nodeName;){var i=n.getBoundingClientRect().top;0<i&&(t=i),n=n.parentElement}return(e=Math.abs(e)+t).toString()}return"top"},Il.prototype.close=function(e){this.parent.trigger(yt,e)};var Al=Il;function Il(e){this.parent=e,this.addEventListener()}Ul=function(e,t){return(Ul=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Ul,Pl,wl=function(e,t){function n(){this.constructor=e}Ul(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Hl="\n    <!DOCTYPE html> \n    <html>\n         <head>\n            <meta charset='utf-8' /> \n            <style>"+'\n@charset "UTF-8";\n\n* {\n    box-sizing: border-box;\n}\n\nhtml {\n    height: auto;\n}\n\nhtml, body {\n    margin: 0;\n}\n\nbody {\n    color: #333;\n    word-wrap: break-word;\n}\n\n.e-content {\n    background: unset;\n    min-height: 100px;\n    outline: 0 solid transparent;\n    padding: 16px;\n    position: relative;\n    overflow-x: auto;\n    font-weight: normal;\n    line-height: 1.5;\n    font-size: 14px;\n    text-align: inherit;\n    font-family: "Roboto", "Segoe UI", "GeezaPro", "DejaVu Serif", "sans-serif", "-apple-system", "BlinkMacSystemFont";\n}\n\n.e-content p {\n    margin: 0 0 10px;\n    margin-bottom: 10px;\n}\n\n.e-content h1 {\n    font-size: 2.857em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h2 {\n    font-size: 2.285em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h3 {\n    font-size: 2em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h4 {\n    font-size: 1.714em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h5 {\n    font-size: 1.428em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h6 {\n    font-size: 1.142em;\n    font-weight: 600;\n    line-height: 1.5;\n    margin: 10px 0;\n}\n\n.e-content blockquote {\n    margin: 10px 0;\n    padding-left: 12px;\n    border-left: 2px solid #5c5c5c;\n}\n\n.e-rtl.e-content blockquote {\n    padding-left: 0;\n    padding-right: 12px;\n}\n\n.e-content pre {\n    border: 0;\n    border-radius: 0;\n    color: #333;\n    font-size: inherit;\n    line-height: inherit;\n    margin: 0 0 10px;\n    overflow: visible;\n    padding: 0;\n    white-space: pre-wrap;\n    word-break: inherit;\n    word-wrap: break-word;\n}\n\n.e-content code {\n    background: #9d9d9d26;\n    color: #ed484c;\n}\n\n.e-content strong,\n.e-content b {\n    font-weight: bold;\n}\n\n.e-content a {\n    text-decoration: none;\n    user-select: auto;\n}\n\n.e-content a:hover {\n    text-decoration: underline;\n}\n\n.e-content li {\n    margin-bottom: 10px;\n}\n\n.e-content li ol,\n.e-content li ul {\n    margin-block-start: 10px;\n}\n\n.e-content ul {\n    list-style-type: disc;\n}\n\n.e-content ul ul,\n.e-content ol ul {\n    list-style-type: circle;\n}\n\n.e-content ul ul ul,\n.e-content ol ul ul,\n.e-content ul ol ul,\n.e-content ol ol ul {\n    list-style-type: square;\n}\n\n.e-content p:last-child,\n.e-content pre:last-child,\n.e-content blockquote:last-child {\n    margin-bottom: 0;\n}\n\n.e-content h3 + h4,\n.e-content h4 + h5,\n.e-content h5 + h6 {\n    margin-top: 0.6em;\n}\n\n.e-content ul:last-child {\n    margin-bottom: 0;\n}\n\n.e-content table {\n    margin-bottom: 10px;\n    border-collapse: collapse;\n    empty-cells: show;\n}\n\n.e-content table.e-cell-select {\n    position: relative;\n}\n\n.e-content table.e-cell-select::after {\n    content: \'\';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border: 2px solid #4a90e2;\n    pointer-events: none;\n}\n\ntable .e-cell-select {\n    border: 1px double #4a90e2 !important;\n}\n\n.e-content table.e-rte-table th {\n    background-color: #E0E0E0;\n}\n\n.e-rte-table td,\n.e-rte-table th {\n    border: 1px solid #BDBDBD;\n    height: 20px;\n    min-width: 20px;\n    padding: 2px 5px;\n}\n\n.e-rte-table td.e-cell-select.e-multi-cells-select,\n.e-rte-table th.e-cell-select.e-multi-cells-select {\n    position: relative;\n}\n\n.e-rte-table td.e-cell-select.e-multi-cells-select::after,\n.e-rte-table th.e-cell-select.e-multi-cells-select::after {\n    background-color: rgba(13, 110, 253, 0.08);\n    content: "";\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    bottom: 0;\n    pointer-events: none;\n    right: 0;\n}\n\ntable td.e-multi-cells-select ::selection,\ntable th.e-multi-cells-select ::selection {\n    background-color: transparent;\n}\n\ntd.e-multi-cells-select,\nth.e-multi-cells-select {\n    user-select: none !important;\n}\n\n.e-rte-table.e-dashed-border td,\n.e-rte-table.e-dashed-border th {\n    border-style: dashed;\n}\n\n.e-rte-table.e-alternate-border tbody tr:nth-child(2n) {\n    background-color: #F5F5F5;\n}\n\n.e-rte-image,\n.e-rte-audio,\n.e-rte-video  {\n    border: 0;\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-imginline,\n.e-rte-audio.e-audio-inline,\n.e-rte-video.e-video-inline {\n    margin-left: 5px;\n    margin-right: 5px;\n    display: inline-block;\n    float: none;\n    max-width: 100%;\n    padding: 1px;\n    vertical-align: bottom;\n}\n\n.e-rte-image.e-imgcenter,\n.e-rte-video.e-video-center {\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-imgright,\n.e-rte-video.e-video-right {\n    float: right;\n    margin: 0 auto;\n    margin-left: 5px;\n    text-align: right;\n}\n\n.e-rte-image.e-imgleft,\n.e-rte-video.e-video-left {\n    float: left;\n    margin: 0 auto;\n    margin-right: 5px;\n    text-align: left;\n}\n\n.e-rte-img-caption {\n    display: inline-block;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-img-caption.e-caption-inline {\n    display: inline-block;\n    margin: 5px auto;\n    margin-left: 5px;\n    margin-right: 5px;\n    max-width: calc(100% - (2 * 5px));\n    position: relative;\n    text-align: center;\n    vertical-align: bottom;\n}\n\n.e-rte-img-caption.e-imgcenter {\n    display: contents;\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.e-rte-img-caption.e-imgright {\n    display: contents;\n    margin-left: auto;\n    margin-right: 0;\n}\n\n.e-rte-img-caption.e-imgleft {\n    display: contents;\n    margin-left: 0;\n    margin-right: auto;\n}\n\n.e-img-caption.e-rte-img-caption.e-imgbreak {\n    display: contents;\n}\n\n.e-rte-img-caption .e-img-inner {\n    display: block;\n    font-size: 16px;\n    font-weight: initial;\n    margin: auto;\n    opacity: .9;\n    position: relative;\n    text-align: center;\n    width: 100%;\n}\n\n.e-img-wrap {\n    display: inline-block;\n    margin: auto;\n    padding: 0;\n    text-align: center;\n    width: 100%;\n}\n\n.e-imgleft,\n.e-video-left {\n    float: left;\n    margin: 0 5px 0 0;\n    text-align: left;\n}\n\n.e-imgright,\n.e-video-right {\n    float: right;\n    margin: 0 0 0 5px;\n    text-align: right;\n}\n\n.e-imgcenter,\n.e-video-center {\n    cursor: pointer;\n    display: block;\n    float: none;\n    height: auto;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-control img:not(.e-resize) {\n    border: 2px solid transparent;\n    z-index: 1000\n}\n\n.e-imginline,\n.e-audio-inline,\n.e-video-inline {\n    display: inline-block;\n    float: none;\n    margin-left: 5px;\n    margin-right: 5px;\n    vertical-align: bottom;\n}\n\n.e-imgbreak,\n.e-audio-break,\n.e-video-break {\n    border: 0;\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-img-focus:not(.e-resize),\n.e-audio-focus:not(.e-resize),\n.e-video-focus:not(.e-resize) {\n    border: solid 2px #4a90e2;\n}\n\nimg.e-img-focus::selection,\naudio.e-audio-focus::selection,\n.e-video-focus::selection {\n    background: transparent;\n    color: transparent;\n}\n\nspan.e-rte-imageboxmark,\nspan.e-rte-videoboxmark {\n    width: 10px;\n    height: 10px;\n    position: absolute;\n    display: block;\n    background: #4a90e2;\n    border: 1px solid #fff;\n    z-index: 1000;\n}\n\n.e-mob-rte.e-mob-span span.e-rte-imageboxmark,\n.e-mob-rte.e-mob-span span.e-rte-videoboxmark {\n    background: #4a90e2;\n    border: 1px solid #fff;\n}\n\n.e-mob-rte span.e-rte-imageboxmark,\n.e-mob-rte span.e-rte-videoboxmark {\n    background: #fff;\n    border: 1px solid #4a90e2;\n    border-radius: 15px;\n    height: 20px;\n    width: 20px;\n}\n\n.e-mob-rte.e-mob-span span.e-rte-imageboxmark,\n.e-mob-rte.e-mob-span span.e-rte-videoboxmark {\n    background: #4a90e2;\n    border: 1px solid #fff;\n}\n\n.e-content img.e-resize,\n.e-content video.e-resize {\n    z-index: 1000;\n}\n\n.e-img-caption .e-img-inner {\n    outline: 0;\n}\n\n.e-rte-img-caption.e-imgleft .e-img-inner {\n    float: left;\n    text-align: left;\n}\n\n.e-rte-img-caption.e-imgright .e-img-inner {\n    float: right;\n    text-align: right;\n}\n\n.e-rte-img-caption.e-imgleft .e-img-wrap,\n.e-rte-img-caption.e-imgright .e-img-wrap {\n    display: contents;\n}\n\n.e-img-caption a:focus-visible {\n    outline: none;\n}\n\n.e-rte-img-caption .e-rte-image.e-imgright {\n    margin-left: auto;\n    margin-right: 0;\n}\n\n.e-rte-img-caption .e-rte-image.e-imgleft {\n    margin: 0;\n}\n\nspan.e-table-box {\n    cursor: nwse-resize;\n    display: block;\n    height: 10px;\n    position: absolute;\n    width: 10px;\n    background-color: #ffffff;\n    border: 1px solid #BDBDBD;\n}\n\nspan.e-table-box.e-rmob {\n    height: 14px;\n    width: 14px;\n    background-color: #BDBDBD;\n    border: 1px solid #BDBDBD;\n}\n\n.e-row-resize,\n.e-column-resize {\n    background-color: transparent;\n    background-repeat: repeat;\n    bottom: 0;\n    cursor: col-resize;\n    height: 1px;\n    overflow: visible;\n    position: absolute;\n    width: 1px;\n}\n\n.e-row-resize {\n    cursor: row-resize;\n    height: 1px;\n}\n\n.e-table-rhelper {\n    cursor: col-resize;\n    opacity: .87;\n    position: absolute;\n}\n\n.e-table-rhelper.e-column-helper {\n    width: 1px;\n}\n\n.e-table-rhelper.e-row-helper {\n    height: 1px;\n}\n\n.e-reicon::before {\n    border-bottom: 6px solid transparent;\n    border-right: 6px solid;\n    border-top: 6px solid transparent;\n    content: \'\';\n    display: block;\n    height: 0;\n    position: absolute;\n    right: 4px;\n    top: 4px;\n    width: 20px;\n}\n\n.e-reicon::after {\n    border-bottom: 6px solid transparent;\n    border-left: 6px solid;\n    border-top: 6px solid transparent;\n    content: \'\';\n    display: block;\n    height: 0;\n    left: 4px;\n    position: absolute;\n    top: 4px;\n    width: 20px;\n    z-index: 3;\n}\n\n.e-row-helper.e-reicon::after {\n    top: 10px;\n    transform: rotate(90deg);\n}\n\n.e-row-helper.e-reicon::before {\n    left: 4px;\n    top: -20px;\n    transform: rotate(90deg);\n}\n\n\n.e-table-rhelper {\n    background-color: #4a90e2;\n}\n\n.e-rtl {\n    direction: rtl;\n}\n\n.e-rte-placeholder::before {\n    content: attr(placeholder);\n    opacity: 0.54;\n    overflow: hidden;\n    padding-top: 16px;\n    position: absolute;\n    text-align: start;\n    top: 0;\n    z-index: 1;\n}\n\n.e-resize-enabled,\n.e-count-enabled {\n    padding-bottom: 0px;\n}\n'.replace(/[\n\t]/g,"")+"\n            </style>\n        </head>\n",jl=(wl(Fl,Pl=zr),Fl.prototype.renderPanel=function(){var i,e=this.parent,t=Br(e.value,e),t=Hl+('<body contenteditable="true">'+t+"</body></html>"),n=this.parent.createElement("iframe",{id:this.parent.getID()+"_rte-view",className:"e-rte-content",attrs:{srcdoc:t}}),o=(n.setAttribute("role","none"),this.setPanel(n),j.isNullOrUndefined(this.parent.iframeSettings.sandbox)||((o=this.parent.iframeSettings.sandbox.map(function(e){return e.toLocaleLowerCase().trim()}).join(" ")).includes("allow-same-origin")||(o+=" allow-same-origin"),n.setAttribute("sandbox",o.trim())),e.rootContainer.appendChild(n),n.contentDocument.body.setAttribute("aria-owns",this.parent.getID()),n.contentDocument.open(),t=this.setThemeColor(t,{color:"#333"}),n.contentDocument.write(t),n.contentDocument.close(),n.contentDocument.body);o.className="e-content","auto"===this.parent.height&&(o.style.overflowY="hidden"),j.isNullOrUndefined(this.parent.fontFamily.default)||(o.style.fontFamily=this.parent.fontFamily.default),j.isNullOrUndefined(this.parent.fontSize.default)||(o.style.fontSize=this.parent.fontSize.default),o.id=this.parent.getID()+"_rte-edit-view",e.enableRtl&&this.contentPanel.contentDocument.body.setAttribute("class","e-rtl"),!j.isNullOrUndefined(n.contentDocument.head)&&0<this.parent.iframeSettings.metaTags.length&&(i=n.contentDocument.head,this.parent.iframeSettings.metaTags.forEach(function(e){var t,n=document.createElement("meta");for(t in e)j.isNullOrUndefined(e[t])||n.setAttribute("httpEquiv"===t?"http-equiv":t,e[t]);i.appendChild(n)}))},Fl.prototype.setThemeColor=function(e,t){var n=getComputedStyle(this.parent.element,".e-richtexteditor").getPropertyValue("color");return e.replace(t.color,n)},Fl.prototype.getEditPanel=function(){var e=j.isNullOrUndefined(this.contentPanel.contentDocument)?this.parent.inputElement:this.contentPanel.contentDocument.body;return e},Fl.prototype.getDocument=function(){return this.getEditPanel().ownerDocument},Fl);function Fl(){return null!==Pl&&Pl.apply(this,arguments)||this}zl.prototype.renderPanel=function(){var e=this.parent,t=this.parent.createElement("div",{id:this.parent.getID()+"_view",className:"e-rte-content"});this.editableElement=this.parent.createElement("textarea",{className:"e-content",id:this.parent.getID()+"_editable-content",attrs:{"aria-labelledby":this.parent.getID()+"_view"}}),t.appendChild(this.editableElement),this.setPanel(t),e.rootContainer.appendChild(t)},zl.prototype.getPanel=function(){return this.contentPanel},zl.prototype.getEditPanel=function(){return this.editableElement},zl.prototype.getText=function(){return this.getEditPanel().value},zl.prototype.setPanel=function(e){this.contentPanel=e},zl.prototype.getDocument=function(){return this.getEditPanel().ownerDocument};var ql=zl;function zl(e){this.parent=e}Vl.prototype.quickToolbarOpen=function(){var e=this.popupObj;this.parent.trigger(Nt,e)},Vl.prototype.renderPopup=function(e){this.setPanel(e.element),this.renderPanel(),e.popupObj=new I.Popup(e.element,{targetType:"relative",relateTo:this.parent.element,open:this.quickToolbarOpen.bind(this)}),this.popupObj=e.popupObj,e.popupObj.hide()},Vl.prototype.renderPanel=function(){this.getPanel().classList.add(jn)},Vl.prototype.getPanel=function(){return this.popupPanel},Vl.prototype.setPanel=function(e){this.popupPanel=e};var _l=Vl;function Vl(e){this.parent=e}Ql=function(e,t){return(Ql=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Ql,Wl,wl=function(e,t){function n(){this.constructor=e}Ql(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Kl=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},wl=(Wl=j.ChildProperty,wl(Gl,Wl),Kl([j.Property(!1)],Gl.prototype,"enable",void 0),Kl([j.Property(["Paragraph","Heading 1","Heading 2","Heading 3","Heading 4","OrderedList","UnorderedList","CodeBlock","Blockquote"])],Gl.prototype,"items",void 0),Kl([j.Property("300px")],Gl.prototype,"popupWidth",void 0),Kl([j.Property("320px")],Gl.prototype,"popupHeight",void 0),Gl);function Gl(){return null!==Wl&&Wl.apply(this,arguments)||this}var Xl=[{command:"Paragraph",subCommand:"p",type:"Basic Block",iconCss:"e-rte-paragraph"},{command:"Heading 1",subCommand:"h1",type:"Basic Block",iconCss:"e-rte-h1"},{command:"Heading 2",subCommand:"h2",type:"Basic Block",iconCss:"e-rte-h2"},{command:"Heading 3",subCommand:"h3",type:"Basic Block",iconCss:"e-rte-h3"},{command:"Heading 4",subCommand:"h4",type:"Basic Block",iconCss:"e-rte-h4"},{command:"OrderedList",subCommand:"insertOrderedList",type:"Basic Block",iconCss:"e-list-ordered e-icons"},{command:"UnorderedList",subCommand:"insertUnorderedList",type:"Basic Block",iconCss:"e-list-unordered e-icons"},{command:"Blockquote",subCommand:"blockquote",type:"Basic Block",iconCss:"e-blockquote e-icons"},{command:"CodeBlock",subCommand:"pre",type:"Basic Block",iconCss:"e-code-view e-icons"}],Yl=[{command:"Image",subCommand:m.DialogType.InsertImage,type:"Media",module:"Image",iconCss:"e-icons e-image"},{command:"Audio",subCommand:m.DialogType.InsertAudio,type:"Media",module:"Audio",iconCss:"e-icons e-audio"},{command:"Video",subCommand:m.DialogType.InsertVideo,type:"Media",module:"Video",iconCss:"e-icons e-video"},{command:"Link",subCommand:m.DialogType.InsertLink,type:"Inline",module:"Link",iconCss:"e-icons e-link"},{command:"Table",subCommand:m.DialogType.InsertTable,type:"Basic Block",module:"Table",iconCss:"e-icons e-table"},{command:"Emojipicker",subCommand:null,type:"Inline",module:"EmojiPicker",iconCss:"e-icons e-emoji"}],Kl=(Jl.prototype.removeEventListener=function(){this.parent.off(te,this.onPropertyChanged),this.parent.off(o,this.removeEventListener)},Jl.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++)if("slashMenuSettings"===n[t])switch(Object.keys(e.newProp.slashMenuSettings)[0]){case"enable":e.newProp.slashMenuSettings.enable?this.render():this.removeEventListener();break;case"items":this.mention.dataSource=this.getItems();break;case"popupHeight":this.mention.popupHeight=e.newProp.slashMenuSettings.popupHeight;break;case"popupWidth":this.mention.popupWidth=e.newProp.slashMenuSettings.popupWidth}},Jl.prototype.getModuleName=function(){return"slashMenu"},Jl.prototype.destroy=function(){this.mention&&!this.mention.isDestroyed&&(this.mention.destroy(),this.defaultItems=[],this.injectibleItems=[])},Jl.prototype.generateMentionModel=function(){var e=this;return{dataSource:this.getItems(),cssClass:"e-slash-menu"+this.parent.getCssClass(),fields:{text:"text",groupBy:"type",iconCss:"iconCss",value:"description"},mentionChar:"/",target:this.parent.inputElement,popupHeight:this.parent.slashMenuSettings.popupHeight,popupWidth:this.parent.slashMenuSettings.popupWidth,allowSpaces:!0,itemTemplate:'${if(iconCss && description)}<div class="e-rte-slash-menu-item-content" style="display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center;"><div class="e-slash-menu-icon"style="padding: 15px 15px 15px 15px;"><div class="${iconCss}"></div></div> <div style="display: flex; flex-direction: column;"><span class="e-rte-slash-menu-item-text" style="font-weight: 500;">${text}</span>${if(description)}<span class="e-rte-slash-menu-item-description">${description}</span>${/if}</div></div>${else}${if(iconCss && text)}<div class="e-rte-slash-menu-item-content" style="display: flex; flex-direction: row; align-items: center; height: 25px; font-weight: 500;"><div class="e-slash-menu-icon"style="margin-left: 15px; width: 30px"><div class="${iconCss}"></div></div> <span class="e-rte-slash-menu-item-icon-text">${text}</span></div>${/if}${/if}',beforeOpen:function(){e.savedSelection=e.savedSelection.save(e.savedSelection.getRange(e.currentDocument),e.currentDocument)},filtering:function(){e.savedSelection=e.savedSelection.save(e.savedSelection.getRange(e.currentDocument),e.currentDocument)},select:this.handleSelect.bind(this)}},Jl.prototype.handleSelect=function(e){var n=this,i=(e.cancel=!0,this.parent.focusIn(),this.savedSelection.restore(),e.itemData),t={isInteracted:e.isInteracted,item:e.item,itemData:e.itemData,originalEvent:e.e,cancel:!1};e.itemData.isCustomItem&&this.parent.formatter.beforeSlashMenuApply(),this.parent.trigger("slashMenuItemSelect",t,function(e){if(!e.cancel)if(e.itemData.isCustomItem)n.parent.inputElement.classList.contains("e-mention")&&(e=n.parent.inputElement.ownerDocument.getElementById(n.parent.inputElement.id+"_slash_menu_popup"))&&e.classList.contains("e-popup-open")&&n.mention.hidePopup();else{n.parent.formatter.beforeSlashMenuApply();var t=i;switch(t.command){case"OrderedList":n.parent.executeCommand("insertOrderedList");break;case"UnorderedList":n.parent.executeCommand("insertUnorderedList");break;case"Audio":case"Video":case"Image":case"Table":case"Link":n.mention.hidePopup(),setTimeout(function(){n.parent.showDialog(t.subCommand)},100);break;case"Emojipicker":n.mention.hidePopup(),setTimeout(function(){n.parent.showEmojiPicker()},100);break;default:n.parent.executeCommand("formatBlock",t.subCommand)}}})},Jl.prototype.getItems=function(){for(var o=this.parent.slashMenuSettings.items,r=[],s=this,e=0;e<o.length;e++)!function(e){var t,n,i;"string"==typeof o[e]?(t=o[e],n=s.defaultItems.filter(function(e){return e.command===t})[0],j.isNullOrUndefined(n)&&(n=s.injectibleItems.filter(function(e){return e.module.toLowerCase().replace(" ","")===t.toLowerCase().replace(" ","")})[0]),i=gr.get(t),r.push({text:s.L10n.getConstant(i.text),command:n.command,subCommand:n.subCommand,type:n.type,module:n.module,iconCss:n.iconCss,description:s.L10n.getConstant(i.description)})):r.push({text:o[e].text,command:o[e].command,type:o[e].type,iconCss:o[e].iconCss,description:o[e].description,isCustomItem:!0})}(e);return r},Jl.prototype.render=function(){var e;"HTML"===this.parent.editorMode&&this.parent.slashMenuSettings.enable&&(e=this.generateMentionModel(),this.mention=new H.Mention(e),this.mention.appendTo(this.parent.rootContainer.appendChild(this.parent.createElement("div",{className:"e-rte-slash-menu",id:this.parent.getID()+"_slash_menu"}))))},Jl);function Jl(e,t){this.parent=e,this.currentDocument=this.parent.element.ownerDocument,this.L10n=t.getService("rteLocale"),this.savedSelection=new gl(this.parent.inputElement),this.defaultItems=Xl,this.injectibleItems=Yl,this.parent.on(te,this.onPropertyChanged,this),this.parent.on(o,this.removeEventListener,this),this.parent.on(n,this.render,this)}Zl.prototype.addEventListener=function(){this.parent.on(at,this.setRtl,this),this.parent.on(on,this.setCssClass,this)},Zl.prototype.removeEventListener=function(){this.parent.off(at,this.setRtl),this.parent.off(on,this.setCssClass)},Zl.prototype.setCssClass=function(e){j.isNullOrUndefined(this.toolbarObj)||(j.isNullOrUndefined(e.oldCssClass)?this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass+" "+e.cssClass).trim()}):this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},Zl.prototype.setRtl=function(e){j.isNullOrUndefined(this.toolbarObj)||this.toolbarObj.setProperties({enableRtl:e.enableRtl})},Zl.prototype.getClass=function(e){var t;switch(e){case"fontsize":t="e-rte-inline-size-template";break;case"fontcolor":case"backgroundcolor":t="e-rte-inline-color-template";break;default:t="e-rte-inline-template"}return t},Zl.prototype.getTemplateObject=function(e,t){var n;switch(e){case"fontcolor":case"backgroundcolor":case"numberformatlist":case"bulletformatlist":n="span";break;default:n="button"}return{command:this.tools[e.toLocaleLowerCase()].command,subCommand:this.tools[e.toLocaleLowerCase()].subCommand,template:this.parent.createElement(n,{id:this.parent.getID()+"_"+t+"_"+this.tools[e.toLocaleLowerCase()].id}).outerHTML,cssClass:this.parent.inlineMode.enable?this.getClass(e):"",tooltipText:Sr(e,this.locator)}},Zl.prototype.getObject=function(e,t){var n=e.toLowerCase();if(-1!==Bo.indexOf(n))return this.getTemplateObject(n,t);switch(n){case"|":return{type:"Separator"};case"-":return{type:"Separator",cssClass:ki};default:return{id:this.parent.getID()+"_"+t+"_"+this.tools[n.toLocaleLowerCase()].id,prefixIcon:this.tools[n.toLocaleLowerCase()].icon,tooltipText:Sr(n,this.locator),command:this.tools[n.toLocaleLowerCase()].command,subCommand:this.tools[n.toLocaleLowerCase()].subCommand}}},Zl.prototype.getItems=function(e,t){var o=this;if(this.parent.toolbarSettings.items.length<1)return[];for(var r=[],s=this,n=0,i=e;n<i.length;n++)!function(e){var n,i;"string"==typeof e?r.push(s.getObject(e,t)):(j.isNullOrUndefined(e.click)||(i=(n=e).click,n.click=function(){if(n.undo&&0===o.parent.formatter.getUndoRedoStack().length&&o.parent.formatter.saveData(),i.call(o),0<o.parent.formatter.getUndoRedoStack().length){var e=o.parent.createElement("div"),t=o.parent.formatter.getUndoRedoStack()[o.parent.formatter.getUndoRedoStack().length-1].text.cloneNode(!0);if(e.appendChild(t),e.innerHTML.trim()===o.parent.inputElement.innerHTML.trim())return}n.undo&&o.parent.formatter.saveData()}),r.push(e))}(i[n]);if(this.parent.showTooltip)for(var a=0;a<r.length;a++)!function(e){var t=r[e].tooltipText,n=void 0,i=window.navigator.platform.toLocaleLowerCase().includes("mac");!(n=!ar[""+t]||j.isNullOrUndefined(r[e].id)&&j.isNullOrUndefined(r[e].cssClass)?t:ar[""+t].split(",").map(function(e){return i?e.replace("Ctrl+","").replace("Shift+","").replace("Alt+",""):e}).join(", "))||"Images"===r[e].command&&"InsertLink"===r[e].subCommand||(r[e].tooltipText=t!==n?t+" ("+n+")":t)}(a);return r},Zl.prototype.getToolbarOptions=function(e){return{target:e.target,rteToolbarObj:this,items:this.getItems(e.items,e.container),overflowMode:e.mode,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,cssClass:e.cssClass,type:e.container}},Zl.prototype.render=function(e){this.toolbarRenderer=this.renderFactory.getRenderer(m.RenderType.Toolbar),this.toolbarRenderer&&this.toolbarRenderer.isDestroyed&&(this.toolbarRenderer=new yl(this.parent,this.locator)),this.toolbarRenderer.renderToolbar(this.getToolbarOptions(e))},Zl.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.toolbarObj&&!this.toolbarObj.isDestroyed&&(this.toolbarObj.destroy(),this.toolbarObj=null),this.toolbarRenderer.destroy(),this.toolbarRenderer=null,this.tools={},this.isDestroyed=!0)};var $l=Zl;function Zl(e,t){this.tools={},this.parent=e,this.locator=t,this.isDestroyed=!1,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.parent.toolbarSettings&&0<Object.keys(this.parent.toolbarSettings.itemConfigs).length?j.extend(this.tools,Ro,Mr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Ro,(this.parent.toolbarSettings.enable||this.parent.quickToolbarSettings.enable)&&(this.toolbarRenderer=new yl(this.parent,this.locator),this.renderFactory.addRenderer(m.RenderType.Toolbar,this.toolbarRenderer))}T.prototype.initializeInstance=function(){this.toolbarRenderer=this.renderFactory.getRenderer(m.RenderType.Toolbar)},T.prototype.beforeRender=function(e){var t=e.item;t.cssClass&&j.addClass([e.element],t.cssClass)},T.prototype.dropdownContent=function(e,t,n){return'<span style="display: inline-flex;width:'+("quick"===t?"auto":e)+'" ><span class="e-rte-dropdown-btn-text">'+n+"</span></span>"},T.prototype.renderDropDowns=function(o){var r=this,s=(this.initializeInstance(),o.containerType),a=o.container;Bo.forEach(function(e){var t=void 0;if(-1!==vr(e,o.items))switch(e){case"numberformatlist":if(t=j.select("#"+r.parent.getID()+"_"+s+"_NumberFormatList",a),j.isNullOrUndefined(t)||t.classList.contains(Gn))return;var n=r.parent.numberFormatList.types.slice();n.forEach(function(e){Object.defineProperties(e,{command:{value:"Lists",enumerable:!0},subCommand:{value:"NumberFormatList",enumerable:!0}})}),r.numberFormatListDropDown=r.toolbarRenderer.renderListDropDown({cssClass:"e-order-list "+Oi+" "+Ei,itemName:"NumberFormatList",items:n,element:t});break;case"bulletformatlist":if(t=j.select("#"+r.parent.getID()+"_"+s+"_BulletFormatList",a),j.isNullOrUndefined(t)||t.classList.contains(Gn))return;n=r.parent.bulletFormatList.types.slice();n.forEach(function(e){Object.defineProperties(e,{command:{value:"Lists",enumerable:!0},subCommand:{value:"BulletFormatList",enumerable:!0}})}),r.bulletFormatListDropDown=r.toolbarRenderer.renderListDropDown({cssClass:"e-unorder-list "+Oi+" "+Ei,itemName:"BulletFormatList",items:n,element:t});break;case"formats":if(t=j.select("#"+r.parent.getID()+"_"+s+"_Formats",a),j.isNullOrUndefined(t)||t.classList.contains(Gn))return;var n=r.parent.format.types.slice(),i=(n.forEach(function(e){Object.defineProperties(e,{command:{value:"Formats",enumerable:!0},subCommand:{value:e.value,enumerable:!0}})}),j.isNullOrUndefined(r.parent.format.default)?n[0].text:r.parent.format.default);r.formatDropDown=r.toolbarRenderer.renderDropDownButton({iconCss:"quick"===s?"e-formats e-icons":"",content:r.dropdownContent(r.parent.format.width,s,"quick"===s?"":yr(n,i,"text","text")),cssClass:Qn+" "+Kn+" "+Bi,itemName:"Formats",items:n,element:t});break;case"fontname":if(t=j.select("#"+r.parent.getID()+"_"+s+"_FontName",a),j.isNullOrUndefined(t)||t.classList.contains(Gn))return;i=r.parent.fontFamily.items.slice(),n=(i.forEach(function(e){Object.defineProperties(e,{command:{value:"Font",enumerable:!0},subCommand:{value:"FontName",enumerable:!0}})}),j.isNullOrUndefined(r.parent.fontFamily.default)?0===i.length?"":i[0].text:r.parent.fontFamily.default);r.fontNameDropDown=r.toolbarRenderer.renderDropDownButton({iconCss:"quick"===s?"e-font-name e-icons":"",content:r.dropdownContent(r.parent.fontFamily.width,s,0===i.length?r.i10n.getConstant("fontName"):"quick"===s?"":"Default"===yr(i,n,"text","text")?r.i10n.getConstant("fontName"):yr(i,n,"text","text")),cssClass:Qn+" "+Kn+" "+Ri,itemName:"FontName",items:i,element:t});break;case"fontsize":if(t=j.select("#"+r.parent.getID()+"_"+s+"_FontSize",a),j.isNullOrUndefined(t)||t.classList.contains(Gn))return;n=!j.isNullOrUndefined(r.fontSizeDropDown)&&!j.isNullOrUndefined(r.fontSizeDropDown.items)&&0<r.fontSizeDropDown.items.length?r.fontSizeDropDown.items:JSON.parse(JSON.stringify(r.parent.fontSize.items.slice())),i=(n.forEach(function(e){Object.defineProperties(e,{command:{value:"Font",enumerable:!0},subCommand:{value:"FontSize",enumerable:!0}})}),j.isNullOrUndefined(r.parent.fontSize.default)?0===n.length?"":n[0].text:r.parent.fontSize.default),i=yr(n,i.replace(/\s/g,""),"Default"===i?"text":"value","text");r.fontSizeDropDown=r.toolbarRenderer.renderDropDownButton({content:r.dropdownContent(r.parent.fontSize.width,s,0===n.length?r.i10n.getConstant("fontSize"):Nr("Default"===i?r.i10n.getConstant("fontSize"):i)),cssClass:Qn+" "+Kn+" "+Ai,itemName:"FontSize",items:n,element:t});break;case"alignments":t=j.select("#"+r.parent.getID()+"_"+s+"_Alignments",a),j.isNullOrUndefined(t)||t.classList.contains(Gn)||(r.alignDropDown=r.toolbarRenderer.renderDropDownButton({iconCss:"e-justify-left e-icons",cssClass:Qn+" "+Kn+" "+Ii,itemName:"Alignments",items:Io,element:t}));break;case"align":case"videoalign":r.renderAlignmentDropDown(s,a,t,e);break;case"display":case"audiolayoutoption":case"videolayoutoption":r.renderDisplayDropDown(s,a,t,e);break;case"tablerows":r.rowDropDown(s,a,t);break;case"tablecolumns":r.columnDropDown(s,a,t);break;case"tablecell":r.cellDropDown(s,a,t);break;case"tablecellverticalalign":r.verticalAlignDropDown(s,a,t);break;case"styles":r.tableStylesDropDown(s,a,t)}}),this.parent.inlineMode.enable&&this.setCssClass({cssClass:this.parent.getCssClass()})},T.prototype.getUpdateItems=function(e,t){e=e.slice();return e.forEach(function(e){Object.defineProperties(e,{command:{value:"Format"===t?"Formats":"Font",enumerable:!0},subCommand:{value:"Format"===t?e.value:t,enumerable:!0}})}),e},T.prototype.onPropertyChanged=function(e){for(var t=e.newProp,n=0,i=Object.keys(t);n<i.length;n++)switch(i[n]){case"fontFamily":if(this.fontNameDropDown)for(var o=0,r=Object.keys(t.fontFamily);o<r.length;o++)switch(r[o]){case"default":case"width":var s=this.fontNameDropDown.items,a=j.isNullOrUndefined(j.closest(this.fontNameDropDown.element,"."+In))?"toolbar":"quick",l=j.isNullOrUndefined(this.parent.fontFamily.default)?s[0].text:this.parent.fontFamily.default,d=this.dropdownContent(this.parent.fontFamily.width,a,"quick"===a?"":"Default"===yr(s,l,"text","text")?this.i10n.getConstant("fontName"):yr(s,l,"text","text"));this.fontNameDropDown.setProperties({content:d}),j.isNullOrUndefined(this.parent.fontFamily.default)?this.getEditNode().style.removeProperty("font-family"):this.getEditNode().style.fontFamily=this.parent.fontFamily.default;break;case"items":this.fontNameDropDown.setProperties({items:this.getUpdateItems(t.fontFamily.items,"FontName")})}break;case"fontSize":if(this.fontSizeDropDown)for(var c=0,p=Object.keys(t.fontSize);c<p.length;c++)switch(p[c]){case"default":case"width":var h=this.fontSizeDropDown.items,u=(a=j.isNullOrUndefined(j.closest(this.fontSizeDropDown.element,"."+In))?"toolbar":"quick",j.isNullOrUndefined(this.parent.fontSize.default)?h[0].text:this.parent.fontSize.default),h=yr(h,u.replace(/\s/g,""),"Default"===u?"text":"value","text");d=this.dropdownContent(this.parent.fontSize.width,a,Nr("Default"===h?this.i10n.getConstant("fontSize"):h)),this.fontSizeDropDown.setProperties({content:d}),j.isNullOrUndefined(this.parent.fontSize.default)?this.getEditNode().style.removeProperty("font-size"):this.getEditNode().style.fontSize=this.parent.fontSize.default;break;case"items":this.fontSizeDropDown.setProperties({items:this.getUpdateItems(t.fontSize.items,"FontSize")})}break;case"format":if(this.formatDropDown)for(var m=0,g=Object.keys(t.format);m<g.length;m++)switch(g[m]){case"default":case"width":var f=this.formatDropDown.items,b=(a=j.isNullOrUndefined(j.closest(this.formatDropDown.element,"."+In))?"toolbar":"quick",j.isNullOrUndefined(this.parent.format.default)?f[0].text:this.parent.format.default);d=this.dropdownContent(this.parent.format.width,a,"quick"===a?"":yr(f,b,"text","text")),this.formatDropDown.setProperties({content:d});break;case"types":this.formatDropDown.setProperties({items:this.getUpdateItems(t.format.types,"Format")})}}},T.prototype.getEditNode=function(){return this.parent.contentModule.getEditPanel()},T.prototype.rowDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableRows",t)).classList.contains(Gn)||(this.tableRowsDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-rows e-icons",cssClass:Qn+" "+Kn+" "+Fn,itemName:"TableRows",items:Wo,element:n}))},T.prototype.columnDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableColumns",t)).classList.contains(Gn)||(this.tableColumnsDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-columns e-icons",cssClass:Qn+" "+Kn+" "+Fn,itemName:"TableColumns",items:Go,element:n}))},T.prototype.cellDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableCell",t)).classList.contains(Gn)||(this.tableCellDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-cell e-icons",cssClass:Qn+" "+Kn+" "+Fn,itemName:"TableCell",items:Vo,element:n}))},T.prototype.verticalAlignDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_TableCellVerticalAlign",t)).classList.contains(Gn)||(this.tableCellVerticalAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-cell-ver-align e-icons",cssClass:Qn+" "+Kn+" "+Fn,itemName:"TableCellVerticalAlign",items:Yo,element:n}))},T.prototype.renderDisplayDropDown=function(e,t,n,i){(n=j.select("#"+this.parent.getID()+"_"+e+("display"===i?"_Display":"videolayoutoption"===i?"_VideoLayoutOption":"_AudioLayoutOption"),t)).classList.contains(Gn)||(this.displayDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"display"===i?"e-display e-icons":"videolayoutoption"===i?"e-video-display e-icons":"e-audio-display e-icons",cssClass:Qn+" "+Kn+" "+Fn,itemName:"display"===i?"Display":"videolayoutoption"===i?"VideoLayoutOption":"AudioLayoutOption",items:"display"===i?qo:"videolayoutoption"===i?_o:zo,element:n}))},T.prototype.renderAlignmentDropDown=function(e,t,n,i){(n=j.select("#"+this.parent.getID()+"_"+e+("align"===i?"_Align":"_VideoAlign"),t)).classList.contains(Gn)||(this.imageAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-justify-left e-icons",cssClass:Qn+" "+Wn+" "+Fn,itemName:"align"===i?"Align":"VideoAlign",items:"align"===i?Uo:Po,element:n}))},T.prototype.tableStylesDropDown=function(e,t,n){(n=j.select("#"+this.parent.getID()+"_"+e+"_Styles",t)).classList.contains(Gn)||(this.imageAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-style e-icons",cssClass:Qn+" "+Wn+" "+Fn,itemName:"Styles",items:this.parent.tableSettings.styles,element:n}))},T.prototype.removeDropDownClasses=function(e){j.removeClass([e],[Gn,Qn,Wn,Kn])},T.prototype.destroyDropDowns=function(){this.formatDropDown&&(this.removeDropDownClasses(this.formatDropDown.element),this.formatDropDown.destroy(),this.formatDropDown=null),this.fontNameDropDown&&(this.removeDropDownClasses(this.fontNameDropDown.element),this.fontNameDropDown.destroy(),this.fontNameDropDown=null),this.fontSizeDropDown&&(this.removeDropDownClasses(this.fontSizeDropDown.element),this.fontSizeDropDown.destroy(),this.fontSizeDropDown=null),this.alignDropDown&&(this.removeDropDownClasses(this.alignDropDown.element),this.alignDropDown.destroy(),this.alignDropDown=null),this.imageAlignDropDown&&(this.removeDropDownClasses(this.imageAlignDropDown.element),this.imageAlignDropDown.destroy(),this.imageAlignDropDown=null),this.displayDropDown&&(this.removeDropDownClasses(this.displayDropDown.element),this.displayDropDown.destroy(),this.displayDropDown=null),this.tableRowsDropDown&&(this.removeDropDownClasses(this.tableRowsDropDown.element),this.tableRowsDropDown.destroy(),this.tableRowsDropDown=null),this.tableColumnsDropDown&&(this.removeDropDownClasses(this.tableColumnsDropDown.element),this.tableColumnsDropDown.destroy(),this.tableColumnsDropDown=null),this.tableCellDropDown&&(this.removeDropDownClasses(this.tableCellDropDown.element),this.tableCellDropDown.destroy(),this.tableCellDropDown=null),this.tableCellVerticalAlignDropDown&&(this.removeDropDownClasses(this.tableCellVerticalAlignDropDown.element),this.tableCellVerticalAlignDropDown.destroy(),this.tableCellVerticalAlignDropDown=null),this.numberFormatListDropDown&&(this.removeDropDownClasses(this.numberFormatListDropDown.element),this.numberFormatListDropDown.destroy(),this.numberFormatListDropDown=null),this.bulletFormatListDropDown&&(this.removeDropDownClasses(this.bulletFormatListDropDown.element),this.bulletFormatListDropDown.destroy(),this.bulletFormatListDropDown=null),this.toolbarRenderer=null},T.prototype.setRtl=function(e){this.formatDropDown&&this.formatDropDown.setProperties({enableRtl:e.enableRtl}),this.fontNameDropDown&&this.fontNameDropDown.setProperties({enableRtl:e.enableRtl}),this.fontSizeDropDown&&this.fontSizeDropDown.setProperties({enableRtl:e.enableRtl}),this.alignDropDown&&this.alignDropDown.setProperties({enableRtl:e.enableRtl}),this.imageAlignDropDown&&this.imageAlignDropDown.setProperties({enableRtl:e.enableRtl}),this.displayDropDown&&this.displayDropDown.setProperties({enableRtl:e.enableRtl}),this.numberFormatListDropDown&&this.numberFormatListDropDown.setProperties({enableRtl:e.enableRtl}),this.bulletFormatListDropDown&&this.bulletFormatListDropDown.setProperties({enableRtl:e.enableRtl})},T.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},T.prototype.setCssClass=function(e){for(var t=[this.formatDropDown,this.fontNameDropDown,this.fontSizeDropDown,this.alignDropDown,this.imageAlignDropDown,this.displayDropDown,this.numberFormatListDropDown,this.bulletFormatListDropDown,this.tableRowsDropDown,this.tableColumnsDropDown,this.tableCellDropDown,this.tableCellVerticalAlignDropDown],n=0;n<t.length;n++)this.updateCss(t[n],e)},T.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(he,this.beforeRender,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(at,this.setRtl,this),this.parent.on(te,this.onPropertyChanged,this),this.parent.on(on,this.setCssClass,this))},T.prototype.onIframeMouseDown=function(){!j.isNullOrUndefined(this.parent.getToolbarElement())&&(0<this.parent.getToolbarElement().querySelectorAll('.e-rte-dropdown-btn[aria-expanded="true"]').length||0<this.parent.getToolbarElement().querySelectorAll('.e-dropdown-btn.e-rte-inline-dropdown[aria-expanded="true"]').length)&&this.closeOpenDropdowns()},T.prototype.closeOpenDropdowns=function(){[this.formatDropDown,this.fontNameDropDown,this.fontSizeDropDown,this.alignDropDown,this.imageAlignDropDown,this.displayDropDown,this.numberFormatListDropDown,this.bulletFormatListDropDown,this.tableRowsDropDown,this.tableColumnsDropDown,this.tableCellDropDown,this.tableCellVerticalAlignDropDown,this.parent.toolbarModule.colorPickerModule.fontColorDropDown,this.parent.toolbarModule.colorPickerModule.backgroundColorDropDown].forEach(function(e){e&&e.dropDown&&e.dropDown.element&&e.dropDown.element.classList.contains("e-popup-open")&&e.toggle()})},T.prototype.removeEventListener=function(){this.parent.off(K,this.onIframeMouseDown),this.parent.off(at,this.setRtl),this.parent.off(he,this.beforeRender),this.parent.off(te,this.onPropertyChanged),this.parent.off(on,this.setCssClass)},T.prototype.destroy=function(){this.removeEventListener(),this.destroyDropDowns()};var ed=T;function T(e,t){this.parent=e,this.locator=t,this.i10n=t.getService("rteLocale"),this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener()}nd.prototype.addEventListener=function(){this.parent.on(G,this.toolbarClick,this),this.parent.on(pe,this.dropDownSelect,this),this.parent.on(Ze,this.renderSelection,this),this.parent.on(o,this.removeEventListener,this)},nd.prototype.toolbarClick=function(e){var t;Hs()&&this.parent.formatter.editorManager.nodeSelection&&0<this.parent.formatter.editorManager.nodeSelection.get(this.parent.contentModule.getDocument()).rangeCount&&!this.parent.inputElement.contains(this.parent.getRange().startContainer)&&this.parent.notify(We,{}),j.isNullOrUndefined(e.item)||(j.isNullOrUndefined(e.item.controlParent)||(t=e.item.controlParent.activeEle)&&(t.tabIndex=-1),"NumberFormatList"!==e.item.command&&"BulletFormatList"!==e.item.command||(e.originalEvent.target.classList.contains("e-order-list")||e.originalEvent.target.classList.contains("e-unorder-list"))&&(e.item.command="Lists",e.item.subCommand="NumberFormatList"===e.item.subCommand?"OL":"UL"),"Lists"===e.item.command&&e.originalEvent.target.classList.contains("e-caret")&&(e.originalEvent.target.parentElement.classList.contains("e-rte-bulletformatlist-dropdown")||e.originalEvent.target.parentElement.classList.contains("e-rte-numberformatlist-dropdown")))||(this.parent.notify(Z,e),this.parent.notify(ee,e))},nd.prototype.dropDownSelect=function(e){var t,n;this.parent.notify(We,{}),document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&e.item&&("Images"===e.item.command||"Audios"===e.item.command||"Videos"===e.item.command||"VideoLayoutOption"===e.item.command||"Display"===e.item.command||"Table"===e.item.command)||(t=e.item.controlParent&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.tableQTBar&&this.parent.quickToolbarModule.tableQTBar.element.contains(e.item.controlParent.element)?"Table":null,"Lists"===e.item.command?(n={listStyle:e.item.value,listImage:e.item.listImage,type:e.item.subCommand},this.parent.formatter.process(this.parent,e,e.originalEvent,n)):this.parent.formatter.process(this.parent,e,e.originalEvent,t)),this.parent.notify(Qe,{})},nd.prototype.renderSelection=function(e){this.parent.notify(We,{}),this.parent.formatter.process(this.parent,e,e.originalEvent,null),this.parent.notify(Qe,{})},nd.prototype.removeEventListener=function(){this.parent.off(G,this.toolbarClick),this.parent.off(pe,this.dropDownSelect),this.parent.off(Ze,this.renderSelection),this.parent.off(o,this.removeEventListener)};var td=nd;function nd(e){this.parent=e,this.addEventListener()}od.prototype.initializeInstance=function(){this.toolbarRenderer=this.renderFactory.getRenderer(m.RenderType.Toolbar)},od.prototype.renderColorPickerInput=function(r){var s,a,l=this,d=(this.initializeInstance(),r.containerType),c=r.container;Bo.forEach(function(e){if(-1!==vr(e,r.items))switch(e){case"fontcolor":s=l.parent.getID()+"_"+d+"_FontColor_Target";var t=l.parent.createElement("input");if(t.id=s,t.classList.add(Ui),!j.isNullOrUndefined(l.parent.cssClass))for(var n=l.parent.cssClass.split(" "),i=0;i<n.length;i++)""!==n[i].trim()&&t.classList.add(n[i]);document.body.appendChild(t),a={cssClass:l.tools[e.toLocaleLowerCase()].icon+" "+Oi+" "+Ei+l.parent.getCssClass(!0),value:l.tools[e.toLocaleLowerCase()].value,command:l.tools[e.toLocaleLowerCase()].command,subCommand:l.tools[e.toLocaleLowerCase()].subCommand,element:j.select("#"+l.parent.getID()+"_"+d+"_FontColor",c),target:s},l.fontColorPicker=l.toolbarRenderer.renderColorPicker(a,"fontcolor"),l.fontColorDropDown=l.toolbarRenderer.renderColorPickerDropDown(a,"fontcolor",l.fontColorPicker);break;case"backgroundcolor":s=l.parent.getID()+"_"+d+"_BackgroundColor_Target";var o=l.parent.createElement("input");if(o.id=s,o.classList.add(Pi),!j.isNullOrUndefined(l.parent.cssClass))for(n=l.parent.cssClass.split(" "),i=0;i<n.length;i++)""!==n[i].trim()&&o.classList.add(n[i]);document.body.appendChild(o),a={cssClass:l.tools[e.toLocaleLowerCase()].icon+" "+Oi+" "+Ei+l.parent.getCssClass(!0),value:l.tools[e.toLocaleLowerCase()].value,command:l.tools[e.toLocaleLowerCase()].command,subCommand:l.tools[e.toLocaleLowerCase()].subCommand,element:j.select("#"+l.parent.getID()+"_"+d+"_BackgroundColor",c),target:s},l.backgroundColorPicker=l.toolbarRenderer.renderColorPicker(a,"backgroundcolor"),l.backgroundColorDropDown=l.toolbarRenderer.renderColorPickerDropDown(a,"backgroundcolor",l.backgroundColorPicker,l.defaultColorPicker)}}),this.parent.inlineMode.enable&&this.setCssClass({cssClass:this.parent.getCssClass()})},od.prototype.destroy=function(){this.removeEventListener(),this.destroyColorPicker(),this.defaultColorPicker=null,this.fontColorPicker=null,this.fontColorDropDown=null,this.backgroundColorDropDown=null,this.backgroundColorPicker=null,this.tools={}},od.prototype.destroyColorPicker=function(){var e;this.fontColorPicker&&!this.fontColorPicker.isDestroyed&&this.fontColorPicker.destroy(),this.backgroundColorPicker&&!this.backgroundColorPicker.isDestroyed&&this.backgroundColorPicker.destroy(),this.fontColorDropDown&&!this.fontColorDropDown.isDestroyed&&((e=this.fontColorDropDown.element.querySelector(".e-rte-color-content"))&&j.detach(e),this.fontColorDropDown.destroy()),this.backgroundColorDropDown&&!this.backgroundColorDropDown.isDestroyed&&((e=this.backgroundColorDropDown.element.querySelector(".e-rte-color-content"))&&(this.defaultColorPicker=e.children[0].style.borderBottomColor,j.detach(e)),this.backgroundColorDropDown.destroy())},od.prototype.setRtl=function(e){this.fontColorPicker&&(this.fontColorPicker.setProperties({enableRtl:e.enableRtl}),this.fontColorDropDown.setProperties({enableRtl:e.enableRtl})),this.backgroundColorPicker&&(this.backgroundColorPicker.setProperties({enableRtl:e.enableRtl}),this.backgroundColorDropDown.setProperties({enableRtl:e.enableRtl}))},od.prototype.setCssClass=function(e){this.updateCss(this.fontColorPicker,this.fontColorDropDown,e),this.updateCss(this.backgroundColorPicker,this.backgroundColorDropDown,e)},od.prototype.updateCss=function(e,t,n){e&&n.cssClass&&(j.isNullOrUndefined(n.oldCssClass)?(e.setProperties({cssClass:(e.cssClass+" "+n.cssClass).trim()}),t.setProperties({cssClass:(t.cssClass+" "+n.cssClass).trim()})):(e.setProperties({cssClass:(e.cssClass.replace(n.oldCssClass,"").replace("  "," ").trim()+" "+n.cssClass).trim()}),t.setProperties({cssClass:(t.cssClass.replace(n.oldCssClass,"").replace("  "," ").trim()+" "+n.cssClass).trim()})))},od.prototype.addEventListener=function(){this.parent.on(le,this.renderColorPickerInput,this),this.parent.on(at,this.setRtl,this),this.parent.on(te,this.onPropertyChanged,this),this.parent.on(on,this.setCssClass,this),this.parent.on(mn,this.showColorPicker,this)},od.prototype.showColorPicker=function(e){j.isNullOrUndefined(this.fontColorPicker)||"fontcolor"!==e.toolbarClick?j.isNullOrUndefined(this.backgroundColorPicker)||"backgroundcolor"!==e.toolbarClick||this.backgroundColorDropDown.toggle():this.fontColorDropDown.toggle()},od.prototype.onPropertyChanged=function(e){for(var t=e.newProp,n=0,i=Object.keys(t);n<i.length;n++)switch(i[n]){case"fontColor":if(this.fontColorPicker)for(var o=0,r=Object.keys(t.fontColor);o<r.length;o++)switch(r[o]){case"default":this.fontColorPicker.setProperties({value:t.fontColor.default}),this.fontColorDropDown.element.querySelector("."+this.tools.fontcolor.icon).style.borderBottomColor=t.fontColor.default;break;case"mode":this.fontColorPicker.setProperties({mode:t.fontColor.mode});break;case"columns":this.fontColorPicker.setProperties({columns:t.fontColor.columns});break;case"colorCode":this.fontColorPicker.setProperties({presetColors:t.fontColor.colorCode});break;case"modeSwitcher":this.fontColorPicker.setProperties({modeSwitcher:t.fontColor.modeSwitcher})}break;case"backgroundColor":if(this.backgroundColorPicker)for(var s=0,a=Object.keys(t.backgroundColor);s<a.length;s++)switch(a[s]){case"default":this.backgroundColorPicker.setProperties({value:t.backgroundColor.default}),this.backgroundColorDropDown.element.querySelector("."+this.tools.backgroundcolor.icon).style.borderBottomColor=t.backgroundColor.default;break;case"mode":this.backgroundColorPicker.setProperties({mode:t.backgroundColor.mode});break;case"columns":this.backgroundColorPicker.setProperties({columns:t.backgroundColor.columns});break;case"colorCode":this.backgroundColorPicker.setProperties({presetColors:t.backgroundColor.colorCode});break;case"modeSwitcher":this.backgroundColorPicker.setProperties({modeSwitcher:t.backgroundColor.modeSwitcher})}}},od.prototype.removeEventListener=function(){this.parent.off(le,this.renderColorPickerInput),this.parent.off(at,this.setRtl),this.parent.off(te,this.onPropertyChanged),this.parent.off(on,this.setCssClass),this.parent.off(mn,this.showColorPicker)};var id=od;function od(e,t){this.tools={},this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.parent.toolbarSettings&&0<Object.keys(this.parent.toolbarSettings.itemConfigs).length?j.extend(this.tools,Ro,Mr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Ro}O.prototype.initializeInstance=function(){this.contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content),this.editableElement=this.contentRenderer.getEditPanel(),this.editPanel=this.contentRenderer.getPanel()},O.prototype.toolbarBindEvent=function(){this.parent.inlineMode.enable||(this.keyBoardModule=new j.KeyboardEvents(this.getToolbarElement(),{keyAction:this.toolBarKeyDown.bind(this),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"}))},O.prototype.toolBarKeyDown=function(e){switch(e.action){case"escape":this.parent.contentModule.getEditPanel().focus();break;case"enter":j.isNullOrUndefined(e.target)||!e.target.classList.contains("e-rte-fontcolor-dropdown")&&!e.target.classList.contains("e-rte-backgroundcolor-dropdown")||this.parent.notify(mn,{toolbarClick:e.target.classList.contains("e-rte-fontcolor-dropdown")?"fontcolor":"backgroundcolor"})}},O.prototype.createToolbarElement=function(){this.tbElement=this.parent.createElement("div",{id:this.parent.getID()+"_toolbar"}),!j.Browser.isDevice&&this.parent.inlineMode.enable&&Cr()||(this.parent.inlineMode.enable?this.parent.rootContainer.insertBefore(this.tbElement,this.editPanel):(this.tbWrapper=this.parent.createElement("div",{id:this.parent.getID()+"_toolbar_wrapper",innerHTML:this.tbElement.outerHTML,className:Jn}),this.tbElement=this.tbWrapper.firstElementChild,this.parent.rootContainer.insertBefore(this.tbWrapper,this.editPanel)))},O.prototype.getToolbarMode=function(){var e;switch(this.parent.toolbarSettings.type){case m.ToolbarType.Expand:e="Extended";break;case m.ToolbarType.Scrollable:e="Scrollable";break;default:e="MultiRow"}return e=Cr()&&this.parent.toolbarSettings.type===m.ToolbarType.Expand?m.ToolbarType.Scrollable:e},O.prototype.checkToolbarResponsive=function(e){var t;return!(!j.Browser.isDevice||Cr()||(t=this.parent.toolbarSettings.type===m.ToolbarType.Expand?m.ToolbarType.MultiRow:this.parent.toolbarSettings.type,this.baseToolbar.render({container:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items,mode:t,target:e,cssClass:this.parent.getCssClass()}),this.parent.toolbarSettings.type===m.ToolbarType.Expand&&(j.addClass([e],["e-rte-tb-mobile"]),this.parent.inlineMode.enable?this.addFixedTBarClass():j.addClass([e],[Hn])),this.wireEvents(),this.dropDownModule.renderDropDowns({container:e,containerType:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items}),this.renderColorPicker({container:this.tbElement,containerType:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items}),0))},O.prototype.checkIsTransformChild=function(){this.isTransformChild=!1;for(var e=j.selectAll('[style*="transform"]',document),t=0;t<e.length;t++)if(!j.isNullOrUndefined(e[t].contains)&&e[t].contains(this.parent.element)){this.isTransformChild=!0;break}},O.prototype.toggleFloatClass=function(){var e=this.parent.floatingToolbarOffset;this.parent.toolbarSettings.enableFloating?(j.addClass([this.tbElement.parentElement],[Mn]),j.setStyleAttribute(this.tbElement.parentElement,{top:e+"px"})):(j.removeClass([this.tbElement.parentElement],[Mn]),j.setStyleAttribute(this.tbElement.parentElement,{top:""}))},O.prototype.renderToolbar=function(){this.initializeInstance(),this.createToolbarElement(),this.checkToolbarResponsive(this.tbElement)||(this.parent.inlineMode.enable?this.parent.notify(rt,{}):(this.baseToolbar.render({container:"toolbar",items:this.parent.toolbarSettings.items,mode:this.getToolbarMode(),target:this.tbElement,cssClass:this.parent.getCssClass()}),this.parent.element.classList.contains("e-rte-full-screen")&&this.updateItem({targetItem:"Maximize",updateItem:"Minimize",baseToolbar:this.parent.getBaseToolbarObject()}),this.parent.inlineMode.enable||(this.parent.toolbarSettings.enableFloating&&(this.checkIsTransformChild(),this.toggleFloatClass()),j.addClass([this.parent.element],[wo]),this.parent.toolbarSettings.type===m.ToolbarType.Expand&&j.addClass([this.parent.element],[Rn]))),this.wireEvents(),this.parent.inlineMode.enable&&!Cr()&&this.addFixedTBarClass(),this.parent.inlineMode.enable||(this.dropDownModule.renderDropDowns({container:this.tbElement,containerType:"toolbar",items:this.parent.toolbarSettings.items}),this.renderColorPicker({container:this.tbElement,containerType:"toolbar",items:this.parent.toolbarSettings.items}),this.refreshToolbarOverflow()),this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-source-code-enabled")&&(this.parent.notify(xe,{targetItem:"SourceCode",updateItem:"Preview",baseToolbar:this.parent.getBaseToolbarObject()}),this.parent.disableToolbarItem(this.parent.toolbarSettings.items)))},O.prototype.addFixedTBarClass=function(){j.addClass([this.tbElement],[Dn])},O.prototype.removeFixedTBarClass=function(){j.removeClass([this.tbElement],[Dn])},O.prototype.showFixedTBar=function(){j.addClass([this.tbElement],[$n]),j.Browser.isIos&&j.addClass([this.tbElement],[wi])},O.prototype.hideFixedTBar=function(){this.isToolbar?this.isToolbar=!1:j.removeClass([this.tbElement],[$n,wi])},O.prototype.updateItem=function(e){var t=this.tools[e.updateItem.toLocaleLowerCase()];("Code View"!==Sr(e.updateItem.toLocaleLowerCase(),this.locator)&&"Preview"!==Sr(e.updateItem.toLocaleLowerCase(),this.locator)||"en-US"!==this.parent.locale)&&(t.tooltip=Sr(e.updateItem.toLocaleLowerCase(),this.locator));var n,i=Lr(Or(this.tools[e.targetItem.toLocaleLowerCase()].subCommand),e.baseToolbar.toolbarObj.items)[0];j.isNullOrUndefined(i)?this.addTBarItem(e,0):(n=this.parent.inlineMode.enable?"_quick_":"_toolbar_",e.baseToolbar.toolbarObj.items[i].id=this.parent.getID()+n+t.id,e.baseToolbar.toolbarObj.items[i].prefixIcon=t.icon,e.baseToolbar.toolbarObj.items[i].tooltipText=t.tooltip,e.baseToolbar.toolbarObj.items[i].subCommand=t.subCommand,e.baseToolbar.toolbarObj.dataBind(),e.baseToolbar.toolbarObj.refreshOverflow())},O.prototype.updateToolbarStatus=function(e){this.tbElement&&(!this.parent.inlineMode.enable||!Cr()&&j.Browser.isDevice)&&Tr({args:e,dropDownModule:this.dropDownModule,parent:this.parent,tbElements:j.selectAll("."+Yn,this.tbElement),tbItems:this.baseToolbar.toolbarObj.items},!!this.parent.inlineMode.enable,this.parent)},O.prototype.fullScreen=function(e){this.parent.fullScreenModule.showFullScreen(e)},O.prototype.hideScreen=function(e){this.parent.fullScreenModule.hideFullScreen(e)},O.prototype.getBaseToolbar=function(){return this.baseToolbar},O.prototype.addTBarItem=function(e,t){e.baseToolbar.toolbarObj.addItems([e.baseToolbar.getObject(e.updateItem,"toolbar")],t)},O.prototype.enableTBarItems=function(e,t,n,i){var o=Lr(Or(t),e.toolbarObj.items);this.tbItems=j.selectAll("."+Yn,e.toolbarObj.element);for(var r=0;r<o.length;r++){var s=this.tbItems[o[r]];s&&e.toolbarObj.enableItems(s,n)}j.select("."+Do,this.parent.element)||i||kr(e,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())},O.prototype.removeTBarItems=function(e){j.isNullOrUndefined(this.baseToolbar.toolbarObj)&&(this.baseToolbar=this.parent.getBaseToolbarObject());var t=Lr(Or(e),this.baseToolbar.toolbarObj.items);this.tbItems=this.parent.inlineMode.enable?j.selectAll("."+Yn,this.baseToolbar.toolbarObj.element):j.selectAll("."+Yn,this.parent.element);for(var n=0;n<t.length;n++)this.baseToolbar.toolbarObj.removeItems(this.tbItems[t[n]])},O.prototype.getExpandTBarPopHeight=function(){var e,t=0;return this.parent.toolbarSettings.type===m.ToolbarType.Expand&&this.tbElement.classList.contains("e-extended-toolbar")&&((e=j.select(".e-toolbar-extended",this.tbElement))&&this.tbElement.classList.contains("e-expand-open")||e&&e.classList.contains("e-popup-open")?(j.addClass([e],[ei]),t+=e.offsetHeight,j.removeClass([e],[ei])):j.removeClass([this.tbElement],[Ti])),t},O.prototype.getToolbarHeight=function(){return this.tbElement.offsetHeight},O.prototype.getToolbarElement=function(){return this.parent&&this.parent.element?j.select("."+xn,this.parent.element):null},O.prototype.refreshToolbarOverflow=function(){this.parent.element.classList.remove(Tn),this.baseToolbar.toolbarObj.refreshOverflow(),this.parent.enableRtl&&this.parent.element.classList.add(Tn)},O.prototype.isToolbarDestroyed=function(){return!!(this.baseToolbar&&this.baseToolbar.toolbarObj&&this.baseToolbar.toolbarObj.isDestroyed)},O.prototype.destroyToolbar=function(){var e,t;this.isToolbarDestroyed()||(this.parent.unWireScrollElementsEvents(),this.unWireEvents(),this.dropDownModule.destroy(),this.parent.emojiPickerModule&&!this.parent.emojiPickerModule.isPopupDestroyed&&this.parent.emojiPickerModule.childDestroy(),this.dropDownModule=null,this.colorPickerModule.destroy(),this.colorPickerModule=null,this.keyBoardModule&&(this.keyBoardModule.destroy(),this.keyBoardModule=null),this.baseToolbar.destroy(),this.removeEventListener(),j.removeClass([this.parent.element],[wo]),j.removeClass([this.parent.element],[Rn]),e=j.select("."+Jn,this.parent.element),t=j.select("."+xn,this.parent.element),j.isNullOrUndefined(e)||j.detach(e),j.isNullOrUndefined(t))||j.detach(t)},O.prototype.destroy=function(){this.isDestroyed||(this.isToolbarDestroyed()||this.destroyToolbar(),this.toolbarObj=null,this.editPanel=null,this.isToolbar=null,this.editableElement=null,this.tbItems=null,this.baseToolbar=null,this.tbElement=null,this.tbWrapper=null,this.isTransformChild=null,this.contentRenderer=null,this.dropDownModule=null,this.colorPickerModule=null,this.toolbarActionModule=null,this.tools=null,this.locator=null,this.renderFactory=null,this.isDestroyed=!0)},O.prototype.mouseDownHandler=function(){j.Browser.isDevice&&this.parent.inlineMode.enable&&!Cr()&&this.showFixedTBar()},O.prototype.focusChangeHandler=function(){j.Browser.isDevice&&this.parent.inlineMode.enable&&!Cr()&&(this.isToolbar=!1,this.hideFixedTBar())},O.prototype.dropDownBeforeOpenHandler=function(){this.isToolbar=!0},O.prototype.tbFocusHandler=function(e){var t=document.activeElement,n=j.closest(t,".e-rte-toolbar");if(t===this.parent.getToolbarElement()||n===this.parent.getToolbarElement())for(var i=this.parent.getToolbarElement().querySelectorAll(".e-expended-nav"),o=0;o<i.length;o++)j.isNullOrUndefined(this.parent.getToolbarElement().querySelector(".e-insert-table-btn"))?i[o].setAttribute("tabindex","0"):i[o].setAttribute("tabindex","1")},O.prototype.wireEvents=function(){this.parent.inlineMode.enable&&Cr()||j.EventHandler.add(this.tbElement,"focusin",this.tbFocusHandler,this)},O.prototype.unWireEvents=function(){j.EventHandler.remove(this.tbElement,"focusin",this.tbFocusHandler)},O.prototype.addEventListener=function(){this.parent.isDestroyed||(this.dropDownModule=new ed(this.parent,this.locator),this.toolbarActionModule=new td(this.parent),this.colorPickerModule=new id(this.parent,this.locator),this.parent.on(n,this.renderToolbar,this),this.parent.on($,this.toolbarBindEvent,this),this.parent.on(J,this.updateToolbarStatus,this),this.parent.on(te,this.onPropertyChanged,this),this.parent.on(Y,this.onRefresh,this),this.parent.on(o,this.destroy,this),this.parent.on(de,this.fullScreen,this),this.parent.on(ce,this.hideScreen,this),this.parent.on(xe,this.updateItem,this),this.parent.on(Ve,this.dropDownBeforeOpenHandler,this),this.parent.on(tt,this.focusChangeHandler,this),this.parent.on(Ge,this.mouseDownHandler,this),this.parent.on(Xe,this.mouseDownHandler,this),this.parent.on(on,this.setCssClass,this))},O.prototype.removeEventListener=function(){this.parent.off(n,this.renderToolbar),this.parent.off($,this.toolbarBindEvent),this.parent.off(J,this.updateToolbarStatus),this.parent.off(te,this.onPropertyChanged),this.parent.off(Y,this.onRefresh),this.parent.off(o,this.destroy),this.parent.off(de,this.parent.fullScreenModule.showFullScreen),this.parent.off(ce,this.parent.fullScreenModule.hideFullScreen),this.parent.off(xe,this.updateItem),this.parent.off(Ve,this.dropDownBeforeOpenHandler),this.parent.off(tt,this.focusChangeHandler),this.parent.off(Ge,this.mouseDownHandler),this.parent.off(Xe,this.mouseDownHandler),this.parent.off(on,this.setCssClass)},O.prototype.setCssClass=function(e){this.toolbarObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)?this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass+" "+e.cssClass).trim()}):this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},O.prototype.onRefresh=function(){this.parent.inlineMode.enable||this.refreshToolbarOverflow(),this.parent.autoResize()},O.prototype.onPropertyChanged=function(e){if(!j.isNullOrUndefined(e.newProp.inlineMode))for(var t=0,n=Object.keys(e.newProp.inlineMode);t<n.length;t++)"enable"===n[t]&&this.refreshToolbar();j.isNullOrUndefined(e.newProp.toolbarSettings)||j.isNullOrUndefined(e.newProp.toolbarSettings.enableFloating)||this.toggleFloatClass(),e.module===this.getModuleName()&&this.refreshToolbar()},O.prototype.refreshToolbar=function(){j.isNullOrUndefined(this.baseToolbar.toolbarObj)&&(this.baseToolbar=this.parent.getBaseToolbarObject());var e=j.select("."+Jn,this.parent.element);(j.select("."+xn,this.parent.element)||e)&&this.destroyToolbar(),this.parent.toolbarSettings.enable&&(this.baseToolbar&&this.baseToolbar.toolbarObj&&!this.baseToolbar.toolbarObj.isDestroyed&&this.baseToolbar.destroy(),this.baseToolbar=new $l(this.parent,this.locator),this.addEventListener(),this.renderToolbar(),this.parent.wireScrollElementsEvents(),j.select("."+Do,this.parent.element)||this.parent.inlineMode.enable||kr(this.baseToolbar,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus()),this.parent.notify(_t,{}))},O.prototype.getModuleName=function(){return"toolbar"},O.prototype.renderColorPicker=function(e){this.colorPickerModule.renderColorPickerInput(e)};var rd=O;function O(e,t){var n;this.tools={},this.parent=e,this.isDestroyed=!1,this.isToolbar=!1,this.locator=t,this.isTransformChild=!1,this.renderFactory=this.locator.getService("rendererFactory"),n=this.parent,Io.forEach(function(e,t){Io[t].text=sr(n,Ao,Io[t])}),qo.forEach(function(e,t){qo[t].text=sr(n,Ho,qo[t])}),zo.forEach(function(e,t){zo[t].text=sr(n,jo,zo[t])}),_o.forEach(function(e,t){_o[t].text=sr(n,Fo,_o[t])}),Wo.forEach(function(e,t){Wo[t].text=sr(n,Qo,Wo[t])}),Go.forEach(function(e,t){Go[t].text=sr(n,Ko,Go[t])}),Yo.forEach(function(e,t){Yo[t].text=sr(n,Xo,Yo[t])}),$o.forEach(function(e,t){$o[t].text=sr(n,Jo,$o[t])}),qr(this.parent),this.baseToolbar=new $l(this.parent,this.locator),this.addEventListener(),this.parent.toolbarSettings&&0<Object.keys(this.parent.toolbarSettings.itemConfigs).length?j.extend(this.tools,Ro,Mr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Ro}ad.prototype.appendPopupContent=function(){this.toolbarElement=this.parent.createElement("div",{className:In}),this.element.classList.contains(zn)&&this.toolbarElement.classList.add(Un),this.element.appendChild(this.toolbarElement)},ad.prototype.render=function(e){var t="Image"===e.popupType?qn:"Inline"===e.popupType?_n:"Text"===e.popupType?zn:"",n=j.getUniqueID(e.popupType+"_Quick_Popup");this.stringItems=e.toolbarItems,this.element=this.parent.createElement("div",{id:n,className:t+" "+Oi}),this.element.setAttribute("aria-owns",this.parent.getID()),this.appendPopupContent(),this.createToolbar(e.toolbarItems,e.mode,e.cssClass),this.popupRenderer.renderPopup(this),this.addEventListener()},ad.prototype.createToolbar=function(e,t,n){this.quickTBarObj=new $l(this.parent,this.locator),this.quickTBarObj.render({container:"quick",target:this.toolbarElement,items:e,mode:t,cssClass:n}),this.quickTBarObj.toolbarObj.refresh()},ad.prototype.setPosition=function(e){var t=j.closest(e.target,".e-img-caption"),n=!!e.target.classList.contains("e-imginline")&&!j.isNullOrUndefined(t)?t:e.target,t=(j.addClass([this.toolbarElement],[ni]),!j.isNullOrUndefined(n.classList)&&["e-rte-image","e-clickelem","e-rte-audio","e-rte-video"].some(function(e){return n.classList.contains(e)}));if(j.isNullOrUndefined(j.closest(n,"table"))||n.classList.contains("e-multi-cells-select")||t)i=(this.parent.iframeSettings.enable?n=n.classList.contains("e-clickelem")?n.childNodes[0]:n:n.parentElement&&n.classList.contains("e-rte-audio")||n.parentElement.classList.contains("e-video-clickelem")?n.parentElement:n).offsetTop;else for(var i=n.offsetTop,o=j.closest(n,"table");!j.isNullOrUndefined(o);)i+=o.offsetTop,o=j.closest(o.parentElement,"table");var r=window.pageYOffset+e.parentData.top,r=i-e.editTop>e.popHeight?r+e.tBarElementHeight+(i-e.editTop)-e.popHeight-5:e.editTop+e.editHeight-(i+n.offsetHeight)>e.popHeight?r+e.tBarElementHeight+(i-e.editTop)+n.offsetHeight+5:e.y;if(j.isNullOrUndefined(j.closest(n,"table"))||n.classList.contains("e-multi-cells-select")||t)s=(!this.parent.iframeSettings.enable&&(n.parentElement&&n.classList.contains("e-rte-audio")||n.parentElement.classList.contains("e-video-clickelem"))?n.parentElement:n).offsetLeft;else for(var s=n.offsetLeft,o=j.closest(n.parentElement,"th, td");!j.isNullOrUndefined(o);)s+=o.offsetLeft,o=j.closest(o.parentElement,"table");t=n.offsetWidth>e.popWidth?n.offsetWidth/2-e.popWidth/2+e.parentData.left+s:e.parentData.left+s,this.popupObj.position.X=t+e.popWidth>e.parentData.right?e.parentData.right-e.popWidth:t,this.popupObj.position.Y=0<=r?r:e.y+5,this.popupObj.dataBind(),j.removeClass([this.toolbarElement],[ni])},ad.prototype.checkCollision=function(e,t,n){for(var i,o=e.parentData.top,r=e.windowY+o+e.tBarElementHeight,s=[],s="document"===t?I.isCollide(e.popup):I.isCollide(e.popup,e.parentElement),a=0;a<s.length;a++)switch(s[a]){case"top":l="document"===t?e.windowY:window.pageYOffset+o+e.tBarElementHeight;break;case"bottom":var l="document"===t?"inline"===n||"text"===n?e.y-e.popHeight-10:e.windowHeight-(o+e.tBarElementHeight)>e.popHeight?r-e.windowHeight>e.popHeight?r+(e.windowHeight-o)-e.popHeight:r:e.windowY+(o+e.tBarElementHeight):"IMG"!==e.target.tagName?e.parentData.bottom+window.pageYOffset-e.popHeight-10:e.parentData.bottom+window.pageYOffset-e.popHeight-5;break;case"right":i="inline"===n||"text"===n?window.pageXOffset+(e.windowWidth-(e.popWidth+e.bodyRightSpace+10)):e.x-e.popWidth;break;case"left":i="inline"===n||"text"===n?0:e.parentData.left}this.popupObj.position.X=i||this.popupObj.position.X,this.popupObj.position.Y=l||this.popupObj.position.Y,this.popupObj.dataBind()},ad.prototype.showPopup=function(p,h,u,m){var g=this,e={popup:this.popupObj,cancel:!1,targetElement:u,positionX:p,positionY:h};this.parent.trigger(Ct,e,function(e){var t,n,i,o,r,s,a,l,d,c;e.cancel||(a=s=void 0,t=window.getComputedStyle(document.body),t=parseFloat(t.marginRight.split("px")[0])+parseFloat(t.paddingRight.split("px")[0]),n=window.innerHeight,i=window.innerWidth,o=g.parent.element,d=(r=!j.isNullOrUndefined(g.parent.getToolbar()))&&g.parent.toolbarModule.getToolbarHeight(),c=r&&g.parent.toolbarModule.getExpandTBarPopHeight(),r=r?d+c:0,j.addClass([g.element],[Zn]),j.Browser.isDevice&&!Cr()&&j.addClass([g.parent.getToolbar()],[Zn]),a=g.parent.iframeSettings.enable?(s=(l=g.contentRenderer.getPanel().contentWindow).pageYOffset,l.innerHeight):(s=(l=j.closest(u,"."+Xn))?l.scrollTop:0,l?l.offsetHeight:0),d=!j.isNullOrUndefined(u.classList)&&["e-rte-image","e-clickelem","e-rte-audio","e-rte-video"].some(function(e){return u.classList.contains(e)}),!g.parent.inlineMode.enable&&!j.closest(u,"table")&&"text"!==m&&"link"!==m||d?(g.parent.disableToolbarItem(g.parent.toolbarSettings.items),g.parent.enableToolbarItem(["Undo","Redo"])):g.parent.enableToolbarItem(g.parent.toolbarSettings.items),j.append([g.element],document.body),g.parent.showTooltip&&(g.tooltip=new I.Tooltip({target:"#"+g.element.id+" [title]",openDelay:400,showTipPointer:!0,beforeRender:g.tooltipBeforeRender.bind(g),windowCollision:!0,position:"BottomCenter",cssClass:g.parent.getCssClass()}),g.tooltip.appendTo(g.element)),g.popupObj.position.X=e.positionX+20,g.popupObj.position.Y=e.positionY+20,g.popupObj.dataBind(),g.popupObj.element.classList.add("e-popup-open"),g.dropDownButtons.renderDropDowns({container:g.toolbarElement,containerType:"quick",items:g.stringItems}),g.colorPickerObj.renderColorPickerInput({container:g.toolbarElement,containerType:"quick",items:g.stringItems}),c={x:p,y:h,target:u,editTop:s,editHeight:a,popup:g.popupObj.element,popHeight:g.popupObj.element.offsetHeight,popWidth:g.popupObj.element.offsetWidth,parentElement:o,bodyRightSpace:t,windowY:window.pageYOffset,windowHeight:n,windowWidth:i,parentData:o.getBoundingClientRect(),tBarElementHeight:r},!(j.closest(u,"TABLE")||"IMG"===u.tagName||"AUDIO"===u.tagName||"VIDEO"===u.tagName||"IFRAME"===u.tagName||u.classList&&(u.classList.contains(ci)||u.classList.contains(li)||u.classList.contains(di)))||p!==e.positionX&&h!==e.positionY||g.setPosition(c),g.parent.inlineMode.enable||g.checkCollision(c,"parent",""),g.checkCollision(c,"document",g.parent.inlineMode.enable?"inline":"text"===m?"text":""),g.popupObj.element.classList.remove("e-popup-open"),j.removeClass([g.element],[Zn]),g.popupObj.show({name:"ZoomIn",duration:j.Browser.isIE?250:400},u),g.popupObj&&g.parent.cssClass&&(j.removeClass([g.popupObj.element],g.parent.cssClass.replace(/\s+/g," ").trim().split(" ")),j.addClass([g.popupObj.element],g.parent.cssClass.replace(/\s+/g," ").trim().split(" "))),j.setStyleAttribute(g.element,{maxWidth:window.outerWidth+"px"}),j.addClass([g.element],[Pn]),g.isRendered=!0)})},ad.prototype.tooltipBeforeRender=function(e){e.target.querySelector(".e-active")&&(e.cancel=!0,j.isNullOrUndefined(e.target.getAttribute("title"))||this.parent.notify(gn,{target:e.target,isTitle:!0}))},ad.prototype.hidePopup=function(){var e,t,n=!j.isNullOrUndefined(this.parent.rootContainer)&&this.parent.rootContainer.classList.contains("e-source-code-enabled");j.Browser.isDevice&&!Cr()&&j.removeClass([this.parent.getToolbar()],[Zn]),j.isNullOrUndefined(this.element.querySelectorAll("[data-title]"))||this.element.querySelectorAll("[data-title]").forEach(function(e){var t=new MouseEvent("mouseout",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}),j.isNullOrUndefined(document.querySelector(".e-tooltip-wrap"))?j.isNullOrUndefined(this.tooltip)||this.tooltip.destroy():(j.isNullOrUndefined(document.querySelector("#"+this.element.id+" [data-tooltip-id]"))||(t=(e=document.querySelector("#"+this.element.id+" [data-tooltip-id]")).getAttribute("data-content"),e.removeAttribute("data-content"),e.setAttribute("title",t),e.removeAttribute("data-tooltip-id")),this.tooltip.destroy()),j.isNullOrUndefined(this.parent.getToolbar())||this.parent.inlineMode.enable||n||this.parent.enableToolbarItem(this.parent.toolbarSettings.items),this.removeEleFromDOM(),this.isRendered=!1},ad.prototype.addQTBarItem=function(e,t){this.quickTBarObj.toolbarObj.addItems(this.quickTBarObj.getItems(e,"toolbar"),t)},ad.prototype.removeQTBarItem=function(e){this.quickTBarObj.toolbarObj.removeItems(e)},ad.prototype.removeEleFromDOM=function(){var e=this.popupObj.element;this.isRendered&&(this.dropDownButtons.destroyDropDowns(),this.colorPickerObj.destroyColorPicker(),j.removeClass([this.element],[Pn]),j.detach(e),e=this.popupObj,this.parent.trigger(Et,e))},ad.prototype.updateStatus=function(e){Tr({args:e,dropDownModule:this.dropDownButtons,parent:this.parent,tbElements:j.selectAll("."+Yn,this.element),tbItems:this.quickTBarObj.toolbarObj.items},!0,this.parent),this.parent.quickToolbarSettings.text&&this.parent.quickToolbarModule.textQTBar&&(Tr({args:e,dropDownModule:this.parent.quickToolbarModule.textQTBar.dropDownButtons,parent:this.parent,tbElements:j.selectAll("."+Yn,this.parent.quickToolbarModule.textQTBar.element),tbItems:this.parent.quickToolbarModule.textQTBar.quickTBarObj.toolbarObj.items},!0,this.parent),kr(this.parent.quickToolbarModule.textQTBar.quickTBarObj,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())),j.select("."+Do,this.parent.element)||kr(this.parent.getBaseToolbarObject(),this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())},ad.prototype.destroy=function(){this.isDestroyed||(this.tooltip&&!this.tooltip.isDestroyed&&(this.tooltip.destroy(),this.tooltip=null),this.removeEventListener(),this.quickTBarObj.destroy(),this.quickTBarObj=null,this.popupObj&&!this.popupObj.isDestroyed&&(this.removeEleFromDOM(),this.popupObj.destroy()),this.colorPickerObj=null,this.dropDownButtons=null,this.stringItems=null,this.dropDownButtons=null,this.colorPickerObj=null,this.toolbarElement=null,this.isDestroyed=!0)},ad.prototype.addEventListener=function(){!this.parent.isDestroyed&&(this.parent.on(o,this.destroy,this),this.parent.on(te,this.onPropertyChanged,this),this.parent.inlineMode.enable||this.parent.quickToolbarSettings.text)&&this.parent.on(J,this.updateStatus,this)},ad.prototype.onPropertyChanged=function(e){if(!j.isNullOrUndefined(e.newProp.inlineMode))for(var t=0,n=Object.keys(e.newProp.inlineMode);t<n.length;t++)"enable"===n[t]&&(e.newProp.inlineMode.enable?this.parent.on(J,this.updateStatus,this):this.parent.off(J,this.updateStatus))},ad.prototype.removeEventListener=function(){this.parent.off(o,this.destroy),this.parent.off(te,this.onPropertyChanged),(this.parent.inlineMode.enable||this.parent.quickToolbarSettings.text)&&this.parent.off(J,this.updateStatus)};var sd=ad;function ad(e,t){this.parent=e,this.locator=t,this.isRendered=!1,this.isDestroyed=!1,this.renderFactory=this.locator.getService("rendererFactory"),this.contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content),this.popupRenderer=this.renderFactory.getRenderer(m.RenderType.Popup),this.dropDownButtons=new ed(this.parent,this.locator),this.colorPickerObj=new id(this.parent,this.locator)}L.prototype.formatItems=function(e){var t=[];return e.forEach(function(e){if("string"==typeof e)switch(e.toLocaleLowerCase()){case"open":t.push("openLink");break;case"edit":t.push("editLink");break;case"unlink":t.push("removeLink");break;default:t.push(e)}else t.push(e)}),t},L.prototype.getQTBarOptions=function(e,t,n,i){return{popupType:e,toolbarItems:n,mode:t,renderType:i,cssClass:this.parent.getCssClass()}},L.prototype.createQTBar=function(e,t,n,i){var o;return n.length<1?null:((o=new sd(this.parent,this.locator)).render(this.getQTBarOptions(e,t,this.formatItems(n),i)),o)},L.prototype.initializeQuickToolbars=function(){(this.parent.quickToolbarModule=this).contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content),this.parent.inlineMode.enable&&this.parent.inlineMode.onSelection&&Cr()&&j.EventHandler.add(this.contentRenderer.getDocument(),"selectionchange",this.selectionChangeHandler,this)},L.prototype.onMouseDown=function(e){this.parent.isBlur=!1,this.parent.isRTE=!0},L.prototype.keyUpQT=function(e){27===e.which&&this.hideQuickToolbars()},L.prototype.renderQuickToolbars=function(){this.linkQTBar||this.imageQTBar||this.audioQTBar||this.videoQTBar||this.textQTBar||this.tableQTBar||(this.linkQTBar=this.createQTBar("Link","Scrollable",this.parent.quickToolbarSettings.link,m.RenderType.LinkToolbar),this.renderFactory.addRenderer(m.RenderType.LinkToolbar,this.linkQTBar),j.isNullOrUndefined(this.parent.quickToolbarSettings.text)||this.parent.inlineMode.enable||(this.textQTBar=this.createQTBar("Text","MultiRow",this.parent.quickToolbarSettings.text,m.RenderType.TextToolbar),this.renderFactory.addRenderer(m.RenderType.TextToolbar,this.textQTBar)),this.imageQTBar=this.createQTBar("Image","MultiRow",this.parent.quickToolbarSettings.image,m.RenderType.ImageToolbar),this.renderFactory.addRenderer(m.RenderType.ImageToolbar,this.imageQTBar),this.audioQTBar=this.createQTBar("Audio","MultiRow",this.parent.quickToolbarSettings.audio,m.RenderType.AudioToolbar),this.renderFactory.addRenderer(m.RenderType.AudioToolbar,this.audioQTBar),this.videoQTBar=this.createQTBar("Video","MultiRow",this.parent.quickToolbarSettings.video,m.RenderType.VideoToolbar),this.renderFactory.addRenderer(m.RenderType.VideoToolbar,this.videoQTBar),this.tableQTBar=this.createQTBar("Table","MultiRow",this.parent.quickToolbarSettings.table,m.RenderType.TableToolbar),this.renderFactory.addRenderer(m.RenderType.TableToolbar,this.tableQTBar),this.linkQTBar&&(j.EventHandler.add(this.linkQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.linkQTBar.element,"keyup",this.keyUpQT,this)),this.imageQTBar&&(j.EventHandler.add(this.imageQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.imageQTBar.element,"keyup",this.keyUpQT,this)),this.audioQTBar&&(j.EventHandler.add(this.audioQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.audioQTBar.element,"keyup",this.keyUpQT,this)),this.videoQTBar&&(j.EventHandler.add(this.videoQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.videoQTBar.element,"keyup",this.keyUpQT,this)),this.textQTBar&&(j.EventHandler.add(this.textQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.textQTBar.element,"keyup",this.keyUpQT,this)),this.tableQTBar&&(j.EventHandler.add(this.tableQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.tableQTBar.element,"keyup",this.keyUpQT,this)))},L.prototype.renderInlineQuickToolbar=function(){!this.parent.inlineMode.enable||j.Browser.isDevice&&!Cr()||(j.addClass([this.parent.element],[Bn]),this.inlineQTBar=this.createQTBar("Inline","MultiRow",this.parent.toolbarSettings.items,m.RenderType.InlineToolbar),this.renderFactory.addRenderer(m.RenderType.InlineToolbar,this.inlineQTBar),j.EventHandler.add(this.inlineQTBar.element,"mousedown",this.onMouseDown,this),j.EventHandler.add(this.inlineQTBar.element,"keyup",this.keyUpQT,this))},L.prototype.showInlineQTBar=function(e,t,n){j.isNullOrUndefined(this.parent)||this.parent.readonly||"img"===n.tagName.toLowerCase()||this.inlineQTBar.element.querySelector(".e-rte-color-content")||this.inlineQTBar.showPopup(e,t,n)},L.prototype.hideInlineQTBar=function(){this.inlineQTBar&&!p(this.inlineQTBar.element,"e-popup-close")&&this.inlineQTBar.hidePopup(),this.escapeKeyPressed=!1},L.prototype.hideQuickToolbars=function(){this.linkQTBar&&!p(this.linkQTBar.element,"e-popup-close")&&document.body.contains(this.linkQTBar.element)&&this.linkQTBar.hidePopup(),this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&document.body.contains(this.textQTBar.element)&&this.textQTBar.hidePopup(),this.imageQTBar&&!p(this.imageQTBar.element,"e-popup-close")&&document.body.contains(this.imageQTBar.element)&&this.imageQTBar.hidePopup(),this.audioQTBar&&!p(this.audioQTBar.element,"e-popup-close")&&document.body.contains(this.audioQTBar.element)&&this.audioQTBar.hidePopup(),this.videoQTBar&&!p(this.videoQTBar.element,"e-popup-close")&&document.body.contains(this.videoQTBar.element)&&this.videoQTBar.hidePopup(),this.tableQTBar&&!p(this.tableQTBar.element,"e-popup-close")&&document.body.contains(this.tableQTBar.element)&&this.tableQTBar.hidePopup(),j.isNullOrUndefined(this.parent)||!this.parent.inlineMode.enable||j.Browser.isDevice&&!Cr()||this.hideInlineQTBar()},L.prototype.deBounce=function(e,t,n){var i=this;clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout(function(){i.showInlineQTBar(e,t,n)},this.debounceTimeout)},L.prototype.mouseUpHandler=function(e){if(this.parent.inlineMode.enable&&(!j.Browser.isDevice||Cr())){var t=e.args.touches?e.args.changedTouches[0]:e.args,n=this.parent.getRange(),i=e.args.target;if(j.isNullOrUndefined(j.select("."+_n,document.body))){if(Cr()&&e.touchData&&e.touchData.prevClientX!==e.touchData.clientX&&e.touchData.prevClientY!==e.touchData.clientY)return;this.hideInlineQTBar();var o=this.parent.element.getBoundingClientRect().left;if(this.offsetX=this.parent.iframeSettings.enable?window.pageXOffset+o+t.clientX:t.pageX,this.offsetY=Er(t,this.parent.element,this.parent.iframeSettings.enable),"TEXTAREA"===i.nodeName)this.showInlineQTBar(this.offsetX,this.offsetY,i);else{var r=j.closest(i,"a"),r=(i=r||i,this.parent.getRange().startContainer.parentElement),s=this.parent.getRange().endContainer.parentElement;if((j.isNullOrUndefined(j.closest(r,"A"))||j.isNullOrUndefined(j.closest(s,"A")))&&(!j.closest(i,"td,th")||!n.collapsed)&&("IMG"!==i.tagName||this.parent.getRange().startOffset!==this.parent.getRange().endOffset)){r=n.startOffset===n.endOffset&&n.startContainer===n.endContainer;if(this.parent.inlineMode.onSelection&&r||!this.parent.inlineMode.onSelection&&!r)return;this.target=i,this.showInlineQTBar(this.offsetX,this.offsetY,i)}}}}j.isNullOrUndefined(this.textQTBar)||j.isNullOrUndefined(this.parent.quickToolbarSettings.text)||this.parent.inlineMode.enable||(j.isNullOrUndefined(e)||j.isNullOrUndefined(e.name)||"sourceCodeMouseDown"!==e.name)&&(t=e.args.touches?e.args.changedTouches[0]:e.args,i=e.args.target,this.hideQuickToolbars(),o=this.parent.element.getBoundingClientRect().left,this.offsetX=this.parent.iframeSettings.enable?this.parent.element.ownerDocument.documentElement.scrollLeft+o+t.clientX:t.pageX,this.offsetY=Er(t,this.parent.element,this.parent.iframeSettings.enable),(n=this.parent.getRange()).endContainer.parentElement.tagName===n.startContainer.parentElement.tagName&&"A"===n.startContainer.parentElement.tagName&&"A"===n.endContainer.parentElement.tagName||"IMG"===i.tagName||"VIDEO"===i.tagName||this.isEmbedVidElem(i)||"AUDIO"===i.tagName||i.childNodes[0]&&1===i.childNodes[0].nodeType&&i.childNodes[0].classList.contains("e-rte-audio")||this.parent.getRange().startOffset===this.parent.getRange().endOffset||(this.target=i,this.textQTBar.showPopup(this.offsetX,this.offsetY,i,"text")))},L.prototype.isEmbedVidElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&e.classList.contains(di)||e&&"IFRAME"===e.nodeName)},L.prototype.keyDownHandler=function(e){var t=e.args.altKey;this.parent.inlineMode.enable&&e.args.metaKey&&65===e.args.keyCode?this.showInlineQTBar(this.offsetX,this.offsetY,e.args.target):t||(!this.parent.inlineMode.enable||j.Browser.isDevice&&!Cr()||j.isNullOrUndefined(j.select("."+_n,document))||this.hideInlineQTBar(),this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&this.textQTBar.hidePopup())},L.prototype.inlineQTBarMouseDownHandler=function(){!this.parent.inlineMode.enable||j.Browser.isDevice&&!Cr()||j.isNullOrUndefined(j.select("."+_n,document))||this.hideInlineQTBar(),j.isNullOrUndefined(this.parent.quickToolbarSettings.text)||this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&document.body.contains(this.textQTBar.element)&&this.textQTBar.hidePopup()},L.prototype.keyUpHandler=function(e){e=e.args;if(this.parent.inlineMode.enable&&!j.Browser.isDevice){if(this.parent.inlineMode.onSelection)return void(0<this.parent.getSelection().length&&(e.ctrlKey&&65===e.keyCode||e.shiftKey&&(33===e.keyCode||34===e.keyCode||35===e.keyCode||36===e.keyCode||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode))&&this.showInlineQTBar(this.offsetX,this.offsetY,e.target));this.deBounce(this.offsetX,this.offsetY,e.target)}this.parent.quickToolbarSettings.text&&!j.Browser.isDevice&&(e.ctrlKey&&65===e.keyCode||e.shiftKey&&(33===e.keyCode||34===e.keyCode||35===e.keyCode||36===e.keyCode||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode))&&this.textQTBar.showPopup(this.offsetX,this.offsetY,e.target,"text")},L.prototype.selectionChangeHandler=function(e){var t=this;clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout(function(){t.onSelectionChange(e)},this.debounceTimeout)},L.prototype.onSelectionChange=function(e){j.isNullOrUndefined(j.select("."+_n,document.body))&&!this.contentRenderer.getDocument().getSelection().isCollapsed&&this.mouseUpHandler({args:e})},L.prototype.getInlineBaseToolbar=function(){return this.inlineQTBar&&this.inlineQTBar.quickTBarObj},L.prototype.destroy=function(){this.isDestroyed||(this.linkQTBar&&!this.linkQTBar.isDestroyed&&(j.EventHandler.remove(this.linkQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.linkQTBar.element,"keyup",this.keyUpQT),this.linkQTBar.destroy()),this.textQTBar&&!this.textQTBar.isDestroyed&&(j.EventHandler.remove(this.textQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.textQTBar.element,"keyup",this.keyUpQT),this.textQTBar.destroy()),this.imageQTBar&&!this.imageQTBar.isDestroyed&&(j.EventHandler.remove(this.imageQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.imageQTBar.element,"keyup",this.keyUpQT),this.imageQTBar.destroy()),this.audioQTBar&&!this.audioQTBar.isDestroyed&&(j.EventHandler.remove(this.audioQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.audioQTBar.element,"keyup",this.keyUpQT),this.audioQTBar.destroy()),this.videoQTBar&&!this.videoQTBar.isDestroyed&&(j.EventHandler.remove(this.videoQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.videoQTBar.element,"keyup",this.keyUpQT),this.videoQTBar.destroy()),this.tableQTBar&&!this.tableQTBar.isDestroyed&&(j.EventHandler.remove(this.tableQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.tableQTBar.element,"keyup",this.keyUpQT),this.tableQTBar.destroy()),this.inlineQTBar&&!this.inlineQTBar.isDestroyed&&(j.EventHandler.remove(this.inlineQTBar.element,"mousedown",this.onMouseDown),j.EventHandler.remove(this.inlineQTBar.element,"keyup",this.keyUpQT),Cr()&&j.EventHandler.remove(document,"selectionchange",this.selectionChangeHandler),this.inlineQTBar.destroy()),this.removeEventListener(),this.isDestroyed=!0)},L.prototype.wireInlineQTBarEvents=function(){this.parent.on(se,this.mouseUpHandler,this),this.parent.on(Ge,this.inlineQTBarMouseDownHandler,this),this.parent.on(h,this.keyDownHandler,this),this.parent.on(ie,this.keyUpHandler,this),this.parent.on(Xe,this.mouseUpHandler,this),this.parent.on(rt,this.renderInlineQuickToolbar,this)},L.prototype.unWireInlineQTBarEvents=function(){this.parent.off(se,this.mouseUpHandler),this.parent.off(Ge,this.inlineQTBarMouseDownHandler),this.parent.off(h,this.keyDownHandler),this.parent.off(ie,this.keyUpHandler),this.parent.off(Xe,this.mouseUpHandler),this.parent.off(rt,this.renderInlineQuickToolbar)},L.prototype.toolbarUpdated=function(e){this.linkQTBar&&!p(this.linkQTBar.element,"e-popup-close")&&this.linkQTBar.hidePopup(),this.escapeKeyPressed||!this.imageQTBar||p(this.imageQTBar.element,"e-popup-close")||this.imageQTBar.hidePopup(),this.escapeKeyPressed||!this.audioQTBar||p(this.audioQTBar.element,"e-popup-close")||this.audioQTBar.hidePopup(),this.escapeKeyPressed||!this.videoQTBar||p(this.videoQTBar.element,"e-popup-close")||this.videoQTBar.hidePopup(),this.escapeKeyPressed||!this.tableQTBar||p(this.tableQTBar.element,"e-popup-close")||this.tableQTBar.hidePopup(),this.escapeKeyPressed=!1},L.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(n,this.initializeQuickToolbars,this),this.parent.on(Ge,this.renderQuickToolbars,this),this.parent.on(J,this.toolbarUpdated,this),this.parent.on(It,this.renderQuickToolbars,this),this.wireInlineQTBarEvents(),this.parent.on(te,this.onPropertyChanged,this),"hide"===this.parent.quickToolbarSettings.actionOnScroll&&(this.parent.on(Je,this.hideQuickToolbars,this),this.parent.on($e,this.hideQuickToolbars,this)),this.parent.on(tt,this.hideQuickToolbars,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(o,this.destroy,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(at,this.setRtl,this),this.parent.on(on,this.setCssClass,this),this.parent.on(dn,this.hideQuickToolbars,this),this.parent.on(Ut,this.renderQuickToolbars,this),this.parent.on(En,this.preventQuickToolbarClose,this))},L.prototype.preventQuickToolbarClose=function(e){var t=this.parent.getID(),t=[t+"_quick_Display-popup",t+"_quick_Align-popup",t+"_quick_VideoLayoutOption-popup",t+"_quick_VideoAlign-popup",t+"_quick_TableRows-popup",t+"_quick_TableColumns-popup",t+"_quick_TableCell-popup",t+"_quick_TableCellVerticalAlign-popup",t+"_quick_Styles-popup",t+"_quick_Alignments-popup",t+"_quick_BackgroundColor-popup",t+"_quick_AudioLayoutOption-popup"];!j.isNullOrUndefined(e.element)&&!j.isNullOrUndefined(e.element.parentElement)&&-1<t.indexOf(e.element.parentElement.id)&&(this.escapeKeyPressed=!0)},L.prototype.onKeyDown=function(e){e=e.args;8!==e.which&&46!==e.which||(this.imageQTBar&&!p(this.imageQTBar.element,"e-popup-close")&&this.imageQTBar.hidePopup(),this.audioQTBar&&!p(this.audioQTBar.element,"e-popup-close")&&this.audioQTBar.hidePopup(),this.videoQTBar&&!p(this.videoQTBar.element,"e-popup-close")&&this.videoQTBar.hidePopup(),this.tableQTBar&&!p(this.tableQTBar.element,"e-popup-close")&&this.tableQTBar.hidePopup(),this.linkQTBar&&!p(this.linkQTBar.element,"e-popup-close")&&this.linkQTBar.hidePopup(),this.textQTBar&&!p(this.textQTBar.element,"e-popup-close")&&this.textQTBar.hidePopup())},L.prototype.onIframeMouseDown=function(){this.hideQuickToolbars(),this.hideInlineQTBar()},L.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass&&e.quickTBarObj.toolbarObj.cssClass!==t.cssClass)?e.quickTBarObj.toolbarObj.setProperties({cssClass:(e.quickTBarObj.toolbarObj.cssClass+" "+t.cssClass).trim()}):e.quickTBarObj.toolbarObj.setProperties({cssClass:(e.quickTBarObj.toolbarObj.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},L.prototype.setCssClass=function(e){for(var t=[this.inlineQTBar,this.imageQTBar,this.linkQTBar,this.textQTBar,this.tableQTBar],n=0;n<t.length;n++)this.updateCss(t[n],e)},L.prototype.setRtl=function(e){this.inlineQTBar&&this.inlineQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.imageQTBar&&this.imageQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.audioQTBar&&this.audioQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.videoQTBar&&this.videoQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.linkQTBar&&this.linkQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.textQTBar&&this.textQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl})},L.prototype.removeEventListener=function(){this.deBouncer&&(clearTimeout(this.deBouncer),this.deBouncer=null),this.parent.off(n,this.initializeQuickToolbars),this.parent.off(Ge,this.renderQuickToolbars),this.parent.off(J,this.toolbarUpdated),this.parent.off(It,this.renderQuickToolbars),this.unWireInlineQTBarEvents(),this.parent.off(te,this.onPropertyChanged),"hide"===this.parent.quickToolbarSettings.actionOnScroll&&(this.parent.off(Je,this.hideQuickToolbars),this.parent.off($e,this.hideQuickToolbars)),this.parent.off(tt,this.hideQuickToolbars),this.parent.off(o,this.destroy),this.parent.off(K,this.onIframeMouseDown),this.parent.off(h,this.onKeyDown),this.parent.off(at,this.setRtl),this.parent.off(on,this.setCssClass),this.parent.off(dn,this.hideQuickToolbars),this.parent.off(Ut,this.renderQuickToolbars),this.parent.off(En,this.preventQuickToolbarClose)},L.prototype.onPropertyChanged=function(e){if(!j.isNullOrUndefined(e.newProp.quickToolbarSettings))for(var t=0,n=Object.keys(e.newProp.quickToolbarSettings);t<n.length;t++)"actionOnScroll"===n[t]&&("none"===e.newProp.quickToolbarSettings.actionOnScroll?(this.parent.off(Je,this.hideQuickToolbars),this.parent.off($e,this.hideQuickToolbars)):(this.parent.on(Je,this.hideQuickToolbars,this),this.parent.on($e,this.hideQuickToolbars,this)));e.module!==this.getModuleName()||(this.inlineQTBar&&(j.removeClass([this.parent.element],[Bn]),this.unWireInlineQTBarEvents(),this.hideInlineQTBar()),!this.parent.inlineMode.enable)||j.Browser.isDevice&&!Cr()||(j.addClass([this.parent.element],[Bn]),this.wireInlineQTBarEvents())},L.prototype.getModuleName=function(){return"quickToolbar"},L.prototype.getQuickToolbarInstance=function(){return[this.linkQTBar,this.imageQTBar,this.audioQTBar,this.videoQTBar,this.tableQTBar,this.textQTBar,this.inlineQTBar]};var ld=L;function L(e,t){this.debounceTimeout=1e3,this.escapeKeyPressed=!1,this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.renderFactory.addRenderer(m.RenderType.Popup,new _l(this.parent)),this.addEventListener(),this.isDestroyed=!1}cd.prototype.initializeInstance=function(){this.contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content),this.editPanel=this.contentRenderer.getEditPanel(),this.addEventListener()},cd.prototype.renderCount=function(){this.initializeInstance(),this.element=this.parent.createElement("span",{className:yi}),this.parent.rootContainer.appendChild(this.element),this.parent.rootContainer.classList.add("e-count-enabled"),this.parent.iframeSettings.enable&&this.parent.inputElement.classList.add("e-count-enabled"),this.appendCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength)},cd.prototype.appendCount=function(){var e="Markdown"===this.parent.editorMode?this.editPanel.value:this.parent.getText().replace(/(\r\n|\n|\r|\t)/gm,""),e=("Markdown"!==this.parent.editorMode&&-1!==e.indexOf("")?this.htmlLength=e.replace(/\u200B/g,"").length:this.htmlLength=e.length,-1===this.parent.maxLength?this.htmlLength:this.htmlLength+" / "+this.parent.maxLength);this.element.innerHTML=e},cd.prototype.charCountBackground=function(e){e=e/this.parent.maxLength*100;e<85?(this.element.classList.remove(Ci),this.element.classList.remove(Ni)):85<e&&e<=90?(this.element.classList.remove(Ni),this.element.classList.add(Ci)):90<e&&(this.element.classList.remove(Ci),this.element.classList.add(Ni))},cd.prototype.refresh=function(){j.isNullOrUndefined(this.editPanel)||(this.appendCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength))},cd.prototype.destroy=function(){this.isDestroyed||(this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-count-enabled")&&this.parent.rootContainer.classList.remove("e-count-enabled"),this.parent.iframeSettings.enable&&!j.isNullOrUndefined(this.parent.inputElement)&&this.parent.inputElement.classList.remove("e-count-enabled"),this.element&&!j.isNullOrUndefined(this.parent.element.querySelector("."+yi))&&j.detach(this.element),this.removeEventListener(),this.editPanel&&(this.editPanel=null),this.element&&(j.detach(this.element),this.element=null),this.isDestroyed=!0)},cd.prototype.toggle=function(e){this.element.style.display="viewSource"===e.member?"none":"block"},cd.prototype.addEventListener=function(){this.parent.on(n,this.renderCount,this),this.parent.on(ie,this.refresh,this),this.parent.on(Ke,this.refresh,this),this.parent.on(Y,this.refresh,this),this.parent.on(Ge,this.refresh,this),this.parent.on(o,this.destroy,this),this.parent.on(ze,this.toggle,this),this.parent.on(_e,this.toggle,this)},cd.prototype.removeEventListener=function(){this.parent.off(n,this.renderCount),this.parent.off(ie,this.refresh),this.parent.off(Y,this.refresh),this.parent.off(Ke,this.refresh),this.parent.off(Ge,this.refresh),this.parent.off(o,this.destroy),this.parent.off(ze,this.toggle),this.parent.off(_e,this.toggle)},cd.prototype.getModuleName=function(){return"count"};var dd=cd;function cd(e,t){this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1}hd.prototype.getLineNumber=function(e,t){return e.value.substr(0,t).split("\n").length},hd.prototype.getSelectedText=function(e){var t=e.selectionStart,n=e.selectionEnd;return e.value.substring(t,n)},hd.prototype.getAllParents=function(e){return e.split("\n")},hd.prototype.getSelectedLine=function(e){return this.getAllParents(e.value)[this.getLineNumber(e,e.selectionStart)-1]},hd.prototype.getLine=function(e,t){return this.getAllParents(e.value)[t]},hd.prototype.getSelectedParentPoints=function(e){var t=this.getAllParents(e.value),n=this.getLineNumber(e,e.selectionStart),i=this.getLineNumber(e,e.selectionEnd),o=this.getSelectedText(e).split("\n"),r=[],e=t[n-1],s=t.slice(0,n-1).join("").length,a={};if(a.line=n-1,a.start=s+a.line,a.end=""!==e?a.start+e.length+1:a.start+e.length,a.text=e,r.push(a),1<o.length){for(var l=1;l<o.length-1;l++){var d={};d.line=r[l-1].line+1,d.start=(o[l],r[l-1].end),d.end=d.start+o[l].length+1,d.text=o[l],r.push(d)}n={};n.line=r[r.length-1].line+1,n.start=r[r.length-1].end,n.end=n.start+t[i-1].length+1,n.text=t[i-1],r.push(n)}return r},hd.prototype.setSelection=function(e,t,n){e.setSelectionRange(t,n),e.focus()},hd.prototype.save=function(e,t){this.selectionStart=e,this.selectionEnd=t},hd.prototype.restore=function(e){this.setSelection(e,this.selectionStart,this.selectionEnd)},hd.prototype.isStartWith=function(e,t){var n=!1,i=RegExp;return n=e?(e.trim()===t.trim()?new i("^("+this.replaceSpecialChar(t.trim())+")","gim"):new i("^("+this.replaceSpecialChar(t)+")","gim")).test(e.trim()):n},hd.prototype.replaceSpecialChar=function(e){return e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"\\$&")},hd.prototype.isClear=function(e,t){for(var n=RegExp,i=0;i<e.length;i++)if(new n(t,"gim").test(e[i].text))return!0;return!1},hd.prototype.getSelectedInlinePoints=function(e){return{start:e.selectionStart,end:e.selectionEnd,text:this.getSelectedText(e)}};var pd=hd;function hd(){}md.prototype.addEventListener=function(){this.parent.on(X,this.onRefreshHandler,this),this.parent.on(o,this.removeEventListener,this)},md.prototype.removeEventListener=function(){this.parent.off(X,this.onRefreshHandler),this.parent.off(o,this.removeEventListener)},md.prototype.onRefreshHandler=function(e){var t=this.selection.getSelectedParentPoints(this.element),t=(this.toolbarStatus={orderedlist:!e.documentNode&&this.isListsApplied(t,"OL"),unorderedlist:!e.documentNode&&this.isListsApplied(t,"UL"),formats:this.currentFormat(t,e.documentNode),bold:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Bold"),italic:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Italic"),inlinecode:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode"),strikethrough:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("StrikeThrough"),subscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SubScript"),superscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SuperScript"),uppercase:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("UpperCase")},this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode")&&(this.toolbarStatus.formats="pre"),JSON.stringify(this.toolbarStatus));this.parent.notify(J,this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==t&&(this.parent.notify(Wt,{html:null,markdown:JSON.parse(t)}),this.prevToolbarStatus=JSON.parse(t))},md.prototype.isListsApplied=function(e,t){var n=!0;if("OL"===t)for(var i=0;i<e.length;i++){var o=e[i].text.trim().split(" ",2)[0]+" ";if(!/^[\d.]+[ ]+$/.test(o)){n=!1;break}}else for(i=0;i<e.length;i++)if(!this.selection.isStartWith(e[i].text,this.parent.formatter.listTags[""+t])){n=!1;break}return n},md.prototype.currentFormat=function(e,t){for(var n="p",i=Object.keys(this.parent.formatter.formatTags),o=("backward"===this.element.selectionDirection?e[0]:e[e.length-1]).text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(o,this.parent.formatter.formatTags[i[r]])){n=i[r];break}if("pre"===i[r]&&this.codeFormat()){n=i[r];break}}return n},md.prototype.codeFormat=function(){var t,e=!1,n=this.parent.inputElement,i=n.selectionStart,i=(t=i,function(e){return[e.slice(0,t),e.slice(t)]}(n.value)),o=this.parent.formatter.formatTags.pre,r=this.getSelectedText(n);if(""!==r&&r===r.toLocaleUpperCase())return!0;if(""===r){r=n.value.substr(i[0].length-1,1),n=i[1].substr(0,1);if(""!==r&&""!==n&&r.match(/[a-z]/i)&&r===r.toLocaleUpperCase()&&n===n.toLocaleUpperCase())return!0}return e=this.isCode(i[0],o)&&this.isCode(i[1],o)&&i[0].match(this.multiCharRegx(o)).length%2==1&&i[1].match(this.multiCharRegx(o)).length%2==1?!0:e},md.prototype.getSelectedText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},md.prototype.isCode=function(e,t){return-1!==e.search("\\"+t)},md.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+")","g")};var ud=md;function md(e){this.toolbarStatus=this.prevToolbarStatus={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,uppercase:!1,lowercase:!1,inlinecode:!1,unorderedlist:!1,formats:null},this.selection=new pd,this.parent=e,this.element=this.parent.contentModule.getEditPanel(),this.addEventListener()}fd.prototype.addEventListener=function(){this.parent.on(ue,this.commandCallBack,this),this.parent.on(o,this.removeEventListener,this)},fd.prototype.commandCallBack=function(e){var t=!j.isNullOrUndefined(e.requestType)&&"FormatPainter"===e.requestType&&"format-copy"===e.action;j.isNullOrUndefined(e)||j.isNullOrUndefined(e.requestType)||"Undo"===e.requestType||"Redo"===e.requestType||t||this.parent.formatter.saveData(),this.parent.notify(X,{args:e}),this.parent.notify(Ke,{})},fd.prototype.removeEventListener=function(){this.parent.off(ue,this.commandCallBack),this.parent.off(o,this.removeEventListener)};var gd=fd;function fd(e){this.parent=e,this.addEventListener()}vd.prototype.process=function(i,o,r,s){var a,t,l=this,e=i.contentModule.getDocument().getSelection(),e=0<e.rangeCount?e.getRangeAt(e.rangeCount-1):null,d=(j.isNullOrUndefined(s)||j.isNullOrUndefined(s.selection)||(n=s.selection.range),!j.isNullOrUndefined(s)&&!j.isNullOrUndefined(s.cssClass)&&"e-video-inline"!==s.cssClass);if("HTML"!==i.editorMode||j.isNullOrUndefined(o)||d||(j.isNullOrUndefined(o.name)||!j.isNullOrUndefined(o.name)&&"showDialog"!==o.name)&&(a=n?this.editorManager.nodeSelection.save(n,i.contentModule.getDocument()):this.editorManager.nodeSelection.save(e,i.contentModule.getDocument())),j.isNullOrUndefined(o)||!o.item.command||"Table"===o.item.command||"Actions"===o.item.command||"Links"===o.item.command||"Images"===o.item.command||"Files"===o.item.command||"Audios"===o.item.command||"Videos"===o.item.command||"EmojiPicker"===o.item.command||!e||i.contentModule.getEditPanel().contains(this.getAncestorNode(e.commonAncestorContainer))||i.contentModule.getEditPanel()===e.commonAncestorContainer||i.contentModule.getPanel()===e.commonAncestorContainer){if(!j.isNullOrUndefined(o)&&-1!==i.maxLength&&!j.isNullOrUndefined(o.item.command)){var n=0,e=("Links"===o.item.command&&(n=(0===s.text.length?s.url:s.text).length),"Images"!==o.item.command&&"Videos"!==o.item.command&&"Table"!==o.item.command&&"Files"!==o.item.command||(n=1),i.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length),c=i.getSelection().length;if(!(-1===i.maxLength||e-c+n<=i.maxLength))return}j.isNullOrUndefined(o)?(t=r.action,e={originalEvent:r,cancel:!(o={}),requestType:t||r.key+"Key",itemCollection:s},j.extend(o,o,e,!0),"tab"!==t&&"enter"!==t&&"space"!==t&&"escape"!==t&&("Markdown"===i.editorMode&&"insert-table"===t&&(s={headingText:i.localeObj.getConstant("TableHeadingText"),colText:i.localeObj.getConstant("TableColText")}),i.trigger(Le,o,function(e){!e.cancel||"paste"!==t&&"cut"!==t&&"copy"!==t||r.preventDefault()})),!o.cancel&&(c=!!j.isNullOrUndefined(i.tableModule)||!!i.tableModule&&i.tableModule.ensureInsideTableList,9===r.which&&c||9!==r.which)&&(13===r.which&&"HTML"===i.editorMode&&(s={enterAction:i.enterKey}),this.editorManager.observer.notify("keydown"===r.type?zs:Ks,{event:r,callBack:this.onSuccess.bind(this,i),value:s,enterAction:i.enterKey,enableTabKey:i.enableTabKey}))):!j.isNullOrUndefined(o)&&o.item.command&&o.item.subCommand&&(o.item.command!==o.item.subCommand&&"Font"!==o.item.command&&"Export"!==o.item.command||("FontName"===o.item.subCommand||"FontSize"===o.item.subCommand)&&"dropDownSelect"===o.name||!("BackgroundColor"!==o.item.subCommand&&"FontColor"!==o.item.subCommand||"colorPickerChanged"!==o.name&&"tableColorPickerChanged"!==o.name)||"FormatPainter"===o.item.subCommand||"EmojiPicker"===o.item.subCommand)&&(j.extend(o,o,{requestType:o.item.subCommand,cancel:!1,itemCollection:s,selectType:o.name},!0),i.trigger(Le,o,function(e){var t,n;e.cancel||(t=!j.isNullOrUndefined(e.requestType)&&"FormatPainter"===e.requestType&&"format-copy"===e.name,n=!j.isNullOrUndefined(e.requestType)&&"FormatPainter"===e.requestType&&"format-paste"===e.name,(0===l.getUndoRedoStack().length&&"Links"!==e.item.command&&"Images"!==e.item.command&&!t||n)&&l.saveData(),i.isBlur=!1,t=!(j.isNullOrUndefined(r)||j.isNullOrUndefined(r.target)||j.isNullOrUndefined(j.closest(r.target,".e-rte-elements.e-dropdown-popup.e-rte-dropdown-popup.e-quick-dropdown.e-popup-open"))&&j.isNullOrUndefined(j.closest(r.target,".e-rte-elements.e-rte-quick-popup.e-popup-open"))),!j.isNullOrUndefined(a)&&(t||!j.isNullOrUndefined(j.closest(a.range.startContainer.parentElement,".e-img-caption"))&&"false"===j.closest(a.range.startContainer.parentElement,".e-img-caption").getAttribute("contenteditable")||-1!==j.Browser.userAgent.indexOf("Firefox"))||i.contentModule.getEditPanel().focus({preventScroll:!0}),"HTML"!==i.editorMode||d||(j.isNullOrUndefined(o.selectType)||!j.isNullOrUndefined(o.selectType)&&"showDialog"!==o.selectType)&&a.restore(),"image"!==(n=e.item.subCommand.toLocaleLowerCase())&&"file"!==n&&"replace"!==n||(s=e.itemCollection),"paste"===n||"cut"===n||"copy"===n?i.clipboardAction(n,r):(l.editorManager.observer.notify(pt,{subCommand:e.item.subCommand}),l.editorManager.execCommand(e.item.command,e.item.subCommand,r,l.onSuccess.bind(l,i),e.item.value,"Pre"===e.item.subCommand&&"dropDownSelect"===e.selectType?{name:e.selectType}:s,"#"+i.getID()+" iframe",i.enterKey)))})),!(j.isNullOrUndefined(r)||r&&"copy"!==r.action)||r&&r.shiftKey&&"Tab"===r.key||this.enableUndo(i)}},vd.prototype.getAncestorNode=function(e){return e=3===e.nodeType?e.parentNode:e},vd.prototype.onKeyHandler=function(e,t){var n=this;this.editorManager.observer.notify(Ks,{event:t,callBack:function(){e.notify(W,{}),n.enableUndo(e)},enterAction:e.enterKey})},vd.prototype.onSuccess=function(t,e){t.notify(W,{}),e&&(j.isNullOrUndefined(e.event)||"copy"!==e.event.action)&&("Paste"===e.requestType?(t.notify(ue,e),this.enableUndo(t)):(this.enableUndo(t),t.notify(ue,e))),t.trigger(ke,e,function(e){if(t.setPlaceHolder(),("Images"===e.requestType||"Replace"===e.requestType||"Links"===e.requestType||"Audios"===e.requestType||"Videos"===e.requestType)&&"HTML"===t.editorMode){if("Links"===e.requestType&&e.event&&"keydown"===e.event.type&&32===e.event.keyCode)return;t.notify(Re,{args:e.event,type:e.requestType,isNotify:!0,elements:e.elements})}"VideosPlayPause"===e.requestType&&t.notify("editAreaClick",{args:event}),t.autoResize()})},vd.prototype.saveData=function(e){this.editorManager.undoRedoManager.saveData(e)},vd.prototype.getUndoStatus=function(){return this.editorManager.undoRedoManager.getUndoStatus()},vd.prototype.getUndoRedoStack=function(){return this.editorManager.undoRedoManager.undoRedoStack},vd.prototype.enableUndo=function(e){var t=this.getUndoStatus();!e.inlineMode.enable||j.Browser.isDevice&&!Cr()?e.toolbarModule&&e.toolbarModule.baseToolbar&&kr(e.toolbarModule.baseToolbar,t):kr(e.quickToolbarModule.inlineQTBar.quickTBarObj,t)},vd.prototype.beforeSlashMenuApply=function(){this.editorManager.beforeSlashMenuApplyFormat()};var bd=vd;function vd(){}var yd="lists-commands",Cd="command-type",Nd="link-commands",Ed="clear-commands",Sd="insert-table",Td="insert-text",Od=(Ld.prototype.addEventListener=function(){this.parent.observer.on(yd,this.applyListsHandler,this),this.parent.observer.on(u,this.keyDownHandler,this),this.parent.observer.on(Ws,this.keyUpHandler,this),this.parent.observer.on(r,this.destroy,this)},Ld.prototype.removeEventListener=function(){this.parent.observer.off(yd,this.applyListsHandler),this.parent.observer.off(u,this.keyDownHandler),this.parent.observer.off(Ws,this.keyUpHandler),this.parent.observer.off(r,this.destroy)},Ld.prototype.keyDownHandler=function(e){switch(9===e.event.which&&this.tabKey(e),e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()}},Ld.prototype.keyUpHandler=function(e){13===e.event.which&&this.enterKey(e)},Ld.prototype.tabKey=function(e){var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),t.selectionStart),i=t.selectionEnd,o=this.selection.getSelectedParentPoints(t),r=0,s=this.isNotFirstLine(t,o[0]);if(s||e.event.shiftKey){var a=this.olListType(),l=this.getListRegex();this.currentAction=this.getAction(o[0].text);for(var d=0;d<o.length;d++){e.event.shiftKey;var c=o[d].line-1;if((b=this.selection.getLine(t,c))&&(!e.event.shiftKey&&s||e.event.shiftKey)){var p=b.split(". "),h=e.event.shiftKey?-"\t".length:"\t".length,u=o[d].text.split("\t");if(e.event.shiftKey&&1===u.length)break;if("OL"===this.currentAction&&/^\d+$/.test(p[0].trim())&&a){e.event.preventDefault(),o[d].text=e.event.shiftKey?u.splice(1,u.length).join("\t"):"\t"+o[d].text;var m=this.getTabSpace(o[d].text),g=this.getTabSpace(b),f=o[d].text.split(". ");if(m===g)this.changeTextAreaValue(f,this.nextOrderedListValue(p[0].trim()),e,t,o,d,i);else if(g<m)this.changeTextAreaValue(f,"1. ",e,t,o,d,i);else for(;g.length>m.length;){c-=1;var b,v=(b=this.selection.getLine(t,c)).trim().split(". ");if(/^\d+$/.test(v[0])&&(g=this.getTabSpace(b)).length<=m.length){this.changeTextAreaValue(f,this.nextOrderedListValue(v[0]),e,t,o,d,i);break}}}else("UL"===this.currentAction&&l.test(b.trim())||!a)&&(e.event.preventDefault(),o[d].text=e.event.shiftKey?u.splice(1,u.length).join("\t"):"\t"+o[d].text,t.value=t.value.substr(0,o[d].start)+o[d].text+"\n"+t.value.substr(o[d].end,t.value.length));if(n=0===d?n+h:n,r+=h,1!==o.length)for(var y=d;y<o.length;y++)o[y].start=0!==y?o[y].start+h:o[y].start,o[y].end=o[y].end+h}}}this.restore(t,n,i+r,e)},Ld.prototype.changeTextAreaValue=function(e,t,n,i,o,r,s){e.splice(0,1);for(var a,l=this.selection.getAllParents(i.value).length,d="",c=this.getTabSpace(o[r].text),p=parseInt(t.split(".")[0],null),h=this.getTabSpace(o[r].text),u=!0,m=!0,g=-1,f=!0,b=0,d=""!==this.selection.getLine(i,o[0].line+1)?"":d+i.value.substr(o[0].end,i.value.length),v=1;v<l&&!j.isNullOrUndefined(this.selection.getLine(i,o[0].line+v))&&""!==this.selection.getLine(i,o[0].line+v);v++){var y=this.selection.getLine(i,o[0].line+v),C=this.getTabSpace(y),N=y.split(". ");if(1===N.length){d+=i.value.substr(o[0].end+b,i.value.length);break}b+=y.length;var E,S=!1,T=n.event.shiftKey?c.length+1:c.length-1;C.length>h.length&&(f=!1),c.length!==C.length&&C.length<h.length?(u=!(m=!0),S=!(!n.event.shiftKey||c.length!==C.length||(m=!1))):f&&n.event.shiftKey&&c.length===C.length&&C.length===h.length&&(S=!(m=!1)),a=""===d?"":"\n",T===C.length&&m?(E=n.event.shiftKey?(g++,this.nextOrderedListValue(g.toString())):this.previousOrderedListValue(N[0]),N.splice(0,1),d=d+a+C+E+N.join(". ")):c.length===C.length&&u||S?(E=this.nextOrderedListValue(p.toString()),p++,N.splice(0,1),d=d+a+C+E+N.join(". ")):(d=d+a+y,m=!1),h=this.getTabSpace(y)}o[r].text=this.getTabSpace(o[r].text)+t+e.join(". ")+"\n",i.value=i.value.substr(0,o[r].start)+o[r].text+d},Ld.prototype.getTabSpace=function(e){for(var t=e.split("\t"),n="",i=0;i<t.length&&""===t[i];i++)n+="\t";return n},Ld.prototype.isNotFirstLine=function(e,t){var n,i=t.text,o=t.line-1,r=this.selection.getLine(e,o),s=this.getListRegex(),a=!1;if(r&&(this.currentAction=this.getAction(r),c=r.split(". "),n="OL"===this.currentAction?/^\d+$/.test(c[0].trim()):s.test(r.trim())),r&&n)for(var l=this.getTabSpace(i),d=this.getTabSpace(r),a=l===d||a;d.length>l.length;){o-=1;var c=(r=this.selection.getLine(e,o)).trim().split(". "),p="OL"===this.currentAction?/^\d+$/.test(c[0]):s.test(r.trim());if(p&&(d=this.getTabSpace(r)).length<=l.length){a=!0;break}}return a},Ld.prototype.getAction=function(e){var t=e.split(". ")[0],t=/^\d+$/.test(t.trim()),e=e.trim().split(new RegExp("^("+this.selection.replaceSpecialChar(this.syntax.UL).trim()+")"))[1];return t?"OL":e?"UL":"NOTLIST"},Ld.prototype.nextOrderedListValue=function(e){return(parseInt(e,null)+1).toString()+". "},Ld.prototype.previousOrderedListValue=function(e){return(parseInt(e,null)-1).toString()+". "},Ld.prototype.enterKey=function(e){var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),t.selectionStart),i=t.selectionEnd,o=this.selection.getSelectedParentPoints(t),r=this.selection.getLine(t,o[0].line-1),s=this.olListType(),a=this.getListRegex(),l=[],d=(j.isNullOrUndefined(r)||(l=r.split(". "),this.currentAction=this.getAction(r)),0);if("OL"===this.currentAction&&1<l.length&&/^\d+$/.test(l[0].trim())&&s&&""!==l[1]){for(var c=this.getTabSpace(r),p=(this.currentAction=this.getAction(r),this.nextOrderedListValue(l[0])),h=(o[0].text=c+p+o[0].text,this.selection.getAllParents(t.value).length),u="\n",m=this.getTabSpace(r),g=this.getTabSpace(o[0].text),f=!0,b=1;b<h&&""!==t.value.substr(o[0].end,t.value.length);b++){var v,y,C,N=this.selection.getLine(t,o[0].line+b);j.isNullOrUndefined(N)?u+="":(v=N.split(". "),(y=this.getTabSpace(N)).length<g.length&&(f=!1),1<v.length&&/^\d+$/.test(v[0].trim())&&m.length===y.length&&f?(C=this.nextOrderedListValue(v[0]),v.splice(0,1),u=u+y+C+v.join(". ")+"\n"):(u=u+N+"\n",g=this.getTabSpace(N)))}t.value=t.value.substr(0,o[0].start)+m+p+this.selection.getLine(t,o[0].line)+u,n=n+p.length+c.length,d+=p.length+c.length}else("UL"===this.currentAction&&r&&a.test(r.trim())&&""!==r.trim().replace(a,"")||"OL"===this.currentAction&&!s&&""!==l[1])&&(c=this.getTabSpace(r),p=this.syntax[this.currentAction],o[0].text=c+p+o[0].text+(0<o[0].text.trim().length?"\n":""),t.value=t.value.substr(0,o[0].start)+o[0].text+t.value.substr(o[0].end,t.value.length),n=n+p.length+c.length,d+=p.length+c.length);this.restore(t,n,i+d,e)},Ld.prototype.olListType=function(){var e=this.syntax.OL.split(".,");return(1===e.length?null:parseInt(e[2].trim(),null)-parseInt(e[0].trim(),null))?1:0},Ld.prototype.applyListsHandler=function(e){for(var t,n=this.parent.element,i=(this.selection.save(n.selectionStart,n.selectionEnd),this.currentAction=e.subCommand,n.selectionStart),o=n.selectionEnd,r=0,s=0,a=this.selection.getSelectedParentPoints(n),l="",d=this.olListType(),c={},p=0;p<a.length;p++)if(t=d?"OL"===this.currentAction?p+d+". ":this.syntax[this.currentAction]:"OL"===this.currentAction?this.syntax.OL:this.syntax[this.currentAction],this.selection.isStartWith(a[p].text,t))a[p].text=a[p].text.replace(t,""),n.value=n.value.substr(0,a[p].start+s)+a[p].text+"\n"+n.value.substr(a[p].end+s,n.value.length),s-=t.length,u=t.length,this.restore(n,i-u,o+s,null);else{if(""===a[p].text&&0===p&&(this.selection.save(i,o),1!==a.length))for(var h=p;h<a.length;h++)a[h].start=0!==h?1+a[h].start:a[h].start,a[h].end=1+a[h].end;var u=j.isNullOrUndefined(a[p-1])?0:this.getTabSpace(a[p-1].text).length,m=this.appliedLine(a[p].text,t,c,u),l=m.line?l:t;if(a[p].text=m.line||l+a[p].text,m.space=m.space||0,n.value=n.value.substr(0,a[p].start+s)+a[p].text+"\n"+n.value.substr(a[p].end,n.value.length),i=0===p?0<i+l.length+m.space?i+l.length+m.space:0:i,r+=l.length+m.space,1!==a.length)for(h=p;h<a.length;h++)a[h].start=0!==h?l.length+a[h].start+m.space:a[h].start,a[h].end=l.length+a[h].end+m.space;this.restore(n,i<=t.length?0:i,o+r,null)}this.restore(n,null,null,e)},Ld.prototype.appliedLine=function(e,t,n,i){var o={},r=new RegExp("^["+this.syntax.UL.trim()+"]"),s=e.split(". "),a=s[0]+". ",l=r.test(e.trim())||e.trim()===this.syntax.OL.trim()||e.trim()===this.syntax.UL.trim()||/^\d+$/.test(s[0].trim()),d=this.olListType(),c=this.getTabSpace(e).length;return"OL"===this.currentAction&&d&&(n[c.toString()]=j.isNullOrUndefined(n[c.toString()])?1:n[c.toString()].valueOf()+1,t=n[c.toString()].valueOf().toString()+". ",!j.isNullOrUndefined(i))&&c<i&&(n[i.toString()]=0),l&&(n=c=void 0,r.test(e.trim())?(n=this.syntax.UL,c=t,o.space=t.trim().length-this.syntax.UL.trim().length):/^\d+$/.test(s[0].trim())&&d?(n=s[0].trim()+". ",c=t,o.space=this.syntax.UL.trim().length-a.trim().length):/^\d+$/.test(s[0].trim())&&(n=s[0].trim()+". ",c=this.syntax.UL,o.space=this.syntax.UL.trim().length-a.trim().length),o.line=e.replace(n,c)),o},Ld.prototype.restore=function(e,t,n,i){j.isNullOrUndefined(t)||j.isNullOrUndefined(t)||this.selection.save(t,n),j.isNullOrUndefined(i)||this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},Ld.prototype.getListRegex=function(){for(var e="",t=Object.keys(this.syntax),n=RegExp,i=0;i<t.length;i++){var o=this.selection.replaceSpecialChar(this.syntax[t[i]]);e+=""===e?"^("+o+")|^("+o.trim()+")":"|^("+o+")|^("+o.trim()+")"}return new n(e)},Ld.prototype.destroy=function(){this.removeEventListener()},Ld);function Ld(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}wd.prototype.addEventListener=function(){this.parent.observer.on(Vs,this.applyFormats,this),this.parent.observer.on(r,this.destroy,this)},wd.prototype.removeEventListener=function(){this.parent.observer.off(Vs,this.applyFormats),this.parent.observer.off(r,this.destroy)},wd.prototype.applyFormats=function(e){e.subCommand=e.subCommand.toLowerCase();var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),this.selection.getSelectedParentPoints(t));if(this.isAppliedFormat(n)===e.subCommand){if("pre"===e.subCommand){if(!(1<n.length))return;this.applyCodeBlock(t,e,n)}this.cleanFormat(t),this.restore(t,t.selectionStart,t.selectionEnd,e)}else if("p"===e.subCommand)this.cleanFormat(t),this.restore(t,t.selectionStart,t.selectionEnd,e);else{("pre"===e.subCommand&&1!==n.length||"pre"!==e.subCommand)&&this.cleanFormat(t,e.subCommand);var i=t.selectionStart,o=t.selectionEnd,r=0,n=this.selection.getSelectedParentPoints(t);if("pre"===e.subCommand)1<n.length?this.applyCodeBlock(t,e,n):(j.extend(e,e,{subCommand:"InlineCode"},!0),this.parent.observer.notify(Cd,e));else{for(var s=0;s<n.length;s++)if(""===n[s].text||this.selection.isStartWith(n[s].text,"\\"+this.syntax[e.subCommand])){if(""===n[s].text&&0===s&&(this.selection.save(i,o),0===this.selection.getSelectedText(t).length&&(n[s].text=this.syntax[e.subCommand],t.value=t.value.substr(0,n[s].start)+this.syntax[e.subCommand]+t.value.substr(n[s].end,t.value.length),i=0===s?i+this.syntax[e.subCommand].length:i,r+=this.syntax[e.subCommand].length),1!==n.length))for(a=s;a<n.length;a++)n[a].start=0!==a?1+n[a].start:n[a].start,n[a].end=1+n[a].end}else if(n[s].text=this.syntax[e.subCommand]+n[s].text,t.value=t.value.substr(0,n[s].start)+n[s].text+"\n"+t.value.substr(n[s].end,t.value.length),i=0===s?i+this.syntax[e.subCommand].length:i,r+=this.syntax[e.subCommand].length,1!==n.length)for(var a=s;a<n.length;a++)n[a].start=0!==a?this.syntax[e.subCommand].length+n[a].start:n[a].start,n[a].end=this.syntax[e.subCommand].length+n[a].end;this.restore(t,i,o+r,e)}}},wd.prototype.clearRegex=function(){for(var e="",t=Object.keys(this.syntax),n=0;n<t.length&&"pre"!==t[n]&&"p"!==t[n];n++)e+=""===e?"^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")":"|^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")";return e},wd.prototype.cleanFormat=function(e,t){var n=this.selection.getSelectedParentPoints(e),i=e.selectionStart,o=e.selectionEnd,r=0;if(this.selection.isClear(n,this.clearRegex())){for(var s=0;s<n.length;s++){for(var a=Object.keys(this.syntax),l=0;""!==n[s].text&&l<a.length;l++){var d=this.syntax[a[l]];if(a[l]!==t){var c=new RegExp("^("+this.selection.replaceSpecialChar(d)+")","gim");if(c.test(n[s].text)){if(n[s].text=n[s].text.replace(c,""),e.value=e.value.substr(0,n[s].start)+n[s].text+"\n"+e.value.substr(n[s].end,e.value.length),i=0===s?0<i-d.length?i-d.length:0:i,r+=d.length,1!==n.length)for(var p=0;p<n.length;p++)n[p].start=0!==p?n[p].start-d.length:n[p].start,n[p].end=n[p].end-d.length;break}}}if(""===n[s].text&&0===s&&(this.selection.save(i,o),1!==n.length))for(l=s;l<n.length;l++)n[l].start=0!==l?1+n[l].start:n[l].start,n[l].end=1+n[l].end}this.restore(e,i,o-r)}},wd.prototype.applyCodeBlock=function(e,t,n){var i,o=t.subCommand,r=n[0].start,s=n[n.length-1].end,a=this.selection.getAllParents(e.value),l=a[n[0].line-1],a=a[n.length+1+1],s=this.selection.isStartWith(l,this.syntax.pre.split("\n")[0])||this.selection.isStartWith(a,this.syntax.pre.split("\n")[0])?(n=this.syntax[""+o],l=this.parent.markdownSelection.getSelectedInlinePoints(e),a=e.value.substr(0,e.selectionStart).lastIndexOf(n),i=e.value.substr(e.selectionEnd,e.selectionEnd).indexOf(n),i+=l.end,a=this.replaceAt(e.value.substr(0,l.start),n,"",a,l.start),i=this.replaceAt(e.value.substr(l.end,e.value.length),n,"",0,i),e.value=a+l.text+i,r=this.selection.selectionStart-n.length,this.selection.selectionEnd-n.length):(l=""===(a=e.value.substring(r,s).split("\n"))[a.length-1]?"":"\n",e.value=e.value.substr(0,r)+this.syntax[""+o]+e.value.substring(r,s)+l+this.syntax[""+o]+e.value.substr(s,e.value.length),r=this.selection.selectionStart+this.syntax[""+o].length,this.selection.selectionEnd+this.syntax[""+o].length-1);this.restore(e,r,s,t)},wd.prototype.replaceAt=function(e,t,n,i,o){return e.slice(0,i)+e.slice(i,o).replace(t,n)+e.slice(o)},wd.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},wd.prototype.isAppliedFormat=function(e,t){for(var n="p",i=(Object.keys(this.syntax),Object.keys(this.syntax)),o=("backward"===this.parent.element.selectionDirection?e[0]:e[e.length-1]).text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(o,this.syntax[i[r]])){n=i[r];break}if("pre"===i[r]){var s=this.selection.getAllParents(this.parent.element.value),a=s[e[0].line-1],s=s[e.length+1];if(this.selection.isStartWith(a,this.syntax[i[r]].split("\n")[0])&&this.selection.isStartWith(s,this.syntax[i[r]].split("\n")[0])){n=i[r];break}}}return n},wd.prototype.destroy=function(){this.removeEventListener()};var kd=wd;function wd(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}Dd.prototype.addEventListener=function(){this.parent.observer.on(Cd,this.applyCommands,this),this.parent.observer.on(u,this.keyDownHandler,this),this.parent.observer.on(r,this.destroy,this)},Dd.prototype.removeEventListener=function(){this.parent.observer.off(Cd,this.applyCommands),this.parent.observer.off(u,this.keyDownHandler),this.parent.observer.off(r,this.destroy)},Dd.prototype.keyDownHandler=function(e){switch(e.event.action){case"bold":this.applyCommands({subCommand:"Bold",callBack:e.callBack}),e.event.preventDefault();break;case"italic":this.applyCommands({subCommand:"Italic",callBack:e.callBack}),e.event.preventDefault();break;case"strikethrough":this.applyCommands({subCommand:"StrikeThrough",callBack:e.callBack}),e.event.preventDefault();break;case"uppercase":this.applyCommands({subCommand:"UpperCase",callBack:e.callBack}),e.event.preventDefault();break;case"lowercase":this.applyCommands({subCommand:"LowerCase",callBack:e.callBack}),e.event.preventDefault();break;case"superscript":this.applyCommands({subCommand:"SuperScript",callBack:e.callBack}),e.event.preventDefault();break;case"subscript":this.applyCommands({subCommand:"SubScript",callBack:e.callBack}),e.event.preventDefault()}},Dd.prototype.isBold=function(e,t){return-1!==e.search("\\"+t+"\\"+t)},Dd.prototype.isItalic=function(e,t){return-1!==e.search("\\"+t)},Dd.prototype.isMatch=function(e,t){var n=[""];switch(t){case this.syntax.Italic:case this.syntax.InlineCode:case this.syntax.StrikeThrough:n=e.match(this.singleCharRegx(t))}return n},Dd.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+"\\"+e+")","g")},Dd.prototype.singleCharRegx=function(e){return new RegExp("(\\"+e+")","g")},Dd.prototype.isAppliedCommand=function(e){var t,n=!1,i=this.parent.element,o=i.selectionStart,o=(t=o,function(e){return[e.slice(0,t),e.slice(t)]}(i.value)),r=this.syntax.Bold.substr(0,1),s=this.syntax.Italic,a=this.parent.markdownSelection.getSelectedText(i);if(""!==a&&a===a.toLocaleUpperCase()&&"UpperCase"===e)return!0;if(""===a){a=i.value.substr(o[0].length-1,1),i=o[1].substr(0,1);if(""!==a&&""!==i&&a.match(/[a-z]/i)&&a===a.toLocaleUpperCase()&&i===i.toLocaleUpperCase()&&"UpperCase"===e)return!0}return this.isBold(o[0],r)||this.isItalic(o[0],s)||this.isBold(o[1],r)||this.isItalic(o[1],s)||(j.isNullOrUndefined(this.isMatch(o[0],this.syntax.StrikeThrough))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.StrikeThrough))||this.isMatch(o[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(o[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),j.isNullOrUndefined(this.isMatch(o[0],this.syntax.InlineCode))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.InlineCode))||this.isMatch(o[0],this.syntax.InlineCode).length%2!=1||this.isMatch(o[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),j.isNullOrUndefined(o[0].match(/\<sub>/g))||j.isNullOrUndefined(o[1].match(/\<\/sub>/g))||o[0].match(/\<sub>/g).length%2!=1||o[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),j.isNullOrUndefined(o[0].match(/\<sup>/g)))||j.isNullOrUndefined(o[1].match(/\<\/sup>/g))||o[0].match(/\<sup>/g).length%2!=1||o[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e||(n=!0),this.isBold(o[0],r)&&this.isBold(o[1],r)&&o[0].match(this.multiCharRegx(r)).length%2==1&&o[1].match(this.multiCharRegx(r)).length%2==1&&"Bold"===e&&(n=!0),o[0]=this.isBold(o[0],r)?o[0].replace(this.multiCharRegx(r),"$%@"):o[0],o[1]=this.isBold(o[1],r)?o[1].replace(this.multiCharRegx(r),"$%@"):o[1],j.isNullOrUndefined(this.isMatch(o[0],this.syntax.Italic))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.Italic))||this.isMatch(o[0],this.syntax.Italic).length%2!=1||this.isMatch(o[1],this.syntax.Italic).length%2!=1||"Italic"!==e||(n=!0),j.isNullOrUndefined(this.isMatch(o[0],this.syntax.StrikeThrough))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.StrikeThrough))||this.isMatch(o[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(o[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),j.isNullOrUndefined(this.isMatch(o[0],this.syntax.InlineCode))||j.isNullOrUndefined(this.isMatch(o[1],this.syntax.InlineCode))||this.isMatch(o[0],this.syntax.InlineCode).length%2!=1||this.isMatch(o[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),j.isNullOrUndefined(o[0].match(/\<sub>/g))||j.isNullOrUndefined(o[1].match(/\<\/sub>/g))||o[0].match(/\<sub>/g).length%2!=1||o[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),n=j.isNullOrUndefined(o[0].match(/\<sup>/g))||j.isNullOrUndefined(o[1].match(/\<\/sup>/g))||o[0].match(/\<sup>/g).length%2!=1||o[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e?n:!0},Dd.prototype.applyCommands=function(e){this.currentAction=e.subCommand;var t,n,i,o,r,s=this.parent.element,a=(this.selection.save(s.selectionStart,s.selectionEnd),s.selectionStart),l=s.selectionEnd,d=0,c=this.parent.markdownSelection.getSelectedInlinePoints(s);this.isAppliedCommand(e.subCommand)&&""!==c.text?(o=this.syntax[e.subCommand],i="SubScript"===e.subCommand?"</sub>":"SuperScript"===e.subCommand?"</sup>":this.syntax[e.subCommand],t="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:o.length,r=s.value.substr(0,c.start).lastIndexOf(o),n=s.value.substr(c.end,s.value.length).indexOf(i),n+=c.end,o=this.replaceAt(s.value.substr(0,c.start),o,"",r,c.start),r=this.replaceAt(s.value.substr(c.end,s.value.length),i,"",0,n),s.value=o+c.text+r,this.restore(s,a-t,l-t,e)):(""===c.text||this.isApplied(c,e.subCommand)?"UpperCase"!==e.subCommand&&"LowerCase"!==e.subCommand?("SubScript"===e.subCommand||"SuperScript"===e.subCommand?(c.text=this.textReplace(c.text,e.subCommand),c.text=this.syntax[e.subCommand]+c.text+"</"+this.syntax[e.subCommand].substring(1,5)):(c.text=this.textReplace(c.text,e.subCommand),c.text=this.syntax[e.subCommand]+c.text+this.syntax[e.subCommand]),s.value=s.value.substr(0,c.start)+c.text+s.value.substr(c.end,s.value.length),d=this.syntax[e.subCommand].length,c.start===c.end?this.restore(s,a+d,l+d,e):this.restore(s,a+d,l-d,e)):this.restore(s,a,l,e):(d="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:this.syntax[e.subCommand].length,i=void 0,(n=s.value.substr(c.start-this.syntax[e.subCommand].length,this.syntax[e.subCommand].length))===e.subCommand||c.start-this.syntax[e.subCommand].length===s.value.indexOf(this.syntax[e.subCommand])&&(c.end===s.value.lastIndexOf(this.syntax[e.subCommand])||c.end===s.value.lastIndexOf("</"+this.syntax[e.subCommand].substring(1,5)))?(i="SubScript"===e.subCommand||"SuperScript"===e.subCommand?s.value.substr(c.end,this.syntax[e.subCommand].length+1):s.value.substr(c.end,this.syntax[e.subCommand].length),o=this.replaceAt(s.value.substr(0,c.start),n,"",c.start-this.syntax[e.subCommand].length,c.start),r=this.replaceAt(s.value.substr(c.end,s.value.length),i,"",0,i.length),s.value=o+c.text+r,this.restore(s,a-d,l-d,e)):("SubScript"===e.subCommand||"SuperScript"===e.subCommand?c.text=this.syntax[e.subCommand]+c.text+"</"+this.syntax[e.subCommand].substring(1,5):"UpperCase"===e.subCommand||"LowerCase"===e.subCommand?c.text="UpperCase"===e.subCommand?c.text.toUpperCase():c.text.toLowerCase():c.text=this.syntax[e.subCommand]+c.text+this.syntax[e.subCommand],s.value=s.value.substr(0,c.start)+c.text+s.value.substr(c.end,s.value.length),this.restore(s,a+d,l+d,e))),this.parent.undoRedoManager.saveData())},Dd.prototype.replaceAt=function(e,t,n,i,o){return e.slice(0,i)+e.slice(i,o).replace(t,n)+e.slice(o)},Dd.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},Dd.prototype.textReplace=function(e,t){var n,i,o=this.singleCharRegx(this.syntax[""+t]);switch(t){case"Bold":o=this.multiCharRegx(this.syntax[""+t].substr(0,1)),e=e.replace(o,"");break;case"Italic":e=this.isBold(e,this.syntax[""+t].substr(0,1))?(i=this.multiCharRegx(this.syntax[""+t].substr(0,1)),n=(n=e).replace(i,"$%@").replace(o,""),i=new RegExp("\\$%@","g"),n.replace(i,this.syntax[""+t].substr(0,1)+this.syntax[""+t].substr(0,1))):e.replace(o,"");break;case"StrikeThrough":case"InlineCode":e=e.replace(o,"");break;case"SubScript":e=e.replace(/<sub>/g,"").replace(/<\/sub>/g,"");break;case"SuperScript":e=e.replace(/<sup>/g,"").replace(/<\/sup>/g,"")}return e},Dd.prototype.isApplied=function(e,t){var n=this.singleCharRegx(this.syntax[""+t]);switch(t){case"SubScript":case"SuperScript":return(n=this.singleCharRegx(this.syntax[""+t])).test(e.text);case"Bold":case"StrikeThrough":return(n=this.multiCharRegx(this.syntax[""+t].substr(0,1))).test(e.text);case"UpperCase":case"LowerCase":return(n=new RegExp("^["+this.syntax[""+t]+"]*$","g")).test(e.text);case"Italic":var i,o=this.multiCharRegx(this.syntax[""+t].substr(0,1));return o.test(e.text)?(i=(i=e.text).replace(o,"$%#"),n.test(i)):n.test(e.text);case"InlineCode":return n.test(e.text)}},Dd.prototype.destroy=function(){this.removeEventListener()};var xd=Dd;function Dd(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}Bd.prototype.addEventListener=function(){var e=j.debounce(this.keyUp,this.undoRedoTimer);this.parent.observer.on(Ws,e,this),this.parent.observer.on(u,this.keyDown,this),this.parent.observer.on(_s,this.onAction,this),this.parent.observer.on(Gs,this.onPropertyChanged,this),this.parent.observer.on(r,this.destroy,this)},Bd.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++)switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}},Bd.prototype.removeEventListener=function(){var e=j.debounce(this.keyUp,300);this.parent.observer.off(Ws,e),this.parent.observer.off(u,this.keyDown),this.parent.observer.off(_s,this.onAction),this.parent.observer.off(Gs,this.onPropertyChanged),this.parent.observer.off(r,this.destroy)},Bd.prototype.destroy=function(){this.removeEventListener()},Bd.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},Bd.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},Bd.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},Bd.prototype.saveData=function(e){var t=this.parent.element,n=(this.selection.save(t.selectionStart,t.selectionEnd),t.selectionStart),t=t.selectionEnd,i={text:this.parent.element.value,start:n,end:t};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),1<this.undoRedoStack.length&&this.undoRedoStack[this.undoRedoStack.length-1].start===n&&this.undoRedoStack[this.undoRedoStack.length-1].end===t||(this.undoRedoStack.push(i),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())},Bd.prototype.undo=function(e){var t,n,i;0<this.steps&&(this.currentAction="Undo",t=this.undoRedoStack[this.steps-1].start,n=this.undoRedoStack[this.steps-1].end,i=this.undoRedoStack[this.steps-1].text,this.parent.element.value=i,this.parent.element.focus(),this.steps--,this.restore(this.parent.element,t,n,e))},Bd.prototype.redo=function(e){var t,n;null!=this.undoRedoStack[this.steps+1]&&(this.currentAction="Redo",t=this.undoRedoStack[this.steps+1].start,n=this.undoRedoStack[this.steps+1].end,this.parent.element.value=this.undoRedoStack[this.steps+1].text,this.parent.element.focus(),this.steps++,this.restore(this.parent.element,t,n,e))},Bd.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},Bd.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return 0<this.steps&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e};var Md=Bd;function Bd(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=j.isNullOrUndefined(t)?30:t.undoRedoSteps,this.undoRedoTimer=j.isNullOrUndefined(t)?300:t.undoRedoTimer,this.selection=this.parent.markdownSelection,this.addEventListener()}Ad.prototype.addEventListener=function(){this.parent.observer.on(Nd,this.createLink,this),this.parent.observer.on(r,this.destroy,this)},Ad.prototype.removeEventListener=function(){this.parent.observer.off(Nd,this.createLink),this.parent.observer.off(r,this.destroy)},Ad.prototype.createLink=function(e){var t=this.parent.element,n=(t.focus(),t.selectionStart),i=t.selectionEnd,o="Image"===e.subCommand?this.selection.getSelectedText(t):e.item.text,r="Image"===e.subCommand?n+2:n+1,s="Image"===e.subCommand?i+2:i+1,o="Image"===e.subCommand?"!["+o+"]("+e.item.url+")":"["+o+"]("+e.item.url+")";t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,s),this.restore(t,r,s,e)},Ad.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},Ad.prototype.destroy=function(){this.removeEventListener()};var Rd=Ad;function Ad(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}Ud.prototype.addEventListener=function(){this.parent.observer.on(Sd,this.createTable,this),this.parent.observer.on(u,this.onKeyDown,this),this.parent.observer.on(r,this.destroy,this)},Ud.prototype.removeEventListener=function(){this.parent.observer.off(Sd,this.createTable),this.parent.observer.off(u,this.onKeyDown),this.parent.observer.off(r,this.destroy)},Ud.prototype.destroy=function(){this.removeEventListener()},Ud.prototype.onKeyDown=function(e){"insert-table"===e.event.action&&(e.item=e.value,this.createTable(e))},Ud.prototype.createTable=function(e){this.element=this.parent.element;var t=this.element.selectionStart,n=this.element.selectionEnd,i=this.element.value;this.locale=e,this.selection.save(t,n),this.restore(this.element.selectionStart,this.element.selectionEnd,null),this.insertTable(t,n,i,e)},Ud.prototype.getTable=function(){var e="";return(e+=this.textNonEmpty())+this.tableHeader(this.locale)+this.tableCell(this.locale)},Ud.prototype.tableHeader=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=1===n?e.item.headingText+" "+i+"|":"---------|";t+=this.insertLine()}return t},Ud.prototype.tableCell=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=e.item.colText+" "+this.convertToLetters(n)+i+"|";t+=this.insertLine()}return t+=this.insertLine()},Ud.prototype.insertLine=function(){var e=document.createElement("div");return e.innerHTML="\n",e.textContent},Ud.prototype.insertTable=function(e,t,n,i){var o=this.selection.getSelectedParentPoints(this.element),r=o[o.length-1].text.split(" ",2),s=this.getFormatTag();!(r.length<2)&&this.ensureFormatApply(o[o.length-1].text)?this.checkValid(e,t,this.getTable(),n,i,r,o,s):(this.element.value=this.updateValue(this.getTable()),this.makeSelection(n,e,t)),this.restore(this.element.selectionStart,this.element.selectionEnd,i)},Ud.prototype.makeSelection=function(e,t,n){n=t+(0<e.length?12:10),t+=0<e.length?3:1,this.selection.setSelection(this.element,t,n)},Ud.prototype.getFormatTag=function(){for(var e=Object.keys(this.syntaxTag.Formats),t=Object.keys(this.syntaxTag.List),n=[],i=0;i<e.length;i++)n.push(this.syntaxTag.Formats[e[i]]);for(var o=0;o<t.length;o++)n.push(this.syntaxTag.List[t[o]]);return n},Ud.prototype.ensureFormatApply=function(e){for(var t=this.getFormatTag(),n=e.trim().split(" ",2)[0]+" ",i=0;i<t.length;i++)if(n===t[i]||/^[\d.]+[ ]+$/.test(n))return!0;return!1},Ud.prototype.ensureStartValid=function(e,t){for(var n=t[0].text.split(" ",2),i=e+1;i<=e+n[0].length-1;i++)if(this.element.selectionStart===i||this.element.selectionEnd===i)return!1;return!0},Ud.prototype.ensureEndValid=function(e,t){for(var n=e+1;n<=e+t-1;n++)if(this.element.selectionEnd===n)return!1;return!0},Ud.prototype.updateValueWithFormat=function(e,t){var n=this.element.value.substring(this.element.selectionEnd,this.element.value.length);return t+=n.replace(n,e[0]+" "+n),this.element.value.substr(0,this.element.selectionStart)+t},Ud.prototype.updateValue=function(e){return this.element.value.substr(0,this.element.selectionStart)+e+this.element.value.substr(this.element.selectionEnd,this.element.value.length)},Ud.prototype.checkValid=function(e,t,n,i,o,r,s,a){this.ensureStartValid(s[0].start,s)&&this.ensureEndValid(s[s.length-1].start,r[0].length)&&(e===s[0].start?e!==t&&t!==s[s.length-1].end-1?this.element.value=this.updateValueWithFormat(r,n):this.element.value=this.updateValue(n):t===s[s.length-1].end-1?this.element.value=this.updateValue(n):this.element.value=this.updateValueWithFormat(r,n),this.makeSelection(i,e,t))},Ud.prototype.convertToLetters=function(e){for(var t="A".charCodeAt(0),n="";--e,n=String.fromCharCode(t+e%26)+n,0<(e=e/26>>0););return n},Ud.prototype.textNonEmpty=function(){var e="";return e=(this.isCursorBased()||this.isSelectionBased())&&0<this.element.value.length?(e+=this.insertLine())+this.insertLine():e},Ud.prototype.isCursorBased=function(){return this.element.selectionStart===this.element.selectionEnd},Ud.prototype.isSelectionBased=function(){return this.element.selectionStart!==this.element.selectionEnd},Ud.prototype.restore=function(e,t,n){this.selection.save(e,t),this.selection.restore(this.element),n&&n.callBack&&n.callBack({requestType:n.subCommand,selectedText:this.selection.getSelectedText(this.element),editorMode:"Markdown",event:n.event})};var Id=Ud;function Ud(e){j.extend(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}Hd.prototype.addEventListener=function(){this.parent.observer.on(Ed,this.clear,this),this.parent.observer.on(r,this.destroy,this)},Hd.prototype.removeEventListener=function(){this.parent.observer.off(Ed,this.clear),this.parent.observer.off(r,this.destroy)},Hd.prototype.replaceRegex=function(e){return e.replace(/\*/gi,"\\*").replace(/\&/gi,"\\&").replace(/\-/gi,"\\-").replace(/\^/gi,"\\^").replace(/\$/gi,"\\$").replace(/\./gi,"\\.").replace(/\|/gi,"\\|").replace(/\?/gi,"\\?").replace(/\+/gi,"\\+").replace(/\-/gi,"\\-").replace(/\&/gi,"\\&")},Hd.prototype.clearSelectionTags=function(e){for(var t=this.parent.selectionTags,n=Object.keys(t),i=0;i<n.length;i++){var o=n[i];if(Object.prototype.hasOwnProperty.call(t,o)&&""!==t[""+o])for(var r=this.replaceRegex(t[""+o]),s=void 0,a=t[""+o].length,l="<sup>"===t[""+o]||"<sub>"===t[""+o]?t[""+o].length+1:t[""+o].length,d=(s="<sup>"===t[""+o]?new RegExp("<sup>(.*?)</sup>","ig"):"<sub>"===t[""+o]?new RegExp("<sub>(.*?)</sub>","ig"):new RegExp(r+"(.*?)"+r,"ig"),e.match(s)),c=0;d&&c<d.length&&""!==d[c];c++)e=e.replace(d[c],d[c].substr(a,d[c].length-l-a))}return e},Hd.prototype.clearFormatTags=function(e){e=e.split("\n");return this.clearFormatLines(e)},Hd.prototype.clearFormatLines=function(e){for(var t=[this.parent.formatTags,this.parent.listTags],n="",i=0;i<e.length;i++){for(var o=0;o<t.length;o++)for(var r=t[o],s=Object.keys(r),a=0;a<s.length;a++){var l=s[a];Object.prototype.hasOwnProperty.call(r,l)&&""!==r[""+l]&&0===e[i].indexOf(r[""+l])&&(e[i]=e[i].replace(r[""+l],""),e[i]=this.clearFormatLines([e[i]]))}n=n+e[i]+(i!==e.length-1?"\n":"")}return n},Hd.prototype.clear=function(e){var t=this.parent.element,n=(t.focus(),t.selectionStart),i=t.selectionEnd,o=this.selection.getSelectedText(t),o=this.clearSelectionTags(o);o=this.clearFormatTags(o),t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,n,n+o.length),this.restore(t,n,n+o.length,e)},Hd.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},Hd.prototype.destroy=function(){this.removeEventListener()};var Pd=Hd;function Hd(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}Fd.prototype.addEventListener=function(){this.parent.observer.on(Td,this.InsertTextExec,this),this.parent.observer.on(r,this.destroy,this)},Fd.prototype.removeEventListener=function(){this.parent.observer.off(Td,this.InsertTextExec),this.parent.observer.off(r,this.destroy)},Fd.prototype.InsertTextExec=function(e){var t=this.parent.element,n=(t.focus(),t.selectionStart),i=t.selectionEnd,o=e.value.text,r=n+o.length,s=i+o.length;t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,s),this.restore(t,r,s,e)},Fd.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},Fd.prototype.destroy=function(){this.removeEventListener()};var jd=Fd;function Fd(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}zd.prototype.initialize=function(){this.formatTags=Ts,this.listTags=Ls,this.selectionTags=Os},zd.prototype.wireEvents=function(){this.observer.on(zs,this.editorKeyDown,this),this.observer.on(Ks,this.editorKeyUp,this),this.observer.on(Xs,this.onPropertyChanged,this)},zd.prototype.unwireEvents=function(){this.observer.off(zs,this.editorKeyDown),this.observer.off(Ks,this.editorKeyUp),this.observer.off(Xs,this.onPropertyChanged)},zd.prototype.onPropertyChanged=function(e){this.observer.notify(Gs,e)},zd.prototype.editorKeyDown=function(e){this.observer.notify(u,e)},zd.prototype.editorKeyUp=function(e){this.observer.notify(Ws,e)},zd.prototype.execCommand=function(e,t,n,i,o,r){switch(e.toLocaleLowerCase()){case"lists":this.observer.notify(yd,{subCommand:t,event:n,callBack:i});break;case"formats":this.observer.notify(Vs,{subCommand:t,event:n,callBack:i});break;case"actions":this.observer.notify(_s,{subCommand:t,event:n,callBack:i});break;case"style":case"effects":case"casing":this.observer.notify(Cd,{subCommand:t,event:n,callBack:i});break;case"links":case"images":this.observer.notify(Nd,{subCommand:t,event:n,callBack:i,item:r});break;case"table":"createtable"===t.toString().toLocaleLowerCase()&&this.observer.notify(Sd,{subCommand:t,item:r,event:n,callBack:i});break;case"clear":this.observer.notify(Ed,{subCommand:t,event:n,callBack:i});break;case"inserttext":this.observer.notify(Td,{subCommand:t,event:n,callBack:i,value:{text:r}})}},zd.prototype.destroy=function(){this.observer.notify(r,{}),this.unwireEvents()};var qd=zd;function zd(e){this.initialize(),j.extend(this,this,e,!0),this.observer=new j.Observer(this),this.markdownSelection=new pd,this.listObj=new Od({parent:this,syntax:this.listTags}),this.formatObj=new kd({parent:this,syntax:this.formatTags}),this.undoRedoManager=new Md(this,e.options),this.mdSelectionFormats=new xd({parent:this,syntax:this.selectionTags}),this.linkObj=new Rd(this),this.tableObj=new Id({parent:this,syntaxTag:{Formats:this.formatTags,List:this.listTags}}),this.clearObj=new Pd(this),this.insertTextObj=new jd(this),this.wireEvents()}_d=function(e,t){return(_d=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};(function(e,t){function n(){this.constructor=e}_d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(Wd,Vd=bd),Wd.prototype.initialize=function(){this.keyConfig=ws,this.formatTags=Ts,this.listTags=Ls,this.selectionTags=Os},Wd.prototype.updateFormatter=function(e,t,n){e&&(this.editorManager=new qd({element:e,formatTags:this.formatTags,listTags:this.listTags,selectionTags:this.selectionTags,options:n}))};var _d,Vd,Qd=Wd;function Wd(e){var t=Vd.call(this)||this;return t.initialize(),j.extend(t,t,e,!0),e&&t.element&&t.updateFormatter(t.element,document,e.options),t}Gd.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.isDestroyed=!0)},Gd.prototype.addEventListener=function(){this.parent.isDestroyed||(this.saveSelection=new pd,this.parent.on(Q,this.instantiateRenderer,this),this.parent.on(n,this.render,this),this.parent.on(te,this.onPropertyChanged,this),this.parent.on(ee,this.onToolbarClick,this),this.parent.on(o,this.destroy,this),this.parent.on(nt,this.selectAll,this),this.parent.on(ot,this.getSelectedHtml,this),this.parent.on(Qe,this.onSelectionSave,this),this.parent.on(We,this.onSelectionRestore,this),this.parent.on(ht,this.updateReadOnly,this))},Gd.prototype.updateReadOnly=function(){this.parent.readonly?(this.parent.contentModule.getEditPanel().setAttribute("readonly","readonly"),j.addClass([this.parent.element],Vi)):(this.parent.contentModule.getEditPanel().removeAttribute("readonly"),j.removeClass([this.parent.element],Vi))},Gd.prototype.onSelectionSave=function(){var e=this.parent.contentModule.getEditPanel();this.saveSelection.save(e.selectionStart,e.selectionEnd)},Gd.prototype.onSelectionRestore=function(e){this.contentRenderer.getEditPanel().focus();var t=this.parent.contentModule.getEditPanel();this.saveSelection.restore(t)},Gd.prototype.onToolbarClick=function(e){var t=e.item,n=this.parent.contentModule.getEditPanel(),i=("Formats"!==t.command&&n.focus(),n.selectionStart),o=n.selectionEnd,r=n.value.substring(i,o);switch(t.subCommand){case"Maximize":this.parent.notify(de,{args:e});break;case"Minimize":this.parent.notify(ce,{args:e});break;case"CreateLink":this.parent.notify(Ee,{member:"link",args:e,text:r,module:"Markdown"});break;case"Image":this.parent.notify(De,{member:"image",args:e,text:r,module:"Markdown"});break;case"CreateTable":var s={headingText:this.parent.localeObj.getConstant("TableHeadingText"),colText:this.parent.localeObj.getConstant("TableColText")};this.parent.formatter.process(this.parent,e,e.originalEvent,s);break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}},Gd.prototype.instantiateRenderer=function(){this.renderFactory.addRenderer(m.RenderType.Content,new ql(this.parent))},Gd.prototype.removeEventListener=function(){this.parent.off(n,this.render),this.parent.off(te,this.onPropertyChanged),this.parent.off(o,this.destroy),this.parent.off(ee,this.onToolbarClick),this.parent.off(Q,this.instantiateRenderer),this.parent.off(nt,this.selectAll),this.parent.off(ot,this.getSelectedHtml),this.parent.off(Qe,this.onSelectionSave),this.parent.off(We,this.onSelectionRestore),this.parent.off(ht,this.updateReadOnly)},Gd.prototype.render=function(){this.contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content);var e=this.contentRenderer.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};j.isNullOrUndefined(this.parent.formatter)?this.parent.formatter=new Qd({element:e,options:t}):this.parent.formatter.updateFormatter(e,this.contentRenderer.getDocument(),t),this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new ud(this.parent)),this.parent.notify($,{})},Gd.prototype.onPropertyChanged=function(e){var t;j.isNullOrUndefined(e.newProp.formatter)||(e=this.contentRenderer.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer},this.parent.formatter.updateFormatter(e,this.contentRenderer.getDocument(),t))},Gd.prototype.getModuleName=function(){return"markdownEditor"},Gd.prototype.selectAll=function(){this.parent.formatter.editorManager.markdownSelection.setSelection(this.parent.contentModule.getEditPanel(),0,this.parent.contentModule.getEditPanel().value.length)},Gd.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()))};var Kd=Gd;function Gd(e,t){this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1}Xd=function(e,t){return(Xd=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};(function(e,t){function n(){this.constructor=e}Xd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})($d,Yd=bd),$d.prototype.initialize=function(){this.keyConfig=ks},$d.prototype.updateFormatter=function(e,t,n,i){e&&t&&(this.editorManager=new ul({document:t,editableElement:e,options:n,formatPainterSettings:i}))};var Xd,Yd,Jd=$d;function $d(e){var t=Yd.call(this)||this;return t.initialize(),j.extend(t,t,e,!0),t.currentDocument&&t.element&&t.updateFormatter(t.element,t.currentDocument,e.options,e.formatPainterSettings),t}ec.prototype.addEventListener=function(){this.parent.on(X,this.onRefreshHandler,this),this.parent.on(o,this.removeEventListener,this)},ec.prototype.removeEventListener=function(){this.toolbarStatus=null,this.prevToolbarStatus=null,this.parent.off(X,this.onRefreshHandler),this.parent.off(o,this.removeEventListener)},ec.prototype.onRefreshHandler=function(e){var t,n,i;this.parent.readonly||(t=[],n=[],i=[],this.parent.fontSize.items.forEach(function(e){t.push(e.value)}),this.parent.fontFamily.items.forEach(function(e){n.push(e.value)}),this.parent.format.types.forEach(function(e){i.push(e.value.toLocaleLowerCase())}),this.toolbarStatus=bl.get(this.parent.contentModule.getDocument(),this.parent.contentModule.getEditPanel(),i,t,n,e.documentNode),e=JSON.stringify(this.toolbarStatus),this.parent.notify(J,this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==e&&(this.parent.notify(Wt,{html:JSON.parse(e),markdown:null}),this.prevToolbarStatus=JSON.parse(e)))};var Zd=ec;function ec(e){this.parent=e,this.toolbarStatus=this.prevToolbarStatus=Is(),this.addEventListener()}nc.prototype.addEventListener=function(){this.parent.on(Pt,this.enableXhtmlValidation,this),this.parent.on(o,this.removeEventListener,this)},nc.prototype.removeEventListener=function(){this.parent.off(Pt,this.enableXhtmlValidation),this.parent.off(o,this.removeEventListener)},nc.prototype.enableXhtmlValidation=function(){this.parent.enableXhtml&&(j.isNullOrUndefined(this.parent.inputElement)?this.currentElement=this.parent.element:this.currentElement=this.parent.inputElement,this.clean(this.currentElement),this.ImageTags(),this.removeTags(),this.RemoveUnsupported(),this.currentElement.innerHTML=this.selfEncloseValidation(this.currentElement.innerHTML,("\n"===this.currentElement.innerText?this.currentElement.innerText:this.currentElement.innerText.trim()).length),this.parent.setProperties({value:this.currentElement.innerHTML},!0))},nc.prototype.selfEncloseValidation=function(e,t){0===t&&e.indexOf("table")<0&&e.indexOf("img")<0&&e.includes("&nbsp;")&&((t=e.split("&nbsp;"))[t.length-1]="&#8203;"+t[t.length-1],e=t.join("")),e=e.replace(/<br>/g,"<br/>").replace(/<hr>/g,"<hr/>").replace(/ /g," ");for(var n,i=[],o=[/<img(.*?)>/gi,/<area(.*?)>/gi,/<base(.*?)>/gi,/<col (.*?)>/gi,/<embed(.*?)>/gi,/<input(.*?)>/gi,/<link(.*?)>/gi,/<meta(.*?)>/gi,/<param(.*?)>/gi,/<source(.*?)>/gi,/<track(.*?)>/gi,/<wbr(.*?)>/gi],r=0;r<o.length;r++){for(n=o[r].exec(e);null!==n;)i.push(n[0].toString()),n=o[r].exec(e);for(var s=i.slice(0),a=0;a<i.length;a++)-1!==i[a].indexOf("/")&&i[a].lastIndexOf("/")===i[a].length-2||(i[a]=i[a].substr(0,i[a].length-1)+" /"+i[a].substr(i[a].length-1,i[a].length));for(var l=0;l<=i.length-1;l++)e=e.replace(s[l],i[l])}return e},nc.prototype.clean=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];8===n.nodeType||"V:IMAGE"===n.nodeName?(e.removeChild(n),t--):1===n.nodeType&&this.clean(n)}return this.currentElement.innerHTML},nc.prototype.ImageTags=function(){for(var e=this.currentElement.querySelectorAll("IMG"),t=e.length-1;0<=t;t--)e[t].hasAttribute("alt")||e[t].setAttribute("alt","")},nc.prototype.removeTags=function(){for(var e=[["br","ul"],["br","ol"],["table","span"],["div","span"],["p","span"]],t=0;t<e.length;t++)this.RemoveElementNode(e[t][0],e[t][1])},nc.prototype.RemoveElementNode=function(e,t){for(var n=this.currentElement.querySelectorAll(t),i=0;i<n.length;i++)for(var o=n[i].querySelectorAll(e),r=o.length;0<r;r--)j.detach(o[r-1])},nc.prototype.RemoveUnsupported=function(){for(var e=this.currentElement.querySelectorAll("u"),t=e.length-1;0<=t;t--){var n=this.parent.createElement("span");n.style.textDecoration="underline",n.innerHTML=e[t].innerHTML,e[t].parentNode.insertBefore(n,e[t]),j.detach(e[t])}for(var i=this.currentElement.querySelectorAll("strong"),t=i.length-1;0<=t;t--){var o=this.parent.createElement("b");o.innerHTML=i[t].innerHTML,i[t].parentNode.insertBefore(o,i[t]),j.detach(i[t])}for(var r=["language","role","target","contenteditable","cellspacing","cellpadding","border","valign","colspan"],t=0;t<=r.length;t++)this.RemoveAttributeByName(r[t])},nc.prototype.RemoveAttributeByName=function(e){if(null!==this.currentElement.firstChild&&3!==this.currentElement.firstChild.nodeType)for(var t=0;t<this.currentElement.childNodes.length;t++){var n=this.currentElement.childNodes[t];if(3!==n.nodeType&&"TABLE"!==n.nodeName&&"TBODY"!==n.nodeName&&"THEAD"!==n.nodeName&&"TH"!==n.nodeName&&"TR"!==n.nodeName&&"TD"!==n.nodeName&&(n.hasAttribute(e)&&n.removeAttribute(e),n.hasChildNodes()))for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(3!==o.nodeType&&"TABLE"!==o.nodeName&&"TBODY"!==o.nodeName&&"THEAD"!==o.nodeName&&"TH"!==o.nodeName&&"TR"!==o.nodeName&&"TD"!==o.nodeName&&o.hasAttribute(e)&&!o.classList.contains("e-mention-chip")&&o.removeAttribute(e),o.hasChildNodes())for(var r=0;r<o.childNodes.length;r++)3!==o.childNodes[r].nodeType&&"TABLE"!==o.childNodes[r].nodeName&&"TBODY"!==o.childNodes[r].nodeName&&"THEAD"!==o.childNodes[r].nodeName&&"TH"!==o.childNodes[r].nodeName&&"TR"!==o.childNodes[r].nodeName&&"TD"!==o.childNodes[r].nodeName&&o.childNodes[r].hasAttribute(e)&&o.childNodes[r].removeAttribute(e)}}};var tc=nc;function nc(e){this.parent=e,this.addEventListener()}k.prototype.destroy=function(){this.isDestroyed||(this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null),this.removeEventListener(),this.locator=null,this.contentRenderer=null,this.renderFactory=null,this.toolbarUpdate=null,this.nodeSelectionObj=null,this.isCopyAll=null,0<this.rangeCollection.length&&(this.rangeCollection=[]),this.rangeElement&&(this.rangeElement=null),this.oldRangeElement&&(this.oldRangeElement=null),this.deleteRangeElement&&(this.deleteRangeElement=null),this.deleteOldRangeElement&&(this.deleteOldRangeElement=null),this.saveSelection&&(this.saveSelection=null),this.xhtmlValidation&&(this.xhtmlValidation=null),this.isDestroyed=!0)},k.prototype.sanitizeHelper=function(e){return e=Pr(e,this.parent)},k.prototype.addEventListener=function(){this.parent.isDestroyed||(this.nodeSelectionObj=new gl(this.parent.inputElement),this.parent.on(Q,this.instantiateRenderer,this),this.parent.on(Z,this.onToolbarClick,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(ie,this.onKeyUp,this),this.parent.on(n,this.render,this),this.parent.on(te,this.onPropertyChanged,this),this.parent.on(o,this.destroy,this),this.parent.on(nt,this.selectAll,this),this.parent.on(it,this.selectRange,this),this.parent.on(ot,this.getSelectedHtml,this),this.parent.on(Qe,this.onSelectionSave,this),this.parent.on(We,this.onSelectionRestore,this),this.parent.on(ht,this.updateReadOnly,this),this.parent.on(st,this.onPaste,this),this.parent.on(_,this.isTableClassAdded,this),this.parent.on(Nn,this.onHandleFontsizeChange,this))},k.prototype.updateReadOnly=function(){this.parent.readonly?(j.attributes(this.parent.contentModule.getEditPanel(),{contenteditable:"false"}),j.addClass([this.parent.element],Vi)):(j.attributes(this.parent.contentModule.getEditPanel(),{contenteditable:"true"}),j.removeClass([this.parent.element],Vi))},k.prototype.onSelectionSave=function(){var e=this.contentRenderer.getDocument(),t=this.nodeSelectionObj.getRange(e);this.saveSelection=this.nodeSelectionObj.save(t,e)},k.prototype.onSelectionRestore=function(e){this.parent.isBlur=!1,this.contentRenderer.getEditPanel().focus({preventScroll:!0}),!j.isNullOrUndefined(e.items)&&!e.items||j.isNullOrUndefined(this.saveSelection)||this.saveSelection.restore()},k.prototype.isTableClassAdded=function(){for(var e=this.parent.inputElement.querySelectorAll("table"),t=0;t<e.length;t++)e[t].classList.contains("e-rte-table")||e[t].classList.contains("e-rte-paste-table")||e[t].classList.contains("e-rte-custom-table")||e[t].classList.add("e-rte-table")},k.prototype.onHandleFontsizeChange=function(e){var t,n,i,o,r,s,e=e.args,a={name:"dropDownSelect",item:{command:"Font",subCommand:"FontSize"}},l=this.parent.fontSize.items,d=(n=this.parent.toolbarModule&&this.parent.toolbarModule.dropDownModule&&this.parent.toolbarModule.dropDownModule.fontSizeDropDown&&!j.isNullOrUndefined(this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent)&&""!==this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent?this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent:(r=void 0,r=(d=this.parent.contentModule.getDocument().getSelection())&&d.focusNode&&d.focusNode.parentElement?document.defaultView.getComputedStyle(d.focusNode.parentElement,null).getPropertyValue("font-size"):this.parent.fontSize.width,d=(r=j.isNullOrUndefined(r)?this.parent.fontSize.width:r).match(/^([\d.]+)(\D+)$/),t=parseInt(d[1],10),r=d[2],d=(d=l[1].value.match(/^([\d.]+)(\D+)$/))[2]===r?l.findIndex(function(e){e=e.value;return parseInt(e,10)>=t}):(i=this.convertFontSize(t,r,d[2]),l.findIndex(function(e){e=e.value;return parseInt(e,10)>=i})),l[d].text),l.findIndex(function(e){return e.text===("Font Size"===n?"Default":n)}));"increase-fontsize"===e.action&&-1!==d?d>=l.length-1?((s=l[d].value.match(/^([\d.]+)(\D+)$/))&&(o=parseInt(s[1],10),r=s[2],s=o%10==0?10*Math.ceil((o+1)/10):10*Math.ceil(o/10),a.item.value=s.toLocaleString()+r,a.item.text=s.toLocaleString()+" "+r),this.parent.fontSize.items.push(a.item)):(a.item.value=l[d+1].value,a.item.text=l[d+1].text):"decrease-fontsize"===e.action&&-1!==d&&0<d?(a.item.value=l[d-1].value,a.item.text=l[d-1].text):0<=d&&d<l.length&&l[d]&&(a.item.value=l[d].value,a.item.text=l[d].text),this.parent.formatter.process(this.parent,a,e)},k.prototype.convertFontSize=function(e,t,n){return-1===yn.indexOf(t)&&-1===yn.indexOf(n)||(t="px"),e*Cn[t][n]},k.prototype.onKeyUp=function(e){var e=e.args,t=this.parent.getRange(),n=new RegExp("","g"),i=t.startContainer===t.endContainer&&t.startOffset===t.endOffset&&1===t.startOffset&&1===t.startContainer.textContent.length&&8203===t.startContainer.textContent.charCodeAt(0)&&0===t.startContainer.textContent.replace(n,"").length,o=!1;if(t.startContainer===t.endContainer&&t.startOffset===t.endOffset&&t.startContainer!==this.parent.inputElement&&0!==t.startOffset&&(r=3===t.startContainer.nodeType?t.startContainer:t.startContainer.childNodes[t.startOffset-1],o=16===e.keyCode&&8203===r.textContent.charCodeAt(0)&&!j.isNullOrUndefined(r.previousSibling)&&"false"===r.previousSibling.contentEditable),!this.isCopyAll){var r=!1;if([8,9,13,17,18,20,27,37,38,39,40,44,45,46,91,112,113,114,115,116,117,118,119,120,121,122,123].indexOf(e.keyCode)<0&&!e.shiftKey&&!e.ctrlKey&&!e.altKey&&!i&&!o){l=t.startOffset,"#text"===t.startContainer.nodeName?t.startContainer.parentElement!==this.parent.inputElement?t.startContainer.parentElement.classList.add("currentStartMark"):r=!0:t.startContainer.classList.add("currentStartMark"),8203===t.startContainer.textContent.charCodeAt(0)&&(e=t.startContainer.textContent.length,i=t.startOffset,this.removeZeroWidthSpaces(t.startContainer,n),l=0===i?i:i-(e-t.startContainer.textContent.length),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),t.startContainer,l));var o=this.parent.inputElement.innerHTML.length,i=this.parent.inputElement.innerHTML.replace(n,"").length,s=t.startContainer;if(i<o&&!r){0!==s.textContent.trim().length&&s.previousSibling&&((e=document.createElement("span")).className="tempSpan",t.insertNode(e));for(var a=this.parent.inputElement.firstChild;!j.isNullOrUndefined(a);)a=("#text"===a.nodeName||0<a.textContent.replace(n,"").trim().length&&a.textContent.includes("")&&this.removeZeroWidthSpaces(a,n),a.nextElementSibling);var l,i=this.parent.inputElement.querySelector(".tempSpan"),d=(i&&i.previousSibling&&0!==s.textContent.trim().length&&(s=i.previousSibling,l=i.previousSibling.textContent.length,i.parentNode.removeChild(i),0),this.parent.inputElement.querySelector(".currentStartMark").childNodes);if(1<d.length)for(var c,p=0;p<d.length;p++)"#text"===d[p].nodeName&&0===d[p].textContent.length&&(j.detach(d[p]),p--),j.isNullOrUndefined(d[p])||s.textContent.replace(n,"")!==d[p].textContent||(c=l<=s.textContent.indexOf(""),l=1<s.textContent.length?s.textContent===d[p].textContent||c?l:l-(s.textContent.length-s.textContent.replace(n,"").length):s.textContent.length,s=d[p]);else 1===d.length&&s.textContent.replace(n,"")===d[0].textContent&&(s=d[0]);this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),s,l)}o=this.parent.inputElement.querySelector(".currentStartMark");j.isNullOrUndefined(o)||(o.classList.remove("currentStartMark"),""===o.getAttribute("class").trim()&&o.removeAttribute("class")),!j.isNullOrUndefined(t.startContainer.previousSibling)&&!j.isNullOrUndefined(t.startContainer.previousSibling.parentElement)&&t.startContainer.parentElement===t.startContainer.previousSibling.parentElement&&8203===t.startContainer.previousSibling.textContent.charCodeAt(0)&&t.startContainer.previousSibling.textContent.length<=1&&(t.startContainer.previousSibling.textContent=t.startContainer.previousSibling.textContent.replace(n,"")),8203===t.endContainer.textContent.charCodeAt(t.endOffset)&&(l=t.startOffset,t.endContainer.textContent=t.endContainer.textContent.replace(n,""),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),t.startContainer,l))}}},k.prototype.removeZeroWidthSpaces=function(e,t){var n=this;e.nodeType===Node.TEXT_NODE?null!==e.textContent&&(e.textContent=e.textContent.replace(t,"")):e.childNodes.forEach(function(e){n.removeZeroWidthSpaces(e,t)})},k.prototype.onKeyDown=function(t){var e,n=this,i=(t.args.ctrlKey&&65===t.args.keyCode?this.isCopyAll=!0:this.isCopyAll=!1,t.args);if(1<this.parent.inputElement.querySelectorAll(".e-cell-select").length&&(8===i.keyCode||32===i.keyCode||13===i.keyCode))this.tableSelectionKeyAction(t);else{var o,r,s;if("chrome"===j.Browser.info.name&&(e=this.parent.getRange(),this.backSpaceCleanup(t,e),this.deleteCleanup(t,e)),9===i.keyCode&&this.parent.enableTabKey&&(this.parent.formatter.saveData(t),!j.isNullOrUndefined(i.target)&&j.isNullOrUndefined(j.closest(i.target,".e-rte-toolbar"))&&(a=this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()),"LI"===(l=this.nodeSelectionObj.getParentNodeCollection(a))[0].nodeName||j.closest(l[0],"li")||j.closest(l[0],"table")||(i.preventDefault(),l=this.contentRenderer.getDocument().getSelection().getRangeAt(0),s=this.parent.formatter.editorManager.domNode.blockNodes(),"BR"===this.parent.enterKey?l.startOffset!==l.endOffset&&0===l.startOffset?(a=this.nodeSelectionObj.save(a,this.contentRenderer.getDocument()),this.parent.formatter.editorManager.domNode.setMarker(a),s=this.parent.formatter.editorManager.domNode.blockNodes(),this.parent.formatter.editorManager.domNode.convertToBlockNodes(s,!1),this.marginTabAdd(i.shiftKey,s),(a=this.parent.formatter.editorManager.domNode.saveMarker(a)).restore()):(la.Insert(this.contentRenderer.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;"),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()))):i.shiftKey?0<this.rangeCollection.length&&4===this.rangeCollection[this.rangeCollection.length-1].startContainer.textContent.length?(a=this.rangeCollection[this.rangeCollection.length-1].startContainer,this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(),a,a,0,a.textContent.length),la.Insert(this.contentRenderer.getDocument(),document.createTextNode("")),this.rangeCollection.pop()):this.marginTabAdd(i.shiftKey,s):l.startOffset!==l.endOffset&&0===l.startOffset?this.marginTabAdd(i.shiftKey,s):(la.Insert(this.contentRenderer.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;"),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()))))),this.parent.formatter.saveData(t)),("space"===t.args.action||"enter"===t.args.action||13===t.args.keyCode||/[^\w\s\\/\\.\\:]/g.test(t.args.key))&&(this.spaceLink(t.args),"HTML"===this.parent.editorMode)&&!this.parent.readonly){var a=this.parent.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length,l=this.parent.getSelection().length;if(!(-1===this.parent.maxLength||a-l+1<=this.parent.maxLength||13!==t.args.keyCode))return void t.args.preventDefault();this.parent.notify(mt,{args:t.args}),Us(this.parent.contentModule.getDocument(),this.parent.inputElement)}"space"!==t.args.action||(a=(s=this.parent.getRange()).startContainer.textContent.slice(0,s.startOffset),o=this.isOrderedList(a),l=this.isUnOrderedList(a),a=!1,a=o||l?this.hasMultipleTextNode(s):a)||!(o&&!l||l&&!o)||(s={cancel:!(r={callBack:null,event:t.args,name:"keydown-handler",enterKey:this.parent.enterKey,shiftEnterKey:this.parent.shiftEnterKey}),item:{command:"Lists",subCommand:o?"OL":"UL"},name:"actionBegin",originalEvent:t.args,requestType:o?"OL":"UL"},this.parent.trigger(Le,s,function(e){e.cancel||(n.parent.formatter.editorManager.observer.notify($s,r),n.parent.trigger(ke,{editorMode:n.parent.editorMode,elements:n.parent.formatter.editorManager.domNode.blockNodes(),event:t.args,name:ke,range:n.parent.getRange(),requestType:o?"OL":"UL"}))})),"chrome"!==j.Browser.info.name||(j.isNullOrUndefined(this.rangeElement)||j.isNullOrUndefined(this.oldRangeElement))&&(j.isNullOrUndefined(this.deleteRangeElement)||j.isNullOrUndefined(this.deleteOldRangeElement))||"TD"===e.startContainer.parentElement.tagName||"TH"===e.startContainer.parentElement.tagName||(this.rangeElement=null,this.oldRangeElement=null,this.deleteRangeElement=null,this.deleteOldRangeElement=null,this.isImageDelete||i.preventDefault(),i.preventDefault())}this.parent.autoResize()},k.prototype.isOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!j.isNullOrUndefined(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},k.prototype.isUnOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[*]$/,/^[-]$/];if(!j.isNullOrUndefined(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},k.prototype.hasMultipleTextNode=function(e){if(e&&e.startContainer&&e.startContainer.parentNode){var t=e.startContainer.parentNode;if(e.startContainer.previousElementSibling&&e.startContainer.previousElementSibling.classList.contains("e-mention-chip")&&!e.startContainer.previousElementSibling.isContentEditable)return!0;if("BR"===this.parent.enterKey||j.closest(t,"table"))return!1;for(var n=t.childNodes,i=[],o=0;o<n.length;o++){var r=n[o];if(r&&r.nodeType===Node.TEXT_NODE&&(i.push(r),1<i.length))return!0}}return!1},k.prototype.backSpaceCleanup=function(e,t){var n=!1,i=!0,o=(j.isNullOrUndefined(t.startContainer.previousSibling)||"SPAN"!==t.startContainer.previousSibling.nodeName||(i="false"!==t.startContainer.previousSibling.contentEditable),"#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer),r=!j.closest("#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,"li")||"li"!==o.nodeName&&j.isNullOrUndefined(o.previousSibling);if("Backspace"===e.args.code&&8===e.args.keyCode&&0===t.startOffset&&0===t.endOffset&&0===this.parent.getSelection().length&&0<t.startContainer.textContent.length&&"TD"!==t.startContainer.parentElement.tagName&&"TH"!==t.startContainer.parentElement.tagName&&i&&r&&(this.parent.formatter.editorManager.domNode.isBlockNode(o)||j.isNullOrUndefined(o.previousSibling)||"BR"!==o.previousSibling.nodeName)&&(j.isNullOrUndefined(t.startContainer.previousSibling)||"BR"!==t.startContainer.previousSibling.nodeName)){if(this.rangeElement=this.getRootBlockNode(t.startContainer),"OL"===this.rangeElement.tagName||"UL"===this.rangeElement.tagName){i=this.getRangeLiNode(t.startContainer);i.previousElementSibling&&0<i.previousElementSibling.childElementCount&&(this.oldRangeElement="BR"===i.previousElementSibling.lastElementChild.nodeName?i.previousElementSibling:i.previousElementSibling.lastChild,!j.isNullOrUndefined(i.lastElementChild)&&"BR"!==i.lastElementChild.nodeName&&j.isNullOrUndefined(i.lastElementChild.previousSibling)&&"#text"!==i.lastChild.nodeName?(this.rangeElement=i.lastElementChild,n=!0):this.rangeElement=i)}else{if(this.rangeElement===this.parent.inputElement||"TABLE"===this.rangeElement.tagName||!j.isNullOrUndefined(this.rangeElement.previousElementSibling)&&"TABLE"===this.rangeElement.previousElementSibling.tagName)return;this.oldRangeElement=this.rangeElement.previousElementSibling}r=this.parent.formatter.editorManager.domNode.blockNodes();if(!j.isNullOrUndefined(r[0])&&t.collapsed&&0===t.startOffset&&0===t.endOffset&&""!==r[0].style.marginLeft&&(r[0].style.marginLeft=parseInt(r[0].style.marginLeft,10)<=20?"":parseInt(r[0].style.marginLeft,10)-20+"px"),!j.isNullOrUndefined(this.oldRangeElement)||!j.isNullOrUndefined(r[0].previousSibling))if(r[0].previousSibling){var s=r[0].previousSibling,o=r[0];if(s.textContent.trim()){"BR"===s.lastChild.nodeName&&s.removeChild(s.lastChild);for(var i=this.findLastTextPosition(s),t=i.offset,r=i.node,a=Array.from(o.childNodes),l=0;l<a.length;l++)s.appendChild(a[l].cloneNode(!0));this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),r,t),o.parentNode.removeChild(o),e.args.preventDefault()}else s.parentNode.removeChild(s)}else{"OL"!==this.oldRangeElement.tagName&&"UL"!==this.oldRangeElement.tagName||(this.oldRangeElement=this.oldRangeElement.lastElementChild.lastElementChild||this.oldRangeElement.lastElementChild);for(var d=this.oldRangeElement.lastChild||this.oldRangeElement;3!==d.nodeType&&"#text"!==d.nodeName&&"BR"!==d.nodeName&&!j.isNullOrUndefined(d.lastChild);)d=d.lastChild;"IMG"===d.nodeName?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),d.parentElement,d.parentElement.childNodes.length):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),d,d.textContent.length);i=!1;if(this.oldRangeElement&&"#text"!==this.oldRangeElement.nodeName&&1===this.oldRangeElement.querySelectorAll("BR").length&&(r=this.oldRangeElement.querySelector("BR"))&&j.isNullOrUndefined(r.nextSibling)&&(t=r.parentNode,o=this.oldRangeElement.innerHTML,this.parent.formatter.saveData(o),j.detach(r),t)&&0===t.childNodes.length&&(j.detach(t),i=!0),!j.isNullOrUndefined(this.rangeElement)&&this.oldRangeElement!==this.rangeElement&&!i){for(;this.rangeElement.firstChild;)("#text"===this.oldRangeElement.nodeName?this.oldRangeElement.parentElement:this.oldRangeElement).appendChild(this.rangeElement.childNodes[0]);n?j.detach(this.rangeElement.parentElement):j.detach(this.rangeElement),this.oldRangeElement.normalize()}}}},k.prototype.findLastTextPosition=function(e){if(e.nodeType===Node.TEXT_NODE)return{node:e,offset:e.textContent?e.textContent.length:0};for(var t=e.childNodes.length-1;0<=t;t--){var n=this.findLastTextPosition(e.childNodes[t]);if(n)return n}return null},k.prototype.deleteCleanup=function(e,t){var n=!1;if("Delete"===e.args.code&&46===e.args.keyCode&&0!==this.parent.contentModule.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length&&0===this.parent.getSelection().length&&"TD"!==t.startContainer.parentElement.tagName&&"TH"!==t.startContainer.parentElement.tagName){if(this.deleteRangeElement=r=this.getRootBlockNode(t.startContainer),"OL"===this.deleteRangeElement.tagName||"UL"===this.deleteRangeElement.tagName)(o=this.getRangeLiNode(t.startContainer)).nextElementSibling&&0<o.nextElementSibling.childElementCount&&!o.nextElementSibling.querySelector("BR")?j.isNullOrUndefined(o.lastElementChild)?this.deleteRangeElement=o:(this.deleteRangeElement=o.lastElementChild,n=!0):this.deleteRangeElement=this.getRangeElement(o);else if(3===this.deleteRangeElement.nodeType||"TABLE"===this.deleteRangeElement.tagName||!j.isNullOrUndefined(this.deleteRangeElement.nextElementSibling)&&"TABLE"===this.deleteRangeElement.nextElementSibling.tagName)return;var i=!1;if(0<this.deleteRangeElement.querySelectorAll("img").length&&""===this.deleteRangeElement.textContent.trim()&&(i=!0),this.getCaretIndex(t,this.deleteRangeElement)!==this.deleteRangeElement.textContent.length||i)this.deleteRangeElement=null;else if(j.isNullOrUndefined(o)?this.deleteOldRangeElement=this.deleteRangeElement.nextElementSibling:n||!j.isNullOrUndefined(o.nextElementSibling)?this.deleteOldRangeElement=this.getRangeElement(o.nextElementSibling):this.deleteOldRangeElement=r.nextElementSibling,!j.isNullOrUndefined(this.deleteOldRangeElement)){0===t.startOffset&&1===t.endOffset&&"IMG"===this.deleteRangeElement.childNodes[0].nodeName?(this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),this.deleteRangeElement,this.deleteRangeElement,0,1),this.isImageDelete=!0):(this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),this.deleteRangeElement,this.deleteRangeElement.childNodes.length),this.isImageDelete=!1);var i=this.deleteRangeElement.querySelector("BR"),o=this.deleteRangeElement.lastChild,r=void 0;if(o&&(r=o.parentNode),i&&i.classList.contains("e-rte-image-remove-focus"))j.removeClass([i],["e-rte-image-focus"]);else if(i&&o&&"BR"===o.nodeName&&(j.detach(o),j.isNullOrUndefined(r)||0!==r.childNodes.length||j.detach(r),e.args.preventDefault()),!j.isNullOrUndefined(this.deleteRangeElement)&&"OL"!==this.deleteOldRangeElement.tagName&&"UL"!==this.deleteOldRangeElement.tagName&&this.deleteOldRangeElement!==this.deleteRangeElement&&this.parent.contentModule.getEditPanel().contains(this.deleteRangeElement)){for(;this.deleteOldRangeElement.firstChild;)this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);n?j.detach(this.deleteOldRangeElement.parentElement):j.detach(this.deleteOldRangeElement),this.deleteRangeElement.normalize()}else this.deleteRangeElement=null,this.deleteOldRangeElement=null}}},k.prototype.getCaretIndex=function(e,t){var n,i=0;return 0!==this.parent.contentModule.getDocument().getSelection().rangeCount&&((n=e.cloneRange()).selectNodeContents(t),n.setEnd(e.endContainer,e.endOffset),i=n.toString().length),i},k.prototype.getRangeElement=function(e){return e.lastElementChild?"BR"===e.lastElementChild.tagName?e.lastElementChild.previousElementSibling||e:e.lastElementChild:e},k.prototype.getRootBlockNode=function(e){for(;e&&this.parent&&this.parent.inputElement!==e&&e.parentElement!==this.parent.inputElement;)e=e.parentElement;return e},k.prototype.getRangeLiNode=function(e){for(var t=e.parentElement;t!==this.parent.inputElement&&(1!==t.nodeType||"LI"!==t.tagName);)t=t.parentElement;return t},k.prototype.onPaste=function(e){var t=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);if(e.text.match(t)&&!e.isWordPaste){e.args.preventDefault();for(var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=(this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument()),new RegExp(/([^\S]|^)(((https?\:\/\/)))/gi)),i=new RegExp(/([^\S]|^)(((www\.))(\S+))/gi),o=e.text.split("\n"),r="",s=0;s<o.length;s++)if(""===o[s].trim())r+=Ar(this.parent);else{for(var a="",l=!0,d=o[s].split(" "),c=0;c<d.length;c++)""===d[c].trim()?a+=l?"&nbsp;":" ":(l=!1,a+=d[c]+" ");r+=0===s?"<span>"+a.trim()+"</span>":"<p>"+a.trim()+"</p>"}for(var t=this.parent.createElement("div"),p=(t.setAttribute("class","pasteContent"),t.style.display="inline",t.innerHTML=r.replace("&para","&amp;para"),t.querySelectorAll("span, p")),s=0;s<p.length;s++){for(var h=p[s].innerHTML.split(" "),u="",c=0;c<h.length;c++)h[c].match(n)||h[c].match(i)?u+='<a class="e-rte-anchor" href="'+h[c]+'" title="'+h[c]+'" target="_blank" aria-label="'+this.parent.serviceLocator.getService("rteLocale").getConstant("linkAriaLabel")+'">'+h[c]+" </a>":u+=h[c]+" ";p[s].innerHTML=u.trim()}var m=t.childNodes[0];j.isNullOrUndefined(m)||j.isNullOrUndefined(m.childNodes[0])||"SPAN"!==m.nodeName||"A"!==m.childNodes[0].nodeName||(t.innerHTML=t.innerHTML.replace("<span>","").replace("</span>","")),j.isNullOrUndefined(this.parent.pasteCleanupModule)?this.parent.formatter.editorManager.execCommand("insertHTML",null,null,null,t):e.callBack(t.innerHTML)}},k.prototype.spaceLink=function(e){var t=this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()),n=this.nodeSelectionObj.getParentNodeCollection(t),i=t.startContainer.textContent.substr(0,t.endOffset),o=i.split(" "),r=o[o.length-1],i=t.startOffset-(i.length-o[o.length-1].length),r=r.slice(0,i),o=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);n[0]&&"A"!==n[0].nodeName&&r.match(o)&&(i=this.nodeSelectionObj.save(t,this.parent.contentModule.getDocument()),n=-1<r.indexOf("http")?r:"http://"+r,o=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),this.parent.formatter.process(this.parent,{item:{command:"Links",subCommand:"CreateLink"}},e,{url:n,selection:i,selectParent:o,text:r,title:"",target:"_blank"}))},k.prototype.onToolbarClick=function(e){var t,n,i,o=this,r=e.item,s=j.closest(e.originalEvent.target,".e-rte-quick-popup"),a=e.originalEvent.target;if(this.parent.notify(gn,{target:a}),"FormatPainter"!==r.command)if(!s||s.classList.contains("e-rte-inline-popup")||s.classList.contains("e-rte-text-popup")){var l,a=document.getElementById(this.parent.getID()+"_rtelink"),s=document.getElementById(this.parent.getID()+"_image");switch("SourceCode"!==r.subCommand&&"Preview"!==r.subCommand&&"FontColor"!==r.subCommand&&"BackgroundColor"!==r.subCommand&&"NumberFormatList"!==r.subCommand&&"BulletFormatList"!==r.subCommand&&(l=this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument()),j.isNullOrUndefined(a)&&j.isNullOrUndefined(s)&&(t=this.nodeSelectionObj.save(l,this.parent.contentModule.getDocument())),n=this.nodeSelectionObj.getNodeCollection(l),i=this.nodeSelectionObj.getParentNodeCollection(l)),r.subCommand){case"Maximize":this.parent.notify(de,{args:e});break;case"Minimize":this.parent.notify(ce,{args:e});break;case"CreateLink":this.parent.notify(Ee,{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"RemoveLink":this.parent.notify(Se,{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"Print":this.parent.print();break;case"Image":this.parent.notify(De,{member:"image",args:e,selectNode:n,selection:t,selectParent:i});break;case"Audio":this.parent.notify(Me,{member:"audio",args:e,selectNode:n,selection:t,selectParent:i});break;case"Video":this.parent.notify(Be,{member:"video",args:e,selectNode:n,selection:t,selectParent:i});break;case"CreateTable":this.parent.notify(lt,{member:"table",args:e,selection:t});break;case"SourceCode":this.parent.notify(ze,{member:"viewSource",args:e});break;case"Preview":this.parent.notify(_e,{member:"updateSource",args:e});break;case"FontColor":case"BackgroundColor":break;case"File":this.parent.notify(qt,{member:"fileManager",args:e,selectNode:n,selection:t,selectParent:i});break;case"EmojiPicker":this.parent.notify(an,{member:"emojiPicker",args:e});break;case"ImportWord":this.parent.notify(oe,{});break;case"ExportWord":this.parent.notify(re,{member:"ExportWord",args:e});break;case"ExportPdf":this.parent.notify(re,{member:"ExportPdf",args:e});break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}!j.isNullOrUndefined(this.parent.quickToolbarModule)&&(j.isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar)&&"Image"===r.subCommand||j.isNullOrUndefined(this.parent.quickToolbarModule.audioQTBar)&&"Audio"===r.subCommand||j.isNullOrUndefined(this.parent.quickToolbarModule.videoQTBar)&&"Video"===r.subCommand||j.isNullOrUndefined(this.parent.quickToolbarModule.linkQTBar)&&"CreateLink"===r.subCommand)&&this.parent.notify(Ut,{})}else"SourceCode"!==r.subCommand&&"Preview"!==r.subCommand&&"FontColor"!==r.subCommand&&"BackgroundColor"!==r.subCommand&&(Rs()&&"Images"===r.command&&this.nodeSelectionObj.restore(),l=this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument()),t=this.nodeSelectionObj.save(l,this.parent.contentModule.getDocument()),n=this.nodeSelectionObj.getNodeCollection(l),i=this.nodeSelectionObj.getParentNodeCollection(l)),"Images"===r.command&&this.parent.notify(me,{member:"image",args:e,selectNode:n,selection:t,selectParent:i}),"Audios"===r.command&&this.parent.notify(ge,{member:"audio",args:e,selectNode:n,selection:t,selectParent:i}),"Videos"===r.command&&this.parent.notify(fe,{member:"video",args:e,selectNode:n,selection:t,selectParent:i}),"Links"===r.command&&this.parent.notify(be,{member:"link",args:e,selectNode:n,selection:t,selectParent:i}),"Table"===r.command&&this.parent.notify(ct,{member:"table",args:e,selectNode:n,selection:t,selectParent:i});else 1===e.originalEvent.detail?(clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(function(){o.parent.notify(rn,{member:"formatPainter",args:e})},200)):(clearTimeout(this.clickTimeout),this.parent.notify(sn,{member:"formatPainter",args:e}))},k.prototype.instantiateRenderer=function(){this.parent.iframeSettings.enable?this.renderFactory.addRenderer(m.RenderType.Content,new jl(this.parent)):this.renderFactory.addRenderer(m.RenderType.Content,new zr(this.parent))},k.prototype.removeEventListener=function(){this.parent.off(n,this.render),this.parent.off(te,this.onPropertyChanged),this.parent.off(Z,this.onToolbarClick),this.parent.off(o,this.destroy),this.parent.off(h,this.onKeyDown),this.parent.off(Q,this.instantiateRenderer),this.parent.off(nt,this.selectAll),this.parent.off(it,this.selectRange),this.parent.off(ot,this.getSelectedHtml),this.parent.off(Qe,this.onSelectionSave),this.parent.off(We,this.onSelectionRestore),this.parent.off(ht,this.updateReadOnly),this.parent.off(st,this.onPaste),this.parent.off(_,this.isTableClassAdded)},k.prototype.render=function(){this.contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content);var e,t=this.contentRenderer.getEditPanel(),n={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};j.isNullOrUndefined(this.parent.formatter)?(e=new Jd({currentDocument:this.contentRenderer.getDocument(),element:t,options:n,formatPainterSettings:this.parent.formatPainterSettings}),this.parent.setProperties({formatter:e},!0)):this.parent.formatter.updateFormatter(t,this.contentRenderer.getDocument(),n),this.parent.enableXhtml&&this.parent.notify(Pt,{}),this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new Zd(this.parent)),this.parent.inlineMode.enable&&(j.isNullOrUndefined(this.parent.fontFamily.default)||(t.style.fontFamily=this.parent.fontFamily.default),j.isNullOrUndefined(this.parent.fontSize.default)||(t.style.fontSize=this.parent.fontSize.default)),this.parent.notify($,{})},k.prototype.onPropertyChanged=function(e){var t;j.isNullOrUndefined(e)||j.isNullOrUndefined(e.newProp.toolbarSettings)||j.isNullOrUndefined(e.newProp.toolbarSettings.enable)||(this.toolbarUpdate=new Zd(this.parent)),j.isNullOrUndefined(e.newProp.formatter)||(e=this.contentRenderer.getEditPanel(),t={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer},this.parent.formatter.updateFormatter(e,this.contentRenderer.getDocument(),t))},k.prototype.getModuleName=function(){return"htmlEditor"},k.prototype.selectAll=function(){var e=Dr(this.parent.contentModule.getDocument(),this.parent.contentModule.getEditPanel());0<e.length&&this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),e[0],e[e.length-1],0,e[e.length-1].textContent.length)},k.prototype.selectRange=function(e){this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(),e.range)},k.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString())},k.prototype.tableSelectionKeyAction=function(e){for(var t=e.args,n=this.parent.inputElement.querySelectorAll(".e-cell-select"),i=0;i<n.length;i++){var o=n[i];g([o],[Qi,Ki,Wi]),0===i?(32===t.keyCode?o.innerHTML="&#8203;<br>":o.innerHTML="<br>",this.nodeSelectionObj.setCursorPoint(this.parent.contentModule.getDocument(),o.firstChild,0)):o.innerHTML="<br>"}},k.prototype.marginTabAdd=function(e,t){for(var n=0;n<t.length;n++){var i,o=t[n];o.closest("li")||(o.style.marginLeft?(i=parseInt(o.style.marginLeft,10),e?i-=20:i+=20,o.style.marginLeft=i.toString()+"px","0px"===o.style.marginLeft&&o.removeAttribute("style")):e||(o.style.marginLeft="20px"))}};var ic=k;function k(e,t){this.rangeCollection=[],this.isImageDelete=!1,this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.xhtmlValidation=new tc(e),this.addEventListener(),this.isDestroyed=!1,this.isCopyAll=!1}x.prototype.addEventListener=function(){this.nodeSelectionObj=new gl(this.parent.inputElement),this.parent.isDestroyed||(this.parent.on(ut,this.pasteClean,this),this.parent.on(on,this.setCssClass,this),this.parent.on(o,this.destroy,this),this.parent.on(dt,this.docClick,this))},x.prototype.destroy=function(){this.isDestroyed||(this.fireFoxUploadTime&&(clearTimeout(this.fireFoxUploadTime),this.fireFoxUploadTime=null),this.refreshPopupTime&&(clearTimeout(this.refreshPopupTime),this.refreshPopupTime=null),this.popupCloseTime&&(clearTimeout(this.popupCloseTime),this.popupCloseTime=null),this.failureTime&&(clearTimeout(this.failureTime),this.failureTime=null),this.iframeUploadTime&&(clearTimeout(this.iframeUploadTime),this.iframeUploadTime=null),this.removeEventListener(),this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.destroy(),this.popupObj=null),this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),this.uploadObj=null),this.keepRadioButton&&!this.keepRadioButton.isDestroyed&&(this.keepRadioButton.destroy(),this.keepRadioButton=null),this.cleanRadioButton&&!this.cleanRadioButton.isDestroyed&&(this.cleanRadioButton.destroy(),this.cleanRadioButton=null),this.plainTextRadioButton&&!this.plainTextRadioButton.isDestroyed&&(this.plainTextRadioButton.destroy(),this.plainTextRadioButton=null),this.isDestroyed=!0)},x.prototype.removeEventListener=function(){this.parent.off(ut,this.pasteClean),this.parent.off(on,this.setCssClass),this.parent.off(o,this.destroy),this.parent.off(dt,this.docClick)},x.prototype.pasteClean=function(t){var n,i=this,o={requestType:"Paste",editorMode:this.parent.editorMode,event:t},r=null,e=!1,s=this.parent.insertImageSettings.allowedTypes;if(t.args&&!j.isNullOrUndefined(t.args.clipboardData)&&(r=t.args.clipboardData.getData("text/html")),t.args&&null!==r&&"HTML"===this.parent.editorMode){if(0===r.length){var a=new RegExp(/<\/[a-z][\s\S]*>/i),r=t.args.clipboardData.getData("text/plain");if(this.parent.trigger(Vt,{value:r}),this.isNotFromHtml=""!==r,r=(r=r.replace(/</g,"&lt;")).replace(/>/g,"&gt;"),this.containsHtml=a.test(r),c=t&&t.args.clipboardData&&0<t.args.clipboardData.items.length?null===t.args.clipboardData.items[0].getAsFile()?j.isNullOrUndefined(t.args.clipboardData.items[1])?null:t.args.clipboardData.items[1].getAsFile():t.args.clipboardData.items[0].getAsFile():null){var l=c.name,d=l.substring(l.lastIndexOf("."));if(s.every(function(e){return e.toLowerCase()!==d}))return void t.args.preventDefault()}this.parent.notify(st,{file:c,args:t.args,text:r,callBack:function(e){"object"==typeof(n=e)?i.parent.formatter.editorManager.execCommand("Images","Image",t.args,i.imageFormatting.bind(i,o),"pasteCleanup",n,"pasteCleanupModule"):r=n}}),a.test(r)||((l=this.parent.createElement("div")).innerHTML=this.splitBreakLine(r),r=l.innerHTML,e=!0)}else 0<r.length&&(this.parent.trigger(Vt,{value:r}),this.parent.formatter.editorManager.observer.notify(Js,{args:t.args,text:t.text,allowedStylePropertiesArray:this.parent.pasteCleanupSettings.allowedStyleProps,callBack:function(e,t,n){o.pasteTableSource=n,r=e.trim(),i.cropImageData=t}}));null!==r&&""!==r&&(r=r.replace(/<base[^>]*>/g,"")),this.contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content);for(var c=this.contentRenderer.getDocument(),a=this.nodeSelectionObj.getRange(c),l=(this.saveSelection=this.nodeSelectionObj.save(a,c),this.parent.createElement("div")),p=(l.innerHTML=r,l.querySelectorAll(".e-rte-image-unsupported")),h=0;h<p.length;h++)p[h].setAttribute("alt",this.i10n.getConstant("unsupportedImage")),p[h].classList.remove("e-rte-image-unsupported");r=l.innerHTML;var a=""!==l.textContent||!j.isNullOrUndefined(l.querySelector("img"))||!j.isNullOrUndefined(l.querySelector("table")),c=l.querySelectorAll("img"),u=this.parent.contentModule.getDocument().baseURI;c.forEach(function(e){var t,n=e.getAttribute("src");j.isNullOrUndefined(n)||""===n||(t=-1<n.indexOf("base64")&&-1<n.indexOf("data:")?n.split(";")[0].split("/")[1]:(-1<n.indexOf("http")?new URL(n):new URL(n,u)).pathname.split(".").pop().toLowerCase(),!j.isNullOrUndefined(t)&&s.every(function(e){return t!==e.substring(1).toLowerCase()})&&-1===n.indexOf("blob")&&j.detach(e))}),r=l.innerHTML,this.parent.notify(cn,{value:r,callBack:function(e){r=e}}),this.parent.pasteCleanupSettings.prompt&&!t.isPlainPaste?a&&(t.args.preventDefault(),this.pasteDialog(r,o,e)):this.parent.pasteCleanupSettings.plainText?(t.args.preventDefault(),this.plainFormatting(r,o,e)):this.parent.pasteCleanupSettings.keepFormat||t.isPlainPaste?(t.args.preventDefault(),this.formatting(r,!1,o)):(t.args.preventDefault(),this.formatting(r,!0,o))}},x.prototype.splitBreakLine=function(e){for(var t=e.split("\r\n\r\n"),n="",i="P"===this.parent.enterKey?"<p>":"DIV"===this.parent.enterKey?"<div>":"",o="P"===this.parent.enterKey?"</p>":"DIV"===this.parent.enterKey?"</div>":"<br>",r=0;r<t.length;r++){var s=t[r],s=this.makeSpace(s).replace(/\r\n|\n/g,"<br>");0===r?"BR"===this.parent.enterKey?n+=s+o:n+=s:"BR"===this.parent.enterKey?r===t.length-1?n+=s+o:n+=s+o+o:n+=i+s+o}return n},x.prototype.makeSpace=function(e){var t="";if(""===e)return e;for(var n=e.split(" "),i=0;i<n.length;i++){var o=n[i];""===o?t+="&nbsp;":"\t"===o?t+="&nbsp;&nbsp;&nbsp;&nbsp;":(0<i&&i<n.length&&(t+=" "),t+=o)}return t=(t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/&nbsp;&nbsp;/g,"&nbsp; ")},x.prototype.imgUploading=function(e){var t=e.querySelectorAll(".pasteContent_Img");if(this.parent.insertImageSettings.saveUrl&&0<t.length){for(var n=[],i=[],o=[],r=0;r<t.length;r++)!j.isNullOrUndefined(t[r].getAttribute("src"))&&0<=t[r].getAttribute("src").split(",")[0].indexOf("base64")&&(n.push(t[r].getAttribute("src")),i.push(j.getUniqueID("rte_image")),o.push(t[r]));for(var s=[],r=0;r<n.length;r++)s.push(this.base64ToFile(n[r],i[r]));for(r=0;r<s.length;r++)this.uploadMethod(s[r],o[r]);j.isNullOrUndefined(this.parent.insertImageSettings.path)&&"Blob"===this.parent.insertImageSettings.saveFormat&&this.getBlob(t)}else"Blob"===this.parent.insertImageSettings.saveFormat&&this.getBlob(t);for(var a=e.querySelectorAll(".pasteContent_Img"),r=0;r<a.length;r++)a[r].classList.remove("pasteContent_Img"),""===a[r].getAttribute("class").trim()&&t[r].removeAttribute("class")},x.prototype.getBlob=function(e){for(var t,n=0;n<e.length;n++)!j.isNullOrUndefined(e[n].getAttribute("src"))&&0<=e[n].getAttribute("src").split(",")[0].indexOf("base64")&&(t=URL.createObjectURL(jr(e[n].getAttribute("src"))),e[n].setAttribute("src",t))},x.prototype.toolbarEnableDisable=function(e){this.parent.inlineMode.enable||this.parent.toolbarModule.baseToolbar.toolbarObj.disable(e)},x.prototype.uploadMethod=function(e,t){var n=this,i=(t.style.opacity="0.5",this.parent.createElement("div")),o=(this.parent.rootContainer.appendChild(i),this.parent.createElement("input",{id:this.parent.getID()+"_upload",attrs:{type:"File",name:"UploadFiles"}})),r=this.parent.iframeSettings.enable?-50:-90,i=(this.popupObj=new I.Popup(i,{relateTo:t,height:"85px",width:"300px",offsetY:r,content:o,viewPortElement:this.parent.element,position:{X:"center",Y:"top"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){n.parent.isBlur=!1,n.popupObj.destroy(),j.detach(n.popupObj.element)}}),this.popupObj.element.style.display="none",j.addClass([this.popupObj.element],[fo,go]),j.isNullOrUndefined(this.parent.cssClass)||j.addClass([this.popupObj.element],this.parent.cssClass.replace(/\s+/g," ").trim().split(" ")),1e6<e.size?300:100),r=(this.refreshPopupTime=setTimeout(function(){n.refreshPopup(t,n.popupObj)},i),this.uploadObj=new U.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},cssClass:No,dropArea:this.parent.inputElement,allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),success:function(e){n.popupClose(n.popupObj,n.uploadObj,t,e)},uploading:function(e){n.parent.isServerRendered||n.parent.trigger(Tt,e,function(e){e.cancel?(j.isNullOrUndefined(t)||j.detach(t),j.isNullOrUndefined(n.popupObj.element)||j.detach(n.popupObj.element)):n.parent.inputElement.contentEditable="false"})},beforeUpload:function(e){n.parent.trigger(Ht,e),n.toolbarEnableDisable(!0)},failure:function(e){n.failureTime=setTimeout(function(){n.uploadFailure(t,n.uploadObj,n.popupObj,e)},900)},canceling:function(){n.parent.inputElement.contentEditable="true"," "===t.nextSibling.textContent&&j.detach(t.nextSibling),j.detach(t),n.popupObj.close()},selected:function(e){e.cancel=!0},removing:function(){n.parent.inputElement.contentEditable="true"," "===t.nextSibling.textContent&&j.detach(t.nextSibling),j.detach(t),n.popupObj.close()}}),this.uploadObj.appendTo(this.popupObj.element.childNodes[0]),[{name:e.name,rawFile:e,size:e.size,type:e.type,status:"Ready to Upload",validationMessages:{minSize:"",maxSize:""},statusCode:"1"}]);this.uploadObj.createFileList(r),this.uploadObj.upload(r),this.popupObj.element.getElementsByClassName("e-file-select-wrap")[0].style.display="none",j.detach(this.popupObj.element.querySelector(".e-rte-dialog-upload .e-file-select-wrap"))},x.prototype.uploadFailure=function(e,t,n,i){this.parent&&this.parent.isDestroyed||(this.parent.inputElement.contentEditable="true",j.detach(e),n&&(this.parent.isBlur=!1,n.destroy(),j.isNullOrUndefined(n.element)||j.detach(n.element)),this.parent.trigger(Lt,i),t&&document.body.contains(t.element)&&t.destroy())},x.prototype.popupClose=function(o,r,s,e){var a=this,t=(this.parent.inputElement.contentEditable="true",e.element=s,e.detectImageSource=m.ImageInputSource.Pasted,e.file);"2"===t.statusCode?this.parent.trigger(Ot,e,function(e){if(!j.isNullOrUndefined(a.parent.insertImageSettings.path)){var t=a.parent.insertImageSettings.path+e.file.name;if(!a.parent.inputElement.contains(s)&&s.id)for(var n=a.parent.inputElement.querySelectorAll("#"+s.id),i=0;i<n.length;i++){var o=n[i];o&&o.style&&"0.5"===o.style.opacity&&(o.src=t,o.setAttribute("alt",e.file.name))}else s.src=t,s.setAttribute("alt",e.file.name)}}):"5"===t.statusCode&&this.parent.trigger(kt,e,function(e){j.isNullOrUndefined(e.element.src)||(e.element.src="")}),this.popupCloseTime=setTimeout(function(){if(o&&(a.parent.isBlur=!1,o.destroy(),j.isNullOrUndefined(o.element)||j.detach(o.element)),a.parent.inputElement.contains(s)||!s.id&&!s.alt)s.style.opacity="1";else{var e=s.id?"#"+s.id:'[alt="'+s.alt+'"]';if(e)for(var t=a.parent.inputElement.querySelectorAll(e),n=0;n<t.length;n++){var i=t[n];i&&i.style&&"0.5"===i.style.opacity&&(i.style.opacity="1")}}a.toolbarEnableDisable(!1),r&&document.body.contains(r.element)&&r.destroy()},1500)},x.prototype.refreshPopup=function(e,t){var n=this.parent.iframeSettings.enable?this.parent.element.offsetTop+e.offsetTop:e.offsetTop;this.parent.element.offsetTop+this.parent.element.offsetHeight<n?(t.relateTo=this.parent.inputElement,t.offsetY=this.parent.iframeSettings.enable?-30:-65,t.element.style.display="block"):t&&(t.refreshPosition(e),t.element.style.display="block")},x.prototype.base64ToFile=function(e,t){for(var e=e.split(","),n=e[0].match(/:(.*?);/)[1].split("/")[1],i=atob(e[1]),o=i.length,r=new Uint8Array(o);o--;)r[o]=i.charCodeAt(o);return j.Browser.isIE||-1<navigator.appVersion.indexOf("Edge")?(e=new Blob([r],{type:n}),j.extend(e,{name:t+"."+(j.isNullOrUndefined(n)?"":n)}),e):new File([r],t+"."+(j.isNullOrUndefined(n)?"":n),{type:n})},x.prototype.imageFormatting=function(e,t){j.isNullOrUndefined(t.elements[0].getAttribute("src"))||t.elements[0].classList.add("pasteContent_Img");var n=this.parent.createElement("span"),t=(n.appendChild(t.elements[0]),n.innerHTML),n=(this.contentRenderer=this.renderFactory.getRenderer(m.RenderType.Content),this.contentRenderer.getDocument()),i=this.nodeSelectionObj.getRange(n);this.saveSelection=this.nodeSelectionObj.save(i,n),this.parent.pasteCleanupSettings.prompt?this.pasteDialog(t,e,!1):this.parent.pasteCleanupSettings.plainText?this.plainFormatting(t,e,!1):this.parent.pasteCleanupSettings.keepFormat?this.formatting(t,!1,e):this.formatting(t,!0,e)},x.prototype.radioRender=function(){this.keepRadioButton=new P.RadioButton({label:this.i10n.getConstant("keepFormat"),name:"pasteOption",checked:!0}),this.keepRadioButton.isStringTemplate=!0;var e=this.parent.element.querySelector("#keepFormating"),e=(this.keepRadioButton.appendTo(e),this.cleanRadioButton=new P.RadioButton({label:this.i10n.getConstant("cleanFormat"),name:"pasteOption"}),this.cleanRadioButton.isStringTemplate=!0,this.parent.element.querySelector("#cleanFormat")),e=(this.cleanRadioButton.appendTo(e),this.plainTextRadioButton=new P.RadioButton({label:this.i10n.getConstant("plainText"),name:"pasteOption"}),this.plainTextRadioButton.isStringTemplate=!0,this.parent.element.querySelector("#plainTextFormat"));this.plainTextRadioButton.appendTo(e)},x.prototype.selectFormatting=function(e,t,n,i,o){n?this.formatting(e,!1,t):i?this.formatting(e,!0,t):this.plainFormatting(e,t,o)},x.prototype.pasteDialog=function(i,o,r){var s=this,e={buttons:[{click:function(){var e,t,n;s.dialogObj.isDestroyed||(e=s.parent.element.querySelector("#keepFormating").checked,t=s.parent.element.querySelector("#cleanFormat").checked,s.dialogObj.hide(),n=s.dialogObj,s.dialogRenderObj.close(n),s.dialogObj.destroy(),s.selectFormatting(i,o,e,t,r))},buttonModel:{isPrimary:!0,cssClass:"e-flat "+io,content:this.i10n.getConstant("pasteDialogOk")}},{click:function(){var e;s.dialogObj.isDestroyed||(s.dialogObj.hide(),e=s.dialogObj,s.dialogRenderObj.close(e),s.dialogObj.destroy())},buttonModel:{cssClass:"e-flat "+oo,content:this.i10n.getConstant("pasteDialogCancel")}}],header:this.i10n.getConstant("pasteFormat"),content:this.i10n.getConstant("pasteFormatContent")+'<br/><div><div style="padding-top:24px;"><input type="radio" class="'+eo+'" id="keepFormating"/></div><div style="padding-top:20px;"><input type="radio" class="'+to+'" id="cleanFormat"/></div><div style="padding-top:20px;"><input type="radio" class="'+no+'" id="plainTextFormat"/></div></div>',target:this.parent.element,width:"300px",height:"265px",cssClass:ro,isModal:j.Browser.isDevice,visible:!1},e=(this.dialogObj=this.dialogRenderObj.render(e),this.parent.element.querySelector("#"+this.parent.getID()+"_pasteCleanupDialog"));null!==e&&""!==e.innerHTML&&this.destroyDialog(e),null===e&&(e=this.parent.createElement("div",{id:this.parent.getID()+"_pasteCleanupDialog"}),this.parent.rootContainer.appendChild(e)),this.dialogObj.appendTo(e),this.radioRender(),this.dialogObj.show(),this.setCssClass({cssClass:this.parent.getCssClass()})},x.prototype.updateCss=function(e,t){e&&t.cssClass&&(j.isNullOrUndefined(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},x.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)||j.removeClass([this.popupObj.element],e.oldCssClass),j.addClass([this.popupObj.element],e.cssClass)),this.updateCss(this.dialogObj,e),this.updateCss(this.uploadObj,e),this.updateCss(this.plainTextRadioButton,e),this.updateCss(this.cleanRadioButton,e),this.updateCss(this.keepRadioButton,e)},x.prototype.destroyDialog=function(e){for(var t=this.parent.element.querySelector(".e-rte-dialog-minheight"),n=(j.detach(t),e.children.length),i=0;i<n;i++)j.detach(e.children[0])},x.prototype.docClick=function(e){e=e.args.target;e&&e.classList&&this.dialogObj&&!j.closest(e,"[id='"+this.dialogObj.element.id+"']")&&!e.classList.contains("e-toolbar-item")&&this.dialogObj&&this.dialogObj.hide()},x.prototype.cleanAppleClass=function(e){for(var t=e.querySelectorAll("br.Apple-interchange-newline"),n=0;n<t.length;n++)j.detach(t[n]);return e},x.prototype.formatting=function(t,e,n){for(var i=this,o=this.parent.createElement("div",{className:"pasteContent",styles:"display:inline;"}),e=(this.isNotFromHtml&&this.containsHtml&&(t=this.splitBreakLine(t)),o.innerHTML=t,o=this.cleanAppleClass(o),null!==this.parent.pasteCleanupSettings.deniedTags&&(o=this.deniedTags(o)),(e||null!==this.parent.pasteCleanupSettings.deniedAttrs)&&(o=this.deniedAttributes(o,e)),null!==this.parent.pasteCleanupSettings.allowedStyleProps&&(o=this.allowedStyle(o)),this.saveSelection.restore(),o.innerHTML.split("&").join("&amp;")),r=(o.innerHTML=this.sanitizeHelper(e),o.querySelectorAll("img")),s=0;s<r.length;s++)j.isNullOrUndefined(r[s].getAttribute("src"))||r[s].classList.add("pasteContent_Img"),this.setImageProperties(r[s]);if(this.addTempClass(o),0<o.querySelectorAll("picture").length&&this.processPictureElement(o),""!==o.textContent||!j.isNullOrUndefined(o.querySelector("img"))||!j.isNullOrUndefined(o.querySelector("table"))){var e=this.parent.createElement("div"),a=(e.innerHTML=t,[]);if(!j.isNullOrUndefined(e.querySelector("img"))){for(var l=e.querySelectorAll("img"),d=[],c=[],p=[],s=0;s<l.length;s++)l[s].getAttribute("src")&&0<=l[s].getAttribute("src").split(",")[0].indexOf("base64")&&(d.push(l[s].getAttribute("src")),c.push(j.getUniqueID("rte_image")),p.push(l[s]));for(var h,u=[],s=0;s<d.length;s++)u.push(this.base64ToFile(d[s],c[s])),h={name:u[s].name,rawFile:u[s],size:u[s].size,type:u[s].type,status:"",validationMessages:{minSize:"",maxSize:""},statusCode:"1"},a.push(h)}this.parent.trigger(Qt,{value:o.innerHTML,filesData:a},function(e){t=e.value}),o.innerHTML=this.parent.addAnchorAriaLabel(t),o=this.addTableClass(o,n.pasteTableSource),this.parent.formatter.editorManager.execCommand("inserthtml","pasteCleanup",n,function(e){j.extend(n,{elements:e.elements,imageElements:e.imgElem},!0),i.parent.formatter.onSuccess(i.parent,n)},o,null,null,this.parent.enterKey),this.parent.notify(fn,{}),Us(this.parent.contentModule.getDocument(),this.parent.inputElement),this.removeTempClass(),this.parent.notify(X,{}),this.cropImageHandler(this.parent.inputElement)}},x.prototype.convertBlobToBase64=function(e){for(var r=e.querySelectorAll("img"),t=0;t<r.length;t++)!function(n){var e,i,o;r[n].getAttribute("src")&&r[n].getAttribute("src").startsWith("blob")&&(e=r[n].getAttribute("src"),i=new Image,o=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),t=(e.width=i.width,e.height=i.height,t.drawImage(i,0,0),e.toDataURL("image/png"));r[n].src=t,i.removeEventListener("load",o)},i.src=e,i.addEventListener("load",o))}(t)},x.prototype.cropImageHandler=function(e){var l=this,d=e.querySelectorAll(".e-img-cropped");if(0<d.length)for(var t=0;t<d.length;t++)!function(o){var r,s,a;0<=d[o].getAttribute("src").split(",")[0].indexOf("base64")&&((r=new Image).src=d[o].getAttribute("src"),s=document.createElement("canvas"),a=s.getContext("2d"),r.onload=function(){var e=l.cropImageData[o].goalWidth/r.naturalWidth,t=l.cropImageData[o].goalHeight/r.naturalHeight,n=l.cropImageData[o].cropLength/e,i=l.cropImageData[o].cropTop/t,e=(l.cropImageData[o].goalWidth-l.cropImageData[o].cropLength-l.cropImageData[o].cropR)/e,t=(l.cropImageData[o].goalHeight-l.cropImageData[o].cropTop-l.cropImageData[o].cropB)/t,n=(s.width=e,s.height=t,a.drawImage(r,n,i,e,t,0,0,e,t),s.toDataURL("image/png"));d[o].setAttribute("src",n),d[o].classList.remove("e-img-cropped"),l.imgUploading(l.parent.inputElement),l.parent.iframeSettings.enable&&l.parent.updateValue()})}(t);else!j.isNullOrUndefined(this.parent.insertImageSettings.saveUrl)&&!j.isNullOrUndefined(this.parent.insertImageSettings.path)&&0<this.parent.inputElement.querySelectorAll("img").length&&this.parent.inputElement.querySelectorAll("img")[0].src.startsWith("blob")?(this.convertBlobToBase64(this.parent.inputElement),this.iframeUploadTime=setTimeout(function(){l.imgUploading(l.parent.inputElement),l.parent.iframeSettings.enable&&l.parent.updateValue()},20)):(this.imgUploading(this.parent.inputElement),this.parent.iframeSettings.enable&&this.parent.updateValue())},x.prototype.addTableClass=function(e,t){for(var n=e.querySelectorAll("table"),i=0;i<n.length;i++){var o="FIGURE"===n[i].parentElement.nodeName;0<n[i].classList.length&&n[i].classList.contains("e-rte-custom-table")||(this.parent.pasteCleanupSettings.keepFormat&&t&&!o?n[i].classList.add("e-rte-paste-"+t+"-table"):n[i].classList.contains("e-rte-table")||n[i].classList.add("e-rte-table"),j.isNullOrUndefined(n[i].nextElementSibling)&&n[i].nextSibling&&!n[i].nextSibling.textContent.trim()&&j.detach(n[i].nextSibling))}return e},x.prototype.setImageProperties=function(e){"auto"!==this.parent.insertImageSettings.width&&e.setAttribute("width",this.parent.insertImageSettings.width),"0"!==this.parent.insertImageSettings.minWidth&&0!==this.parent.insertImageSettings.minWidth&&(e.style.minWidth=this.parent.insertImageSettings.minWidth.toString()),null!==this.parent.insertImageSettings.maxWidth&&(e.style.maxWidth=this.parent.getInsertImgMaxWidth().toString()),"auto"!==this.parent.insertImageSettings.height&&e.setAttribute("height",this.parent.insertImageSettings.height),"0"!==this.parent.insertImageSettings.minHeight&&0!==this.parent.insertImageSettings.minHeight&&(e.style.minHeight=this.parent.insertImageSettings.minHeight.toString()),null!==this.parent.insertImageSettings.maxHeight&&(e.style.maxHeight=this.parent.insertImageSettings.maxHeight.toString())},x.prototype.addTempClass=function(e){for(var t=e.children,n=0;n<t.length;n++)t[n].classList.add("pasteContent_RTE")},x.prototype.removeTempClass=function(){for(var e=this.parent.inputElement.querySelectorAll(".pasteContent_RTE"),t=0;t<e.length;t++)e[t].classList.remove("pasteContent_RTE"),""===e[t].getAttribute("class")&&e[t].removeAttribute("class")},x.prototype.sanitizeHelper=function(e){return e=Pr(e,this.parent)},x.prototype.plainFormatting=function(t,n,e){var i=this,o=this.parent.createElement("div",{className:"pasteContent",styles:"display:inline;"});if(o.innerHTML=t,this.detachInlineElements(o),this.getTextContent(o),""!==o.textContent.trim()){if(!j.isNullOrUndefined(o.firstElementChild)&&"BR"!==o.firstElementChild.tagName){var r=o.firstElementChild;if(!j.isNullOrUndefined(o.firstElementChild)){for(var s=this.parent.createElement("span"),a=0,l=0;a<r.childNodes.length;a++,l++){if("#text"===r.childNodes[a].nodeName)s.appendChild(r.childNodes[a]),o.insertBefore(s,o.firstElementChild);else{if("#text"===r.childNodes[a].nodeName||0!==l)break;for(var d=0;d<r.childNodes[a].childNodes.length;d++)s.appendChild(r.childNodes[a].childNodes[d]),o.insertBefore(s,o.firstElementChild),d--}a--}r.hasChildNodes()||j.detach(r)}}this.removeEmptyElements(o),this.saveSelection.restore(),o.innerHTML=this.sanitizeHelper(o.innerHTML),this.addTempClass(o),this.removingComments(o),"BR"!==this.parent.enterKey||e?"DIV"===this.parent.enterKey&&(o.innerHTML=o.innerHTML.replace(/<p class="pasteContent_RTE">/g,"<div>").replace(/<\/p>/g,"</div>")):o=this.reframeToBrContent(o),this.parent.trigger(Qt,{value:o.innerHTML,filesData:null},function(e){t=e.value}),o.innerHTML=t,this.parent.formatter.editorManager.execCommand("inserthtml","pasteCleanup",n,function(e){j.extend(n,{elements:e.elements,imageElements:e.imgElem},!0),i.parent.formatter.onSuccess(i.parent,n)},o,null,null,this.parent.enterKey),this.removeTempClass()}else this.saveSelection.restore(),j.extend(n,{elements:[]},!0),this.parent.formatter.onSuccess(this.parent,n)},x.prototype.removingComments=function(e){var t=(t=e.innerHTML).replace(/<!--[\s\S]*?-->/g,"");e.innerHTML=t},x.prototype.reframeToBrContent=function(e){for(var t=this.parent.createElement("div",{className:"pasteContent",styles:"display:inline;"});!j.isNullOrUndefined(e.firstChild);){var n,i=this.parent.createElement("br"),o=e.firstChild;"#text"===o.nodeName?(n=!j.isNullOrUndefined(o.nextSibling),t.appendChild(o),n&&t.appendChild(i)):((n="BR"===o.nodeName)?t.appendChild(o):t.appendChild(o.childNodes[0]),j.isNullOrUndefined(o)||j.isNullOrUndefined(o.nextSibling)||t.appendChild(i),n||j.isNullOrUndefined(o)||j.detach(o))}return t},x.prototype.getTextContent=function(e){for(var t=0;t<this.blockNode.length;t++)for(var n=e.querySelectorAll(this.blockNode[t]),i=0;i<n.length;i++){for(var o,r=void 0,s=0,a=void 0;s<n[i].childNodes.length;s++,0)"DIV"===n[i].childNodes[s].nodeName||"P"===n[i].childNodes[s].nodeName||"#text"===n[i].childNodes[s].nodeName&&"&nbsp;"!==n[i].childNodes[s].nodeValue.replace(/\u00a0/g,"&nbsp;")&&""===n[i].childNodes[s].textContent.trim()?(r=n[i].childNodes[s].parentElement,n[i].childNodes[s].parentElement.parentElement.insertBefore(n[i].childNodes[s],n[i].childNodes[s].parentElement),s--):(r=n[i].childNodes[s].parentElement,"text"===a?r.previousElementSibling.appendChild(n[i].childNodes[s]):((o=this.parent.createElement("div",{id:"newDiv"})).appendChild(n[i].childNodes[s]),r.parentElement.insertBefore(o,r)),s--,a="text");j.isNullOrUndefined(r)||j.detach(r)}for(var l=e.querySelectorAll("*"),t=0;t<l.length;t++)for(var d=l[t].attributes,i=0;i<d.length;i++)l[t].removeAttribute(d[i].name),i--},x.prototype.detachInlineElements=function(e){for(var t=0;t<this.inlineNode.length;t++)for(var n=e.querySelectorAll(this.inlineNode[t]),i=0;i<n.length;i++)if(n[i]!==e.firstChild||"SPAN"!==n[i].nodeName){for(var o=void 0,r=0;r<n[i].childNodes.length;r++)o=n[i].childNodes[r].parentElement,n[i].childNodes[r].parentElement.parentElement.insertBefore(n[i].childNodes[r],n[i].childNodes[r].parentElement),r--;j.isNullOrUndefined(o)||j.detach(o)}},x.prototype.findDetachEmptyElem=function(e){return j.isNullOrUndefined(e)||j.isNullOrUndefined(e.parentElement)?null:0<e.parentElement.textContent.length&&e.parentElement.textContent.match(/\u00a0/g)&&0<e.parentElement.textContent.match(/\u00a0/g).length||""!==e.parentElement.textContent.trim()||"pasteContent"===e.parentElement.getAttribute("class")?e:this.findDetachEmptyElem(e.parentElement)},x.prototype.removeEmptyElements=function(e){for(var t,n=e.querySelectorAll(":empty"),i=0;i<n.length;i++)"BR"!==n[i].tagName&&(t=this.findDetachEmptyElem(n[i]),j.isNullOrUndefined(t)||j.detach(t))},x.prototype.tagGrouping=function(e){for(var t=e.slice(),n=Object.keys(xs),i=n.map(function(e){return xs[""+e]}),o=[],r=0;r<t.length;r++)if(1<t[r].split("[").length&&(t[r]=t[r].split("[")[0].trim()),-1<n.indexOf(t[r]))for(var s=0;s<i[n.indexOf(t[r])].length;s++)t.indexOf(i[n.indexOf(t[r])][s])<0&&o.indexOf(i[n.indexOf(t[r])][s])<0&&o.push(i[n.indexOf(t[r])][s]);return e.concat(o)},x.prototype.attributesfilter=function(e){for(var t=0;t<e.length;t++)if(1<e[t].split("[").length){for(var n=e[t].split("[")[1].split("]")[0].split(","),i=[],o=[],r=0;r<n.length;r++)n[r].indexOf("!")<0?i.push(n[r].trim()):o.push(n[r].split("!")[1].trim());var s,a=1<i.length?i.join("]["):i.join(),l=1<o.length?o.join("]["):o.join();0<l.length?(s=""!==a?e[t].split("[")[0]+"["+a+"]":e[t].split("[")[0],e[t]=s+":not(["+l+"])"):e[t]=e[t].split("[")[0]+"["+a+"]"}return e},x.prototype.deniedTags=function(e){var t=j.isNullOrUndefined(this.parent.pasteCleanupSettings.deniedTags)?[]:this.parent.pasteCleanupSettings.deniedTags.slice(),t=this.attributesfilter(t);t=this.tagGrouping(t);for(var n=0;n<t.length;n++)for(var i=e.querySelectorAll(t[n]),o=i.length-1;0<=o;o--){for(var r=i[o].parentNode;i[o].firstChild;)r.insertBefore(i[o].firstChild,i[o]);r.removeChild(i[o])}return e},x.prototype.deniedAttributes=function(e,t){var n=j.isNullOrUndefined(this.parent.pasteCleanupSettings.deniedAttrs)?[]:this.parent.pasteCleanupSettings.deniedAttrs.slice();t&&n.push("style");for(var i=0;i<n.length;i++)for(var o=e.querySelectorAll("["+n[i]+"]"),r=0;r<o.length;r++)o[r].removeAttribute(n[i]);return e},x.prototype.allowedStyle=function(e){for(var t=j.isNullOrUndefined(this.parent.pasteCleanupSettings.allowedStyleProps)?[]:this.parent.pasteCleanupSettings.allowedStyleProps.slice(),n=(t.push("list-style-type","list-style"),e.querySelectorAll("[style]")),i=0;i<n.length;i++){for(var o,r=[],s=n[i].getAttribute("style").split(";"),a=0;a<s.length;a++)0<=t.indexOf(s[a].split(":")[0].trim())&&r.push(s[a]);n[i].removeAttribute("style"),(o=""===r.join(";").trim()?r.join(";"):r.join(";")+";")&&n[i].setAttribute("style",o)}return e},x.prototype.processPictureElement=function(e){for(var t=e.querySelectorAll("picture"),n=this.parent.contentModule.getDocument().baseURI,i=0;i<t.length;i++){var o=t[i].querySelector("img"),r=t[i].querySelectorAll("source");if(o&&o.getAttribute("src"))for(var o=o.getAttribute("src"),s=-1<o.indexOf("http")?new URL(o):new URL(o,n),a=0;a<r.length;a++){var l=r[a].getAttribute("srcset");l&&-1===l.indexOf("http")&&(l=s.origin+l,r[a].setAttribute("srcset",l))}}},x.prototype.getModuleName=function(){return"pasteCleanup"};var oc=x;function x(e,t){this.inlineNode=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"],this.blockNode=["div","h1","h2","h3","h4","h5","h6","address","blockquote","button","center","dd","dir","dl","dt","fieldset","frameset","hr","iframe","isindex","li","map","menu","noframes","noscript","object","ol","pre","td","tr","th","tbody","tfoot","thead","table","ul","header","article","nav","footer","section","aside","main","figure","figcaption"],this.isNotFromHtml=!1,this.containsHtml=!1,this.cropImageData=[],this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.i10n=t.getService("rteLocale"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1}sc.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(n,this.renderResizable,this),this.parent.on(o,this.destroy,this))},sc.prototype.renderResizable=function(){var t=this,e=this.parent.enableRtl?xo:ao;this.resizer=this.parent.createElement("div",{id:this.parent.getID()+"-resizable",className:"e-icons "+so+" "+e}),this.parent.element.classList.add(Eo),this.parent.rootContainer.appendChild(this.resizer),this.parent.rootContainer.classList.add("e-resize-enabled"),this.parent.iframeSettings.enable&&(this.parent.inputElement.classList.add("e-resize-enabled"),this.parent.contentModule.getDocument().addEventListener("mouseup",this.iframeMouseUpBoundFn)),this.iframeElement=this.parent.contentModule.getDocument().querySelectorAll("iframe"),j.isNullOrUndefined(this.iframeElement)||this.iframeElement.forEach(function(e){j.EventHandler.add(e,"load",t.onIFrameLoad,t)}),this.touchStartEvent="msie"===j.Browser.info.name?"pointerdown":"touchstart",j.EventHandler.add(this.resizer,"mousedown",this.resizeStart,this),j.EventHandler.add(this.resizer,this.touchStartEvent,this.resizeStart,this)},sc.prototype.onIFrameLoad=function(e){e=e.target;"IFRAME"===e.nodeName&&e.contentDocument&&j.EventHandler.add(e.contentDocument,"mouseup",this.stopResize,this)},sc.prototype.removeMouseUpEventListener=function(e){e.contentDocument&&j.EventHandler.remove(e.contentDocument,"mouseup",this.stopResize)},sc.prototype.resizeStart=function(e){var t=this,e=(this.isResizing=!1,e.cancelable&&e.preventDefault(),this.wireResizeEvents(),this.parent.notify(Ft,{}),{event:e,requestType:"editor"});this.parent.trigger(ye,e,function(e){e.cancel&&t.unwireResizeEvents()})},sc.prototype.performResize=function(e){var t,n=this,i=(this.isResizing=!0,{event:e,requestType:"editor"}),i=(this.parent.trigger(Ce,i,function(e){e.cancel&&n.unwireResizeEvents()}),this.parent.element.getBoundingClientRect()),o=(this.isMouseEvent(e)?(this.parent.element.style.height=e.clientY-i.top+"px",this.parent.element.style.width=this.parent.enableRtl?i.right-e.clientX+"px":e.clientX-i.left+"px",t=this.parent.toolbarModule.getToolbarElement(),j.isNullOrUndefined(t)||j.isNullOrUndefined(t.parentElement)||t.parentElement.classList.contains(Mn)&&this.parent.toolbarSettings.enableFloating&&this.parent.getToolbar()&&!this.parent.inlineMode.enable&&(o=this.parent.contentModule.getPanel().getBoundingClientRect().width,t.style.width=o+"px")):(t="msie"!==j.Browser.info.name?e.touches[0]:e,this.parent.element.style.height=t.clientY-i.top+"px",this.parent.element.style.width=this.parent.enableRtl?i.right-t.clientX+"px":t.clientX-i.left+"px"),this.parent.element.querySelector("#"+this.parent.getID()+"_source-view"));j.isNullOrUndefined(o)||(o.style.height=this.parent.element.style.height),this.parent.refreshUI()},sc.prototype.stopResize=function(e){this.isResizing=!1,this.parent.refreshUI(),this.unwireResizeEvents(),this.parent.trigger(Ne,{event:e,requestType:"editor"})},sc.prototype.getEventType=function(e){return-1<e.indexOf("mouse")?"mouse":"touch"},sc.prototype.isMouseEvent=function(e){var t=!1;return t="mouse"!==this.getEventType(e.type)&&(j.isNullOrUndefined(e.pointerType)||"mouse"!==this.getEventType(e.pointerType))?t:!0},sc.prototype.wireResizeEvents=function(){j.EventHandler.add(document,"mousemove",this.performResize,this),j.EventHandler.add(document,"mouseup",this.stopResize,this),this.touchMoveEvent="msie"===j.Browser.info.name?"pointermove":"touchmove",this.touchEndEvent="msie"===j.Browser.info.name?"pointerup":"touchend",j.EventHandler.add(document,this.touchMoveEvent,this.performResize,this),j.EventHandler.add(document,this.touchEndEvent,this.stopResize,this)},sc.prototype.unwireResizeEvents=function(){j.EventHandler.remove(document,"mousemove",this.performResize),j.EventHandler.remove(document,"mouseup",this.stopResize),j.EventHandler.remove(document,this.touchMoveEvent,this.performResize),j.EventHandler.remove(document,this.touchEndEvent,this.stopResize)},sc.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.resizer&&(j.detach(this.resizer),this.resizer=null),this.isDestroyed=!0)},sc.prototype.removeEventListener=function(){var t=this;this.parent.off(n,this.renderResizable),this.parent.element.classList.remove(Eo),this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-resize-enabled")&&this.parent.rootContainer.classList.remove("e-resize-enabled"),this.parent.iframeSettings.enable&&!j.isNullOrUndefined(this.parent.inputElement)&&(this.parent.inputElement.classList.remove("e-resize-enabled"),this.parent.contentModule.getDocument().removeEventListener("mouseup",this.iframeMouseUpBoundFn)),j.isNullOrUndefined(this.iframeElement)||this.iframeElement.forEach(function(e){t.removeMouseUpEventListener(e),j.EventHandler.remove(e,"load",t.onIFrameLoad)}),this.resizer&&(j.EventHandler.remove(this.resizer,"mousedown",this.resizeStart),j.EventHandler.remove(this.resizer,this.touchStartEvent,this.resizeStart),j.detach(this.resizer)),this.parent.off(o,this.destroy),this.iframeMouseUpBoundFn=null},sc.prototype.iframeMouseUp=function(e){this.isResizing&&this.stopResize(e)},sc.prototype.getModuleName=function(){return"resize"};var rc=sc;function sc(e){this.parent=e,this.addEventListener(),this.isDestroyed=!1,this.isResizing=!1,this.iframeMouseUpBoundFn=this.iframeMouseUp.bind(this)}lc.prototype.initialize=function(){this.contentModule=this.rendererFactory.getRenderer(m.RenderType.Content)},lc.prototype.render=function(e){var t=e.selectNode&&"IMG"===e.selectNode[0].nodeName?this.parent.localeObj.getConstant("dialogUpdate"):this.i10n.getConstant("dialogInsert"),n=this.parent.localeObj.getConstant("fileDialogHeader"),i=this.i10n.getConstant("dialogCancel"),t=(this.dlgButtons=[{click:this.insertImageBoundFn,buttonModel:{content:t,cssClass:"e-flat e-insertImage",isPrimary:!0,disabled:!0}},{click:this.cancelDialogBoundFn,buttonModel:{cssClass:"e-flat e-cancel",content:i}}],this.selectObj={selection:e.selection,args:e.args,selectParent:e.selectParent},this.parent.createElement("div",{className:"e-rte-file-manager-dialog",id:this.parent.getID()+"_file-manager-dialog",attrs:{"aria-owns":this.parent.getID()}})),i=(document.body.appendChild(t),this.fileWrap=this.parent.createElement("div",{id:this.parent.getID()+"_rte-file-manager",className:"e-img-file-wrap"}),t.appendChild(this.fileWrap),t.appendChild(this.getInputUrlElement()),{visible:!1,isModal:!0,header:n,target:document.body,locale:this.parent.locale,enableRtl:this.parent.enableRtl,cssClass:Oi,animationSettings:{effect:"None"},showCloseIcon:!0,closeOnEscape:!0,width:"720px",height:"auto",position:{X:"center",Y:"center"},buttons:this.dlgButtons,created:this.renderFileManagerBoundFn,close:this.dialogClosedBoundFn});this.dialogObj=this.dialogRenderObj.render(i),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(t),this.dialogObj.show(!!j.Browser.isDevice),this.setCssClass({cssClass:this.parent.getCssClass()})},lc.prototype.setCssClass=function(e){this.dialogObj&&e.cssClass&&(j.isNullOrUndefined(e.oldCssClass)?this.dialogObj.setProperties({cssClass:(this.dialogObj.cssClass+" "+e.cssClass).trim()}):this.dialogObj.setProperties({cssClass:(this.dialogObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},lc.prototype.dialogClosed=function(e){this.parent.isBlur=!1,e&&e.event.returnValue&&this.selectObj.selection.restore(),this.destroyComponents(),this.parent.element.ownerDocument.removeEventListener("mousedown",this.onDocumentClickBoundFn),this.dialogRenderObj.close(e)},lc.prototype.renderFileManager=function(){var t=this;this.fileObj=new z.FileManager({allowMultiSelection:!1,locale:this.parent.locale,enableRtl:this.parent.enableRtl,path:this.parent.fileManagerSettings.path,view:this.parent.fileManagerSettings.view,enablePersistence:this.parent.enablePersistence,cssClass:this.parent.fileManagerSettings.cssClass,sortOrder:this.parent.fileManagerSettings.sortOrder,ajaxSettings:this.parent.fileManagerSettings.ajaxSettings,showThumbnail:this.parent.fileManagerSettings.showThumbnail,rootAliasName:this.parent.fileManagerSettings.rootAliasName,uploadSettings:this.parent.fileManagerSettings.uploadSettings,searchSettings:this.parent.fileManagerSettings.searchSettings,toolbarSettings:this.parent.fileManagerSettings.toolbarSettings,showHiddenItems:this.parent.fileManagerSettings.showHiddenItems,allowDragAndDrop:this.parent.fileManagerSettings.allowDragAndDrop,showFileExtension:this.parent.fileManagerSettings.showFileExtension,detailsViewSettings:this.parent.fileManagerSettings.detailsViewSettings,contextMenuSettings:this.parent.fileManagerSettings.contextMenuSettings,navigationPaneSettings:this.parent.fileManagerSettings.navigationPaneSettings,beforeSend:this.parent.fileManagerSettings.beforeSend,fileSelect:function(e){e=e.fileDetails;e.isFile&&-1<t.parent.insertImageSettings.allowedTypes.indexOf(e.type)?(t.inputUrl.value=t.parent.fileManagerSettings.ajaxSettings.getImageUrl+"?path="+(e.filterPath&&e.filterPath.replace(/\\/g,"/"))+e.name,t.dlgButtons[0].buttonModel.disabled=!1):(t.inputUrl.value="",t.dlgButtons[0].buttonModel.disabled=!0),t.dialogObj.setProperties({buttons:t.dlgButtons})},created:function(){t.inputUrl.removeAttribute("disabled")},success:function(){t.fileObj.refreshLayout()}}),j.Browser.isDevice&&(this.fileObj.height="85%"),this.fileObj.appendTo(this.fileWrap),this.parent.element.ownerDocument.addEventListener("mousedown",this.onDocumentClickBoundFn)},lc.prototype.getInputUrlElement=function(){var e=this.parent.createElement("div",{className:"imgUrl"}),t=this.parent.createElement("div",{className:"e-rte-label"}),t=(t.innerHTML='<label for="rteSample_img_url">'+this.i10n.getConstant("linkWebUrl")+"</label>",e.appendChild(t),this.i10n.getConstant("imageUrl"));return this.inputUrl=this.parent.createElement("input",{className:"e-input e-img-url",attrs:{placeholder:t,spellcheck:"false",disabled:"true"}}),e.appendChild(this.inputUrl),e},lc.prototype.insertImageUrl=function(e){var t,n=this.inputUrl.value;0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),""!==n&&("HTML"===this.parent.editorMode&&j.isNullOrUndefined(j.closest(this.selectObj.selection.range.startContainer.parentNode,"#"+this.contentModule.getPanel().id))&&(this.contentModule.getEditPanel().focus(),t=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),this.selectObj.selection=this.parent.formatter.editorManager.nodeSelection.save(t,this.contentModule.getDocument()),this.selectObj.selectParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)),t=j.isNullOrUndefined(n.match(t=/[\w-]+.(jpg|png|jpeg|gif)/g))||"HTML"!==this.parent.editorMode?"":n.match(t)[0],n={cssClass:"inline"===this.parent.insertImageSettings.display?fi:si,url:n,selection:this.selectObj.selection,altText:t,selectParent:this.selectObj.selectParent,width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.parent.getInsertImgMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}},this.parent.formatter.process(this.parent,this.selectObj.args,this.selectObj.args.originalEvent,n),this.dialogObj.hide({returnValue:!1}))},lc.prototype.cancelDialog=function(){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0})},lc.prototype.onDocumentClick=function(e){var e=e.target,t="#document"!==e.nodeName&&!j.isNullOrUndefined(e.previousElementSibling)&&e.previousElementSibling;j.isNullOrUndefined(this.dialogObj)||j.closest(e,"#"+this.parent.getID()+"_file-manager-dialog")||j.closest(e,"#"+this.parent.getID()+"_rte-file-manager_tb_sortby-popup")||j.closest(e,"#"+this.parent.getID()+"_rte-file-manager_tb_view-popup")||j.closest(e,"#"+this.parent.getID()+"_rte-file-manager_contextmenu")||!j.isNullOrUndefined(j.closest(e,".e-contextmenu-wrapper"))&&j.closest(e,".e-contextmenu-wrapper").querySelector("#"+this.parent.getID()+"_rte-file-manager_contextmenu")||j.isNullOrUndefined(t)||t.classList.contains("e-rte-file-manager-dialog")||j.isNullOrUndefined(t)||t.id===this.parent.getID()+"_rte-file-manager_contextmenu"?this.parent.isRTE=!0:(this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,wr(this.parent.element,"focusout"))},lc.prototype.addEventListener=function(){this.parent.on(n,this.initialize,this),this.parent.on(qt,this.render,this),this.parent.on(on,this.setCssClass,this),this.parent.on(o,this.destroy,this)},lc.prototype.removeEventListener=function(){this.parent.element.ownerDocument.removeEventListener("mousedown",this.onDocumentClickBoundFn),this.parent.off(n,this.initialize),this.parent.off(qt,this.render),this.parent.off(on,this.setCssClass),this.parent.off(o,this.destroy)},lc.prototype.destroyComponents=function(){this.fileObj&&(this.fileObj.destroy(),this.fileObj=null),this.dialogObj&&(this.dialogObj.destroy(),j.detach(this.dialogObj.element))},lc.prototype.destroy=function(){this.isDestroyed||(this.destroyComponents(),this.removeEventListener(),this.dlgButtons=null,this.isDestroyed=!0,this.insertImageBoundFn=null,this.cancelDialogBoundFn=null,this.renderFileManagerBoundFn=null,this.dialogClosedBoundFn=null,this.onDocumentClickBoundFn=null)},lc.prototype.getModuleName=function(){return"fileManager"};var ac=lc;function lc(e,t){z.FileManager.Inject(z.ContextMenu,z.DetailsView,z.NavigationPane,z.Toolbar),this.parent=e,this.i10n=t.getService("rteLocale"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.rendererFactory=t.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1,this.insertImageBoundFn=this.insertImageUrl.bind(this),this.cancelDialogBoundFn=this.cancelDialog.bind(this),this.renderFileManagerBoundFn=this.renderFileManager.bind(this),this.dialogClosedBoundFn=this.dialogClosed.bind(this),this.onDocumentClickBoundFn=this.onDocumentClick.bind(this)}cc.prototype.showFullScreen=function(t){var n=this;!0!==this.parent.toolbarSettings.enable||"Markdown"===this.parent.editorMode||j.isNullOrUndefined(this.parent.quickToolbarModule)||this.parent.quickToolbarModule.hideQuickToolbars(),this.parent.showTooltip&&!j.isNullOrUndefined(document.querySelector(".e-tooltip-wrap"))&&this.parent.notify(ln,{args:t}),this.scrollableParent=I.getScrollableParent(this.parent.element),this.parent.element.classList.contains(An)||this.parent.trigger(Le,{cancel:!1,requestType:"Maximize",targetItem:"Maximize",args:t},function(e){e.cancel||(n.parent.toolbarSettings.enableFloating&&!n.parent.inlineMode.enable&&n.parent.toolbarSettings.enable&&(n.parent.getToolbarElement().style.width="100%",n.parent.getToolbarElement().style.top="0px"),n.parent.element.classList.add(An),n.toggleParentOverflow(!0),n.parent.toolbarModule&&(n.parent.getBaseToolbarObject().toolbarObj.items[0].properties||n.parent.getBaseToolbarObject().toolbarObj.removeItems(0),j.Browser.isDevice&&n.parent.toolbarModule.removeFixedTBarClass(),n.parent.toolbarModule.updateItem({targetItem:"Maximize",updateItem:"Minimize",baseToolbar:n.parent.getBaseToolbarObject()})),n.parent.refreshUI(),n.parent.trigger(ke,{requestType:"Maximize",targetItem:"Maximize",args:t}))})},cc.prototype.hideFullScreen=function(i){var o=this;!0!==this.parent.toolbarSettings.enable||"Markdown"===this.parent.editorMode||j.isNullOrUndefined(this.parent.quickToolbarModule)||this.parent.quickToolbarModule.hideQuickToolbars(),this.parent.showTooltip&&!j.isNullOrUndefined(document.querySelector(".e-tooltip-wrap"))&&this.parent.notify(ln,{args:i}),this.parent.element.classList.contains(An)&&this.parent.trigger(Le,{cancel:!1,requestType:"Minimize",targetItem:"Minimize",args:i},function(e){if(!e.cancel){o.parent.element.classList.remove(An);for(var t=document.querySelectorAll(".e-rte-overflow"),n=0;n<t.length;n++)j.removeClass([t[n]],["e-rte-overflow"]);o.parent.toolbarModule&&(o.parent.getBaseToolbarObject().toolbarObj.items[0].properties||o.parent.getBaseToolbarObject().toolbarObj.removeItems(0),o.parent.toolbarModule.updateItem({targetItem:"Minimize",updateItem:"Maximize",baseToolbar:o.parent.getBaseToolbarObject()}),j.Browser.isDevice)&&o.parent.inlineMode.enable&&o.parent.toolbarModule.addFixedTBarClass(),o.parent.refreshUI(),o.parent.trigger(ke,{requestType:"Minimize",targetItem:"Minimize",args:i})}})},cc.prototype.toggleParentOverflow=function(e){if(!j.isNullOrUndefined(this.scrollableParent))for(var t,n=0;n<this.scrollableParent.length;n++)t="#document"===this.scrollableParent[n].nodeName?document.querySelector("body"):this.scrollableParent[n],j.addClass([t],["e-rte-overflow"])},cc.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"full-screen":this.showFullScreen(e.args),t.preventDefault();break;case"escape":this.hideFullScreen(e.args),t.preventDefault()}},cc.prototype.addEventListener=function(){this.parent.on(h,this.onKeyDown,this),this.parent.on(o,this.destroy,this)},cc.prototype.removeEventListener=function(){this.parent.off(h,this.onKeyDown),this.parent.off(o,this.destroy)},cc.prototype.destroy=function(){if(!j.isNullOrUndefined(this.parent)){this.parent.element.classList.contains(An)&&this.toggleParentOverflow(!1);for(var e=document.querySelectorAll(".e-rte-overflow"),t=0;t<e.length;t++)j.removeClass([e[t]],["e-rte-overflow"]);this.removeEventListener()}};var dc=cc;function cc(e){this.parent=e,this.addEventListener()}function pc(e,t,n,i){var o;if(o=n?t.contentModule.getDocument().querySelector("body"):t.element,Object.keys(e).length)for(var r=0,s=Object.keys(e);r<s.length;r++){var a=s[r];"class"===a?o.classList.add(e[""+a]):"disabled"===a&&"disabled"===e[""+a]?(t.enabled=!1,t.setEnable()):"readonly"===a&&"readonly"===e[""+a]?(t.readonly=!0,t.setReadOnly(i)):"style"===a?o.setAttribute("style",e[""+a]):"tabindex"===a?t.inputElement.setAttribute("tabindex",e[""+a]):"placeholder"===a?(t.placeholder=e[""+a],t.setPlaceHolder()):(-1<["name","required"].indexOf(a)?t.valueContainer:o).setAttribute(a,e[""+a])}}uc.prototype.addEventListener=function(){this.parent.on(rn,this.toolbarClick,this),this.parent.on(sn,this.toolbarDoubleClick,this),this.parent.on(Ye,this.editAreaClick,this),this.parent.on(h,this.onKeyDown,this),this.parent.on(o,this.destroy,this)},uc.prototype.toolbarClick=function(e){this.parent.focusIn(),this.isSticky?(e.args.action="escape",this.actionHandler(e,"keyBoard")):(this.isActive=!0,this.actionHandler(e,"click")),this.parent.quickToolbarModule&&!j.isNullOrUndefined(this.parent.quickToolbarSettings.text)&&this.parent.element.ownerDocument.contains(this.parent.quickToolbarModule.textQTBar.element)&&this.parent.quickToolbarModule.textQTBar.hidePopup()},uc.prototype.toolbarDoubleClick=function(e){this.isActive=!0,this.isSticky=!0,this.parent.focusIn(),this.actionHandler(e,"dbClick")},uc.prototype.onKeyDown=function(e){var t=e.args;(j.isNullOrUndefined(t)||j.isNullOrUndefined(t.action)||"format-copy"!==t.action&&"format-paste"!==t.action)&&("escape"!==t.action||"format-copy"!==this.previousAction&&"format-paste"!==this.previousAction)||("format-copy"!==t.action&&"format-paste"!==t.action||t.stopPropagation(),-1!==j.Browser.userAgent.indexOf("Firefox")&&t.preventDefault(),this.actionHandler(e,"keyBoard"))},uc.prototype.actionHandler=function(e,t){var n,i,o,r=!1;switch(t){case"dbClick":o=e.args.item,i=e.args.originalEvent,n="format-copy";break;case"keyBoard":i=e.args,r=!null,"escape"===(n=e.args.action)&&(this.isSticky=!1,this.isActive=!1);break;case"click":o=e.args.item,i=e.args.originalEvent,n="format-copy";break;case"docClick":i=e,n="format-paste"}var s={requestType:"FormatPainter",originalEvent:i,name:n,item:o=j.isNullOrUndefined(o)?{command:"FormatPainter",subCommand:"FormatPainter"}:o};this.parent.formatter.process(this.parent,s,i,{formatPainterAction:n}),s.cancel||(this.updateCursor(r),this.updateToolbarBtn("docClick"!==t&&"escape"!==n)),this.previousAction=n},uc.prototype.updateCursor=function(e){this.parent.inputElement.classList.contains("e-rte-cursor-brush")||e?this.isSticky||j.removeClass([this.parent.inputElement],"e-rte-cursor-brush"):j.addClass([this.parent.inputElement],"e-rte-cursor-brush")},uc.prototype.updateToolbarBtn=function(e){var t;j.isNullOrUndefined(this.parent.element.querySelector(".e-rte-format-painter"))||(t=this.parent.element.querySelector(".e-rte-format-painter").parentElement.parentElement,e?j.addClass([t],"e-active"):this.isSticky||j.removeClass([t],"e-active"))},uc.prototype.editAreaClick=function(e){this.isActive&&(this.isSticky||(this.isActive=!1),this.actionHandler(e,"docClick"),this.updateToolbarBtn(!1))},uc.prototype.destroy=function(){this.isDestroyed||(this.parent.off(rn,this.toolbarClick),this.parent.off(Ye,this.editAreaClick),this.parent.off(sn,this.toolbarDoubleClick),this.parent.off(h,this.onKeyDown),this.parent.off(o,this.destroy),this.parent=null,this.isSticky=null,this.isActive=null,this.previousAction=null,this.isDestroyed=!0)},uc.prototype.getModuleName=function(){return"formatPainter"};var hc=uc;function uc(e){this.isSticky=!1,this.isActive=!1,this.parent=e,this.addEventListener(),this.isDestroyed=!1}gc.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.isDestroyed=!0)},gc.prototype.childDestroy=function(){var e;this.isPopupDestroyed||(this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.element&&this.popupObj.element.querySelector(".e-rte-emoji-search")&&(e=j.getComponent(this.popupObj.element.querySelector(".e-rte-emoji-search"),"textbox"))&&!e.isDestroyed&&e.destroy(),this.popupObj.element&&this.popupObj.element.querySelector(".e-rte-emojipicker-toolbar")&&(e=j.getComponent(this.popupObj.element.querySelector(".e-rte-emojipicker-toolbar"),"toolbar"))&&!e.isDestroyed&&e.destroy(),e=this.popupObj.element.querySelector(".e-clear-icon"),j.isNullOrUndefined(e)||j.EventHandler.remove(e,"mousedown",this.searchFilter),this.popupObj.destroy(),this.isPopupDestroyed=!0),this.popDiv&&(j.EventHandler.remove(this.popDiv,"keydown",this.onKeyDown),j.EventHandler.remove(this.popDiv,"keyup",this.searchFilter),this.popDiv.querySelector(".e-rte-emojipicker-btn"))&&(e=this.popDiv.querySelector(".e-rte-emojipicker-btn"),j.EventHandler.remove(e,"scroll",this.scrollEvent),j.EventHandler.remove(e,"click",this.emojiBtnClick)))},gc.prototype.addEventListener=function(){this.parent.on(an,this.toolbarClick,this),this.parent.on(dt,this.docClick,this),this.parent.on(K,this.onIframeMouseDown,this),this.parent.on(h,this.onkeyPress,this),this.parent.on(ie,this.onkeyUp,this),this.parent.on($e,this.contentscroll,this),this.parent.on(Je,this.contentscroll,this),this.parent.on(o,this.destroy,this)},gc.prototype.toolbarClick=function(e){var t,n=this,i=(this.noResultsFoundCount=0,j.isNullOrUndefined(this.parent.element.querySelector(".e-emoji"))?this.parent.inlineMode.enable&&(i=this.parent.element.ownerDocument.querySelector(".e-emoji")):i=this.parent.element.querySelector(".e-emoji"),this.divElement=i.closest("div"),this.parent.inputElement.contains(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).startContainer)||this.parent.contentModule.getEditPanel().focus(),this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())),o=(this.save=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument()),this.clickEvent=e.args,this.parent.emojiPickerSettings.iconsSet);if(this.popupObj){if(j.removeClass([this.divElement],"e-active"),this.popupObj.element.querySelector(".e-rte-emoji-search")||!this.parent.emojiPickerSettings.showSearchBox)return void this.popupObj.hide();this.popupObj.hide()}this.popDiv=this.parent.createElement("div",{className:"e-rte-emojipicker-popup",id:this.parent.getID()+"_emojiPicker"}),j.isNullOrUndefined(this.parent.getToolbar())||this.parent.inlineMode.enable?this.parent.inlineMode.enable&&this.parent.rootContainer.appendChild(this.popDiv):this.parent.getToolbar().parentElement.appendChild(this.popDiv),j.EventHandler.add(this.popDiv,"keydown",this.onKeyDown,this),j.EventHandler.add(this.popDiv,"keyup",this.searchFilter,this);for(var i=this.parent.element.querySelector(".e-toolbar-extended"),r=(i=j.isNullOrUndefined(i)?"10001":window.getComputedStyle(i).getPropertyValue("z-index"),j.isNullOrUndefined(e.args)||this.parent.inlineMode.enable||!j.isNullOrUndefined(this.parent.quickToolbarSettings.text)?j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y)&&!this.parent.inlineMode.enable&&j.isNullOrUndefined(this.parent.quickToolbarSettings.text)?(f=this.parent.inputElement,0<this.parent.contentModule.getDocument().getSelection().rangeCount&&(r=(b=this.getCoordinates()).left,s=b.top)):j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y)&&(this.parent.inlineMode.enable||!j.isNullOrUndefined(this.parent.quickToolbarSettings.text))?(this.parent.notify(dn,{}),0<this.parent.contentModule.getDocument().getSelection().rangeCount&&(r=(b=this.getCoordinates()).left,s=b.top)):(f=this.parent.inputElement,r=e.x,s=e.y):(f=(f=e.args.originalEvent.target).classList.contains("e-toolbar-item")?f.firstChild:f.parentElement,r="left",s="bottom"),this.popupObj=new I.Popup(this.popDiv,{targetType:"relative",relateTo:f,collision:{X:"fit",Y:"none"},offsetY:8,viewPortElement:this.parent.element,position:{X:r,Y:s},enableRtl:this.parent.enableRtl,zIndex:parseInt(i,10)+1,actionOnScroll:"hide",close:function(){n.parent.isBlur=!1,n.childDestroy(),j.detach(n.popupObj.element),n.popupObj=null,n.divElement.firstChild.focus()}}),this.isPopupDestroyed=!1,j.addClass([this.popupObj.element],"e-popup-open"),this.popupObj.refreshPosition(f),(!j.isNullOrUndefined(e.args)||j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y))&&this.parent.emojiPickerSettings.showSearchBox&&(b=j.createElement("input",{id:"e-rte-emoji-search",className:"e-rte-emoji-search"}),this.popDiv.append(b),new U.TextBox({placeholder:this.i10n.getConstant("emojiPickerTypeToFind"),showClearButton:!0}).appendTo(b),b.focus()),this.popupObj.element.querySelector(".e-clear-icon")),s=(j.isNullOrUndefined(r)||j.EventHandler.add(r,"mousedown",this.searchFilter,this),this.parent.createElement("div",{className:"e-rte-emojipicker-toolbar"})),a=(this.popDiv.appendChild(s),[]),l=0;l<this.parent.emojiPickerSettings.iconsSet.length;l++)j.isNullOrUndefined(this.parent.emojiPickerSettings.iconsSet[l].iconCss)?a.push({text:"&#x"+this.parent.emojiPickerSettings.iconsSet[l].code+";",htmlAttributes:((t={}).title=this.parent.emojiPickerSettings.iconsSet[l].name,t)}):a.push({prefixIcon:this.parent.emojiPickerSettings.iconsSet[l].iconCss,htmlAttributes:((t={}).title=this.parent.emojiPickerSettings.iconsSet[l].name,t)});new R.Toolbar({items:a,clicked:this.emojiToolbarClick.bind(this)}).appendTo(s);var d=this.parent.createElement("div",{className:"e-rte-emojipicker-btn"}),i=(this.popDiv.appendChild(d),window.getComputedStyle(this.popDiv));r=(!j.isNullOrUndefined(e.args)||j.isNullOrUndefined(e.x)&&j.isNullOrUndefined(e.y))&&this.parent.emojiPickerSettings.showSearchBox?(f=this.parent.element.querySelector(".e-rte-emoji-search").parentElement,b=window.getComputedStyle(f),this.popDiv.getBoundingClientRect().height-s.getBoundingClientRect().height-f.getBoundingClientRect().height-parseFloat(b.marginTop)-parseFloat(b.marginBottom)-2*parseFloat(i.borderWidth)+"px"):this.popDiv.getBoundingClientRect().height-s.getBoundingClientRect().height-2*parseFloat(i.borderWidth)+"px",d.style.setProperty("height",r,"important");for(l=0;l<o.length;l++){var c=this.parent.createElement("div",{className:"e-rte-emojipicker-group"}),p=(d.appendChild(c),this.parent.createElement("div",{className:"e-rte-emojipicker-name"})),h=(p.innerText=this.parent.emojiPickerSettings.iconsSet[l].name,p.setAttribute("aria-label",this.parent.emojiPickerSettings.iconsSet[l].name),c.appendChild(p),this.parent.createElement("div",{className:"e-rte-emojipickerbtn-group"}));c.appendChild(h);for(var u=0;u<o[l].icons.length;u++){var m=this.parent.createElement("button",{className:"e-btn  e-control"});m.innerHTML=this.buttoncode(this.parent.emojiPickerSettings.iconsSet[l].icons[u].code),m.setAttribute("aria-label",this.parent.emojiPickerSettings.iconsSet[l].icons[u].desc),m.setAttribute("title",this.parent.emojiPickerSettings.iconsSet[l].icons[u].desc),h.appendChild(m),2<m.innerHTML.length&&(m.style.fontSize="17px")}}j.EventHandler.add(d,"scroll",this.scrollEvent,this),j.EventHandler.add(d,"click",this.emojiBtnClick,this);var g,f=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),b=(j.isNullOrUndefined(this.parent.element.querySelector(".e-rte-emoji-search"))&&!j.isNullOrUndefined(e.args)&&(f[0].focus(),j.addClass([f[0]],"e-focus")),this.parent.element.querySelector(".e-rte-emojipicker-btn")),s=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button");(g=j.isNullOrUndefined(b)?g:Math.round(b.scrollTop))<s[0].offsetHeight&&j.addClass([s[0]],"e-selected"),this.popupObj&&j.addClass([this.divElement],"e-active")},gc.prototype.onIframeMouseDown=function(e){this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide())},gc.prototype.buttoncode=function(e){return e.split("-").map(function(e){return String.fromCodePoint(parseInt(e,16))}).join("")},gc.prototype.docClick=function(e){e=e.args.target;e&&e.classList&&this.popupObj&&!j.closest(e,"[id='"+this.popupObj.element.id+"']")&&!e.classList.contains("e-emoji")&&!e.classList.contains("e-toolbar-item")&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide())},gc.prototype.scrollEvent=function(){for(var e,t=this.parent.element.querySelector(".e-rte-emojipicker-btn"),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),i=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button"),o=(j.isNullOrUndefined(t)||(e=Math.round(t.scrollTop)),0),r=0;r<i.length;r++)e<i[0].offsetHeight&&(j.isNullOrUndefined(i[r+1])||j.removeClass([i[r+1]],"e-selected"),j.addClass([i[0]],"e-selected"));for(var s=0;s<n.length;s++)if((o+=Math.round(n[s].offsetHeight))<=e){for(var a=0;a<i.length;a++)i[a].classList.contains("e-selected")&&j.removeClass([i[a]],"e-selected");j.isNullOrUndefined(i[s+1])||j.addClass([i[s+1]],"e-selected")}},gc.prototype.contentscroll=function(){j.isNullOrUndefined(this.clickEvent)&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide())},gc.prototype.emojiToolbarClick=function(e){for(var o={text:e.item.htmlAttributes.title}.text,e=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),t=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button"),i=0;i<n.length;i++)n[i].classList.contains("e-selected")&&j.removeClass([n[i]],"e-selected");for(i=0;i<t.length;i++)t[i].classList.contains("e-focus")&&j.removeClass([t[i]],"e-focus");var r=this.parent.element.querySelector(".e-rte-emojipicker-btn"),s=0;e.forEach(function(e){var t=e.childNodes[0],n=e.childNodes[1].childNodes[0],i=t.getAttribute("aria-label");o===i?t&&(r.scrollTop=s+10,j.addClass([n],"e-focus"),n.focus()):(s+=e.scrollHeight,j.removeClass([n],"e-focus"))})},gc.prototype.onKeyDown=function(e){var t=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),n=this.parent.element.querySelectorAll(".e-rte-emojipickerbtn-group"),i=this.parent.element.querySelector(".e-rte-emojisearch-btn button"),o=(27===e.keyCode&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide()),13===e.keyCode&&document.activeElement.classList.contains("e-btn")&&(this.emojiBtnClick(e),e.preventDefault()),e.srcElement);if(!j.isNullOrUndefined(o)&&o.classList.contains("e-rte-emoji-search")&&40===e.keyCode)for(var r=0;r<t.length;r++)t[r].classList.contains("e-focus")&&j.removeClass([t[r]],"e-focus");if(j.isNullOrUndefined(i))for(r=0;r<t.length;r++){var s=r;if(t[r].classList.contains("e-focus"))if(40===e.keyCode){if(t.length-4>r){for(var a=0,l=0;l<n.length;l++)for(var d=0;d<n[l].childNodes.length;d++)if(n[l].childNodes[d].classList.contains("e-focus")&&1!==a){var c=d,p=n[l].lastChild,h=Math.floor(d%6),u=n[l].childNodes.length-1,u=Math.floor(u%6);if(-1!==c){var m=c+6;if(j.isNullOrUndefined(n[l].childNodes[m])){if(j.isNullOrUndefined(n[l].childNodes[m])&&!p.classList.contains("e-focus")&&u<h){var g=t[r],f=(j.removeClass([g],"e-focus"),n[l].lastChild);j.addClass([f],"e-focus"),f.focus(),a=1;break}var g=t[r],f=(j.removeClass([g],"e-focus"),n[l+1].childNodes[h]);j.addClass([f],"e-focus"),f.focus(),a=1;break}var g=t[r],f=(j.removeClass([g],"e-focus"),t[s+=6]);j.addClass([f],"e-focus"),f.focus();break}}break}}else{if(38===e.keyCode){if(6<=r){for(a=0,l=0;l<n.length;l++)for(d=0;d<n[l].childNodes.length;d++)if(n[l].childNodes[d].classList.contains("e-focus")&&1!==a){var c=d,b=j.isNullOrUndefined(n[l-1])?null:n[l-1].childNodes.length%6||6;if(-1!==c){if(j.isNullOrUndefined(n[l].childNodes[c-6])){if(j.isNullOrUndefined(n[l-1].childNodes[n[l-1].childNodes.length-(b-d)])){g=t[r],f=(j.removeClass([g],"e-focus"),n[l-1].lastChild);j.addClass([f],"e-focus"),f.focus(),a=1;break}g=t[r],f=(j.removeClass([g],"e-focus"),n[l-1].childNodes[n[l-1].childNodes.length-(b-d)]);j.addClass([f],"e-focus"),f.focus(),a=1;break}var g=t[r],f=(j.removeClass([g],"e-focus"),t[s-=6]);j.addClass([f],"e-focus"),f.focus();break}}}else{var g=t[r],f=(j.removeClass([g],"e-focus"),t[--s]),v=this.popupObj.element.querySelector(".e-rte-emoji-search");if(j.isNullOrUndefined(f)&&!j.isNullOrUndefined(v)){v.focus();break}j.addClass([f],"e-focus"),f.focus()}break}if(39===e.keyCode){t.length!==r+1&&(g=t[r],j.removeClass([g],"e-focus"),f=t[s+=1],j.addClass([f],"e-focus"),t[s].focus());break}if(37===e.keyCode){0<r&&(g=t[r],j.removeClass([g],"e-focus"),f=t[--s],j.addClass([f],"e-focus"),t[s].focus());break}}}else this.filterKeyHandler(e);40===e.keyCode&&(g=this.parent.element.querySelector(".e-focus"),j.isNullOrUndefined(g))&&(f=t[0],j.addClass([f],"e-focus"),Hs()&&this.parent.notify(Qe,{}),t[0].focus())},gc.prototype.filterKeyHandler=function(e){var t=this.parent.element.querySelectorAll(".e-rte-emojisearch-btn button"),n=this.parent.element.querySelector(".e-focus");if(j.isNullOrUndefined(n)&&40===e.keyCode){var i=t[0];j.addClass([i],"e-focus"),Hs()&&this.parent.notify(Qe,{}),t[0].focus()}else for(var o=0;o<t.length;o++){var r=o;if(t[o].classList.contains("e-focus"))if(38===e.keyCode){if(6<=o){var s=t[o],i=(j.removeClass([s],"e-focus"),t[r-=6]);j.addClass([i],"e-focus"),i.focus();break}var s=t[o],i=(j.removeClass([s],"e-focus"),t[--r]),a=this.popupObj.element.querySelector(".e-rte-emoji-search");if(j.isNullOrUndefined(i)&&!j.isNullOrUndefined(a)){a.focus();break}j.addClass([i],"e-focus"),i.focus()}else if(40===e.keyCode){if(t.length-6>o){a=t[o],i=(j.removeClass([a],"e-focus"),t[r+=6]);j.addClass([i],"e-focus"),i.focus();break}}else{if(39===e.keyCode){t.length!==o+1&&(l=t[o],j.removeClass([l],"e-focus"),i=t[r+=1],j.addClass([i],"e-focus"),t[r].focus());break}if(37===e.keyCode&&0<o){var l=t[o],i=(j.removeClass([l],"e-focus"),t[--r]);j.addClass([i],"e-focus"),t[r].focus();break}}}},gc.prototype.searchFilter=function(e,t,n){void 0===n&&(n=!1);var i=this.parent.element.querySelector(".e-rte-emoji-search"),o=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel():this.parent.element.querySelector(".e-content");if(document.activeElement===i||document.activeElement===o){var o=void 0,r=(":"===t||j.isNullOrUndefined(t)?j.isNullOrUndefined(t)||(o=t):o=t.replace(/^:/,""),j.isNullOrUndefined(i)?o:i.value),o=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),i=this.parent.element.querySelector(".e-rte-emojipicker-btn"),s=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),a=this.parent.element.querySelector(".e-rte-emojipicker-toolbar"),l=this.parent.element.querySelector(".e-rte-emojisearch-btn"),d=this.popDiv.childNodes[0],c=window.getComputedStyle(d),d="SPAN"===d.nodeName?d.getBoundingClientRect().height+parseFloat(c.marginTop)+parseFloat(c.marginBottom):0,c=window.getComputedStyle(this.popDiv),p=j.isNullOrUndefined(l)?o:Array.from(o).filter(function(e){return!l.contains(e)});if(!j.isNullOrUndefined(a)&&!j.isNullOrUndefined(i)&&!j.isNullOrUndefined(r)){""===r||":"===t?(a.style.display="",i.style.height=this.popDiv.getBoundingClientRect().height-a.getBoundingClientRect().height-d-2*parseFloat(c.borderWidth)+"px",s.forEach(function(e){e.style.display=""})):(s.forEach(function(e){e.style.display="none"}),a.style.display="none",i.style.height=this.popDiv.getBoundingClientRect().height-d-2*parseFloat(c.borderWidth)+"px");for(var h=this.parent.createElement("div",{className:"e-rte-emojisearch-btn"}),o=this.parent.element.querySelector(".e-rte-emojisearch-btn"),u=(o&&o.remove(),!0),m=0;m<p.length;m++)if(!j.isNullOrUndefined(p[m].getAttribute("title")))for(var g=p[m].getAttribute("title").toLowerCase().split(" "),f=0;f<g.length;f++)if(g[f].startsWith(r.toLowerCase())&&""!==r){var b=p[m].cloneNode(!0);h.appendChild(b),u=!1;break}s=this.parent.createElement("div",{className:"e-rte-emojiSearch-noEmoji"});u&&!this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")&&""!==r&&":"!==t&&": :"!==t?j.isNullOrUndefined(s)||(s.innerHTML='<span style="color: rgba(0, 0, 0, 0.75); font-weight: 500; font-size: 16px;">'+this.i10n.getConstant("emojiPickerNoResultFound")+'  </span><br><span style="color: rgba(0, 0, 0, 0.75);"> '+this.i10n.getConstant("emojiPickerTrySomethingElse")+" ? </span>",s.style.margin="55px",i.appendChild(s)):(!u&&this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")||""===r&&":"===t||""===r&&this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji"))&&i.removeChild(this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")),i.appendChild(h),n&&(u&&":"!==t?this.noResultsFoundCount+=1:this.noResultsFoundCount=0,9<=this.noResultsFoundCount)&&(j.isNullOrUndefined(this.popupObj)||(j.removeClass([this.divElement],"e-active"),this.popupObj.hide(),this.noResultsFoundCount=0))}}},gc.prototype.emojiBtnClick=function(e){for(var t=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0}),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-popup [data-tooltip-id]"),i=0;i<n.length;i++)n[i].dispatchEvent(t);var o,r=e.target;"BUTTON"===r.tagName&&(r.focus(),o=this.save.startOffset,o=this.save.range.startContainer.textContent.substring(o,o+1),j.isNullOrUndefined(this.clickEvent)&&":"===o||this.save.restore(),this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide()),Hs()&&"keydown"===e.type&&this.parent.notify(We,{}),this.parent.formatter.process(this.parent,{item:{command:"EmojiPicker",subCommand:"EmojiPicker",value:r.innerHTML},originalEvent:e},e,e))},gc.prototype.onkeyPress=function(e){var t,n,i,e=e.args,o=(this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow:this.parent.contentModule.getDocument()).getSelection();o.rangeCount<=0||(n=o.getRangeAt(0).startOffset,i=o.focusNode.textContent.substring(n-1,n),i=/\s/.test(i),t=":"===o.focusNode.textContent.substring(n-1,n),n=":"===o.focusNode.textContent.charAt(n-1),186===e.keyCode&&e.shiftKey&&(i||0===o.focusOffset)&&(i=this.getCoordinates(),this.parent.showEmojiPicker(i.left,i.top)),8===e.keyCode&&n&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),this.popupObj.hide()),32===e.keyCode&&t&&this.popupObj&&(j.removeClass([this.divElement],"e-active"),o=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument(),this.parent.showTooltip&&!j.isNullOrUndefined(o.querySelector(".e-tooltip-wrap"))&&this.parent.notify(ln,{args:event}),this.popupObj.hide()),!this.popupObj)||37!==e.keyCode&&38!==e.keyCode&&39!==e.keyCode&&27!==e.keyCode&&40!==e.keyCode||(this.onKeyDown(e),e.preventDefault())},gc.prototype.onkeyUp=function(e){var t=e.args,n=(this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow:this.parent.contentModule.getDocument()).getSelection();if(!(n.rangeCount<=0)){for(var i,o=n.getRangeAt(0),r=o.startOffset,s=0,a=r-1;a>=r-n.focusNode.textContent.length;a--){var l=n.focusNode.textContent.substring(a-1,a);/:$/.test(l)&&!j.isNullOrUndefined(this.popDiv)&&0===s&&(i=o.startContainer.textContent.substring(a-1,r),this.searchFilter(t,i,!0),s=1)}e=n.focusNode.textContent.substring(r-1,r);":"!==e||j.isNullOrUndefined(this.popupObj)||this.searchFilter(t,i=e,!0)}},gc.prototype.getCoordinates=function(){var e,t=(this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow:window).getSelection().getRangeAt(0),t=("P"!==t.startContainer.nodeName&&"DIV"!==t.startContainer.nodeName||"#text"!==t.startContainer.childNodes[0].nodeName&&(n=t.startContainer.childNodes[0]),(j.isNullOrUndefined(n)?t:n).getBoundingClientRect()),n=this.parent.element.querySelector(".e-rte-content"),i=this.parent.element,o=i.offsetHeight-n.offsetHeight,r=t.top-this.parent.inputElement.getBoundingClientRect().top,s=t.left-this.parent.inputElement.getBoundingClientRect().left,a=window.innerHeight,s=s+t.width;return i.getBoundingClientRect().top<0&&!this.parent.inlineMode.enable&&(r=r+n.getBoundingClientRect().top-o),t.top<330||t.top+330>a&&(r-=350),e=this.parent.inputElement?{top:r+60,left:s+8}:e},gc.prototype.removeEventListener=function(){this.parent.off(an,this.toolbarClick),this.parent.off(dt,this.docClick),this.parent.off(K,this.onIframeMouseDown),this.parent.off(h,this.onkeyPress),this.parent.off(ie,this.onkeyUp),this.parent.off($e,this.contentscroll),this.parent.off(Je,this.contentscroll),this.parent.off(o,this.destroy)},gc.prototype.getModuleName=function(){return"emojiPicker"};var mc=gc;function gc(e,t){this.noResultsFoundCount=0,this.parent=e,this.locator=t,this.i10n=t.getService("rteLocale"),this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1,this.isPopupDestroyed=!1}bc.prototype.addEventListener=function(){this.parent.on(oe,this.onImport,this),this.parent.on(re,this.onExport,this),this.parent.on(o,this.destroy,this)},bc.prototype.onImport=function(){var n=this;this.parent.trigger(Le,{cancel:!1,requestType:"Import"},function(e){var t;e.cancel||(n.uploaderObj=new U.Uploader({allowedExtensions:".doc,.docx,.rtf,.dot,.dotx,.docm,.dotm",asyncSettings:{saveUrl:n.parent.importWord.serviceUrl},success:function(e){n.parent.executeCommand("importWord",e.e.currentTarget.response,{undo:!0}),n.parent.trigger(ke,{requestType:"Import"})}}),n.parent.setProperties({enableXhtml:!0},!0),e=n.parent.createElement("div",{className:"e-import-uploadwrap e-droparea"+n.parent.getCssClass(!0)}),t=n.parent.createElement("input",{id:n.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"},className:n.parent.getCssClass()}),e.appendChild(t),n.uploaderObj.appendTo(t),n.uploaderObj.element.click(),n.uploaderObj.element.closest(".e-upload").style.display="none")})},bc.prototype.onExport=function(i){var t,n,e,o=this,r=(this.parent.setProperties({enableXhtml:!0},!0),this.parent.getHtml()),r=("ExportWord"===i.member?(t=this.parent.exportWord.fileName,n=this.parent.exportWord.serviceUrl,e="<html><head><style>"+this.parent.exportWord.stylesheet+"</style></head><body>"+r+"</body></html>"):"ExportPdf"===i.member&&(t=this.parent.exportPdf.fileName,n=this.parent.exportPdf.serviceUrl,e="<html><head><style>"+this.parent.exportPdf.stylesheet+"</style></head><body>"+r+"</body></html>"),{requestType:i.member,exportValue:e,cancel:!1});this.parent.trigger(Le,r,function(e){e.cancel||fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e.exportValue})}).then(function(e){if(e.ok)return e.blob().then(function(e){return{blob:e,filename:t}});throw new Error("HTTP error! Status: "+e.status)}).then(function(e){var t=e.blob,e=e.filename,t=window.URL.createObjectURL(t),n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t),o.parent.trigger(ke,{requestType:i.member})}).catch(function(e){console.error("Fetch error:",e)})})},bc.prototype.destroy=function(){this.parent.isDestroyed||(this.parent.off(oe,this.onImport),this.parent.off(re,this.onExport),this.parent.off(o,this.destroy),this.uploaderObj&&!this.uploaderObj.isDestroyed&&(this.uploaderObj.destroy(),this.uploaderObj=null))},bc.prototype.getModuleName=function(){return"importExport"};var fc=bc;function bc(e){this.parent=e,this.addEventListener()}var vc={bold:{command:"Style",subCommand:"Bold",value:"strong"},italic:{command:"Style",subCommand:"Italic",value:"em"},underline:{command:"Style",subCommand:"Underline",value:"span"},strikeThrough:{command:"Style",subCommand:"StrikeThrough",value:"span"},insertCode:{command:"Formats",subCommand:"Pre",value:"pre"},superscript:{command:"Effects",subCommand:"SuperScript",value:"sup"},subscript:{command:"Effects",subCommand:"SubScript",value:"sub"},uppercase:{command:"Casing",subCommand:"UpperCase"},lowercase:{command:"Casing",subCommand:"LowerCase"},fontColor:{command:"font",subCommand:"fontcolor",value:"#ff0000"},fontName:{command:"font",subCommand:"fontname",value:"Segoe UI"},fontSize:{command:"font",subCommand:"fontsize",value:"10pt"},backColor:{command:"font",subCommand:"backgroundcolor",value:"#ffff00"},justifyCenter:{command:"Alignments",subCommand:"JustifyCenter"},justifyFull:{command:"Alignments",subCommand:"JustifyFull"},justifyLeft:{command:"Alignments",subCommand:"JustifyLeft"},justifyRight:{command:"Alignments",subCommand:"JustifyRight"},undo:{command:"Actions",subCommand:"Undo"},redo:{command:"Actions",subCommand:"Redo"},createLink:{command:"Links",subCommand:"createLink"},editLink:{command:"Links",subCommand:"createLink"},createImage:{command:"Images",subCommand:"Images"},formatBlock:{command:"Formats",value:"P"},heading:{command:"Formats",value:"H1"},indent:{command:"Indents",subCommand:"Indent"},outdent:{command:"Indents",subCommand:"Outdent"},insertHTML:{command:"InsertHTML",subCommand:"InsertHTML",value:""},insertText:{command:"InsertText",subCommand:"InsertText",value:""},insertHorizontalRule:{command:"InsertHTML",subCommand:"InsertHTML",value:"<hr/>"},insertImage:{command:"Images",subCommand:"Image"},insertAudio:{command:"Audios",subCommand:"Audio"},insertVideo:{command:"Videos",subCommand:"Video"},editImage:{command:"Images",subCommand:"Image"},insertTable:{command:"Table",subCommand:"CreateTable"},insertBrOnReturn:{command:"InsertHTML",subCommand:"InsertHTML",value:"<br/>"},insertOrderedList:{command:"Lists",value:"OL"},insertUnorderedList:{command:"Lists",value:"UL"},insertParagraph:{command:"Formats",value:"P"},removeFormat:{command:"Clear",subCommand:"ClearFormat"},copyFormatPainter:{command:"FormatPainter",value:"format-copy"},applyFormatPainter:{command:"FormatPainter",value:"format-paste"},escapeFormatPainter:{command:"FormatPainter",value:"escape"},InlineCode:{command:"Style",subCommand:"inlinecode",value:"inlinecode"}},yc=(Cc.prototype.register=function(e,t){j.isNullOrUndefined(this.services[""+e])&&(this.services[""+e]=t)},Cc.prototype.getService=function(e){if(j.isNullOrUndefined(this.services[""+e]))throw"The service "+e+" is not registered";return this.services[""+e]},Cc.prototype.destroy=function(){this.services={}},Cc);function Cc(){this.services={}}Ec.prototype.addRenderer=function(e,t){e=j.getEnumValue(m.RenderType,e);j.isNullOrUndefined(this.rendererMap[""+e])&&(this.rendererMap[""+e]=t)},Ec.prototype.getRenderer=function(e){e=j.getEnumValue(m.RenderType,e);if(j.isNullOrUndefined(this.rendererMap[""+e]))throw"The renderer "+e+" is not found";return this.rendererMap[""+e]},Ec.prototype.destroy=function(){this.rendererMap={}};var Nc=Ec;function Ec(){this.rendererMap={}}Sc=function(e,t){return(Sc=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Sc,Tc,Oc=function(e,t){function n(){this.constructor=e}Sc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},D=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},e=(Tc=j.ChildProperty,Oc(Lc,Tc),D([j.Property(!0)],Lc.prototype,"enable",void 0),D([j.Property(!0)],Lc.prototype,"enableFloating",void 0),D([j.Property(m.ToolbarType.Expand)],Lc.prototype,"type",void 0),D([j.Property(e)],Lc.prototype,"items",void 0),D([j.Property({})],Lc.prototype,"itemConfigs",void 0),Lc);function Lc(){return null!==Tc&&Tc.apply(this,arguments)||this}kc=j.ChildProperty,Oc(xc,kc),D([j.Property(null)],xc.prototype,"serviceUrl",void 0);var kc,wc=xc;function xc(){return null!==kc&&kc.apply(this,arguments)||this}Dc=j.ChildProperty,Oc(Bc,Dc),D([j.Property(null)],Bc.prototype,"serviceUrl",void 0),D([j.Property("Sample.docx")],Bc.prototype,"fileName",void 0),D([j.Property(null)],Bc.prototype,"stylesheet",void 0);var Dc,Mc=Bc;function Bc(){return null!==Dc&&Dc.apply(this,arguments)||this}Rc=j.ChildProperty,Oc(Ic,Rc),D([j.Property(null)],Ic.prototype,"serviceUrl",void 0),D([j.Property("Sample.pdf")],Ic.prototype,"fileName",void 0),D([j.Property(null)],Ic.prototype,"stylesheet",void 0);var Rc,Ac=Ic;function Ic(){return null!==Rc&&Rc.apply(this,arguments)||this}Uc=j.ChildProperty,Oc(Hc,Uc),D([j.Property([".jpeg",".jpg",".png"])],Hc.prototype,"allowedTypes",void 0),D([j.Property("inline")],Hc.prototype,"display",void 0),D([j.Property("Blob")],Hc.prototype,"saveFormat",void 0),D([j.Property("auto")],Hc.prototype,"width",void 0),D([j.Property("auto")],Hc.prototype,"height",void 0),D([j.Property(null)],Hc.prototype,"saveUrl",void 0),D([j.Property(null)],Hc.prototype,"path",void 0),D([j.Property(!0)],Hc.prototype,"resize",void 0),D([j.Property(null)],Hc.prototype,"removeUrl",void 0),D([j.Property(0)],Hc.prototype,"minWidth",void 0),D([j.Property(null)],Hc.prototype,"maxWidth",void 0),D([j.Property(0)],Hc.prototype,"minHeight",void 0),D([j.Property(null)],Hc.prototype,"maxHeight",void 0),D([j.Property(!1)],Hc.prototype,"resizeByPercent",void 0);var Uc,Pc=Hc;function Hc(){return null!==Uc&&Uc.apply(this,arguments)||this}jc=j.ChildProperty,Oc(qc,jc),D([j.Property([".wav",".mp3",".m4a",".wma"])],qc.prototype,"allowedTypes",void 0),D([j.Property("Inline")],qc.prototype,"layoutOption",void 0),D([j.Property("Blob")],qc.prototype,"saveFormat",void 0),D([j.Property(null)],qc.prototype,"saveUrl",void 0),D([j.Property(null)],qc.prototype,"removeUrl",void 0),D([j.Property(null)],qc.prototype,"path",void 0);var jc,Fc=qc;function qc(){return null!==jc&&jc.apply(this,arguments)||this}zc=j.ChildProperty,Oc(Vc,zc),D([j.Property([".mp4",".mov",".wmv",".avi"])],Vc.prototype,"allowedTypes",void 0),D([j.Property("Inline")],Vc.prototype,"layoutOption",void 0),D([j.Property("Blob")],Vc.prototype,"saveFormat",void 0),D([j.Property("auto")],Vc.prototype,"width",void 0),D([j.Property("auto")],Vc.prototype,"height",void 0),D([j.Property(null)],Vc.prototype,"saveUrl",void 0),D([j.Property(null)],Vc.prototype,"path",void 0),D([j.Property(!0)],Vc.prototype,"resize",void 0),D([j.Property(null)],Vc.prototype,"removeUrl",void 0),D([j.Property(0)],Vc.prototype,"minWidth",void 0),D([j.Property(null)],Vc.prototype,"maxWidth",void 0),D([j.Property(0)],Vc.prototype,"minHeight",void 0),D([j.Property(null)],Vc.prototype,"maxHeight",void 0),D([j.Property(!1)],Vc.prototype,"resizeByPercent",void 0);var zc,_c=Vc;function Vc(){return null!==zc&&zc.apply(this,arguments)||this}Qc=j.ChildProperty,Oc(Kc,Qc),D([j.Event()],Kc.prototype,"beforeSend",void 0),D([j.Complex({getImageUrl:null,url:null,uploadUrl:null},z.AjaxSettings)],Kc.prototype,"ajaxSettings",void 0),D([j.Property(!1)],Kc.prototype,"allowDragAndDrop",void 0),D([j.Complex({visible:!0,file:["Open","|","Cut","Copy","|","Delete","Rename","|","Details"],folder:["Open","|","Cut","Copy","Paste","|","Delete","Rename","|","Details"],layout:["SortBy","View","Refresh","|","Paste","|","NewFolder","Upload","|","Details","|","SelectAll"]},z.ContextMenuSettings)],Kc.prototype,"contextMenuSettings",void 0),D([j.Property("")],Kc.prototype,"cssClass",void 0),D([j.Complex({},z.DetailsViewSettings)],Kc.prototype,"detailsViewSettings",void 0),D([j.Property(!1)],Kc.prototype,"enable",void 0),D([j.Complex({maxWidth:"650px",minWidth:"240px",visible:!0},z.NavigationPaneSettings)],Kc.prototype,"navigationPaneSettings",void 0),D([j.Property("/")],Kc.prototype,"path",void 0),D([j.Property(null)],Kc.prototype,"rootAliasName",void 0),D([j.Complex({},z.SearchSettings)],Kc.prototype,"searchSettings",void 0),D([j.Property(!0)],Kc.prototype,"showFileExtension",void 0),D([j.Property(!1)],Kc.prototype,"showHiddenItems",void 0),D([j.Property(!0)],Kc.prototype,"showThumbnail",void 0),D([j.Property("Ascending")],Kc.prototype,"sortOrder",void 0),D([j.Complex({visible:!0,items:["NewFolder","Upload","Cut","Copy","Paste","Delete","Download","Rename","SortBy","Refresh","Selection","View","Details"]},z.ToolbarSettings)],Kc.prototype,"toolbarSettings",void 0),D([j.Complex({autoUpload:!0,minFileSize:0,maxFileSize:3e7,allowedExtensions:"",autoClose:!1},z.UploadSettings)],Kc.prototype,"uploadSettings",void 0),D([j.Property("LargeIcons")],Kc.prototype,"view",void 0);var Qc,Wc=Kc;function Kc(){return null!==Qc&&Qc.apply(this,arguments)||this}Gc=j.ChildProperty,Oc(Yc,Gc),D([j.Property("100%")],Yc.prototype,"width",void 0),D([j.Property($o)],Yc.prototype,"styles",void 0),D([j.Property(!0)],Yc.prototype,"resize",void 0),D([j.Property(0)],Yc.prototype,"minWidth",void 0),D([j.Property(null)],Yc.prototype,"maxWidth",void 0);var Gc,Xc=Yc;function Yc(){return null!==Gc&&Gc.apply(this,arguments)||this}Jc=j.ChildProperty,Oc(Zc,Jc),D([j.Property(!0)],Zc.prototype,"enable",void 0),D([j.Property(!1)],Zc.prototype,"showOnRightClick",void 0),D([j.Property("hide")],Zc.prototype,"actionOnScroll",void 0),D([j.Property(["Open","Edit","UnLink"])],Zc.prototype,"link",void 0),D([j.Property(["Replace","Align","Caption","Remove","-","InsertLink","OpenImageLink","EditImageLink","RemoveImageLink","Display","AltText","Dimension"])],Zc.prototype,"image",void 0),D([j.Property(["AudioReplace","AudioRemove","AudioLayoutOption"])],Zc.prototype,"audio",void 0),D([j.Property(["VideoReplace","VideoAlign","VideoRemove","VideoLayoutOption","VideoDimension"])],Zc.prototype,"video",void 0),D([j.Property(null)],Zc.prototype,"text",void 0),D([j.Property(["TableHeader","TableRows","TableColumns","BackgroundColor","-","TableRemove","Alignments","TableCellVerticalAlign","Styles"])],Zc.prototype,"table",void 0);var Jc,$c=Zc;function Zc(){return null!==Jc&&Jc.apply(this,arguments)||this}ep=j.ChildProperty,Oc(np,ep),D([j.Property("b; em; font; sub; sup; kbd; i; s; u; code; strong; span; p; div; h1; h2; h3; h4; h5; h6; blockquote; ol; ul; li; pre;")],np.prototype,"allowedFormats",void 0),D([j.Property(null)],np.prototype,"deniedFormats",void 0);var ep,tp=np;function np(){return null!==ep&&ep.apply(this,arguments)||this}ip=j.ChildProperty,Oc(op,ip),D([j.Property(lr)],op.prototype,"iconsSet",void 0),D([j.Property(!0)],op.prototype,"showSearchBox",void 0);var ip,lr=op;function op(){return null!==ip&&ip.apply(this,arguments)||this}rp=j.ChildProperty,Oc(ap,rp),D([j.Property(!1)],ap.prototype,"prompt",void 0),D([j.Property(null)],ap.prototype,"deniedAttrs",void 0),D([j.Property(["background","background-color","border","border-bottom","border-left","border-radius","border-right","border-style","border-top","border-width","clear","color","cursor","direction","display","float","font","font-family","font-size","font-weight","font-style","height","left","line-height","list-style-type","margin","margin-top","margin-left","margin-right","margin-bottom","max-height","max-width","min-height","min-width","overflow","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","position","right","table-layout","text-align","text-decoration","text-transform","text-indent","top","vertical-align","visibility","white-space","width","flex-direction"])],ap.prototype,"allowedStyleProps",void 0),D([j.Property(null)],ap.prototype,"deniedTags",void 0),D([j.Property(!0)],ap.prototype,"keepFormat",void 0),D([j.Property(!1)],ap.prototype,"plainText",void 0);var rp,sp=ap;function ap(){return null!==rp&&rp.apply(this,arguments)||this}lp=j.ChildProperty,Oc(cp,lp),D([j.Property(null)],cp.prototype,"default",void 0),D([j.Property("72px")],cp.prototype,"width",void 0),D([j.Property(Zo)],cp.prototype,"items",void 0);var lp,dp=cp;function cp(){return null!==lp&&lp.apply(this,arguments)||this}pp=j.ChildProperty,Oc(hp,pp),D([j.Property(null)],hp.prototype,"default",void 0),D([j.Property("60px")],hp.prototype,"width",void 0),D([j.Property(er)],hp.prototype,"items",void 0);var pp,er=hp;function hp(){return null!==pp&&pp.apply(this,arguments)||this}up=j.ChildProperty,Oc(gp,up),D([j.Property(null)],gp.prototype,"default",void 0),D([j.Property("65px")],gp.prototype,"width",void 0),D([j.Property(tr)],gp.prototype,"types",void 0);var up,mp=gp;function gp(){return null!==up&&up.apply(this,arguments)||this}fp=j.ChildProperty,Oc(bp,fp),D([j.Property("#ff0000")],bp.prototype,"default",void 0),D([j.Property("Palette")],bp.prototype,"mode",void 0),D([j.Property(10)],bp.prototype,"columns",void 0),D([j.Property(nr)],bp.prototype,"colorCode",void 0),D([j.Property(!1)],bp.prototype,"modeSwitcher",void 0);var fp,nr=bp;function bp(){return null!==fp&&fp.apply(this,arguments)||this}vp=j.ChildProperty,Oc(yp,vp),D([j.Property("#ffff00")],yp.prototype,"default",void 0),D([j.Property("Palette")],yp.prototype,"mode",void 0),D([j.Property(10)],yp.prototype,"columns",void 0),D([j.Property(ir)],yp.prototype,"colorCode",void 0),D([j.Property(!1)],yp.prototype,"modeSwitcher",void 0);var vp,ir=yp;function yp(){return null!==vp&&vp.apply(this,arguments)||this}Cp=j.ChildProperty,Oc(Ep,Cp),D([j.Property(or)],Ep.prototype,"types",void 0);var Cp,Np=Ep;function Ep(){return null!==Cp&&Cp.apply(this,arguments)||this}Sp=j.ChildProperty,Oc(Tp,Sp),D([j.Property(rr)],Tp.prototype,"types",void 0);var Sp,Oc=Tp;function Tp(){return null!==Sp&&Sp.apply(this,arguments)||this}Op=function(e,t){return(Op=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Op,Lp,D=function(e,t){function n(){this.constructor=e}Op(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},kp=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},wp=(Lp=j.ChildProperty,D(xp,Lp),kp([j.Property([])],xp.prototype,"styles",void 0),kp([j.Property([])],xp.prototype,"scripts",void 0),xp);function xp(){return null!==Lp&&Lp.apply(this,arguments)||this}Dp=j.ChildProperty,D(Mp,Dp),kp([j.Property(!1)],Mp.prototype,"enable",void 0),kp([j.Property(null)],Mp.prototype,"attributes",void 0),kp([j.Complex({},wp)],Mp.prototype,"resources",void 0),kp([j.Property([])],Mp.prototype,"metaTags",void 0),kp([j.Property(null)],Mp.prototype,"sandbox",void 0);var Dp,D=Mp;function Mp(){return null!==Dp&&Dp.apply(this,arguments)||this}Bp=function(e,t){return(Bp=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Bp,Rp,wp=function(e,t){function n(){this.constructor=e}Bp(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},kp=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},wp=(Rp=j.ChildProperty,wp(Ap,Rp),kp([j.Property(!1)],Ap.prototype,"enable",void 0),kp([j.Property(!0)],Ap.prototype,"onSelection",void 0),Ap);function Ap(){return null!==Rp&&Rp.apply(this,arguments)||this}Up.prototype.addEventListener=function(){this.parent.on(mt,this.enterHandler,this),this.parent.on(o,this.destroy,this)},Up.prototype.destroy=function(){j.isNullOrUndefined(this.parent)||this.removeEventListener()},Up.prototype.removeEventListener=function(){this.parent.off(mt,this.enterHandler),this.parent.off(o,this.destroy)},Up.prototype.getRangeNode=function(){this.range=this.parent.getRange(),this.startNode="#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement:this.range.startContainer,this.endNode="#text"===this.range.endContainer.nodeName?this.range.endContainer.parentElement:this.range.endContainer},Up.prototype.enterHandler=function(N){var E=this,S=(this.getRangeNode(),!0),e=(this.formatTags=["h1","h2","h3","h4","h5","h6","blockquote"],this.processedTableImageCursor());if(!e.start&&!e.end||"TABLE"!==e.startName&&"TABLE"!==e.endName)if(!e.start&&!e.end&&"IMG"!==this.range.startContainer.nodeName||"BR"!==this.parent.enterKey||"IMG"!==e.startName&&"IMG"!==e.endName&&"IMG"!==this.range.startContainer.nodeName){if(!j.isNullOrUndefined(this.startNode.closest("TABLE"))&&!j.isNullOrUndefined(this.endNode.closest("TABLE"))){for(var S=!1,t=this.startNode,n=t;!this.parent.formatter.editorManager.domNode.isBlockNode(t);)n=t=t.parentElement;S="TH"!==n.tagName&&"TD"!==n.tagName&&"TBODY"!==n.tagName}var T,i=N.args;13!==i.which||i.ctrlKey||(j.Browser.isDevice?"Enter"!==i.key:"Enter"!==i.code&&"NumpadEnter"!==i.code)||j.isNullOrUndefined(this.startNode.closest("LI, UL, OL"))&&j.isNullOrUndefined(this.endNode.closest("LI, UL, OL"))&&j.isNullOrUndefined(this.startNode.closest(".e-img-inner"))&&S&&j.isNullOrUndefined(this.startNode.closest("PRE"))&&j.isNullOrUndefined(this.endNode.closest("PRE"))&&j.isNullOrUndefined(this.startNode.closest("BLOCKQUOTE"))&&j.isNullOrUndefined(this.endNode.closest("BLOCKQUOTE"))&&(T=N.args.shiftKey,i={cancel:!1,name:Le,requestType:T?"ShiftEnterAction":"EnterAction",originalEvent:N.args},this.parent.trigger(Le,i,function(e){if(!e.cancel){if(0===E.parent.formatter.getUndoRedoStack().length&&E.parent.formatter.saveData(),E.range.startOffset!==E.range.endOffset||E.range.startContainer!==E.range.endContainer)if("SPAN"===E.range.startContainer.nodeName&&(E.range.startContainer.classList.contains("e-video-wrap")||E.range.startContainer.classList.contains("e-audio-wrap"))||E.range.deleteContents(),"#text"===E.range.startContainer.nodeName&&0===E.range.startContainer.textContent.length&&E.range.startContainer.parentElement!==E.parent.inputElement)"BR"===E.parent.enterKey?E.range.startContainer.parentElement.innerHTML="&#8203;":E.range.startContainer.parentElement.innerHTML="<br>";else if(E.range.startContainer===E.parent.inputElement&&""===E.range.startContainer.innerHTML){E.range.startContainer.innerHTML="<br>";var t=E.range.startContainer.childNodes[E.range.startOffset];E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),t,0)}else if(E.parent.inputElement===E.range.startContainer){if("#text"===(t=E.range.startContainer.childNodes[E.range.startOffset]).nodeName&&0===t.textContent.length)E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),t,0===t.textContent.length?0:t.previousSibling.textContent.length);else if(E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),t,0<=t.textContent.length?0:1),0===t.previousSibling.textContent.length){if(j.detach(t.previousSibling),!T){for(var n=j.isNullOrUndefined(t.lastChild)?t:t.lastChild;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName&&"BR"!==n.nodeName;)n=n.lastChild;"BR"!==n.nodeName&&0===n.parentElement.textContent.length&&0===n.parentElement.innerHTML.length&&"BR"!==n.parentElement.nodeName&&n.parentElement.appendChild(E.parent.createElement("BR")),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),"BR"===n.nodeName?n:n.parentElement,0<=n.parentElement.textContent.length||"BR"===n.nodeName?0:1)}}else if(0===t.textContent.length){for(n="#text"===t.previousSibling.nodeName?t.previousSibling:t.previousSibling.lastChild;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName;)n=n.lastChild;E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),n,n.textContent.length),j.detach(t)}else if("BR"!==E.parent.enterKey&&0!==t.previousSibling.textContent.length&&0!==t.textContent.length)return void N.args.preventDefault();E.getRangeNode()}if(E.range.startContainer===E.range.endContainer&&E.range.startOffset===E.range.endOffset&&E.range.startContainer===E.parent.inputElement){if(1!==E.parent.inputElement.childNodes.length||"TABLE"!==E.parent.inputElement.childNodes[0].nodeName)if(j.isNullOrUndefined(E.range.startContainer.childNodes[E.range.startOffset])){for(var i=E.range.startContainer.childNodes[E.range.startOffset-1];null!==i.lastChild&&"#text"!==i.nodeName;)i=i.lastChild;E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),i,"BR"===i.nodeName?0:i.textContent.length)}else E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),E.range.startContainer.childNodes[E.range.startOffset],0);E.getRangeNode()}if("P"===E.parent.enterKey&&!T||"DIV"===E.parent.enterKey&&!T||"P"===E.parent.shiftEnterKey&&T||"DIV"===E.parent.shiftEnterKey&&T){if(1===E.range.startOffset&&1===E.parent.inputElement.childNodes.length&&"TABLE"===E.parent.inputElement.childNodes[0].nodeName)(c=E.createInsertElement(T)).appendChild(E.parent.createElement("BR")),E.parent.inputElement.appendChild(c),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),c,0);else{var e=void 0,e=S&&E.parent.formatter.editorManager.domNode.isBlockNode(E.startNode)?"#text"!==E.range.startContainer.nodeName||j.isNullOrUndefined(E.range.startContainer.previousSibling)||"HR"!==E.range.startContainer.previousSibling.nodeName?E.startNode:E.range.startContainer.nextSibling:E.parent.formatter.editorManager.domNode.blockParentNode(E.startNode),o=!1,r=!1,s=E.range.startContainer.parentElement,a=!1,l=!1,d=(s&&(a="pre-wrap"===(s=E.parent.contentModule.getDocument().defaultView.getComputedStyle(s)).getPropertyValue("white-space"),l="nowrap"===s.getPropertyValue("text-wrap")),0===E.range.startOffset||0===E.range.endOffset||E.range.startContainer!==E.range.endContainer||!j.isNullOrUndefined(e.childNodes[0])&&("IMG"===e.childNodes[0].nodeName||0<e.querySelectorAll("img, audio, video").length)?0===E.range.startOffset&&0===E.range.endOffset&&(r=!0):(d=(p=(s=E.range.startContainer.textContent).substring(0,E.range.startOffset)).charCodeAt(E.range.startOffset-1),p=0===p.trim().length,s=0!==s.slice(E.range.startOffset).trim().length,(160!==d&&p&&!a&&!l||32===d&&(a||l)&&p&&s)&&!E.range.startContainer.previousSibling&&(r=!0)),E.removeBRElement(e),-1!==j.Browser.userAgent.indexOf("Firefox")&&0===E.range.startOffset&&E.range.startContainer===E.range.endContainer&&"#text"===E.range.startContainer.nodeName&&!j.isNullOrUndefined(E.range.startContainer.previousSibling)&&!E.parent.formatter.editorManager.domNode.isBlockNode(E.range.startContainer.previousSibling)&&E.range.startContainer.parentElement===E.range.startContainer.previousSibling.parentElement),a="#text"===E.range.startContainer.nodeName&&E.range.startContainer.textContent.includes("")&&""===E.range.startContainer.textContent.trim()||"#text"===E.range.startContainer.nodeName&&!j.isNullOrUndefined(E.range.startContainer.textContent[E.range.startOffset])&&E.range.startContainer.textContent[E.range.startOffset].includes("")&&""===E.range.startContainer.textContent[E.range.startOffset]&&""!==E.parent.inputElement.textContent[0];if(("#text"===E.range.startContainer.nodeName||"BR"===E.range.startContainer.nodeName)&&0===E.range.startOffset&&0===E.range.endOffset&&E.range.startContainer.parentElement===E.parent.inputElement&&"BR"===E.parent.enterKey&&T||a||d||!(0===E.range.startOffset&&0===E.range.endOffset||r)||!(j.isNullOrUndefined(E.range.startContainer.previousSibling)||"IMG"!==E.range.startContainer.previousSibling.nodeName&&"BR"!==E.range.startContainer.previousSibling.nodeName))if(e===E.parent.inputElement||0!==e.textContent.length||(!j.isNullOrUndefined(e.childNodes[0])&&"IMG"===e.childNodes[0].nodeName||0<e.querySelectorAll("video").length||0<e.querySelectorAll("audio").length||0<e.querySelectorAll("img").length))if(E.range.startContainer===E.range.endContainer&&"SPAN"===E.range.startContainer.nodeName&&(E.range.startContainer.classList.contains("e-video-wrap")||E.range.startContainer.classList.contains("e-audio-wrap"))){if(0<e.textContent.trim().length){for(var c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,e,!0),l=j.isNullOrUndefined(c.previousSibling.querySelector(".e-video-wrap"))?c.previousSibling.querySelector(".e-audio-wrap"):c.previousSibling.querySelector(".e-video-wrap"),p=!1,h=l.previousSibling;!j.isNullOrUndefined(h)&&"#text"!==h.nodeName;)h=h.lastChild;j.isNullOrUndefined(h)&&(u=E.parent.createElement("br"),l.parentElement.appendChild(u),p=!0),p?E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),l.parentElement,0):E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),h,h.textContent.length),j.detach(l)}else{for(t=(c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,e,!0)).previousSibling;!j.isNullOrUndefined(t.firstChild);)j.detach(t.firstChild);var u=E.parent.createElement("br");t.appendChild(u),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),t,0)}j.isNullOrUndefined(E.parent.audioModule)||E.parent.audioModule.hideAudioQuickToolbar(),j.isNullOrUndefined(E.parent.videoModule)||E.parent.videoModule.hideVideoQuickToolbar()}else if("BR"===E.parent.enterKey&&T&&E.range.startContainer.nodeType===Node.TEXT_NODE&&E.range.startContainer.parentElement&&E.range.startContainer.parentElement===E.parent.inputElement){s=E.range,a=s.startContainer,d=s.startOffset,r=E.parent.createElement(E.parent.shiftEnterKey);a.nodeType===Node.TEXT_NODE&&0!==s.endOffset&&0!==s.startOffset?(d<(p=a).length?(l=p.splitText(d),r.appendChild(l)):r.innerHTML="<br>",p.parentNode.insertBefore(r,p.nextSibling),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),r,0)):0===d&&0===s.endOffset&&(r.innerHTML="<br>",s.endOffset===a.textContent.length&&(l=E.parent.createElement("br"),a.parentNode.insertBefore(l,a)),a.parentNode.insertBefore(r,a),p=s.endOffset===a.textContent.length?r:r.nextSibling,a.parentNode.insertBefore(r,a),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),p,0))}else{c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,e,!0);if(j.isNullOrUndefined(c.childNodes[0])||"#text"!==c.childNodes[0].nodeName||0!==c.childNodes[0].textContent.length||j.detach(c.childNodes[0]),(0===c.textContent.trim().length||c.childNodes[0].textContent.trim().includes("")&&""===c.childNodes[0].textContent.trim())&&(u=E.parent.createElement("br"),"A"===E.startNode.nodeName?(d=E.startNode.parentElement,E.startNode.parentElement.insertBefore(u,E.startNode),j.detach(E.startNode),E.startNode=d):"BR"!==E.startNode.nodeName&&E.startNode.appendChild(u),"\n"===c.childNodes[0].textContent&&j.detach(c.childNodes[0]),c.childNodes[0].textContent.trim().includes("")&&""===c.childNodes[0].textContent.trim()&&j.detach(c.childNodes[0]),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),E.startNode,0)),("P"===E.parent.enterKey||"DIV"===E.parent.enterKey)&&!T||("DIV"===E.parent.shiftEnterKey||"P"===E.parent.shiftEnterKey)&&T){l=E.formatTags.indexOf(c.nodeName.toLocaleLowerCase());if(l<0||0<=l&&0===c.textContent.trim().length){for(var m=E.createInsertElement(T);c.firstChild;)m.appendChild(c.firstChild);E.parent.formatter.editorManager.domNode.insertAfter(m,c),j.detach(c),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),E.parent.formatter.editorManager.domNode.isBlockNode(E.startNode)?m:E.startNode,0)}}}else j.isNullOrUndefined(e.children[0])||"BR"===e.children[0].tagName?((g=E.createInsertElement(T)).innerHTML="<br>",E.parent.formatter.editorManager.domNode.insertAfter(g,e),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),g,0)):(c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,e,!1).cloneNode(!0),E.parent.formatter.editorManager.domNode.insertAfter(c,e),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),c,0<=c.textContent.length?0:1));else{var s=void 0,c=void 0,s=j.isNullOrUndefined(E.range.startContainer.childNodes)||0!==E.range.startContainer.textContent.length&&("#text"===E.range.startContainer.nodeName||j.isNullOrUndefined(E.range.startContainer.querySelector(".e-video-clickelem"))||0!==E.range.startContainer.querySelector(".e-video-clickelem").textContent.length)||!(0<E.range.startContainer.querySelectorAll("img, audio, video").length)&&j.isNullOrUndefined(E.range.startContainer.querySelector(".e-video-clickelem"))&&"IMG"!==E.range.startContainer.nodeName&&"TABLE"!==E.range.startContainer.nodeName?0!==e.textContent.trim().length||!j.isNullOrUndefined(e.childNodes[0])&&"IMG"===e.childNodes[0].nodeName||""===e.textContent.trim()&&0<e.querySelectorAll("img, audio, video").length?(E.range.startOffset===E.range.endOffset&&0!==E.range.startOffset?c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,e,!1).cloneNode(!0):(c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,e,!0).cloneNode(!0),o=!0),!1):(c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,e,!0).cloneNode(!0),!0):(c=E.createInsertElement(T),!(o=!0)),g=void 0;for(g=E.formatTags.indexOf(c.nodeName.toLocaleLowerCase())<0?E.createInsertElement(T):E.parent.createElement(c.nodeName);c.firstChild;)g.appendChild(c.firstChild);if(e.parentElement.insertBefore(g,e),!s){var n=g,f=void 0;if(E.range.startOffset===E.range.endOffset&&0!==E.range.startOffset)for(;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName&&"BR"!==n.nodeName;)n=(f=n).lastChild;else f=n;f.innerHTML="<br>",o||j.detach(e)}E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),g.nextElementSibling,0)}}N.args.preventDefault()}if("BR"===E.parent.enterKey&&!T||"BR"===E.parent.shiftEnterKey&&T){r=void 0;if(E.parent.formatter.editorManager.domNode.isBlockNode(E.startNode))r=E.startNode;else{for(var b=E.startNode,v=b;!E.parent.formatter.editorManager.domNode.isBlockNode(b);)b=(v=b).parentElement;r=b===E.parent.inputElement?v:b}for(var a=window.getComputedStyle(r),y=(E.removeBRElement(r),r.lastChild);!j.isNullOrUndefined(y)&&"#text"!==y.nodeName&&"BR"!==y.nodeName&&"IMG"!==y.nodeName;)y=y.lastChild;p=(E.range.startContainer===y?E.range.startContainer:r).textContent.length,d="IMG"===E.range.startContainer.nodeName||0<E.range.startContainer.childNodes.length&&!j.isNullOrUndefined(E.range.startContainer.childNodes[E.range.startOffset])&&"IMG"===E.range.startContainer.childNodes[E.range.startOffset].nodeName||1===E.range.startContainer.nodeType&&null!==E.range.startContainer.querySelector("img");if(r!==E.parent.inputElement&&E.parent.formatter.editorManager.domNode.isBlockNode(r)&&E.range.startOffset===E.range.endOffset&&(E.range.startOffset===p||0===r.textContent.trim().length&&d)){u=E.parent.createElement("br");0===E.range.startOffset&&"TABLE"===E.range.startContainer.nodeName?E.range.startContainer.parentElement.insertBefore(u,E.range.startContainer):"BR"===y.nodeName&&0===r.textContent.length?E.parent.formatter.editorManager.domNode.insertAfter(u,y):0===E.range.startOffset&&0===E.range.endOffset&&d?(l="IMG"===E.range.startContainer.nodeName?E.range.startContainer:E.range.startContainer.childNodes[E.range.startOffset],r.insertBefore(u,l),u=l):(s=E.parent.createElement("br"),o=j.isNullOrUndefined(E.range.startContainer.parentElement)||"A"!==E.range.startContainer.parentElement.nodeName||E.range.startContainer.parentElement.textContent.length!==E.range.startOffset?E.range.startContainer:E.range.startContainer.parentElement,E.parent.formatter.editorManager.domNode.insertAfter(u,o),E.parent.formatter.editorManager.domNode.insertAfter(s,o),e=o.nextElementSibling,p=j.isNullOrUndefined(e)?null:e.nextElementSibling,j.isNullOrUndefined(e)||j.isNullOrUndefined(p)||j.isNullOrUndefined(p.nextElementSibling)||"BR"!==e.nodeName||"BR"!==p.nodeName||"BR"!==p.nextElementSibling.nodeName||p.nextElementSibling.remove()),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),u,0)}else if(j.isNullOrUndefined(r)||r===E.parent.inputElement||"BR"===r.nodeName)E.insertBRElement();else if(0===r.textContent.trim().length||1===r.textContent.trim().length&&8203===r.textContent.charCodeAt(0))1<r.childElementCount&&"IMG"===r.lastElementChild.nodeName?E.insertBRElement():(c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,r,!0).cloneNode(!0),E.parent.formatter.editorManager.domNode.insertAfter(c,r),C=E.parent.createElement("br"),c.parentElement.insertBefore(C,c),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),c,0));else{var c=void 0,C=E.parent.createElement("br");if(0!==E.range.startOffset||0!==E.range.endOffset||j.isNullOrUndefined(r.previousSibling)||"BR"!==r.previousSibling.nodeName||"P"===r.nodeName||"DIV"===r.nodeName)r===E.parent.inputElement||"inline"!==a.display&&"inline-block"!==a.display?E.insertBRElement():(c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,r,!0).cloneNode(!0),r.parentElement.insertBefore(C,r),E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),r,0),E.insertFocusContent());else{c=E.parent.formatter.editorManager.nodeCutter.SplitNode(E.range,r,!1).cloneNode(!0),E.parent.formatter.editorManager.domNode.insertAfter(C,r),E.insertFocusContent();for(n=C.nextSibling;!j.isNullOrUndefined(n)&&"#text"!==n.nodeName;)n=n.lastChild;E.parent.formatter.editorManager.nodeSelection.setCursorPoint(E.parent.contentModule.getDocument(),n,0)}}N.args.preventDefault()}E.triggerActionComplete(N,T),E.parent.inputElement.dispatchEvent(new Event("input"))}}))}else this.handleEnterKeyAtImageSide(N,e.start,e.end);else this.handleCursorAtTableSide(N,e.start,e.end)},Up.prototype.removeBRElement=function(e){-1!==j.Browser.userAgent.indexOf("Firefox")&&this.range.endOffset===e.textContent.length&&(0!==e.textContent.length||1<e.querySelectorAll("BR").length)&&!j.isNullOrUndefined(e.lastChild)&&"BR"===e.lastChild.nodeName&&j.detach(e.lastChild)},Up.prototype.insertBRElement=function(){for(var e=!1,t=!0,n=(0===this.range.endContainer.textContent.length&&"BR"===this.range.startContainer.nodeName&&(t=!1),this.parent.createElement("br")),i=this.startNode;i.lastChild;)i=i.lastChild;var o="A"===this.startNode.nodeName&&"A"===this.endNode.nodeName&&!j.isNullOrUndefined(this.range.startContainer.parentElement)&&this.range.startOffset===this.range.endOffset&&this.range.startContainer.textContent.trim().length===i.textContent.trim().length;"BR"===this.startNode.nodeName&&"BR"===this.endNode.nodeName&&0===this.range.startOffset&&this.range.startOffset===this.range.endOffset?(this.parent.formatter.editorManager.domNode.insertAfter(n,this.startNode),e=!0):(this.startNode!==this.parent.inputElement||j.isNullOrUndefined(this.range.startContainer.previousSibling)||"BR"!==this.range.startContainer.previousSibling.nodeName||0!==this.range.startContainer.textContent.length||(e=!0),o?this.parent.formatter.editorManager.domNode.insertAfter(n,this.startNode):this.range.insertNode(n)),e||!j.isNullOrUndefined(n.nextElementSibling)&&"BR"===n.nextElementSibling.tagName||!j.isNullOrUndefined(n.nextSibling)&&(0<n.nextSibling.textContent.length||"#text"===n.nextSibling.nodeName&&0===n.nextSibling.textContent.trim().length&&!j.isNullOrUndefined(n.nextSibling.nextSibling)&&0<n.nextSibling.nextSibling.textContent.trim().length)?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),!j.isNullOrUndefined(n.nextSibling)&&t?n.nextSibling:n,0):(e=this.parent.createElement("br"),o?this.parent.formatter.editorManager.domNode.insertAfter(e,this.startNode):this.range.insertNode(e),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),n,0))},Up.prototype.insertFocusContent=function(){0===this.range.startContainer.textContent.length&&("#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement.innerHTML="&#8203;":this.range.startContainer.innerHTML="&#8203;")},Up.prototype.createInsertElement=function(e){"DIV"===this.parent.enterKey&&!e||"DIV"===this.parent.shiftEnterKey&&e?t=this.parent.createElement("div"):("P"===this.parent.enterKey&&!e||"P"===this.parent.shiftEnterKey&&e)&&(t=this.parent.createElement("p"));var t,e=this.parent.formatter.editorManager.domNode.blockNodes()[0].previousSibling,n=this.parent.formatter.editorManager.domNode.blockNodes()[0].nextSibling;return!j.isNullOrUndefined(e)&&"#text"!==e.nodeName&&e.hasAttribute("style")&&"TABLE"!==e.nodeName&&t.setAttribute("style",e.getAttribute("style")),j.isNullOrUndefined(e)&&!j.isNullOrUndefined(n)&&"#text"!==n.nodeName&&n.hasAttribute("style")&&"TABLE"!==n.nodeName&&t.setAttribute("style",n.getAttribute("style")),t},Up.prototype.triggerActionComplete=function(e,t){this.parent.trigger(ke,{requestType:t?"ShiftEnterAction":"EnterAction",args:e.args})},Up.prototype.handleCursorAtTableSide=function(n,i,o){var r,e,s=this;"BR"!==this.parent.enterKey&&(r=n.args.shiftKey,e={cancel:!1,name:Le,requestType:r?"ShiftEnterAction":"EnterAction",originalEvent:n.args},this.parent.trigger(Le,e,function(e){var t;e.cancel||(t=void((e=s.parent.createElement(s.parent.enterKey)).innerHTML="<br>"),i&&(t=s.range.startContainer.childNodes[s.range.startOffset]).parentElement.insertBefore(e,t),o&&(t=s.range.startContainer.childNodes[s.range.startOffset-1],j.isNullOrUndefined(t.nextSibling)?j.isNullOrUndefined(t.nextSibling)&&t.parentElement.appendChild(e):t.parentElement.insertBefore(e,t.nextSibling)),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),e,0),n.args.preventDefault(),s.triggerActionComplete(n,r))}))},Up.prototype.handleEnterKeyAtImageSide=function(i,o,r){var s=this,e={cancel:!1,name:Le,requestType:i.args.shiftKey?"ShiftEnterAction":"EnterAction",originalEvent:i.args},a=!1;"IMG"===this.range.startContainer.nodeName&&0===this.range.startOffset&&(a=!0),this.parent.trigger(Le,e,function(e){var t,n;e.cancel||"BR"===s.parent.enterKey&&(e=s.parent.createElement("BR"),n=void 0,a&&((n=s.range.startContainer).parentElement.insertBefore(e,n),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),n,0)),o&&((n=s.range.startContainer.childNodes[s.range.startOffset]).parentElement.insertBefore(e,n),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),n,0)),r&&(n=s.range.startContainer.childNodes[s.range.startOffset-1],j.isNullOrUndefined(n.nextSibling)?j.isNullOrUndefined(n.nextSibling)&&(n.parentElement.appendChild(e),t=s.parent.createElement("BR"),n.parentElement.appendChild(t),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),t,0)):(n.parentElement.insertBefore(e,n.nextSibling),s.parent.formatter.editorManager.nodeSelection.setCursorPoint(s.parent.contentModule.getDocument(),e.nextSibling,0))),i.args.preventDefault(),s.triggerActionComplete(i,i.args.shiftKey))})},Up.prototype.isTableOrImageStart=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t]&&-1<["IMG","TABLE"].indexOf(e.childNodes[t].nodeName);return n?{start:n,startNodeName:e.childNodes[t].nodeName}:{start:!1,startNodeName:""}},Up.prototype.isTableOrImageEnd=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t-1]&&-1<["IMG","TABLE"].indexOf(e.childNodes[t-1].nodeName);return n?{end:n,endNodeName:e.childNodes[t-1].nodeName}:{end:!1,endNodeName:""}},Up.prototype.processedTableImageCursor=function(){var e=this.isTableOrImageStart(),t=e.start,e=e.startNodeName,n=this.isTableOrImageEnd();return{start:t,startName:e,end:n.end,endName:n.endNodeName}};var Ip=Up;function Up(e){this.parent=e,this.addEventListener()}Pp=function(e,t){return(Pp=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)};var Pp,Hp,kp=function(e,t){function n(){this.constructor=e}Pp(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},jp=function(){return(jp=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},M=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(r<3?o(s):3<r?o(t,n,s):o(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},kp=(Hp=j.Component,kp(B,Hp),B.prototype.requiredModules=function(){var e=[];return this.toolbarSettings.enable&&(e.push({member:"toolbar",args:[this,this.serviceLocator]}),e.push({member:"link",args:[this,this.serviceLocator]}),e.push({member:"table",args:[this,this.serviceLocator]}),e.push({member:"image",args:[this,this.serviceLocator]}),e.push({member:"audio",args:[this,this.serviceLocator]}),e.push({member:"video",args:[this,this.serviceLocator]}),this.quickToolbarSettings.enable)&&e.push({member:"quickToolbar",args:[this,this.serviceLocator]}),"HTML"===this.editorMode&&this.slashMenuSettings.enable&&e.push({member:"slashMenu",args:[this,this.serviceLocator]}),this.showCharCount&&e.push({member:"count",args:[this,this.serviceLocator]}),"Markdown"===this.editorMode&&e.push({member:"markdownEditor",args:[this,this.serviceLocator]}),"HTML"===this.editorMode&&(e.push({member:"htmlEditor",args:[this,this.serviceLocator]}),e.push({member:"pasteCleanup",args:[this,this.serviceLocator]}),e.push({member:"importExport",args:[this,this.serviceLocator]}),e.push({member:"formatPainter",args:[this]}),e.push({member:"emojiPicker",args:[this,this.serviceLocator]})),this.fileManagerSettings.enable&&e.push({member:"fileManager",args:[this,this.serviceLocator]}),this.enableResize&&e.push({member:"resize",args:[this]}),e},B.prototype.updateEnable=function(){this.enabled?(j.removeClass([this.element],On),this.element.setAttribute("aria-disabled","false"),j.isNullOrUndefined(this.htmlAttributes.tabindex)?this.inputElement.setAttribute("tabindex","0"):this.inputElement.setAttribute("tabindex",this.htmlAttributes.tabindex)):(this.getToolbar()&&(j.removeClass(this.getToolbar().querySelectorAll("."+Si),Si),j.removeClass([this.getToolbar().parentElement],[Mn])),j.addClass([this.element],On),this.element.tabIndex=-1,this.element.setAttribute("aria-disabled","true"),this.inputElement.setAttribute("tabindex","-1"))},B.prototype.setEnable=function(){this.updateEnable(),this.enabled?this.eventInitializer():this.unWireEvents()},B.prototype.initializeValue=function(){this.isFocusOut=!1,this.isRTE=!1,this.isBlur=!0,this.defaultResetValue=null,this.isResizeInitialized=!1},B.prototype.preRender=function(){this.initializeValue(),this.clickPoints={clientX:0,clientY:0},this.initialValue=this.value,this.serviceLocator=new yc,this.initializeServices(),this.setContainer(),this.persistData(),j.setStyleAttribute(this.element,{width:j.formatUnit(this.width)}),j.attributes(this.element,{role:"application","aria-label":"Rich Text Editor"}),this.beforeRenderClassValue=this.element.getAttribute("class")},B.prototype.persistData=function(){var e;this.enablePersistence&&"TEXTAREA"===this.originalElement.tagName&&(this.element.id=this.originalElement.id+"_wrapper",e=window.localStorage.getItem(this.getModuleName()+this.element.id),j.isNullOrUndefined(e)||""===e||this.setProperties(JSON.parse(e),!0))},B.prototype.setContainer=function(){this.originalElement=this.element.cloneNode(!0),null!==this.value&&null===this.valueTemplate||this.setValue(),this.element.hasAttribute("tabindex")&&(this.htmlAttributes={tabindex:this.element.getAttribute("tabindex")},this.element.removeAttribute("tabindex")),this.element.innerHTML="";for(var e,t=["class","style","id","ejs-for"],n={},i=0;i<this.element.attributes.length;i++)-1!==t.indexOf(this.element.attributes[i].name)||/^data-val/.test(this.element.attributes[i].name)||(n[this.element.attributes[i].name]=this.element.getAttribute(this.element.attributes[i].name));if(j.extend(n,this.htmlAttributes,n),this.setProperties({htmlAttributes:n},!0),j.isNullOrUndefined(this.htmlAttributes.id)||(this.element.id=this.htmlAttributes.id),this.internalID=this.element.id,"TEXTAREA"===this.element.tagName?(e=this.createElement("div",{className:this.element.getAttribute("class")}),this.element.innerHTML="",this.element.parentElement.insertBefore(e,this.element),this.valueContainer=this.element,j.removeClass([this.valueContainer],this.element.getAttribute("class").split(" ")),this.element=e):this.valueContainer=this.createElement("textarea",{id:this.getID()+"-value",attrs:{"aria-labelledby":this.getID()}}),this.valueContainer.name=this.getID(),j.addClass([this.valueContainer],Zi),!j.isNullOrUndefined(this.cssClass))for(var o=this.cssClass.split(" "),r=0;r<o.length;r++)j.addClass([this.valueContainer],o[r]);this.rootContainer=this.createElement("div",{className:wn,attrs:{role:"presentation"}}),this.element.appendChild(this.rootContainer),this.rootContainer.appendChild(this.valueContainer)},B.prototype.getPersistData=function(){return this.addOnPersist(["value"])},B.prototype.focusIn=function(){this.enabled&&(this.inputElement.focus(),this.focusHandler({}))},B.prototype.focusOut=function(){this.enabled&&(this.inputElement.blur(),this.blurHandler({}))},B.prototype.selectAll=function(){this.notify(nt,{})},B.prototype.selectRange=function(e){this.notify(it,{range:e})},B.prototype.getSelection=function(){var t="";return this.notify(ot,{callBack:function(e){t=e}}),t},B.prototype.showEmojiPicker=function(e,t){this.readonly||this.notify(an,{x:e,y:t})},B.prototype.executeCommand=function(e,t,n){if("importWord"===e){for(var i=this.createElement("div"),o=(i.innerHTML=t,i.querySelectorAll("table:not(.e-rte-table):not(.e-rte-paste-table)")),r=0;r<o.length;r++)o[r].classList.add("e-rte-paste-table");t=i.innerHTML,i.remove(),e="insertHTML"}t=this.htmlPurifier(e,t),"HTML"===this.editorMode&&(i=this.getRange(),this.iframeSettings.enable&&this.formatter.editorManager.nodeSelection.Clear(this.element.ownerDocument),this.iframeSettings.enable&&i.startContainer===this.inputElement||!this.inputElement.contains(i.startContainer))&&this.focusIn();i=vc[""+e];if(n&&n.undo&&n.undo&&0===this.formatter.getUndoRedoStack().length&&this.formatter.saveData(),-1!==this.maxLength&&!j.isNullOrUndefined(i.command)){var e=0,s=("Links"===i.command&&(e=(0===t.text.length?t.url:t.text).length),"Images"!==i.command&&"Table"!==i.command&&"Files"!==i.command||(e=1),"InsertHTML"===i.command&&(j.isNullOrUndefined(t)?j.isNullOrUndefined(i.value)||"<hr/>"!==i.value&&"<br/>"!==i.value||(e=1):((s=this.createElement("div")).innerHTML=t,e=s.textContent.length)),"InsertText"===i.command&&(e=t.length),this.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length),a=this.getSelection().length;if(!(-1===this.maxLength||s-a+e<=this.maxLength))return}s=t,"FormatPainter"===i.command&&(j.isNullOrUndefined(t)||(this.formatPainterSettings=t),s={formatPainterAction:i.value}),this.formatter.editorManager.execCommand(i.command,i.subCommand||s||i.value,null,null,s||i.value,s||("UL"===i.value||"OL"===i.value?null:i.value),null,this.enterKey),Us(this.contentModule.getDocument(),this.inputElement),n&&n.undo&&(this.formatter.saveData(),this.formatter.enableUndo(this)),this.setPlaceHolder(),this.notify(W,{})},B.prototype.htmlPurifier=function(e,t){if("HTML"===this.editorMode)switch(e){case"insertHTML":this.enableHtmlSanitizer&&(t="string"==typeof t?(t=t.replace(/&(times|divide|ne)/g,"&amp;amp;$1"),this.htmlEditorModule.sanitizeHelper(t)):this.htmlEditorModule.sanitizeHelper(t.outerHTML));break;case"insertTable":j.isNullOrUndefined(t.width)&&(t.width={minWidth:this.tableSettings.minWidth,maxWidth:this.tableSettings.maxWidth,width:this.tableSettings.width});break;case"insertImage":var n=(o=this.createElement("img",{attrs:{src:t.url}})).outerHTML,n=""!==(n=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(o.outerHTML):n)&&this.createElement("div",{innerHTML:n}).firstElementChild.getAttribute("src")||null;n=j.isNullOrUndefined(n)?"":n,t.url=n,j.isNullOrUndefined(t.width)&&(t.width={minWidth:this.insertImageSettings.minWidth,maxWidth:this.insertImageSettings.maxWidth,width:this.insertImageSettings.width}),j.isNullOrUndefined(t.height)&&(t.height={minHeight:this.insertImageSettings.minHeight,maxHeight:this.insertImageSettings.maxHeight,height:this.insertImageSettings.height});break;case"insertAudio":var i=this.createElement("audio",{attrs:{controls:""}}),o=this.createElement("source",{attrs:{src:t.url,type:t.url&&0<t.url.split(".").length?"audio/"+t.url.split(".")[t.url.split(".").length-1]:""}}),r=(i.appendChild(o),i.outerHTML),n=""!==(r=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(i.outerHTML):r)&&this.createElement("div",{innerHTML:r}).firstElementChild.firstElementChild.getAttribute("src")||null;n=j.isNullOrUndefined(n)?"":n,t.url=n;break;case"insertVideo":i=this.createElement("video",{attrs:{controls:""}}),o=this.createElement("source",{attrs:{src:t.url,type:t.url&&0<t.url.split(".").length?"video/"+t.url.split(".")[t.url.split(".").length-1]:""}}),r=(i.appendChild(o),i.outerHTML),n=""!==(r=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(o.outerHTML):r)&&this.createElement("div",{innerHTML:r}).firstElementChild.getAttribute("src")||null;n=j.isNullOrUndefined(n)?"":n,t.url=n,j.isNullOrUndefined(t.width)&&(t.width={minWidth:this.insertVideoSettings.minWidth,maxWidth:this.insertVideoSettings.maxWidth,width:this.insertVideoSettings.width}),j.isNullOrUndefined(t.height)&&(t.height={minHeight:this.insertVideoSettings.minHeight,maxHeight:this.insertVideoSettings.maxHeight,height:this.insertVideoSettings.height});break;case"createLink":i=this.createElement("a",{attrs:{href:t.url}}),o=i.outerHTML,r=""!==(o=this.enableHtmlSanitizer?this.htmlEditorModule.sanitizeHelper(i.outerHTML):o)&&this.createElement("div",{innerHTML:o}).firstElementChild.getAttribute("href")||null,r=j.isNullOrUndefined(r)?"":r;t.url=r}return t},B.prototype.encode=function(e){var t=this.createElement("div");return t.innerText=e.trim(),t.innerHTML.replace(/<br\s*[\/]?>/gi,"\n")},B.prototype.render=function(){this.setProperties({value:this.replaceEntities(this.value)},!0),this.value&&!this.valueTemplate&&this.setProperties({value:this.serializeValue(this.value)},!0),this.value="Markdown"===this.editorMode||j.isNullOrUndefined(this.value)?this.value:this.addAnchorAriaLabel(this.value),this.renderModule=new Vr(this,this.serviceLocator),this.sourceCodeModule=new Bl(this,this.serviceLocator),this.notify(Q,{}),this.trigger(V),this.RTERender();new gd(this);this.notify(n,{}),this.enableXhtml&&this.setProperties({value:this.getXhtml()},!0),this.toolbarSettings.enable&&("Expand"===this.toolbarSettings.type||"MultiRow"===this.toolbarSettings.type||"Scrollable"===this.toolbarSettings.type)&&!j.isNullOrUndefined(this.getToolbar())&&-1<this.toolbarSettings.items.indexOf("Undo")&&-1<this.toolbarSettings.items.indexOf("Redo")&&this.disableToolbarItem(["Undo","Redo"]),null!==this.value&&(this.valueContainer.defaultValue=this.value),this.enabled&&!this.readonly?this.eventInitializer():this.unWireEvents(),this.notify(on,{cssClass:this.getCssClass()}),this.addAudioVideoWrapper(),this.notify(_,{}),this.autoResize(),this.renderComplete()},B.prototype.addAudioVideoWrapper=function(){for(var e,t,n,i=this,o=this.element.querySelectorAll("audio"),r=0;r<o.length;r++)o[r].classList.contains("e-rte-audio")||(o[r].classList.add("e-rte-audio"),o[r].classList.add(bi)),o[r].parentElement.classList.contains(li)||o[r].parentElement.classList.contains(ci)||((t=this.createElement("span",{className:ci})).setAttribute("style","width:300px; margin:0 auto;"),t.contentEditable="false",n=this.createElement("span",{className:li}),t.appendChild(n),o[r].parentNode.insertBefore(t,o[r].nextSibling),n.appendChild(o[r]),null===t.nextElementSibling&&(e=this.createElement("br"),t.parentNode.insertBefore(e,t.nextSibling)));for(var s,a=this.element.querySelectorAll("video"),r=0;r<a.length;r++)a[r].classList.contains("e-rte-video")||(a[r].classList.add("e-rte-video"),a[r].classList.add(vi)),a[r].parentElement.classList.contains(li)||a[r].parentElement.classList.contains(pi)||((s=this.createElement("span",{className:pi})).contentEditable="false",a[r].parentNode.insertBefore(s,a[r].nextSibling),s.appendChild(a[r]),null===s.nextElementSibling&&(e=this.createElement("br"),s.parentNode.insertBefore(e,s.nextSibling))),-1!==j.Browser.userAgent.indexOf("Firefox")&&(a[r].addEventListener("play",function(e){i.notify(Ge,{args:e}),i.notify("editAreaClick",{args:e})}),a[r].addEventListener("pause",function(e){i.notify(Ge,{args:e}),i.notify("editAreaClick",{args:e})}))},B.prototype.eventInitializer=function(){this.wireEvents()},B.prototype.cleanList=function(e){var t=this.getRange(),n=t.startContainer,i=t.endContainer,o=t.startOffset,r=n===i,s=(i.textContent.length,"#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer),a=j.closest(s,"LI"),l=!1,d=t.endOffset;if(i.nodeType===Node.TEXT_NODE&&"\ufeff"===i.textContent.charAt(d-1)&&d--,!j.isNullOrUndefined(a)&&s.textContent.trim().length===d&&!t.collapsed&&j.isNullOrUndefined(s.nextElementSibling)&&!s.classList.contains(yo)){for(var c=0;c<a.childNodes.length;c++)"#text"===a.childNodes[c].nodeName&&0===a.childNodes[c].textContent.trim().length&&(j.detach(a.childNodes[c]),l=!0,c--);for(var p=a;null!==p.lastChild&&"#text"!==p.nodeName;)p=p.lastChild;l&&(i="BR"!==p.nodeName||j.isNullOrUndefined(p.previousSibling)?p:p.previousSibling,this.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),r?i:n,i,o,"BR"===i.nodeName?0:i.textContent.length))}},B.prototype.keyDown=function(e){var t=window.navigator.platform.toLocaleLowerCase().includes("mac");if(((e.ctrlKey||e.metaKey&&t)&&e.shiftKey&&86===e.keyCode||e.metaKey&&t&&e.altKey&&e.shiftKey&&86===e.keyCode)&&(this.isPlainPaste=!0),this.inputElement.classList.contains("e-mention")){var t=this.element.ownerDocument.getElementById(this.inputElement.id+"_popup"),n=this.element.ownerDocument.getElementById(this.inputElement.id+"_slash_menu_popup"),i=-1!==Bs.indexOf(e.key),t=t&&t.classList.contains("e-popup-open"),n=n&&n.classList.contains("e-popup-open");if(i&&(t||n))return}if(this.enableTabKey&&(this.quickToolbarModule&&!e.altKey&&"F10"!==e.key&&"toolbar-focus"!==e.action&&this.quickToolbarModule.hideQuickToolbars(),i=!(!this.imageModule||!this.imageModule.imgResizeDiv),t=!(!this.videoModule||!this.videoModule.vidResizeDiv),i&&this.imageModule.cancelResizeAction(),t)&&this.videoModule.cancelResizeAction(),this.notify(h,{member:"keydown",args:e}),this.restrict(e),"HTML"===this.editorMode&&this.cleanList(e),"HTML"===this.editorMode&&(8===e.which&&"Backspace"===e.code||46===e.which&&"Delete"===e.code)){n="#text"===(d=this.getRange()).startContainer.nodeName?d.startContainer.parentElement:d.startContainer;if(j.closest(n,"pre")&&8===e.which&&8203===d.startContainer.textContent.charCodeAt(d.startOffset-1)||46===e.which&&8203===d.startContainer.textContent.charCodeAt(d.startOffset)){i=new RegExp("","g"),t=8===e.which?d.startOffset-1:d.startOffset;d.startContainer.textContent=d.startContainer.textContent.replace(i,""),this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),d.startContainer,t)}else if("Backspace"===e.code&&8===e.which&&8203===d.startContainer.textContent.charCodeAt(0)&&d.collapsed){for(var o=d.startContainer.parentElement,r=void 0,s=void 0,s=0;s<o.childNodes.length;s++)o.childNodes[s]===d.startContainer&&(r=s);var a=!0,l=[];for(s=r;0<=s;s--)3===o.childNodes[s].nodeType&&8203===o.childNodes[s].textContent.charCodeAt(0)&&a?l.push(s):a=!1;if(0<l.length)for(s=l.length-1;0<s;s--)o.childNodes[l[s]].textContent="";this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),d.startContainer,d.startOffset)}}var d,n=!!j.isNullOrUndefined(e.action)||"format-copy"!==e.action,i=(0===this.formatter.getUndoRedoStack().length&&n&&!(e.altKey||e.shiftKey&&16===e.which||e.altKey&&e.shiftKey&&67===e.which)&&this.formatter.saveData(),!1);"HTML"===this.editorMode&&(d=this.getRange(),i=!j.isNullOrUndefined(d.startContainer)&&d.startContainer===d.endContainer&&1<d.endContainer.childNodes.length&&!j.isNullOrUndefined(d.startContainer.childNodes[d.startOffset-1])&&"#text"===d.startContainer.childNodes[d.startOffset-1].nodeName&&!j.isNullOrUndefined(d.startContainer.childNodes[d.startOffset-1].previousSibling)&&32===d.startContainer.childNodes[d.startOffset-1].textContent.charCodeAt(0)&&d.startContainer.childNodes[d.startOffset-1].previousSibling.classList.contains("e-mention-chip"));if(-1===["insert-link","format-copy","format-paste","insert-image","insert-table","insert-audio","insert-video"].indexOf(e.action)&&(!e.target||!e.target.classList.contains("e-mention")||j.isNullOrUndefined(document.querySelector("#"+e.target.id+"_popup.e-popup-open"))||"Tab"!==e.code)&&(e.action&&"paste"!==e.action&&"space"!==e.action||9===e.which||"Backspace"===e.code&&8===e.which)&&!i){var c,p,t=!1;switch((t=j.isNullOrUndefined(this.formatPainterModule)?t:"escape"===this.formatPainterModule.previousAction)||("HTML"!==this.editorMode||"increase-fontsize"!==e.action&&"decrease-fontsize"!==e.action?this.formatter.process(this,null,e):this.notify(Nn,{member:"onHandleFontsizeChange",args:e})),e.action){case"toolbar-focus":this.toolbarSettings.enable&&this.getToolbarElement()&&(Hs()&&"keydown"===e.type&&this.formatter.editorManager.nodeSelection&&0<this.formatter.editorManager.nodeSelection.get(this.contentModule.getDocument()).rangeCount&&this.inputElement.contains(this.getRange().startContainer)&&this.notify(Qe,{}),c=this.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]"),c=(p=this.getRenderedQuickToolbarElem())?p.querySelector(".e-toolbar-item:not(.e-overlay)[title]"):c)&&((p=c.firstElementChild).removeAttribute("tabindex"),p.focus());break;case"escape":this.contentModule.getEditPanel().focus()}}this.notify(pn,{member:"afterKeyDown",args:e}),this.autoResize(),j.isNullOrUndefined(this.placeholder)||this.setPlaceHolder(),j.isNullOrUndefined(e)||j.isNullOrUndefined(e.code)||"Backspace"!==e.code&&"Delete"!==e.code||(d=this.contentModule.getDocument().getSelection().getRangeAt(0),(n=document.createElement("div")).appendChild(d.cloneContents()),n.innerHTML===this.inputElement.innerHTML&&(this.isCopyAll=!0)),e.metaKey&&"Backspace"===e.key&&this.autoSaveOnIdle&&this.keyUp(e)},B.prototype.keyUp=function(e){"HTML"===this.editorMode&&(o=this.getRange(),j.isNullOrUndefined(e)||j.isNullOrUndefined(e.code)||"Backspace"!==e.code&&"Delete"!==e.code||(i=this.getRange(),n=(this.iframeSettings.enable?this.contentModule.getPanel().ownerDocument:this.contentModule.getDocument()).getSelection(),this.isCopyAll&&(t=this.createElement("br"),r="BR"===this.enterKey?t:this.createElement(this.enterKey).appendChild(t).parentElement,this.inputElement.innerHTML="",this.inputElement.appendChild(r),this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),t,0),this.isCopyAll=!1),0<n.rangeCount&&"INPUT"!==this.contentModule.getDocument().activeElement.tagName&&this.inputElement.contains(this.contentModule.getDocument().activeElement)&&"<br>"===o.startContainer.innerHTML&&""===o.startContainer.textContent&&(n.removeAllRanges(),n.addRange(i))),-1!==j.Browser.userAgent.indexOf("Firefox"))&&"#text"===o.startContainer.nodeName&&o.startContainer.parentElement===this.inputElement&&"BR"!==this.enterKey&&(r=this.getRange(),t=this.createElement(this.enterKey),r.startContainer.parentElement.insertBefore(t,r.startContainer),t.appendChild(r.startContainer),this.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),t.childNodes[0],t.childNodes[0],t.childNodes[0].textContent.length,t.childNodes[0].textContent.length)),this.notify(ie,{member:"keyup",args:e}),this.notify(ne,{member:"tableModulekeyUp",args:e}),"KeyX"!==e.code||88!==e.which||88!==e.keyCode||!e.ctrlKey||""!==this.inputElement.innerHTML&&"<br>"!==this.inputElement.innerHTML||(this.inputElement.innerHTML=Br(Ar(this),this));var t,n=this.inputElement.classList.contains("e-mention"),i=32===e.which||13===e.which||8===e.which||46===e.which||9===e.which&&n,o="C"===e.key&&e.altKey&&e.shiftKey,r="V"===e.key&&e.altKey&&e.shiftKey;(!o&&!r&&("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||i)||"Markdown"===this.editorMode&&("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||i)||this.autoSaveOnIdle&&j.Browser.isDevice&&!this.inlineMode.enable)&&this.formatter.onKeyHandler(this,e),(this.inputElement&&0!==this.inputElement.textContent.length||0<this.element.querySelectorAll(".e-toolbar-item.e-active").length||0<this.formatter.getUndoRedoStack().length)&&this.notify(X,{args:e}),this.setPlaceHolder()},B.prototype.serializeValue=function(e){return e="HTML"!==this.editorMode||j.isNullOrUndefined(e)?e:this.enableHtmlEncode?(e=this.htmlEditorModule.sanitizeHelper(Ur(e)),this.encode(e)):(e=this.htmlEditorModule.sanitizeHelper(e),this.enableXhtml?this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e):e)},B.prototype.sanitizeHtml=function(e){return this.serializeValue(e)},B.prototype.updateValue=function(e){var t;j.isNullOrUndefined(e)?(t=this.inputElement.innerHTML,this.setProperties({value:Ir(t)?null:t})):this.setProperties({value:e})},B.prototype.triggerEditArea=function(e){var t;Cr()&&(t=e.touches?e.changedTouches[0]:e,this.clickPoints.clientX!==t.clientX||this.clickPoints.clientY!==t.clientY)||this.notify(Ye,{member:"editAreaClick",args:e})},B.prototype.notifyMouseUp=function(e){var t=e.touches?e.changedTouches[0]:e;this.notify(se,{member:"mouseUp",args:e,touchData:{prevClientX:this.clickPoints.clientX,prevClientY:this.clickPoints.clientY,clientX:t.clientX,clientY:t.clientY}}),(this.inputElement&&("HTML"===this.editorMode&&(0!==this.inputElement.textContent.length||e.target&&!j.isNullOrUndefined(e.target.querySelector("li")))||"Markdown"===this.editorMode&&0!==this.inputElement.value.length)||e.target&&!j.isNullOrUndefined(j.closest(e.target,"table"))||e.target&&!j.isNullOrUndefined(e.target.querySelector("img"))||e.target&&("VIDEO"===e.target.nodeName||0<e.target.querySelectorAll("."+pi).length)||e.target&&"BR"!==e.target.nodeName&&(e.target.classList.contains(ci)||e.target.classList.contains(li)||e.target.classList.contains(di)))&&this.notify(X,{args:e}),this.triggerEditArea(e)},B.prototype.mouseUp=function(e){if(this.quickToolbarSettings.showOnRightClick&&j.Browser.isDevice){var t=e.target,n=j.closest(t,"table");if(t&&"A"===t.nodeName||"IMG"===t.nodeName||"TD"===t.nodeName||"TH"===t.nodeName||"TABLE"===t.nodeName||n&&this.contentModule.getEditPanel().contains(n))return}this.notifyMouseUp(e),this.setPlaceHolder(),this.autoResize(),0===this.formatter.getUndoRedoStack().length&&this.formatter.saveData()},B.prototype.ensureModuleInjected=function(e){return 0<=this.getInjectedModules().indexOf(e)},B.prototype.onCopy=function(){this.contentModule.getDocument().execCommand("copy",!1,null)},B.prototype.onCut=function(){this.contentModule.getDocument().execCommand("cut",!1,null)},B.prototype.onPaste=function(s){var a=this;this.trigger(Le,{originalEvent:s,cancel:!1,requestType:"Paste"},function(e){var t,n,i,o,r=a.getText().replace(/\u200B/g,"").replace("HTML"===a.editorMode?/(\r\n|\n|\r|\t)/gm:"","").length-a.getSelection().length+(j.isNullOrUndefined(s)||j.isNullOrUndefined(s.clipboardData)?0:s.clipboardData.getData("text/plain").replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length);"Markdown"===a.editorMode?(t={requestType:"Paste",editorMode:a.editorMode,event:s},setTimeout(function(){a.formatter.onSuccess(a,t)},0),-1===a.maxLength||r<=a.maxLength||s.preventDefault()):!e.cancel&&"true"===a.inputElement.contentEditable&&(-1===a.maxLength||r<=a.maxLength)?(e=a.contentModule.getDocument().querySelector(".e-rte-img-dialog"),j.isNullOrUndefined(a.pasteCleanupModule)?a.isPlainPaste||(console.warn('[WARNING] :: Module "pasteCleanup" is not available in RichTextEditor component! You either misspelled the module name or forgot to load it.'),r=null,i=!(n={requestType:"Paste",editorMode:a.editorMode,event:s}),s&&!j.isNullOrUndefined(s.clipboardData)&&(r=s.clipboardData.getData("text/plain"),i=0<s.clipboardData.getData("text/html").indexOf("MsoNormal")),o=s&&s.clipboardData&&0<s.clipboardData.items.length?s.clipboardData.items[0].getAsFile():null,null!==r&&a.notify(st,{file:o,args:s,text:r,isWordPaste:i}),setTimeout(function(){a.formatter.onSuccess(a,n)},0)):j.isNullOrUndefined(e)&&a.notify(ut,{args:s,isPlainPaste:a.isPlainPaste})):s.preventDefault()}),this.isPlainPaste=!1},B.prototype.clipboardAction=function(e,t){switch(e.toLowerCase()){case"cut":this.onCut(),this.formatter.onSuccess(this,{requestType:"Cut",editorMode:this.editorMode,event:t});break;case"copy":this.onCopy(),this.formatter.onSuccess(this,{requestType:"Copy",editorMode:this.editorMode,event:t});break;case"paste":this.onPaste(t)}},B.prototype.destroy=function(){if(!this.isDestroyed&&this.isRendered){if(this.element.className=this.beforeRenderClassValue,this.removeHtmlAttributes(),this.removeAttributes(),this.beforeRenderClassValue=null,j.isNullOrUndefined(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null),j.isNullOrUndefined(this.autoSaveTimeOut)||(clearTimeout(this.autoSaveTimeOut),this.autoSaveTimeOut=null),j.isNullOrUndefined(this.idleInterval)||(clearTimeout(this.idleInterval),this.idleInterval=null),this.notify(o,{}),this.destroyDependentModules(),this.unWireEvents(),"TEXTAREA"===this.originalElement.tagName){this.element.parentElement.insertBefore(this.valueContainer,this.element),this.valueContainer.id=this.getID(),this.valueContainer.removeAttribute("name"),j.detach(this.element),""!==this.originalElement.innerHTML.trim()?(this.valueContainer.value=this.originalElement.innerHTML.trim(),this.setProperties({value:j.isNullOrUndefined(this.initialValue)?null:this.initialValue},!0)):this.valueContainer.value=this.valueContainer.defaultValue,this.element=this.valueContainer;for(var e=0;e<this.originalElement.classList.length;e++)j.addClass([this.element],this.originalElement.classList[e]);if(!j.isNullOrUndefined(this.cssClass))for(var t=this.cssClass.split(" "),e=0;e<t.length;e++)j.addClass([this.element],t[e]);j.removeClass([this.element],Zi)}else""!==this.originalElement.innerHTML.trim()?(this.element.innerHTML=this.originalElement.innerHTML.trim(),this.setProperties({value:j.isNullOrUndefined(this.initialValue)?null:this.initialValue},!0)):this.element.innerHTML="";var n=document.querySelector(".e-dialog.e-rte-elements");if(n&&j.detach(n),this.placeholder&&this.placeHolderWrapper&&(this.placeHolderWrapper=null),!j.isNullOrUndefined(this.cssClass))for(var i=this.cssClass.split(" "),e=0;e<i.length;e++)""!==i[e].trim()&&j.removeClass([this.element],i[e]);this.rootContainer&&(this.rootContainer=null),this.valueContainer&&(this.valueContainer=null),this.originalElement&&(this.originalElement=null),this.currentTarget=null,this.scrollParentElements=[],this.isRendered=!1,Hp.prototype.destroy.call(this)}},B.prototype.removeHtmlAttributes=function(){if(this.htmlAttributes)for(var e=Object.keys(this.htmlAttributes),t=0;t<e.length&&this.element.hasAttribute(e[t]);t++)this.element.removeAttribute(e[t])},B.prototype.removeAttributes=function(){this.enabled||j.removeClass([this.element],On),this.enableRtl&&j.removeClass([this.element],Tn),this.readonly&&j.removeClass([this.element],Vi),""!==this.element.style.width&&""===this.originalElement.style.width&&this.element.style.removeProperty("width"),""!==this.element.style.height&&""===this.originalElement.style.height&&this.element.style.removeProperty("height"),this.element.removeAttribute("aria-disabled"),this.element.removeAttribute("role"),this.element.removeAttribute("tabindex"),this.element.removeAttribute("aria-label")},B.prototype.destroyDependentModules=function(){this.renderModule.destroy(),this.formatter.editorManager.destroy()},B.prototype.getContent=function(){return this.contentModule.getPanel()},B.prototype.getText=function(){return this.contentModule.getText()},B.prototype.getSelectedHtml=function(){var e=this.createElement("div"),t=this.contentModule.getDocument().getSelection();return 0<t.rangeCount&&(t=t.getRangeAt(0).cloneContents(),e.appendChild(t)),e.innerHTML},B.prototype.showInlineToolbar=function(){var e,t,n;this.inlineMode.enable&&(e="#text"===(n=this.getRange()).endContainer.nodeName?n.endContainer.parentElement:n.endContainer,t=n.getClientRects()[0].left,n=n.getClientRects()[0].top,this.quickToolbarModule.showInlineQTBar(t,n,e))},B.prototype.hideInlineToolbar=function(){this.quickToolbarModule.hideInlineQTBar()},B.prototype.getModuleName=function(){return"richtexteditor"},B.prototype.onPropertyChanged=function(e,t){for(var n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];switch(o){case"enterKey":case"value":var r=void 0,r="enterKey"===o?null===this.value||"<div><br></div>"===this.value||"<p><br></p>"===this.value||"<br>"===this.value?null:this.value:e[o],s=(r="HTML"===this.editorMode?this.replaceEntities(r):r,r=this.serializeValue(r),"HTML"===this.editorMode?Br(r,this):r);(j.isNullOrUndefined(r)||""===r)&&"enterKey"!==o||this.setProperties({value:this.enableHtmlEncode?this.encode(Ur(s)):s},!0),this.updatePanelValue(),this.inputElement&&this.notify(_,{}),this.setPlaceHolder(),this.notify(Pt,{module:"XhtmlValidation",newProp:e,oldProp:t}),this.enableXhtml&&this.setProperties({value:this.getXhtml()},!0),this.showCharCount&&this.countModule.refresh(),this.addAudioVideoWrapper();break;case"valueTemplate":this.setValue(!0),this.showCharCount&&this.countModule.refresh();break;case"width":this.setWidth(e[o]),this.toolbarSettings.enable&&!this.inlineMode.enable&&(this.toolbarModule.refreshToolbarOverflow(),this.resizeHandler());break;case"height":this.setHeight(e[o]),this.autoResize();break;case"readonly":this.setReadOnly(!1);break;case"cssClass":this.element.classList.remove(t[o]),this.setCssClass(e[o]),this.notify(on,{cssClass:e[o],oldCssClass:t[o]});break;case"enabled":this.setEnable();break;case"enableRtl":this.updateRTL();break;case"placeholder":this.placeholder=e[o],this.setPlaceHolder();break;case"htmlAttributes":pc(this.htmlAttributes,this,!1,!1);break;case"iframeSettings":var a,r=t[o];r.resources&&(s=this.contentModule.getDocument().querySelector("head"),a=void 0,r.resources.scripts&&(a=s.querySelectorAll("."+Ln),this.removeSheets(a)),r.resources.styles)&&(a=s.querySelectorAll("."+kn),this.removeSheets(a)),this.setIframeSettings();break;case"locale":Hp.prototype.refresh.call(this);break;case"inlineMode":this.notify(te,{module:"quickToolbar",newProp:e,oldProp:t});break;case"toolbarSettings":this.notify(te,{module:"toolbar",newProp:e,oldProp:t});break;case"maxLength":this.showCharCount&&this.countModule.refresh();break;case"showCharCount":e[o]&&this.countModule?this.countModule.renderCount():!1===e[o]&&this.countModule&&this.countModule.destroy();break;case"enableHtmlEncode":this.updateValueData(),this.updatePanelValue(),this.setPlaceHolder(),this.showCharCount&&this.countModule.refresh();break;case"undoRedoSteps":case"undoRedoTimer":this.formatter.editorManager.observer.notify(Xs,{newProp:e,oldProp:t});break;case"enableXhtml":this.notify(Pt,{module:"XhtmlValidation",newProp:e,oldProp:t});break;case"quickToolbarSettings":e.quickToolbarSettings.showOnRightClick?this.wireContextEvent():this.unWireContextEvent(),this.notify(te,{newProp:e,oldProp:t});break;case"formatPainterSettings":this.formatter.editorManager.observer.notify(Xs,{module:"formatPainter",newProp:e});break;default:this.notify(te,{newProp:e,oldProp:t})}this.autoResize()}},B.prototype.updateValueData=function(){this.enableHtmlEncode?this.setProperties({value:this.encode(Ur(this.inputElement.innerHTML))},!0):this.setProperties({value:/<[a-z][\s\S]*>/i.test(this.inputElement.innerHTML)?this.inputElement.innerHTML:Ur(this.inputElement.innerHTML)})},B.prototype.removeSheets=function(e){for(var t=0;t<e.length;t++)j.detach(e[t])},B.prototype.replaceEntities=function(e){var n=this;if("HTML"===this.editorMode&&!j.isNullOrUndefined(e)&&/&(amp;)*((times)|(divide)|(ne))/.test(e))for(var i=this.enableHtmlEncode||this.enableHtmlSanitizer,t=0,o=["times","divide","ne"].map(function(e){var t=!n.enableHtmlEncode&&n.enableHtmlSanitizer?"&("+e+")":"&(amp;)*("+e+")";return[i?"&amp;amp;"+e:"&amp;"+e,new RegExp(t,"g")]});t<o.length;t++){var r=o[t],s=r[0],r=r[1];r.test(e)&&(e=e.replace(r,s))}return e},B.prototype.updatePanelValue=function(){this.setProperties({value:this.replaceEntities(this.value)},!0);var e="HTML"===this.editorMode?this.listOrderCorrection(this.value):this.value,e=this.enableHtmlEncode&&this.value?Ur(e):e,t=this.element.querySelector("."+Do);e?(!j.isNullOrUndefined(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(t.value=this.value),this.valueContainer&&(this.valueContainer.value=this.enableHtmlEncode?this.value:e),"HTML"===this.editorMode&&this.inputElement&&this.inputElement.innerHTML.trim()!==e.trim()?this.inputElement.innerHTML=e:"Markdown"===this.editorMode&&this.inputElement&&this.inputElement.value.trim()!==e.trim()&&(this.inputElement.value=e)):(!j.isNullOrUndefined(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(t.value=""),"HTML"===this.editorMode?"DIV"===this.enterKey?this.inputElement.innerHTML="<div><br/></div>":"BR"===this.enterKey?this.inputElement.innerHTML="<br/>":this.inputElement.innerHTML="<p><br/></p>":this.inputElement.value="",this.valueContainer&&(this.valueContainer.value="")),this.showCharCount&&this.countModule.refresh()},B.prototype.listOrderCorrection=function(e){for(var t=this.createElement("div"),n=(t.innerHTML=e,t.querySelectorAll("UL, OL")),i=0;i<n.length;i++)j.isNullOrUndefined(n[i])||j.isNullOrUndefined(n[i].parentElement)||j.isNullOrUndefined(n[i].previousElementSibling)||"UL"!==n[i].parentElement.nodeName&&"OL"!==n[i].parentElement.nodeName||n[i].previousElementSibling.appendChild(n[i]);return t.innerHTML},B.prototype.setHeight=function(e){this.element.style.height="auto"!==e?j.formatUnit(e):"auto","Expand"===this.toolbarSettings.type&&("string"==typeof this.height&&-1<this.height.indexOf("px")||"number"==typeof this.height)?this.element.classList.add(ko):this.element.classList.remove(ko)},B.prototype.setPlaceHolder=function(){this.inputElement&&this.placeholder&&!0!==this.iframeSettings.enable&&("Markdown"!==this.editorMode?(this.placeHolderWrapper||(this.placeHolderWrapper=this.createElement("span",{className:"rte-placeholder e-rte-placeholder "+this.getCssClass()}),this.fontSize.default&&(this.placeHolderWrapper.style.fontSize=this.fontSize.default),this.inputElement&&this.inputElement.parentElement.insertBefore(this.placeHolderWrapper,this.inputElement)),this.placeHolderWrapper.innerHTML=this.placeholder,0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2&&!j.isNullOrUndefined(this.inputElement.firstChild)&&("BR"===this.inputElement.firstChild.nodeName||("P"===this.inputElement.firstChild.nodeName||"DIV"===this.inputElement.firstChild.nodeName)&&!j.isNullOrUndefined(this.inputElement.firstChild.firstChild)&&this.inputElement.firstChild.childNodes.length<2&&"BR"===this.inputElement.firstChild.firstChild.nodeName)?this.placeHolderWrapper.classList.add("enabled"):this.placeHolderWrapper.classList.remove("enabled")):this.inputElement.setAttribute("placeholder",this.placeholder)),this.placeholder&&this.iframeSettings.enable&&this.inputElement&&(!(0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2)||j.isNullOrUndefined(this.inputElement.firstChild)||"BR"!==this.inputElement.firstChild.nodeName&&("P"!==this.inputElement.firstChild.nodeName&&"DIV"!==this.inputElement.firstChild.nodeName||j.isNullOrUndefined(this.inputElement.firstChild.firstChild)||"BR"!==this.inputElement.firstChild.firstChild.nodeName)?j.removeClass([this.inputElement],"e-rte-placeholder"):(j.addClass([this.inputElement],"e-rte-placeholder"),this.inputElement.setAttribute("placeholder",this.placeholder)))},B.prototype.setWidth=function(e){"auto"!==e?j.setStyleAttribute(this.element,{width:j.formatUnit(this.width)}):this.element.style.width="auto"},B.prototype.setCssClass=function(e){if(!j.isNullOrUndefined(e))for(var t=e.split(" "),n=0;n<t.length;n++)""!==t[n].trim()&&this.element.classList.add(t[n])},B.prototype.updateRTL=function(){this.notify(at,{enableRtl:this.enableRtl}),this.enableRtl?(this.element.classList.add(Tn),this.inputElement.classList.add(Tn)):(this.element.classList.remove(Tn),this.inputElement.classList.remove(Tn))},B.prototype.updateReadOnly=function(){this.notify(ht,{editPanel:this.inputElement,mode:this.readonly})},B.prototype.setReadOnly=function(e){this.updateReadOnly(),e||(this.readonly&&this.enabled?(this.unbindEvents(),this.unWireEvents()):this.enabled&&this.wireEvents())},B.prototype.print=function(){var t,n=this,e={element:this.inputElement,requestType:"print",cancel:!1};this.trigger(Le,e,function(e){t=window.open("","print","height="+window.outerHeight+",width="+window.outerWidth),"msie"===j.Browser.info.name&&t.resizeTo(screen.availWidth,screen.availHeight),t=j.print(n.inputElement,t),e.cancel||n.trigger(ke,{requestType:"print"})})},B.prototype.refreshUI=function(){this.renderModule.refresh()},B.prototype.showFullScreen=function(){this.fullScreenModule.showFullScreen()},B.prototype.enableToolbarItem=function(e,t){this.toolbarModule.enableTBarItems(this.getBaseToolbarObject(),e,!0,t)},B.prototype.disableToolbarItem=function(e,t){this.toolbarModule.enableTBarItems(this.getBaseToolbarObject(),e,!1,t)},B.prototype.removeToolbarItem=function(e){this.toolbarModule.removeTBarItems(e)},B.prototype.getRange=function(){return this.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument())},B.prototype.initializeServices=function(){this.serviceLocator.register("rendererFactory",new Nc),this.serviceLocator.register("rteLocale",this.localeObj=new j.L10n(this.getModuleName(),dr,this.locale)),this.serviceLocator.register("dialogRenderObject",new Al(this))},B.prototype.RTERender=function(){var e=this.serviceLocator.getService("rendererFactory");this.contentModule=e.getRenderer(m.RenderType.Content),this.fullScreenModule=new dc(this),this.enterKeyModule=new Ip(this),this.renderModule.render(),this.inputElement=this.contentModule.getEditPanel(),this.setHeight(this.height),pc(this.htmlAttributes,this,!1,!0),this.iframeSettings&&this.setIframeSettings(),this.setCssClass(this.cssClass),this.updateEnable(),this.setPlaceHolder(),this.updateRTL(),this.updateReadOnly(),this.updatePanelValue(),this.enableHtmlEncode&&!j.isNullOrUndefined(this.value)&&this.setProperties({value:this.encode(Ur(this.value))})},B.prototype.setIframeSettings=function(){var e,t;this.iframeSettings.resources&&(e=this.iframeSettings.resources.styles,t=this.iframeSettings.resources.scripts,!j.isNullOrUndefined(this.iframeSettings.resources.scripts)&&0<this.iframeSettings.resources.scripts.length&&this.InjectSheet(!0,t),!j.isNullOrUndefined(this.iframeSettings.resources.styles))&&0<this.iframeSettings.resources.styles.length&&this.InjectSheet(!1,e),this.iframeSettings.attributes&&pc(this.iframeSettings.attributes,this,!0,!1)},B.prototype.InjectSheet=function(e,t){try{if(t&&0<t.length)for(var n,i,o=this.contentModule.getDocument().querySelector("head"),r=0;r<t.length;r++)e?((n=this.createScriptElement()).src=t[r],o.appendChild(n)):((i=this.createStyleElement()).href=t[r],o.appendChild(i))}catch(e){}},B.prototype.createScriptElement=function(){var e=this.createElement("script",{className:Ln});return e.type="text/javascript",e},B.prototype.createStyleElement=function(){var e=this.createElement("link",{className:kn});return e.rel="stylesheet",e},B.prototype.setValue=function(e){var t=this;if(this.valueTemplate){var n=new RegExp(/<(?=.*? .*?\/ ?>|br|hr|input|!--|wbr)[a-z]+.*?>|<([a-z]+).*?<\/\1>/i);if("string"==typeof this.valueTemplate&&n.test(this.valueTemplate))this.setProperties({value:this.valueTemplate});else{var i=j.compile(this.valueTemplate)("",this,"valueTemplate");if("string"!=typeof this.valueTemplate&&this.isReact){this.displayTempElem=this.createElement("div");for(var o=0;o<i.length;o++){var r=i[o];j.append([r],this.displayTempElem)}this.renderTemplates(function(){t.inputElement.innerHTML=t.displayTempElem.childNodes[0].innerHTML,t.setProperties({value:t.inputElement.innerHTML.trim()})})}else{var s=this.element;e&&(this.inputElement.innerHTML="",s=this.inputElement);for(o=0;o<i.length;o++){r=i[o];j.append([r],s)}n=s.innerHTML.trim();0<n.length&&this.setProperties({value:n}),this.renderReactTemplates()}}}else{e=!j.isNullOrUndefined(this.element.innerHTML)&&this.element.innerHTML.replace(/<(\/?|\!?)(!--!--)>/g,"").trim();""!==e&&("TEXTAREA"===this.element.tagName?this.setProperties({value:Ur(e)}):this.setProperties({value:e}))}},B.prototype.renderTemplates=function(e){this.renderReactTemplates(e)},B.prototype.updateResizeFlag=function(){this.isResizeInitialized=!0},B.prototype.getInsertImgMaxWidth=function(){var e=this.insertImageSettings.maxWidth,t=this.contentModule.getEditPanel(),n=("HTML"!==this.editorMode||j.isNullOrUndefined(this.formatter.editorManager.nodeSelection)||j.isNullOrUndefined(this.formatter.editorManager.nodeSelection.range)||3!==(n=this.formatter.editorManager.nodeSelection.range).startContainer.nodeType&&n.startContainer.closest&&!j.isNullOrUndefined(n.startContainer.closest("TD"))&&(t=n.startContainer),window.getComputedStyle(t)),t=t.offsetWidth-(14+parseFloat(n.paddingLeft.split("px")[0])+parseFloat(n.paddingRight.split("px")[0])+parseFloat(n.marginLeft.split("px")[0])+parseFloat(n.marginRight.split("px")[0]));return j.isNullOrUndefined(e)?t:e},B.prototype.getInsertVidMaxWidth=function(){var e=this.insertVideoSettings.maxWidth,t=this.contentModule.getEditPanel(),n=window.getComputedStyle(t),t=t.offsetWidth-(14+parseFloat(n.paddingLeft.split("px")[0])+parseFloat(n.paddingRight.split("px")[0])+parseFloat(n.marginLeft.split("px")[0])+parseFloat(n.marginRight.split("px")[0]));return j.isNullOrUndefined(e)?t:e},B.prototype.getHtml=function(){var e=this.removeResizeElement(this.contentModule.getEditPanel().innerHTML);return!this.enableXhtml||"<p><br></p>"!==e&&"<div><br></div>"!==e&&"<br>"!==e?this.serializeValue(e):null},B.prototype.getXhtml=function(){var e=this.removeResizeElement(this.value);return e=!j.isNullOrUndefined(e)&&this.enableXhtml?this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e):e},B.prototype.showSourceCode=function(){this.readonly||this.notify(ze,{})},B.prototype.getCharCount=function(){var e=("Markdown"===this.editorMode?this.inputElement.value:this.inputElement.textContent).trim(),e=("Markdown"!==this.editorMode&&-1!==e.indexOf("")?e.replace(/\u200B/g,""):e).length;return e},B.prototype.showDialog=function(e){e===m.DialogType.InsertLink?this.notify(Kt,{}):e===m.DialogType.InsertImage?this.notify(Xt,{}):e===m.DialogType.InsertAudio?this.notify(Yt,{}):e===m.DialogType.InsertVideo?this.notify(Jt,{}):e===m.DialogType.InsertTable&&this.notify(tn,{})},B.prototype.closeDialog=function(e){e===m.DialogType.InsertLink?this.notify(Gt,{}):e===m.DialogType.InsertImage?this.notify($t,{}):e===m.DialogType.InsertAudio?this.notify(Zt,{}):e===m.DialogType.InsertVideo?this.notify(en,{}):e===m.DialogType.InsertTable&&this.notify(nn,{})},B.prototype.getBaseToolbarObject=function(){var e=!this.inlineMode.enable||j.Browser.isDevice&&!Cr()?this.toolbarModule&&this.toolbarModule.getBaseToolbar():this.quickToolbarModule&&this.quickToolbarModule.getInlineBaseToolbar();return e},B.prototype.getToolbar=function(){return this.toolbarModule?this.toolbarModule.getToolbarElement():null},B.prototype.getToolbarElement=function(){return this.toolbarModule&&this.toolbarModule.getToolbarElement()},B.prototype.getID=function(){return this.internalID},B.prototype.getCssClass=function(e){return j.isNullOrUndefined(this.cssClass)?"":e?" "+this.cssClass:this.cssClass},B.prototype.mouseDownHandler=function(e){var t=e.touches?e.changedTouches[0]:e;j.addClass([this.element],[ti]),this.preventDefaultResize(e),this.notify(Ge,{args:e}),this.formatter.editorManager.observer.notify(Ge,{args:e}),this.clickPoints={clientX:t.clientX,clientY:t.clientY}},B.prototype.preventImgResize=function(e){"img"===e.target.nodeName.toLocaleLowerCase()&&e.preventDefault()},B.prototype.preventDefaultResize=function(e){"msie"===j.Browser.info.name?this.contentModule.getEditPanel().addEventListener("mscontrolselect",this.preventImgResize):"mozilla"===j.Browser.info.name&&(this.contentModule.getDocument().execCommand("enableObjectResizing",!1,"false"),this.contentModule.getDocument().execCommand("enableInlineTableEditing",!1,"false"))},B.prototype.defaultResize=function(e){"msie"===j.Browser.info.name?this.contentModule.getEditPanel().removeEventListener("mscontrolselect",this.preventImgResize):"mozilla"===j.Browser.info.name&&(this.contentModule.getDocument().execCommand("enableObjectResizing",!0,"true"),this.contentModule.getDocument().execCommand("enableInlineTableEditing",!0,"true"))},B.prototype.resizeHandler=function(){document.body.contains(this.element)?(this.toolbarSettings.enable&&!this.inlineMode.enable&&this.toolbarModule.refreshToolbarOverflow(),this.notify(ve,null),this.autoResize()):(document.defaultView.removeEventListener("resize",this.resizeHandler,!0),this.onResizeHandler=null)},B.prototype.scrollHandler=function(e){this.element&&this.notify(Je,{args:e})},B.prototype.contentScrollHandler=function(e){this.notify($e,{args:e})},B.prototype.focusHandler=function(e){if(!this.isRTE||this.isFocusOut){this.isRTE=!this.isFocusOut,this.isFocusOut=!1,j.addClass([this.element],[ti]),"HTML"===this.editorMode?this.cloneValue="<p><br></p>"===this.inputElement.innerHTML||"<div><br></div>"===this.inputElement.innerHTML||"<br>"===this.inputElement.innerHTML?null:this.enableHtmlEncode?this.encode(Ur(this.inputElement.innerHTML)):this.inputElement.innerHTML:this.cloneValue=""===this.inputElement.value?null:this.inputElement.value;var t=document.activeElement;if((t===this.element||t===this.getToolbarElement()||t===this.contentModule.getEditPanel()||this.iframeSettings.enable&&t===this.contentModule.getPanel()&&e.target&&!e.target.classList.contains("e-img-inner")&&e.target&&e.target.parentElement&&!e.target.parentElement.classList.contains("e-img-wrap")||j.closest(t,".e-rte-toolbar")===this.getToolbarElement())&&(this.contentModule.getEditPanel().focus(),!j.isNullOrUndefined(this.getToolbarElement()))){this.getToolbarElement().setAttribute("tabindex","-1");for(var n=this.getToolbarElement().querySelectorAll('[tabindex="0"]'),i=0;i<n.length;i++)n[i].setAttribute("tabindex","-1")}this.preventDefaultResize(e),this.trigger("focus",{event:e,isInteracted:0!==Object.keys(e).length}),!j.isNullOrUndefined(this.saveInterval)&&0<this.saveInterval&&!this.autoSaveOnIdle&&j.isNullOrUndefined(this.timeInterval)&&(this.timeInterval=setInterval(this.updateValueOnIdle.bind(this),this.saveInterval)),j.EventHandler.add(document,"mousedown",this.onDocumentClick,this)}this.readonly||"editArea"!==(t=this.getCurrentFocus(e))&&"textArea"!==t&&"sourceCode"!==t||this.resetToolbarTabIndex()},B.prototype.getUpdatedValue=function(){var e,t=this.element.querySelector("."+Do);return"HTML"===this.editorMode?(e="<p><br></p>"===this.inputElement.innerHTML||"<div><br></div>"===this.inputElement.innerHTML||"<br>"===this.inputElement.innerHTML?null:this.enableHtmlEncode?this.encode(Ur(this.removeResizeElement(this.inputElement.innerHTML))):this.inputElement.innerHTML,this.enableHtmlSanitizer&&!j.isNullOrUndefined(e)&&/&(amp;)*((times)|(divide)|(ne))/.test(e)&&(e=e.replace(/&(amp;)*(times|divide|ne)/g,"&amp;amp;$2")),!j.isNullOrUndefined(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(e=/&(amp;)*((times)|(divide)|(ne))/.test(t.value)?t.value.replace(/&(amp;)*(times|divide|ne)/g,"&amp;amp;$2"):t.value)):e=""===this.inputElement.value?null:this.inputElement.value,e=null==e||this.enableHtmlEncode?e:this.removeResizeElement(e)},B.prototype.updateValueOnIdle=function(){(j.isNullOrUndefined(this.tableModule)||j.isNullOrUndefined(this.inputElement.querySelector(".e-table-box.e-rbox-select")))&&(this.setProperties({value:this.getUpdatedValue()},!0),this.valueContainer.value=this.value,this.isValueChangeBlurhandler=!1,this.invokeChangeEvent())},B.prototype.updateIntervalValue=function(){clearTimeout(this.idleInterval),this.idleInterval=setTimeout(this.updateValueOnIdle.bind(this),0)},B.prototype.cleanupResizeElements=function(e){var t=this.removeResizeElement(e.value);e.callBack(t)},B.prototype.addAnchorAriaLabel=function(e){var t=document.createElement("div"),n=(t.innerHTML=e,t.querySelectorAll("a"));if(0<n.length)for(var i=0;i<n.length;i++)n[i].hasAttribute("target")&&"_blank"===n[i].getAttribute("target")&&n[i].setAttribute("aria-label",this.serviceLocator.getService("rteLocale").getConstant("linkAriaLabel"));return t.innerHTML},B.prototype.removeResizeElement=function(e){var t=document.createElement("div");if("HTML"===this.editorMode){t.innerHTML=e;var n=t.querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box, .e-table-rhelper, .e-img-resize");if(0<n.length)for(var i=0;i<n.length;i++)j.detach(n[i]);this.removeSelectionClassStates(t)}else t.textContent=e;return"Markdown"===this.editorMode?t.innerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t.innerHTML},B.prototype.updateStatus=function(e){var t;j.isNullOrUndefined(e.html)&&j.isNullOrUndefined(e.markdown)||(t={undo:(t=this.formatter.editorManager.undoRedoManager.getUndoStatus()).undo,redo:t.redo,html:e.html,markdown:e.markdown},this.trigger(we,t))},B.prototype.onDocumentClick=function(e){var t=e.target,n=j.closest(t,"."+Sn),n=(this.element.contains(e.target)||document===e.target||n===this.element||j.closest(t,'[aria-owns="'+this.getID()+'"]')||(this.isBlur=!0,this.isRTE=!1),this.notify(dt,{args:e}),this.quickToolbarModule&&!this.inlineMode.enable&&j.isNullOrUndefined(this.quickToolbarModule.inlineQTBar));(!n||j.isNullOrUndefined(j.closest(t,".e-toolbar-wrapper")))&&(!n||j.isNullOrUndefined(j.closest(t,".e-rte-table-resize"))&&j.isNullOrUndefined(j.closest(t,".e-table-box")))||this.quickToolbarModule.hideQuickToolbars(),"msie"!==j.Browser.info.name&&3<e.detail&&e.preventDefault()},B.prototype.blurHandler=function(e){var t,n,i=e.relatedTarget;i&&((t=!(t=j.closest(i,"."+Sn))&&this.iframeSettings.enable&&(n=this.element.querySelector("#"+this.getID()+"_rte-view"))&&n.contentWindow.document.body.contains(i)?j.closest(n,"."+Sn):t)&&t===this.element?(this.isBlur=!1,i===this.getToolbarElement()&&i.setAttribute("tabindex","-1")):j.closest(i,'[aria-owns="'+this.getID()+'"]')||j.closest(i,"."+Oi)?this.isBlur=!1:(this.isBlur=!0,i=null)),this.isBlur&&j.isNullOrUndefined(i)?(j.removeClass([this.element],[ti]),this.removeSelectionClassStates(this.inputElement),this.notify(tt,{}),n=this.getUpdatedValue(),this.setProperties({value:n}),this.valueContainer.value=this.value,this.isValueChangeBlurhandler=!0,this.invokeChangeEvent(),this.isFocusOut=!0,this.isBlur=!1,wr(this.valueContainer,"focusout"),this.defaultResize(e),this.trigger("blur",{event:e,isInteracted:0!==Object.keys(e).length}),j.isNullOrUndefined(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null),!j.isNullOrUndefined(this.placeHolderWrapper)&&this.element.querySelector("[title = Preview]")&&(this.placeHolderWrapper.style.display="none"),j.EventHandler.remove(document,"mousedown",this.onDocumentClick)):this.isRTE=!0,this.readonly||"outside"!==this.getCurrentFocus(e)||this.resetToolbarTabIndex()},B.prototype.contentChanged=function(e){var t=this.inputElement.querySelector(".tempSpan");t&&j.detach(t),e&&!j.isNullOrUndefined(e.detail)&&e.detail.click&&this.formatter.saveData(),this.autoSaveOnIdle&&!j.isNullOrUndefined(this.saveInterval)&&(clearTimeout(this.autoSaveTimeOut),this.autoSaveTimeOut=setTimeout(this.updateIntervalValue.bind(this),this.saveInterval))},B.prototype.invokeChangeEvent=function(){var e=this.enableXhtml?this.getXhtml():this.value,e={value:e,isInteracted:this.isValueChangeBlurhandler};this.value!==this.cloneValue&&(this.trigger("change",e),this.cloneValue=this.value)},B.prototype.wireScrollElementsEvents=function(){this.scrollParentElements=I.getScrollableParent(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];j.EventHandler.add(n,"scroll",this.scrollHandler,this)}this.iframeSettings.enable||j.EventHandler.add(this.inputElement,"scroll",this.contentScrollHandler,this)},B.prototype.wireContextEvent=function(){this.quickToolbarSettings.showOnRightClick&&(j.EventHandler.add(this.inputElement,"contextmenu",this.contextHandler,this),j.Browser.isDevice)&&(this.touchModule=new j.Touch(this.inputElement,{tapHold:this.touchHandler.bind(this),tapHoldThreshold:500}))},B.prototype.unWireContextEvent=function(){j.EventHandler.remove(this.inputElement,"contextmenu",this.contextHandler),j.Browser.isDevice&&this.touchModule&&this.touchModule.destroy()},B.prototype.unWireScrollElementsEvents=function(){this.scrollParentElements=I.getScrollableParent(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];j.EventHandler.remove(n,"scroll",this.scrollHandler)}this.iframeSettings.enable||j.EventHandler.remove(this.inputElement,"scroll",this.contentScrollHandler)},B.prototype.touchHandler=function(e){this.notifyMouseUp(e.originalEvent),this.triggerEditArea(e.originalEvent)},B.prototype.contextHandler=function(e){var t=j.closest(e.target,"a, table, img, video, audio, .e-embed-video-wrap");!t&&e.target&&e.target.classList&&(e.target.classList.contains(ci)||e.target.classList.contains(li))&&(t=e.target.querySelector("audio")),!1!==this.inlineMode.onSelection&&(j.isNullOrUndefined(t)||!this.inputElement.contains(t)||"IMG"!==t.tagName&&"TABLE"!==t.tagName&&"A"!==t.tagName&&"video"!==t.tagName.toLowerCase()&&"audio"!==t.tagName.toLowerCase()&&"SPAN"!==t.tagName)||e.preventDefault()},B.prototype.resetHandler=function(){var e=this.valueContainer.defaultValue.trim();this.setProperties({value:""===e?null:e})},B.prototype.autoResize=function(){var e,t;this.element&&this.originalElement&&this.valueContainer&&("auto"===this.height?"Markdown"===this.editorMode?this.setAutoHeight(this.inputElement):this.iframeSettings.enable&&(e=this.element.querySelector("#"+this.getID()+"_rte-view"))&&this.setAutoHeight(e):"Markdown"===this.editorMode?(e=this.inputElement,t=this.enableResize||this.showCharCount?20:0,e&&(e.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+t+3)+"px")):this.iframeSettings.enable&&(e=this.element.querySelector("#"+this.getID()+"_rte-view"),t=this.enableResize||this.showCharCount?20:0,e)&&(e.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+t+3)+"px"))},B.prototype.setAutoHeight=function(e){"TEXTAREA"===e.nodeName?(e.style.height="auto",e.style.height=this.inputElement.scrollHeight+16+"px",e.style.overflow="hidden"):"IFRAME"===e.nodeName&&(e.style.height=this.inputElement.parentElement.offsetHeight+"px")},B.prototype.wireEvents=function(){this.onBlurHandler=this.blurHandler.bind(this),this.onFocusHandler=this.focusHandler.bind(this),this.onResizeHandler=this.resizeHandler.bind(this),this.element.addEventListener("focusin",this.onFocusHandler,!0),this.element.addEventListener("focusout",this.onBlurHandler,!0),this.on(W,this.contentChanged,this),this.on(Ft,this.updateResizeFlag,this),this.on(Wt,this.updateStatus,this),this.on(cn,this.cleanupResizeElements,this),this.on(hn,this.updateValueOnIdle,this),this.on(fn,this.autoResize,this),this.iframeSettings.enable&&(this.onLoadHandler=this.iframeEditableElemLoad.bind(this),this.contentModule.getEditPanel().addEventListener("load",this.onLoadHandler,!0)),this.readonly&&this.enabled||this.bindEvents()},B.prototype.restrict=function(e){if(0<=this.maxLength){var t="Markdown"===this.editorMode?this.contentModule.getText():this.getText().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"");if(t){for(var n=[8,16,17,37,38,39,40,46,65],i=void 0,o=0;o<=n.length-1;o++)if(e.which===n[o]){if(e.ctrlKey&&65===e.which)return;if(65!==e.which)return void(i=n[o])}t.length>=this.maxLength&&-1!==this.maxLength&&e.which!==i&&e.preventDefault()}}},B.prototype.bindEvents=function(){this.keyboardModule=new Dl(this.inputElement,{keyAction:this.keyDown.bind(this),keyConfigs:jp({},this.formatter.keyConfig,this.keyConfig),eventName:"keydown"});var e=j.closest(this.valueContainer,"form");e&&j.EventHandler.add(e,"reset",this.resetHandler,this),j.EventHandler.add(this.inputElement,"keyup",this.keyUp,this),j.EventHandler.add(this.inputElement,"paste",this.onPaste,this),j.EventHandler.add(this.inputElement,"content-changed",this.contentChanged,this),this.mouseDownDebListener=j.debounce(this.mouseUp,30),j.EventHandler.add(this.inputElement,j.Browser.touchEndEvent,this.mouseDownDebListener,this),j.EventHandler.add(this.inputElement,j.Browser.touchStartEvent,this.mouseDownHandler,this),j.EventHandler.add(this.inputElement,"input",this.inputHandler,this),this.wireContextEvent(),this.formatter.editorManager.observer.on(u,this.editorKeyDown,this),this.element.ownerDocument.defaultView.addEventListener("resize",this.onResizeHandler,!0),this.iframeSettings.enable&&(j.EventHandler.add(this.inputElement,"focusin",this.focusHandler,this),j.EventHandler.add(this.inputElement,"focusout",this.blurHandler,this),j.EventHandler.add(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler,this),j.EventHandler.add(this.inputElement.ownerDocument,j.Browser.touchStartEvent,this.onIframeMouseDown,this),j.EventHandler.add(this.contentModule.getPanel(),"load",this.iframeLoadHandler,this)),this.wireScrollElementsEvents()},B.prototype.onIframeMouseDown=function(e){this.isBlur=!1,this.currentTarget=e.target,this.notify(K,e)},B.prototype.inputHandler=function(){this.autoResize()},B.prototype.editorKeyDown=function(e){switch(e.event.action){case"copy":this.onCopy();break;case"cut":this.onCut();break;case"tab":this.iframeSettings.enable&&(this.isBlur=!0)}!e.callBack||"copy"!==e.event.action&&"cut"!==e.event.action&&"delete"!==e.event.action||e.callBack({requestType:e.event.action,editorMode:"HTML",event:e.event})},B.prototype.unWireEvents=function(){this.element.removeEventListener("focusin",this.onFocusHandler,!0),this.onFocusHandler=null,this.element.removeEventListener("focusout",this.onBlurHandler,!0),this.onBlurHandler=null,this.off(W,this.contentChanged),this.off(Ft,this.updateResizeFlag),this.off(Wt,this.updateStatus),this.off(cn,this.cleanupResizeElements),this.off(hn,this.updateValueOnIdle),this.off(fn,this.autoResize),this.iframeSettings.enable&&(this.contentModule.getEditPanel().removeEventListener("load",this.onLoadHandler,!0),this.onLoadHandler=null),this.readonly&&this.enabled||this.unbindEvents()},B.prototype.unbindEvents=function(){this.keyboardModule&&!this.keyboardModule.isDestroyed&&(this.keyboardModule.destroy(),this.keyboardModule=null);var e=j.closest(this.valueContainer,"form");e&&j.EventHandler.remove(e,"reset",this.resetHandler),j.EventHandler.remove(this.inputElement,"keyup",this.keyUp),j.EventHandler.remove(this.inputElement,"paste",this.onPaste),j.EventHandler.remove(this.inputElement,"content-changed",this.contentChanged),j.EventHandler.remove(this.inputElement,j.Browser.touchEndEvent,this.mouseDownDebListener),this.mouseDownDebListener=null,j.EventHandler.remove(this.inputElement,j.Browser.touchStartEvent,this.mouseDownHandler),j.EventHandler.remove(this.inputElement,"input",this.inputHandler),j.EventHandler.remove(document,"mousedown",this.onDocumentClick),this.unWireContextEvent(),this.formatter&&this.formatter.editorManager.observer.off(u,this.editorKeyDown),this.element.ownerDocument.defaultView.removeEventListener("resize",this.onResizeHandler,!0),this.onResizeHandler=null,this.iframeSettings.enable&&(j.EventHandler.remove(this.inputElement,"focusin",this.focusHandler),j.EventHandler.remove(this.inputElement,"focusout",this.blurHandler),j.EventHandler.remove(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler),j.EventHandler.remove(this.inputElement.ownerDocument,j.Browser.touchStartEvent,this.onIframeMouseDown),j.EventHandler.remove(this.contentModule.getPanel(),"load",this.iframeLoadHandler)),this.unWireScrollElementsEvents()},B.prototype.getCurrentFocus=function(e){return e.target===this.inputElement&&document.activeElement===this.inputElement?"editArea":e.target===this.getToolbarElement()||!j.isNullOrUndefined(e.relatedTarget)&&j.closest(e.relatedTarget,".e-rte-toolbar")===this.getToolbarElement()?"toolbar":e.target===this.valueContainer&&document.activeElement===this.valueContainer?"textArea":!j.isNullOrUndefined(e.target)&&e.target.classList.contains(Do)&&document.activeElement===e.target?"sourceCode":"outside"},B.prototype.resetToolbarTabIndex=function(){if(this.getToolbarElement())for(var e=this.getToolbarElement().querySelectorAll("input,select,button,a,[tabindex]"),t=0;t<e.length;t++)e[t].classList.contains("e-rte-dropdown-btn")||e[t].classList.contains("e-insert-table-btn")||e[t].hasAttribute("tabindex")&&"-1"===e[t].getAttribute("tabindex")||e[t].setAttribute("tabindex","-1")},B.prototype.removeSelectionClassStates=function(e){for(var t=[po,Qi,Ki,Wi,uo,ho],n=0;n<t.length;n++){var i=e.querySelectorAll("."+t[n]);if(j.removeClass(i,t[n]),0!==i.length)for(var o=0;o<i.length;o++)0===i[o].classList.length&&i[o].removeAttribute("class"),"IMG"===i[o].nodeName&&""!==i[o].style.outline&&(i[o].style.outline="")}},B.prototype.getRenderedQuickToolbarElem=function(){for(var e=this.quickToolbarModule.getQuickToolbarInstance(),t=0;t<e.length;t++)if(e[t]&&e[t].isRendered)return e[t].element;return null},B.prototype.iframeLoadHandler=function(){this.autoResize()},B.prototype.iframeEditableElemLoad=function(){this.autoResize()},M([j.Complex({},e)],B.prototype,"toolbarSettings",void 0),M([j.Complex({enable:!1,items:["Paragraph","Heading 1","Heading 2","Heading 3","Heading 4","OrderedList","UnorderedList","CodeBlock","Blockquote"],popupWidth:"300px",popupHeight:"320px"},wl)],B.prototype,"slashMenuSettings",void 0),M([j.Complex({},$c)],B.prototype,"quickToolbarSettings",void 0),M([j.Complex({},sp)],B.prototype,"pasteCleanupSettings",void 0),M([j.Complex({},tp)],B.prototype,"formatPainterSettings",void 0),M([j.Complex({},lr)],B.prototype,"emojiPickerSettings",void 0),M([j.Complex({},D)],B.prototype,"iframeSettings",void 0),M([j.Complex({},Pc)],B.prototype,"insertImageSettings",void 0),M([j.Complex({},wc)],B.prototype,"importWord",void 0),M([j.Complex({},Mc)],B.prototype,"exportWord",void 0),M([j.Complex({},Ac)],B.prototype,"exportPdf",void 0),M([j.Complex({},Fc)],B.prototype,"insertAudioSettings",void 0),M([j.Complex({},_c)],B.prototype,"insertVideoSettings",void 0),M([j.Complex({},Xc)],B.prototype,"tableSettings",void 0),M([j.Property(0)],B.prototype,"floatingToolbarOffset",void 0),M([j.Complex({},wp)],B.prototype,"inlineMode",void 0),M([j.Complex({},Wc)],B.prototype,"fileManagerSettings",void 0),M([j.Property("100%")],B.prototype,"width",void 0),M([j.Property(!1)],B.prototype,"enablePersistence",void 0),M([j.Property(!0)],B.prototype,"showTooltip",void 0),M([j.Property(!1)],B.prototype,"enableResize",void 0),M([j.Property({})],B.prototype,"htmlAttributes",void 0),M([j.Property(null)],B.prototype,"placeholder",void 0),M([j.Property(!1)],B.prototype,"autoSaveOnIdle",void 0),M([j.Property(!1)],B.prototype,"readonly",void 0),M([j.Property(!0)],B.prototype,"enabled",void 0),M([j.Property(!0)],B.prototype,"enableHtmlSanitizer",void 0),M([j.Property(!1)],B.prototype,"enableHtmlEncode",void 0),M([j.Property(!1)],B.prototype,"enableXhtml",void 0),M([j.Property("auto")],B.prototype,"height",void 0),M([j.Property(null)],B.prototype,"cssClass",void 0),M([j.Property(null)],B.prototype,"value",void 0),M([j.Property("P")],B.prototype,"enterKey",void 0),M([j.Property("BR")],B.prototype,"shiftEnterKey",void 0),M([j.Property(30)],B.prototype,"undoRedoSteps",void 0),M([j.Property(300)],B.prototype,"undoRedoTimer",void 0),M([j.Property("HTML")],B.prototype,"editorMode",void 0),M([j.Property(null)],B.prototype,"keyConfig",void 0),M([j.Property(!1)],B.prototype,"showCharCount",void 0),M([j.Property(!1)],B.prototype,"enableTabKey",void 0),M([j.Property(!1)],B.prototype,"enableAutoUrl",void 0),M([j.Property(-1)],B.prototype,"maxLength",void 0),M([j.Complex({},mp)],B.prototype,"format",void 0),M([j.Complex({},Np)],B.prototype,"numberFormatList",void 0),M([j.Complex({},Oc)],B.prototype,"bulletFormatList",void 0),M([j.Complex({},dp)],B.prototype,"fontFamily",void 0),M([j.Complex({},er)],B.prototype,"fontSize",void 0),M([j.Complex({},nr)],B.prototype,"fontColor",void 0),M([j.Complex({},ir)],B.prototype,"backgroundColor",void 0),M([j.Property(null)],B.prototype,"valueTemplate",void 0),M([j.Property(1e4)],B.prototype,"saveInterval",void 0),M([j.Event()],B.prototype,"actionBegin",void 0),M([j.Event()],B.prototype,"actionComplete",void 0),M([j.Event()],B.prototype,"beforeDialogOpen",void 0),M([j.Event()],B.prototype,"dialogOpen",void 0),M([j.Event()],B.prototype,"beforeDialogClose",void 0),M([j.Event()],B.prototype,"dialogClose",void 0),M([j.Event()],B.prototype,"beforeQuickToolbarOpen",void 0),M([j.Event()],B.prototype,"quickToolbarOpen",void 0),M([j.Event()],B.prototype,"quickToolbarClose",void 0),M([j.Event()],B.prototype,"toolbarStatusUpdate",void 0),M([j.Event()],B.prototype,"updatedToolbarStatus",void 0),M([j.Event()],B.prototype,"imageSelected",void 0),M([j.Event()],B.prototype,"beforeImageUpload",void 0),M([j.Event()],B.prototype,"imageUploading",void 0),M([j.Event()],B.prototype,"imageUploadSuccess",void 0),M([j.Event()],B.prototype,"imageUploadFailed",void 0),M([j.Event()],B.prototype,"imageRemoving",void 0),M([j.Event()],B.prototype,"afterImageDelete",void 0),M([j.Event()],B.prototype,"fileSelected",void 0),M([j.Event()],B.prototype,"beforeFileUpload",void 0),M([j.Event()],B.prototype,"fileUploading",void 0),M([j.Event()],B.prototype,"fileUploadSuccess",void 0),M([j.Event()],B.prototype,"fileUploadFailed",void 0),M([j.Event()],B.prototype,"fileRemoving",void 0),M([j.Event()],B.prototype,"afterMediaDelete",void 0),M([j.Event()],B.prototype,"created",void 0),M([j.Event()],B.prototype,"destroyed",void 0),M([j.Event()],B.prototype,"beforeSanitizeHtml",void 0),M([j.Event()],B.prototype,"blur",void 0),M([j.Event()],B.prototype,"toolbarClick",void 0),M([j.Event()],B.prototype,"focus",void 0),M([j.Event()],B.prototype,"change",void 0),M([j.Event()],B.prototype,"resizing",void 0),M([j.Event()],B.prototype,"resizeStart",void 0),M([j.Event()],B.prototype,"resizeStop",void 0),M([j.Event()],B.prototype,"beforePasteCleanup",void 0),M([j.Event()],B.prototype,"afterPasteCleanup",void 0),M([j.Event()],B.prototype,"beforeImageDrop",void 0),M([j.Property(null)],B.prototype,"formatter",void 0),M([j.Event()],B.prototype,"slashMenuItemSelect",void 0),M([j.NotifyPropertyChanges],B));function B(e,t){e=Hp.call(this,e,t)||this;return e.isPlainPaste=!1,e.needsID=!0,e.isCopyAll=!1,e}m.ACTION=_s,m.ALIGNMENT_TYPE=ps,m.ALLOWED_ACTIONKEYS=Mo,m.ALLOWED_TABLE_BLOCK_TAGS=Ss,m.AUDIO=Gr,m.Alignments=fa,m.Audio=El,m.AudioCommand=Va,m.BLOCKQUOTE_LIST_HANDLE=ta,m.BLOCK_TAGS=ms,m.BaseQuickToolbar=sd,m.BaseToolbar=$l,m.CLASS_AUDIO=Aa,m.CLASS_AUDIO_BREAK=ka,m.CLASS_AUDIO_FOCUS=ja,m.CLASS_AUDIO_INLINE=Ma,m.CLASS_AUDIO_WRAP=Ua,m.CLASS_CAPTION=l,m.CLASS_CAPTION_INLINE=xa,m.CLASS_CLICK_ELEM=Ba,m.CLASS_EMBED_VIDEO_WRAP=Ha,m.CLASS_IMAGE_BREAK=La,m.CLASS_IMAGE_CENTER=Ea,m.CLASS_IMAGE_INLINE=Da,m.CLASS_IMAGE_LEFT=Na,m.CLASS_IMAGE_RIGHT=Ca,m.CLASS_RTE_CAPTION="e-rte-img-caption",m.CLASS_VIDEO=Ia,m.CLASS_VIDEO_BREAK=wa,m.CLASS_VIDEO_CENTER=Oa,m.CLASS_VIDEO_CLICK_ELEM=Ra,m.CLASS_VIDEO_FOCUS=Fa,m.CLASS_VIDEO_INLINE=qa,m.CLASS_VIDEO_LEFT=Ta,m.CLASS_VIDEO_RIGHT=Sa,m.CLASS_VIDEO_WRAP=Pa,m.CLEAR_COMMAND=Ed,m.CLEAR_TYPE=Cs,m.CLS_ACTIVE=Si,m.CLS_ALIGN_TB_BTN=Ii,m.CLS_AUDIOBREAK=ai,m.CLS_AUDIOINLINE=bi,m.CLS_AUDIOWRAP=ci,m.CLS_AUD_FOCUS=ho,m.CLS_BACK="e-back",m.CLS_BACKGROUND_COLOR_DROPDOWN=Fi,m.CLS_BACKGROUND_COLOR_PICKER=_i,m.CLS_BACKGROUND_COLOR_TARGET=Pi,m.CLS_BULLETFORMATLIST_TB_BTN=Mi,m.CLS_CAPINLINE=gi,m.CLS_CAPTION=ui,m.CLS_CLICKELEM=li,m.CLS_COLOR_CONTENT=Hi,m.CLS_COLOR_PALETTE=qi,m.CLS_CONTENT="e-content",m.CLS_COUNT=yi,m.CLS_CUSTOM_TILE=So,m.CLS_DISABLED=On,m.CLS_DROPAREA=vo,m.CLS_DROPDOWN_BTN=Gn,m.CLS_DROPDOWN_ICONS=Wn,m.CLS_DROPDOWN_ITEMS=Kn,m.CLS_DROPDOWN_POPUP=Qn,m.CLS_ERROR=Ni,m.CLS_EXPAND_OPEN=Ti,m.CLS_FOCUS=ti,m.CLS_FONT_COLOR_DROPDOWN=ji,m.CLS_FONT_COLOR_PICKER=zi,m.CLS_FONT_COLOR_TARGET=Ui,m.CLS_FONT_NAME_TB_BTN=Ri,m.CLS_FONT_SIZE_TB_BTN=Ai,m.CLS_FORMATS_TB_BTN=Bi,m.CLS_FULL_SCREEN=An,m.CLS_HIDE=Zn,m.CLS_HR_SEPARATOR=ki,m.CLS_ICONS=Ei,m.CLS_IMAGE_POP=qn,m.CLS_IMGBREAK=si,m.CLS_IMGCENTER=ri,m.CLS_IMGINLINE=fi,m.CLS_IMGLEFT=oi,m.CLS_IMGRIGHT=ii,m.CLS_IMG_FOCUS=po,m.CLS_IMG_INNER=yo,m.CLS_IMG_RESIZE=bo,m.CLS_INLINE=Bn,m.CLS_INLINE_DROPDOWN=Vn,m.CLS_INLINE_POP=_n,m.CLS_LIST_PRIMARY_CONTENT=xi,m.CLS_MAXIMIZE="e-maximize",m.CLS_MINIMIZE="e-minimize",m.CLS_NOCOLOR_ITEM=To,m.CLS_NUMBERFORMATLIST_TB_BTN=Di,m.CLS_POP=Pn,m.CLS_POPUP="e-popup",m.CLS_POPUP_OPEN=fo,m.CLS_QUICK_DROPDOWN=Fn,m.CLS_QUICK_POP=jn,m.CLS_QUICK_TB=In,m.CLS_RESIZE=co,m.CLS_RM_WHITE_SPACE=ni,m.CLS_RTE=Sn,m.CLS_RTE_CAPTION=mi,m.CLS_RTE_CONTAINER=wn,m.CLS_RTE_CONTENT=Xn,m.CLS_RTE_DIALOG_MIN_HEIGHT=ro,m.CLS_RTE_DIALOG_UPLOAD=No,m.CLS_RTE_DRAG_IMAGE=mo,m.CLS_RTE_ELEMENTS=Oi,m.CLS_RTE_EXPAND_TB=Rn,m.CLS_RTE_FIXED_TB_EXPAND=ko,m.CLS_RTE_HIDDEN=Zi,m.CLS_RTE_IMAGE=lo,m.CLS_RTE_PASTE_CANCEL=oo,m.CLS_RTE_PASTE_KEEP_FORMAT=eo,m.CLS_RTE_PASTE_OK=io,m.CLS_RTE_PASTE_PLAIN_FORMAT=no,m.CLS_RTE_PASTE_REMOVE_FORMAT=to,m.CLS_RTE_READONLY=Vi,m.CLS_RTE_RES_CNT=Eo,m.CLS_RTE_RES_EAST=ao,m.CLS_RTE_RES_HANDLE=so,m.CLS_RTE_RES_WEST=xo,m.CLS_RTE_SOURCE_CODE_TXTAREA=Do,m.CLS_RTE_TABLE_RESIZE=Lo,m.CLS_RTE_TB_ENABLED=wo,m.CLS_RTE_UPLOAD_POPUP=go,m.CLS_RTL=Tn,m.CLS_SCRIPT_SHEET=Ln,m.CLS_SEPARATOR="e-separator",m.CLS_SHOW=$n,m.CLS_STYLE_SHEET=kn,m.CLS_TABLE="e-rte-table",m.CLS_TABLE_BORDER=Oo,m.CLS_TABLE_MULTI_CELL=Ki,m.CLS_TABLE_SEL=Qi,m.CLS_TABLE_SEL_END=Wi,m.CLS_TB_ALT_BOR=Xi,m.CLS_TB_BOX_RES=$i,m.CLS_TB_BTN=Li,m.CLS_TB_COL_RES=Yi,m.CLS_TB_DASH_BOR=Gi,m.CLS_TB_EXTENDED="e-toolbar-extended",m.CLS_TB_FIXED=Dn,m.CLS_TB_FLOAT=Mn,m.CLS_TB_INLINE="e-rte-tb-inline",m.CLS_TB_IOS_FIX=wi,m.CLS_TB_ITEM=Yn,m.CLS_TB_ROW_RES=Ji,m.CLS_TB_STATIC=Hn,m.CLS_TB_WRAP=Jn,m.CLS_TEXT_POP=zn,m.CLS_TEXT_QUICK_TB=Un,m.CLS_TOOLBAR=xn,m.CLS_UPLOAD_FILES=Co,m.CLS_VIDEOBREAK=hi,m.CLS_VIDEOINLINE=vi,m.CLS_VIDEOWRAP=pi,m.CLS_VID_CLICK_ELEM=di,m.CLS_VID_FOCUS=uo,m.CLS_VISIBLE=ei,m.CLS_WARNING=Ci,m.ClearFormat=Pd,m.ClearFormatExec=il,m.ColorPickerInput=id,m.ContentRender=zr,m.Count=dd,m.DEFAULT_TAG=us,m.DELETECOLUMN=ts,m.DELETEROW=es,m.DESTROY=oa,m.DOMNode=qs,m.DialogRenderer=Al,m.DropDownButtons=ed,m.EMOJI_PICKER_ACTIONS=na,m.EditorManager=ul,m.EmojiPicker=mc,m.EmojiPickerAction=cl,m.ExecCommandCallBack=gd,m.FORMAT_PAINTER_ACTIONS=ea,m.FORMAT_TYPE=Vs,m.FileManager=ac,m.FormatPainter=hc,m.FormatPainterActions=hl,m.Formats=pa,m.Formatter=bd,m.FullScreen=dc,m.HTMLFormatter=Jd,m.HtmlEditor=ic,m.HtmlToolbarStatus=Zd,m.IGNORE_BLOCK_TAGS=gs,m.IMAGE=Kr,m.INDENT_TYPE=hs,m.INSERTHTML_TYPE=vs,m.INSERT_COLUMN=Zr,m.INSERT_ROW=$r,m.INSERT_TEXT_COMMAND=Td,m.INSERT_TEXT_TYPE=ys,m.INTERNAL_DESTROY=r,m.IframeContentRender=jl,m.Image=Nl,m.ImageCommand=za,m.ImportExport=fc,m.Indents=va,m.InsertHtml=la,m.InsertHtmlExec=Za,m.InsertMethods=F,m.InsertTextExec=ll,m.IsFormatted=Wr,m.KEY_DOWN=zs,m.KEY_DOWN_HANDLER=u,m.KEY_UP=Ks,m.KEY_UP_HANDLER=Ws,m.KeyboardEvents=Dl,m.LINK=Jr,m.LINK_COMMAND=Nd,m.LISTS_COMMAND=yd,m.LIST_TYPE=Qs,m.Link=Cl,m.LinkCommand=ma,m.Lists=ca,m.MDFormats=kd,m.MDLink=Rd,m.MDLists=Od,m.MDSelectionFormats=xd,m.MDTable=Id,m.MD_TABLE=Sd,m.MODEL_CHANGED=Xs,m.MODEL_CHANGED_PLUGIN=Gs,m.MOUSE_DOWN=ia,m.MS_WORD_CLEANUP=Js,m.MS_WORD_CLEANUP_PLUGIN=Ys,m.MarkdownEditor=Kd,m.MarkdownFormatter=Qd,m.MarkdownParser=qd,m.MarkdownRender=ql,m.MarkdownSelection=pd,m.MarkdownToolbarStatus=ud,m.MsWordPaste=al,m.NodeCutter=sa,m.NodeSelection=gl,m.ON_BEGIN=$s,m.PASTE_SOURCE=Es,m.PasteCleanup=oc,m.PopupRenderer=_l,m.QuickToolbar=ld,m.REMOVETABLE=ns,m.Render=Vr,m.RendererFactory=Nc,m.Resize=rc,m.RichTextEditor=kp,m.SELECTION_TYPE=bs,m.SELF_CLOSING_TAGS=Ns,m.SPACE_ACTION=Zs,m.SelectionBasedExec=Ja,m.SelectionCommands=Ya,m.ServiceLocator=yc,m.SlashMenu=Kl,m.TABLE=Yr,m.TABLEHEADER=is,m.TABLE_ALTERNATE=ds,m.TABLE_BLOCK_TAGS=fs,m.TABLE_DASHED=ls,m.TABLE_HORIZONTAL_SPLIT=as,m.TABLE_MERGE=rs,m.TABLE_MOVE=cs,m.TABLE_VERTICAL_ALIGN=os,m.TABLE_VERTICAL_SPLIT=ss,m.Table=kl,m.TableCommand=Ga,m.Toolbar=rd,m.ToolbarAction=td,m.ToolbarRenderer=yl,m.ToolbarStatus=bl,m.UndoRedoCommands=Md,m.UndoRedoManager=rl,m.VIDEO=Xr,m.Video=Sl,m.VideoCommand=Wa,m.ViewSource=Bl,m.XhtmlValidation=tc,m.actionBegin=Le,m.actionComplete=ke,m.actionSuccess="actionSuccess",m.afterImageDelete=Rt,m.afterKeyDown=pn,m.afterMediaDelete=At,m.afterPasteCleanup=Qt,m.audioDelete=Pe,m.audioToolbarAction=ge,m.autoResize=fn,m.beforeDialogClose=vt,m.beforeDialogOpen=gt,m.beforeDropDownItemRender=he,m.beforeDropDownOpen=Ve,m.beforeFileUpload=jt,m.beforeImageDrop=zt,m.beforeImageUpload=Ht,m.beforePasteCleanup=Vt,m.beforeQuickToolbarOpen=Ct,m.bindCssClass=on,m.bindOnEnd=$,m.blockEmptyNodes=bn,m.checkUndo=pt,m.cleanupResizeElements=cn,m.clearDialogObj=ft,m.closeAudioDialog=Zt,m.closeImageDialog=$t,m.closeLinkDialog=Gt,m.closeTableDialog=nn,m.closeTooltip=gn,m.closeVideoDialog=en,m.colorPickerChanged=Ze,m.contentBlur="contentBlur",m.contentChanged=W,m.contentFocus="contentFocus",m.contentscroll=$e,m.conversionFactors=Cn,m.convertToBlob=jr,m.count=Ke,m.createTable=lt,m.created="create",m.decode=Ur,m.destroy=o,m.destroyTooltip=ln,m.destroyed="destroy",m.dialogClose=yt,m.dialogOpen=bt,m.disableFullScreen=ce,m.dispatchEvent=wr,m.docClick=dt,m.documentClickClosedBy=un,m.drop=It,m.dropDownSelect=pe,m.dynamicModule=_t,m.editAreaClick=Ye,m.editLink=Te,m.emojiPicker=an,m.enableFullScreen=de,m.enterHandler=mt,m.execCommandCallBack=ue,m.executeGroup=vc,m.expandPopupClick="expandPopupClick",m.fileRemoving=Bt,m.fileSelected=wt,m.fileUploadFailed=Mt,m.fileUploadSuccess=Dt,m.fileUploading=xt,m.focusChange=tt,m.formatPainterClick=rn,m.formatPainterDoubleClick=sn,m.getCollection=Or,m.getDefaultValue=Ar,m.getDropDownValue=yr,m.getEditValue=Br,m.getFormattedFontSize=Nr,m.getIndex=vr,m.getLocaleFontFormat=Fr,m.getSelectedHtml=ot,m.getTBarItemsIndex=Lr,m.getTextNodesUnder=Dr,m.getTooltipText=Sr,m.hasClass=p,m.hidePopup=dn,m.htmlKeyConfig=ks,m.htmlToolbarClick=Z,m.iframeMouseDown=K,m.imageAlt=Ie,m.imageBreak="break",m.imageCaption=je,m.imageCenter="justifyCenter",m.imageDelete=Ue,m.imageInline="inline",m.imageLeft="justifyLeft",m.imageLink=Ae,m.imageRemoving=kt,m.imageResizeFactor=Ms,m.imageRight="justifyRight",m.imageSelected=St,m.imageSize=Fe,m.imageToolbarAction=me,m.imageUploadFailed=Lt,m.imageUploadSuccess=Ot,m.imageUploading=Tt,m.imgModule="imageModule",m.initialEnd=n,m.initialLoad=Q,m.inlineEmptyNodes=vn,m.insertAudio=Me,m.insertCompleted=Re,m.insertImage=De,m.insertLink=Ee,m.insertVideo=Be,m.isEditableValueEmpty=Ir,m.isIDevice=Cr,m.keyDown=h,m.keyUp=ie,m.linkToolbarAction=be,m.listConversionFilters={first:"MsoListParagraphCxSpFirst",middle:"MsoListParagraphCxSpMiddle",last:"MsoListParagraphCxSpLast"},m.load=V,m.markdownFormatTags=Ts,m.markdownKeyConfig=ws,m.markdownListsTags=Ls,m.markdownSelectionTags=Os,m.markdownToolbarClick=ee,m.markerClassName=w,m.mentionRestrictKeys=Bs,m.modelChanged=te,m.mouseDown=Ge,m.mouseUp=se,m.onExport=re,m.onHandleFontsizeChange=Nn,m.onImport=oe,m.onResize=Ce,m.openLink=Oe,m.pageYOffset=Er,m.parseHelper=Hr,m.parseHtml=xr,m.paste=st,m.pasteClean=ut,m.pasteCleanupGroupingTags=xs,m.popupHide="popupHide",m.preventQuickToolbarClose=En,m.quickToolbarClose=Et,m.quickToolbarOpen=Nt,m.readOnlyMode=ht,m.redo="redo",m.refreshBegin=Y,m.renderFileManager=qt,m.renderInlineToolbar=rt,m.renderQuickToolbar=Ut,m.resizeInitialized=Ft,m.resizeStart=ye,m.resizeStop=Ne,m.rtlMode=at,m.sanitizeHelper=Pr,m.scroll=Je,m.selectAll=nt,m.selectRange=it,m.selectionCommand=Cd,m.selectionRestore=We,m.selectionSave=Qe,m.selfClosingTags=Ds,m.setAttributes=pc,m.setToolbarStatus=Tr,m.showAudioDialog=Yt,m.showColorPicker=mn,m.showImageDialog=Xt,m.showLinkDialog=Kt,m.showTableDialog=tn,m.showVideoDialog=Jt,m.sourceCode=ze,m.sourceCodeMouseDown=Xe,m.statusCollection=fl,m.supportedUnits=yn,m.tableColorPickerChanged=et,m.tableModulekeyUp=ne,m.tableToolbarAction=ct,m.tableclass=_,m.toObjectLowerCase=Mr,m.toolbarClick=G,m.toolbarCreated=ae,m.toolbarOpen="toolbarOpen",m.toolbarRefresh=X,m.toolbarRenderComplete=le,m.toolbarUpdated=J,m.unLink=Se,m.undo="undo",m.updateDropDownFontFormatLocale=qr,m.updateSource=_e,m.updateTbItemsStatus=Wt,m.updateTextNode=Rr,m.updateToolbarItem=xe,m.updateUndoRedoStatus=kr,m.updateValueOnIdle=hn,m.updatedToolbarStatus=we,m.videoDelete=He,m.videoSize=qe,m.videoToolbarAction=fe,m.windowResize=ve,m.xhtmlValidation=Pt,Object.defineProperty(m,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-richtexteditor.umd.min.js.map
